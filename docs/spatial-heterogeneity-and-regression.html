<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Spatial heterogeneity and regression | Crime Mapping and Spatial Data Analysis using R</title>
  <meta name="description" content="Chapter 13 Spatial heterogeneity and regression | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Spatial heterogeneity and regression | Crime Mapping and Spatial Data Analysis using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapter 13 Spatial heterogeneity and regression | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="github-repo" content="maczokni/crime_mapping" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Spatial heterogeneity and regression | Crime Mapping and Spatial Data Analysis using R" />
  
  <meta name="twitter:description" content="Chapter 13 Spatial heterogeneity and regression | Crime Mapping and Spatial Data Analysis using R" />
  

<meta name="author" content="Juanjo Medina and Reka Solymosi" />


<meta name="date" content="2022-09-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial-regression-models.html"/>
<link rel="next" href="appendix-a-quick-intro-to-r-and-rstudio.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet/leaflet.js"></script>
<link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4/proj4.min.js"></script>
<script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding/leaflet.js"></script>
<script src="libs/leaflet-providers/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
<script src="libs/burglary_raster_cc_9107d3/data_stars_burglary_raster_cc983ce5.txt"></script>
<script src="libs/joda/joda.js"></script>
<script src="libs/joda/addImageQuery-bindings.js"></script>
<script src="libs/clipboard/setClipboardText.js"></script>
<link href="libs/HomeButton/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton/home-button.js"></script>
<script src="libs/HomeButton/easy-button-src.min.js"></script>
<link href="libs/mapviewCSS/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS/mapview.css" rel="stylesheet" />
<script src="libs/Leaflet.Sync/L.Map.Sync.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Crime Mapping and Spatial Data Analysis using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble: how to use this book</a></li>
<li class="chapter" data-level="2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html"><i class="fa fa-check"></i><b>2</b> Producing your first crime map</a>
<ul>
<li class="chapter" data-level="2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#geospatial-perspective-key-terms-and-ideas"><i class="fa fa-check"></i><b>2.2</b> Geospatial Perspective: key terms and ideas</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#place"><i class="fa fa-check"></i><b>2.2.1</b> Place</a></li>
<li class="chapter" data-level="2.2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#attributes"><i class="fa fa-check"></i><b>2.2.2</b> Attributes</a></li>
<li class="chapter" data-level="2.2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#spatial-objects"><i class="fa fa-check"></i><b>2.2.3</b> Spatial objects</a></li>
<li class="chapter" data-level="2.2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#networks"><i class="fa fa-check"></i><b>2.2.4</b> Networks</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#maps-and-their-types"><i class="fa fa-check"></i><b>2.3</b> Maps and their types</a></li>
<li class="chapter" data-level="2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#map-projections-and-geographic-coordinate-systems"><i class="fa fa-check"></i><b>2.4</b> Map projections and geographic coordinate systems</a></li>
<li class="chapter" data-level="2.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#key-terms-summary"><i class="fa fa-check"></i><b>2.5</b> Key terms summary</a></li>
<li class="chapter" data-level="2.6" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#getting-started-with-crime-data"><i class="fa fa-check"></i><b>2.6</b> Getting started with crime data</a></li>
<li class="chapter" data-level="2.7" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#from-dataframes-to-spatial-objects"><i class="fa fa-check"></i><b>2.7</b> From dataframes to spatial objects</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-point"><i class="fa fa-check"></i><b>2.7.1</b> The point</a></li>
<li class="chapter" data-level="2.7.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-line"><i class="fa fa-check"></i><b>2.7.2</b> The line</a></li>
<li class="chapter" data-level="2.7.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-polygon"><i class="fa fa-check"></i><b>2.7.3</b> The polygon</a></li>
<li class="chapter" data-level="2.7.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#choosing-the-ideal-unit-of-analysis"><i class="fa fa-check"></i><b>2.7.4</b> Choosing the ideal unit of analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-simple-features-framework"><i class="fa fa-check"></i><b>2.8</b> The simple features framework</a></li>
<li class="chapter" data-level="2.9" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#plotting-data-with-ggplot2"><i class="fa fa-check"></i><b>2.9</b> Plotting data with ggplot2</a></li>
<li class="chapter" data-level="2.10" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-points"><i class="fa fa-check"></i><b>2.10</b> Mapping crime data as points</a></li>
<li class="chapter" data-level="2.11" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-polygons"><i class="fa fa-check"></i><b>2.11</b> Mapping crime data as polygons</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#finding-boundary-data"><i class="fa fa-check"></i><b>2.11.1</b> Finding boundary data</a></li>
<li class="chapter" data-level="2.11.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#reading-shapefiles-into-r"><i class="fa fa-check"></i><b>2.11.2</b> Reading shapefiles into R</a></li>
<li class="chapter" data-level="2.11.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>2.11.3</b> Data wrangling with dplyr</a></li>
<li class="chapter" data-level="2.11.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#join-data-to-sf-object"><i class="fa fa-check"></i><b>2.11.4</b> Join data to sf object</a></li>
<li class="chapter" data-level="2.11.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#putting-polygon-data-on-the-map"><i class="fa fa-check"></i><b>2.11.5</b> Putting polygon data on the map</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#summary-and-further-reading"><i class="fa fa-check"></i><b>2.12</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html"><i class="fa fa-check"></i><b>3</b> Basic geospatial operations in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#exploring-the-relationship-between-alcohol-outlets-and-crime"><i class="fa fa-check"></i><b>3.2</b> Exploring the relationship between alcohol outlets and crime</a></li>
<li class="chapter" data-level="3.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#acquiring-relevant-data"><i class="fa fa-check"></i><b>3.3</b> Acquiring relevant data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#reading-in-crime-data"><i class="fa fa-check"></i><b>3.3.1</b> Reading in crime data</a></li>
<li class="chapter" data-level="3.3.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#meet-a-new-format-geojson"><i class="fa fa-check"></i><b>3.3.2</b> Meet a new format: geoJSON</a></li>
<li class="chapter" data-level="3.3.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#open-street-map-and-points-of-interest"><i class="fa fa-check"></i><b>3.3.3</b> Open Street Map and points of interest</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#attribute-operations"><i class="fa fa-check"></i><b>3.4</b> Attribute operations</a></li>
<li class="chapter" data-level="3.5" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#spatial-operations"><i class="fa fa-check"></i><b>3.5</b> Spatial operations</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#reprojecting-coordinates"><i class="fa fa-check"></i><b>3.5.1</b> Reprojecting coordinates</a></li>
<li class="chapter" data-level="3.5.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#subsetting-points"><i class="fa fa-check"></i><b>3.5.2</b> Subsetting points</a></li>
<li class="chapter" data-level="3.5.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#building-buffers"><i class="fa fa-check"></i><b>3.5.3</b> Building buffers</a></li>
<li class="chapter" data-level="3.5.4" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#counting-points-within-a-polygon"><i class="fa fa-check"></i><b>3.5.4</b> Counting Points within a Polygon</a></li>
<li class="chapter" data-level="3.5.5" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#distances-finding-the-nearest-point"><i class="fa fa-check"></i><b>3.5.5</b> Distances: Finding the nearest point</a></li>
<li class="chapter" data-level="3.5.6" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#measuring-distances"><i class="fa fa-check"></i><b>3.5.6</b> Measuring distances</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#plotting-interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>3.6</b> Plotting interactive maps with leaflet</a></li>
<li class="chapter" data-level="3.7" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#geocoding"><i class="fa fa-check"></i><b>3.7</b> Geocoding</a></li>
<li class="chapter" data-level="3.8" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#measuring-distance-more-thoroughly"><i class="fa fa-check"></i><b>3.8</b> Measuring distance more thoroughly</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#how-far-are-police-stations-in-madrid"><i class="fa fa-check"></i><b>3.8.1</b> How far are police stations in Madrid?</a></li>
<li class="chapter" data-level="3.8.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#distance-in-geographical-space"><i class="fa fa-check"></i><b>3.8.2</b> Distance in geographical space</a></li>
<li class="chapter" data-level="3.8.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#a-practical-example-to-evaluate-distance"><i class="fa fa-check"></i><b>3.8.3</b> A practical example to evaluate distance</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#summary-and-further-reading-1"><i class="fa fa-check"></i><b>3.9</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html"><i class="fa fa-check"></i><b>4</b> Mapping rates and counts</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#thematic-maps-key-terms-and-ideas"><i class="fa fa-check"></i><b>4.2</b> Thematic maps: key terms and ideas</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#choropleth-maps"><i class="fa fa-check"></i><b>4.2.1</b> Choropleth maps</a></li>
<li class="chapter" data-level="4.2.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#what-do-we-use-choropleth-maps-for"><i class="fa fa-check"></i><b>4.2.2</b> What do we use choropleth maps for?</a></li>
<li class="chapter" data-level="4.2.3" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#proportional-and-graduate-symbol-maps-mapping-crime-counts"><i class="fa fa-check"></i><b>4.2.3</b> Proportional and graduate symbol maps: mapping crime counts</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#creating-proportional-symbol-maps"><i class="fa fa-check"></i><b>4.3</b> Creating proportional symbol maps</a></li>
<li class="chapter" data-level="4.4" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#mapping-rates-rather-than-counts"><i class="fa fa-check"></i><b>4.4</b> Mapping rates rather than counts</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#generating-the-rates"><i class="fa fa-check"></i><b>4.4.1</b> Generating the rates</a></li>
<li class="chapter" data-level="4.4.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#creating-a-choropleth-map-with-tmap"><i class="fa fa-check"></i><b>4.4.2</b> Creating a choropleth map with tmap</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#classification-systems-for-thematic-maps"><i class="fa fa-check"></i><b>4.5</b> Classification systems for thematic maps</a></li>
<li class="chapter" data-level="4.6" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#interactive-mapping-with-tmap"><i class="fa fa-check"></i><b>4.6</b> Interactive mapping with tmap</a></li>
<li class="chapter" data-level="4.7" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#smoothing-rates-adjusting-for-small-sample-noise"><i class="fa fa-check"></i><b>4.7</b> Smoothing rates: adjusting for small sample noise</a></li>
<li class="chapter" data-level="4.8" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#summary-and-further-reading-2"><i class="fa fa-check"></i><b>4.8</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html"><i class="fa fa-check"></i><b>5</b> Variations of thematic mapping</a>
<ul>
<li class="chapter" data-level="5.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#binning-points"><i class="fa fa-check"></i><b>5.2</b> Binning points</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#the-binning-process"><i class="fa fa-check"></i><b>5.2.1</b> The Binning Process</a></li>
<li class="chapter" data-level="5.2.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#different-binning-techniques"><i class="fa fa-check"></i><b>5.2.2</b> Different Binning Techniques</a></li>
<li class="chapter" data-level="5.2.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#benefits-of-binning"><i class="fa fa-check"></i><b>5.2.3</b> Benefits of Binning</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#transforming-polygons-cartograms"><i class="fa fa-check"></i><b>5.3</b> Transforming polygons: cartograms</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#dorling-cartogram"><i class="fa fa-check"></i><b>5.3.1</b> Dorling Cartogram</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#bivariate-maps"><i class="fa fa-check"></i><b>5.4</b> Bivariate Maps</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-1-bin-our-variables-of-interest"><i class="fa fa-check"></i><b>5.4.1</b> Step 1: Bin our variables of interest</a></li>
<li class="chapter" data-level="5.4.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-2-new-variable"><i class="fa fa-check"></i><b>5.4.2</b> Step 2: New variable</a></li>
<li class="chapter" data-level="5.4.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-3-create-colour-scheme"><i class="fa fa-check"></i><b>5.4.3</b> Step 3: Create colour scheme</a></li>
<li class="chapter" data-level="5.4.4" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-4-join-colour-scheme"><i class="fa fa-check"></i><b>5.4.4</b> Step 4: Join colour scheme</a></li>
<li class="chapter" data-level="5.4.5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-5-create-legend"><i class="fa fa-check"></i><b>5.4.5</b> Step 5: Create legend</a></li>
<li class="chapter" data-level="5.4.6" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-6-map"><i class="fa fa-check"></i><b>5.4.6</b> Step 6: Map</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#a-note-of-caution-maup"><i class="fa fa-check"></i><b>5.5</b> A note of caution: MAUP</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#why-does-maup-matter"><i class="fa fa-check"></i><b>5.5.1</b> Why does MAUP matter?</a></li>
<li class="chapter" data-level="5.5.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#what-can-we-do"><i class="fa fa-check"></i><b>5.5.2</b> What can we do?</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#summary-and-further-reading-3"><i class="fa fa-check"></i><b>5.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html"><i class="fa fa-check"></i><b>6</b> Basics of cartographic design: elements of a map</a>
<ul>
<li class="chapter" data-level="6.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#data-representation"><i class="fa fa-check"></i><b>6.2</b> Data representation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#thematic-maps"><i class="fa fa-check"></i><b>6.2.1</b> Thematic maps</a></li>
<li class="chapter" data-level="6.2.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#symbols"><i class="fa fa-check"></i><b>6.2.2</b> Symbols</a></li>
<li class="chapter" data-level="6.2.3" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#rate-vs-count"><i class="fa fa-check"></i><b>6.2.3</b> Rate vs count</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#colour"><i class="fa fa-check"></i><b>6.3</b> Colour</a></li>
<li class="chapter" data-level="6.4" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#text"><i class="fa fa-check"></i><b>6.4</b> Text</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#titles-and-subtitles"><i class="fa fa-check"></i><b>6.4.1</b> Titles and subtitles</a></li>
<li class="chapter" data-level="6.4.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#legend"><i class="fa fa-check"></i><b>6.4.2</b> Legend</a></li>
<li class="chapter" data-level="6.4.3" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#annotation"><i class="fa fa-check"></i><b>6.4.3</b> Annotation</a></li>
<li class="chapter" data-level="6.4.4" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#production-notes"><i class="fa fa-check"></i><b>6.4.4</b> Production notes</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#composition"><i class="fa fa-check"></i><b>6.5</b> Composition</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#orientation-indicators"><i class="fa fa-check"></i><b>6.5.1</b> Orientation indicators</a></li>
<li class="chapter" data-level="6.5.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#scale-indicators"><i class="fa fa-check"></i><b>6.5.2</b> Scale indicators</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#context"><i class="fa fa-check"></i><b>6.6</b> Context</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#basemap"><i class="fa fa-check"></i><b>6.6.1</b> Basemap</a></li>
<li class="chapter" data-level="6.6.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#inset-maps"><i class="fa fa-check"></i><b>6.6.2</b> Inset maps</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#summary-and-further-reading-4"><i class="fa fa-check"></i><b>6.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="time-matters.html"><a href="time-matters.html"><i class="fa fa-check"></i><b>7</b> Time matters</a>
<ul>
<li class="chapter" data-level="7.1" data-path="time-matters.html"><a href="time-matters.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="time-matters.html"><a href="time-matters.html#temporal-data-in-crime-analysis"><i class="fa fa-check"></i><b>7.2</b> Temporal data in crime analysis</a></li>
<li class="chapter" data-level="7.3" data-path="time-matters.html"><a href="time-matters.html#temporal-data-wrangling"><i class="fa fa-check"></i><b>7.3</b> Temporal data wrangling</a></li>
<li class="chapter" data-level="7.4" data-path="time-matters.html"><a href="time-matters.html#visualising-time-data"><i class="fa fa-check"></i><b>7.4</b> Visualising time data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="time-matters.html"><a href="time-matters.html#how-not-to-present-time"><i class="fa fa-check"></i><b>7.4.1</b> How (not) to present time</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="time-matters.html"><a href="time-matters.html#time-series-analysis"><i class="fa fa-check"></i><b>7.5</b> Time series analysis</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="time-matters.html"><a href="time-matters.html#plotting-time-series-data"><i class="fa fa-check"></i><b>7.5.1</b> Plotting time series data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="time-matters.html"><a href="time-matters.html#spatio-temporal-data-visualisation"><i class="fa fa-check"></i><b>7.6</b> Spatio-temporal data visualisation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="time-matters.html"><a href="time-matters.html#small-multiples-to-show-temporal-variation"><i class="fa fa-check"></i><b>7.6.1</b> Small multiples to show temporal variation</a></li>
<li class="chapter" data-level="7.6.2" data-path="time-matters.html"><a href="time-matters.html#spaghetti-plots"><i class="fa fa-check"></i><b>7.6.2</b> Spaghetti plots</a></li>
<li class="chapter" data-level="7.6.3" data-path="time-matters.html"><a href="time-matters.html#animations"><i class="fa fa-check"></i><b>7.6.3</b> Animations</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="time-matters.html"><a href="time-matters.html#summary-and-further-reading-5"><i class="fa fa-check"></i><b>7.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html"><i class="fa fa-check"></i><b>8</b> Spatial point patterns of crime events</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#mapping-crime-intensity-with-isarithmic-maps"><i class="fa fa-check"></i><b>8.1</b> Mapping crime intensity with isarithmic maps</a></li>
<li class="chapter" data-level="8.2" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#burglaries-in-nyc"><i class="fa fa-check"></i><b>8.2</b> Burglaries in NYC</a></li>
<li class="chapter" data-level="8.3" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#using-the-spatstat-package"><i class="fa fa-check"></i><b>8.3</b> Using the <code>spatstat</code> package</a></li>
<li class="chapter" data-level="8.4" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#homogeneous-or-spatially-varying-intensity"><i class="fa fa-check"></i><b>8.4</b> Homogeneous or spatially varying intensity?</a></li>
<li class="chapter" data-level="8.5" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#mapping-intensity-estimates-with-spatstat"><i class="fa fa-check"></i><b>8.5</b> Mapping intensity estimates with <code>spatstat</code></a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#basics-of-kernel-density-estimation-kde"><i class="fa fa-check"></i><b>8.5.1</b> Basics of kernel density estimation (KDE)</a></li>
<li class="chapter" data-level="8.5.2" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#selecting-the-appropriate-bandwith-for-kde"><i class="fa fa-check"></i><b>8.5.2</b> Selecting the appropriate bandwith for KDE</a></li>
<li class="chapter" data-level="8.5.3" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#selecting-the-smoothing-kernel"><i class="fa fa-check"></i><b>8.5.3</b> Selecting the smoothing kernel</a></li>
<li class="chapter" data-level="8.5.4" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#weighted-kernel-density-estimates"><i class="fa fa-check"></i><b>8.5.4</b> Weighted kernel density estimates</a></li>
<li class="chapter" data-level="8.5.5" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#better-kde-maps-using-leaflet"><i class="fa fa-check"></i><b>8.5.5</b> Better KDE maps using <code>leaflet</code></a></li>
<li class="chapter" data-level="8.5.6" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#problems-with-kde"><i class="fa fa-check"></i><b>8.5.6</b> Problems with KDE</a></li>
<li class="chapter" data-level="8.5.7" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#other-packages-for-kde"><i class="fa fa-check"></i><b>8.5.7</b> Other packages for KDE</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#summary-and-further-reading-6"><i class="fa fa-check"></i><b>8.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html"><i class="fa fa-check"></i><b>9</b> Crime along spatial networks</a>
<ul>
<li class="chapter" data-level="9.1" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#constructing-and-storing-a-spatial-linear-network"><i class="fa fa-check"></i><b>9.2</b> Constructing and storing a spatial linear network</a></li>
<li class="chapter" data-level="9.3" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#density-estimation-along-networks"><i class="fa fa-check"></i><b>9.3</b> Density estimation along networks</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#adding-context"><i class="fa fa-check"></i><b>9.3.1</b> Adding context</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#visualising-crime-distribution-along-networks"><i class="fa fa-check"></i><b>9.4</b> Visualising crime distribution along networks</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#hot-routes"><i class="fa fa-check"></i><b>9.4.1</b> Hot Routes</a></li>
<li class="chapter" data-level="9.4.2" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#street-profile-analysis"><i class="fa fa-check"></i><b>9.4.2</b> Street Profile Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#quantifying-crime-concentration-at-micro-places"><i class="fa fa-check"></i><b>9.5</b> Quantifying crime concentration at micro-places</a></li>
<li class="chapter" data-level="9.6" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#summary-and-further-reading-7"><i class="fa fa-check"></i><b>9.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html"><i class="fa fa-check"></i><b>10</b> Spatial dependence and autocorrelation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#exploring-spatial-dependence-in-point-pattern-data"><i class="fa fa-check"></i><b>10.2</b> Exploring spatial dependence in point pattern data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#the-empirical-k-function"><i class="fa fa-check"></i><b>10.2.1</b> The empirical K function</a></li>
<li class="chapter" data-level="10.2.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#homicide-in-buenos-aires"><i class="fa fa-check"></i><b>10.2.2</b> Homicide in Buenos Aires</a></li>
<li class="chapter" data-level="10.2.3" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#estimating-and-plotting-the-k-function"><i class="fa fa-check"></i><b>10.2.3</b> Estimating and plotting the K-function</a></li>
<li class="chapter" data-level="10.2.4" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#network-constrained-k-function"><i class="fa fa-check"></i><b>10.2.4</b> Network constrained K function</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#exploring-spatial-autocorrelation-in-lattice-data"><i class="fa fa-check"></i><b>10.3</b> Exploring spatial autocorrelation in lattice data</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#burglary-in-manchester"><i class="fa fa-check"></i><b>10.3.1</b> Burglary in Manchester</a></li>
<li class="chapter" data-level="10.3.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#what-is-a-neighbour"><i class="fa fa-check"></i><b>10.3.2</b> What is a neighbour?</a></li>
<li class="chapter" data-level="10.3.3" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#creating-a-list-of-neighbours-based-on-contiguity"><i class="fa fa-check"></i><b>10.3.3</b> Creating a list of neighbours based on contiguity</a></li>
<li class="chapter" data-level="10.3.4" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#generating-the-weight-matrix"><i class="fa fa-check"></i><b>10.3.4</b> Generating the weight matrix</a></li>
<li class="chapter" data-level="10.3.5" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#spatial-weight-matrix-based-on-distance"><i class="fa fa-check"></i><b>10.3.5</b> Spatial weight matrix based on distance</a></li>
<li class="chapter" data-level="10.3.6" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#spatial-weight-matrix-based-on-k-neighbors"><i class="fa fa-check"></i><b>10.3.6</b> Spatial weight matrix based on k-neighbors</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#choosing-the-correct-matrix"><i class="fa fa-check"></i><b>10.4</b> Choosing the correct matrix</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#measuring-global-autocorrelation"><i class="fa fa-check"></i><b>10.4.1</b> Measuring global autocorrelation</a></li>
<li class="chapter" data-level="10.4.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#the-rgeoda-and-sfweight-packages"><i class="fa fa-check"></i><b>10.4.2</b> The <code>rgeoda</code> and <code>sfweight</code> packages</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#further-reading"><i class="fa fa-check"></i><b>10.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html"><i class="fa fa-check"></i><b>11</b> Detecting hot spots and repeats</a>
<ul>
<li class="chapter" data-level="11.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#clusters-hot-spots-of-crime-and-near-repeat-victimisation"><i class="fa fa-check"></i><b>11.1.1</b> Clusters, hot spots of crime, and near repeat victimisation</a></li>
<li class="chapter" data-level="11.1.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#burglaries-in-manchester"><i class="fa fa-check"></i><b>11.1.2</b> Burglaries in Manchester</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#using-raster-micro-grid-cells-to-spot-hot-spots"><i class="fa fa-check"></i><b>11.2</b> Using <code>raster</code> micro grid cells to spot hot spots</a></li>
<li class="chapter" data-level="11.3" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#local-getis-ord"><i class="fa fa-check"></i><b>11.3</b> Local Getis-Ord</a></li>
<li class="chapter" data-level="11.4" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#local-morans-i-and-moran-scaterplot"><i class="fa fa-check"></i><b>11.4</b> Local Moran’s I and Moran scaterplot</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#computing-the-local-morans-i"><i class="fa fa-check"></i><b>11.4.1</b> Computing the local Moran’s I</a></li>
<li class="chapter" data-level="11.4.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#creating-a-lisa-map"><i class="fa fa-check"></i><b>11.4.2</b> Creating a LISA map</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#scan-satistics"><i class="fa fa-check"></i><b>11.5</b> Scan satistics</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#the-dcluster-package"><i class="fa fa-check"></i><b>11.5.1</b> The <code>DCluster</code> package</a></li>
<li class="chapter" data-level="11.5.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#openshaws-gam"><i class="fa fa-check"></i><b>11.5.2</b> Openshaw’s GAM</a></li>
<li class="chapter" data-level="11.5.3" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#kulldorfs-scan-statistic"><i class="fa fa-check"></i><b>11.5.3</b> Kulldorf’s Scan Statistic</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#exploring-near-repeat-victimisation"><i class="fa fa-check"></i><b>11.6</b> Exploring near repeat victimisation</a></li>
<li class="chapter" data-level="11.7" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#further-reading-1"><i class="fa fa-check"></i><b>11.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html"><i class="fa fa-check"></i><b>12</b> Spatial regression models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#challenges-for-regression-with-spatial-data"><i class="fa fa-check"></i><b>12.2</b> Challenges for regression with spatial data</a></li>
<li class="chapter" data-level="12.3" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-a-non-spatial-regression-model-with-r"><i class="fa fa-check"></i><b>12.3</b> Fitting a non-spatial regression model with R</a></li>
<li class="chapter" data-level="12.4" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#looking-at-the-residuals-and-testing-for-spatial-autocorrelation-in-regression"><i class="fa fa-check"></i><b>12.4</b> Looking at the residuals and testing for spatial autocorrelation in regression</a></li>
<li class="chapter" data-level="12.5" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i><b>12.5</b> Choosing a spatial regression model</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#the-basic-spatial-models"><i class="fa fa-check"></i><b>12.5.1</b> The basic spatial models</a></li>
<li class="chapter" data-level="12.5.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#lagrange-multipliers-the-bottom-up-approach-to-select-a-model"><i class="fa fa-check"></i><b>12.5.2</b> Lagrange multipliers: the bottom-up approach to select a model</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-and-interpreting-a-spatial-error-model"><i class="fa fa-check"></i><b>12.6</b> Fitting and interpreting a spatial error model</a></li>
<li class="chapter" data-level="12.7" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-and-interpreting-a-spatially-lagged-model"><i class="fa fa-check"></i><b>12.7</b> Fitting and interpreting a spatially lagged model</a></li>
<li class="chapter" data-level="12.8" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#beyond-the-sar-and-sem-models"><i class="fa fa-check"></i><b>12.8</b> Beyond the SAR and SEM models</a></li>
<li class="chapter" data-level="12.9" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#summary-and-further-reading-8"><i class="fa fa-check"></i><b>12.9</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html"><i class="fa fa-check"></i><b>13</b> Spatial heterogeneity and regression</a>
<ul>
<li class="chapter" data-level="13.1" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#spatial-regimes"><i class="fa fa-check"></i><b>13.2</b> Spatial regimes</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#fitting-the-constrained-and-the-unconstrained-models"><i class="fa fa-check"></i><b>13.2.1</b> Fitting the constrained and the unconstrained models</a></li>
<li class="chapter" data-level="13.2.2" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#running-the-chow-test"><i class="fa fa-check"></i><b>13.2.2</b> Running the Chow test</a></li>
<li class="chapter" data-level="13.2.3" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#spatial-dependence-with-spatial-heterogeneity"><i class="fa fa-check"></i><b>13.2.3</b> Spatial dependence with spatial heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#geographically-weighted-regression"><i class="fa fa-check"></i><b>13.3</b> Geographically Weighted Regression</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#calculate-kernel-bandwidth"><i class="fa fa-check"></i><b>13.3.1</b> Calculate kernel bandwidth</a></li>
<li class="chapter" data-level="13.3.2" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#building-the-geographically-weighted-model"><i class="fa fa-check"></i><b>13.3.2</b> Building the geographically weighted model</a></li>
<li class="chapter" data-level="13.3.3" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#using-gwr"><i class="fa fa-check"></i><b>13.3.3</b> Using GWR</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#summary-and-further-reading-9"><i class="fa fa-check"></i><b>13.4</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>14</b> Appendix: A quick intro to R and RStudio</a>
<ul>
<li class="chapter" data-level="14.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#exploring-rstudio"><i class="fa fa-check"></i><b>14.1</b> Exploring RStudio</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#the-four-panes-of-r-studio"><i class="fa fa-check"></i><b>14.1.1</b> The four panes of R Studio</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#customising-the-rstudio-look"><i class="fa fa-check"></i><b>14.2</b> Customising the RStudio look</a></li>
<li class="chapter" data-level="14.3" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#elements-of-r-grammar"><i class="fa fa-check"></i><b>14.3</b> Elements of R grammar</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#functions"><i class="fa fa-check"></i><b>14.3.1</b> Functions</a></li>
<li class="chapter" data-level="14.3.2" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#objects"><i class="fa fa-check"></i><b>14.3.2</b> Objects</a></li>
<li class="chapter" data-level="14.3.3" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#types-of-objects"><i class="fa fa-check"></i><b>14.3.3</b> Types of objects</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#packages"><i class="fa fa-check"></i><b>14.4</b> Packages</a></li>
<li class="chapter" data-level="14.5" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#exploring-data-with-r"><i class="fa fa-check"></i><b>14.5</b> Exploring data with R</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#playing-around-with-data"><i class="fa fa-check"></i><b>14.5.1</b> Playing around with data</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#getting-organised-r-projects"><i class="fa fa-check"></i><b>14.6</b> Getting organised: R Projects</a></li>
<li class="chapter" data-level="14.7" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#summary-and-further-reading-10"><i class="fa fa-check"></i><b>14.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html"><i class="fa fa-check"></i><b>15</b> Appendix B: Regression analysis (a refresher)</a>
<ul>
<li class="chapter" data-level="15.1" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#introduction-11"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#motivating-regression"><i class="fa fa-check"></i><b>15.2</b> Motivating regression</a></li>
<li class="chapter" data-level="15.3" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-a-simple-regression-model"><i class="fa fa-check"></i><b>15.3</b> Fitting a simple regression model</a></li>
<li class="chapter" data-level="15.4" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#residuals-revisited-r-squared"><i class="fa fa-check"></i><b>15.4</b> Residuals revisited: R squared</a></li>
<li class="chapter" data-level="15.5" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#inference-with-regression"><i class="fa fa-check"></i><b>15.5</b> Inference with regression</a></li>
<li class="chapter" data-level="15.6" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-regression-with-categorical-predictors"><i class="fa fa-check"></i><b>15.6</b> Fitting regression with categorical predictors</a></li>
<li class="chapter" data-level="15.7" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#motivating-multiple-regression"><i class="fa fa-check"></i><b>15.7</b> Motivating multiple regression</a></li>
<li class="chapter" data-level="15.8" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-and-interpreting-a-multiple-regression-model"><i class="fa fa-check"></i><b>15.8</b> Fitting and interpreting a multiple regression model</a></li>
<li class="chapter" data-level="15.9" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#presenting-your-regression-results."><i class="fa fa-check"></i><b>15.9</b> Presenting your regression results.</a></li>
<li class="chapter" data-level="15.10" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#rescaling-input-variables-to-assist-interpretation"><i class="fa fa-check"></i><b>15.10</b> Rescaling input variables to assist interpretation</a></li>
<li class="chapter" data-level="15.11" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#testing-conditional-hypothesis-interactions"><i class="fa fa-check"></i><b>15.11</b> Testing conditional hypothesis: interactions</a></li>
<li class="chapter" data-level="15.12" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#model-building-and-variable-selection"><i class="fa fa-check"></i><b>15.12</b> Model building and variable selection</a></li>
<li class="chapter" data-level="15.13" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#regression-assumptions"><i class="fa fa-check"></i><b>15.13</b> Regression assumptions</a></li>
<li class="chapter" data-level="15.14" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#summary-and-further-reading-11"><i class="fa fa-check"></i><b>15.14</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><i class="fa fa-check"></i><b>16</b> Appendix C: sourcing geographical data for crime analysis</a>
<ul>
<li class="chapter" data-level="16.1" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#the-rnaturalearth-package"><i class="fa fa-check"></i><b>16.1</b> The rnaturalearth package</a></li>
<li class="chapter" data-level="16.2" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#data-from-apis"><i class="fa fa-check"></i><b>16.2</b> Data from APIs</a></li>
<li class="chapter" data-level="16.3" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#data-from-data-repositories"><i class="fa fa-check"></i><b>16.3</b> Data from data repositories</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#international-resources"><i class="fa fa-check"></i><b>16.3.1</b> International resources</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#open-street-map"><i class="fa fa-check"></i><b>16.4</b> Open Street Map</a></li>
<li class="chapter" data-level="16.5" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#summary-and-further-reading-12"><i class="fa fa-check"></i><b>16.5</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime Mapping and Spatial Data Analysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-heterogeneity-and-regression" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> Spatial heterogeneity and regression<a href="spatial-heterogeneity-and-regression.html#spatial-heterogeneity-and-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-10" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Introduction<a href="spatial-heterogeneity-and-regression.html#introduction-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the challenges of spatial data is that we may encounter exceptions to stationary processes. There may be, for example, parameter variability across the study area. When we have homogeneity everything is the same everywhere, in terms of our regression equation, the parameters are constant. But as we illustrated via an interaction term in the last chapter, that may not be the case. We can encounter situations where a particular input has a different effect in parts of our study area. In this chapter we explore this issue and a number of solutions that have been proposed to deal with it. It goes without saying that having extreme heterogeneity creates technical problems for estimation. If everything is different everywhere we may have to estimate more parameters that we have data for.</p>
<p>One way of dealing with this is by imposing some form of structure, for example partitioning data for the United States to fit a separate model for Southern and Northern counties. Unlike data partition, <strong>full spatial regimes</strong> also imply using different coefficients for each subset of the data but you fit everything in one go. This is essentially the same as running as many models as subsets you have. As <span class="citation">Anselin (<a href="#ref-Anselin_2007" role="doc-biblioref">2007</a>)</span> highlights, this corrects for heterogeneity but does not explain it. We can then test whether this was necessary, using a <em>Chow test</em> comparing the simpler model with the one where we allow variability. Of course, we can also include spatial dependence in these models.</p>
<p>Another way of dealing with heterogeneity is by allowing continuous variation, rather than discrete (as when we subset the data), of the parameters. A popular method for doing this is <strong>geographically weighted regression (GWR)</strong>. This is a case of a local regression where you try to estimate a different set of parameters for each location and these parameters are obtained from a subset of observation using kernel regression. In traditional local regression we select the subset in the attribute space (observations with similar attributes), in GWR the local subset is defined in a geographical sense using a kernel (remember how we used kernels for density estimation to define a set of “neighbours”). We are estimating regression equations based on nearby locations as specified by our kernel and this produces a different coefficient for each location. As with kernel density estimation you can distinguish between fixed bandwidth and adaptive bandwidth.</p>
<p>For this chapter we will need to load the following packages:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="spatial-heterogeneity-and-regression.html#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb600-2"><a href="spatial-heterogeneity-and-regression.html#cb600-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb600-3"><a href="spatial-heterogeneity-and-regression.html#cb600-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for handling spatial data and for geospatial carpentry</span></span>
<span id="cb600-4"><a href="spatial-heterogeneity-and-regression.html#cb600-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb600-5"><a href="spatial-heterogeneity-and-regression.html#cb600-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb600-6"><a href="spatial-heterogeneity-and-regression.html#cb600-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb600-7"><a href="spatial-heterogeneity-and-regression.html#cb600-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for regression and spatial regression</span></span>
<span id="cb600-8"><a href="spatial-heterogeneity-and-regression.html#cb600-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg)</span>
<span id="cb600-9"><a href="spatial-heterogeneity-and-regression.html#cb600-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for mapping and visualisation</span></span>
<span id="cb600-10"><a href="spatial-heterogeneity-and-regression.html#cb600-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb600-11"><a href="spatial-heterogeneity-and-regression.html#cb600-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb600-12"><a href="spatial-heterogeneity-and-regression.html#cb600-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages with spatial datasets</span></span>
<span id="cb600-13"><a href="spatial-heterogeneity-and-regression.html#cb600-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodaData)</span>
<span id="cb600-14"><a href="spatial-heterogeneity-and-regression.html#cb600-14" aria-hidden="true" tabindex="-1"></a><span class="co"># For geographicaly weighted regression</span></span>
<span id="cb600-15"><a href="spatial-heterogeneity-and-regression.html#cb600-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spgwr)</span></code></pre></div>
</div>
<div id="spatial-regimes" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Spatial regimes<a href="spatial-heterogeneity-and-regression.html#spatial-regimes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fitting-the-constrained-and-the-unconstrained-models" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Fitting the constrained and the unconstrained models<a href="spatial-heterogeneity-and-regression.html#fitting-the-constrained-and-the-unconstrained-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To illustrate this solution we will go back to the “ncovr” data we explored last week and use the same spatial weight matrix as in the previous chapter. If you have read the <span class="citation">Baller et al. (<a href="#ref-Baller_2001" role="doc-biblioref">2001</a>)</span> paper that we are in a way replicating here, you could see they decided that they needed to run separate models for the South and the North. Let´s explore this here.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="spatial-heterogeneity-and-regression.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ncovr&quot;</span>)</span>
<span id="cb601-2"><a href="spatial-heterogeneity-and-regression.html#cb601-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We coerce the sf object into a new sp object</span></span>
<span id="cb601-3"><a href="spatial-heterogeneity-and-regression.html#cb601-3" aria-hidden="true" tabindex="-1"></a>ncovr_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(ncovr, <span class="st">&quot;Spatial&quot;</span>)</span></code></pre></div>
<pre><code>## old-style crs object detected; please recreate object with a recent sf::st_crs()
## old-style crs object detected; please recreate object with a recent sf::st_crs()</code></pre>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="spatial-heterogeneity-and-regression.html#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we create a list of neighbours using 10 nearest neighbours criteria</span></span>
<span id="cb603-2"><a href="spatial-heterogeneity-and-regression.html#cb603-2" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(ncovr_sp)</span>
<span id="cb603-3"><a href="spatial-heterogeneity-and-regression.html#cb603-3" aria-hidden="true" tabindex="-1"></a>nb_k10 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy, <span class="at">k =</span> <span class="dv">10</span>))</span>
<span id="cb603-4"><a href="spatial-heterogeneity-and-regression.html#cb603-4" aria-hidden="true" tabindex="-1"></a>rwm <span class="ot">&lt;-</span> <span class="fu">nb2mat</span>(nb_k10, <span class="at">style=</span><span class="st">&#39;W&#39;</span>)</span>
<span id="cb603-5"><a href="spatial-heterogeneity-and-regression.html#cb603-5" aria-hidden="true" tabindex="-1"></a>rwm <span class="ot">&lt;-</span> <span class="fu">mat2listw</span>(rwm, <span class="at">style=</span><span class="st">&#39;W&#39;</span>)</span>
<span id="cb603-6"><a href="spatial-heterogeneity-and-regression.html#cb603-6" aria-hidden="true" tabindex="-1"></a><span class="co"># remove redundant objects</span></span>
<span id="cb603-7"><a href="spatial-heterogeneity-and-regression.html#cb603-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">&quot;ncovr_sp&quot;</span>, <span class="st">&quot;xy&quot;</span>, <span class="st">&quot;nb_k10&quot;</span>))</span></code></pre></div>
<p>We can start by running a model for the whole country to use as a baseline model:</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="spatial-heterogeneity-and-regression.html#cb604-1" aria-hidden="true" tabindex="-1"></a>fit1_70 <span class="ot">&lt;-</span> <span class="fu">lm</span>(HR70 <span class="sc">~</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70, <span class="at">data =</span> ncovr)</span>
<span id="cb604-2"><a href="spatial-heterogeneity-and-regression.html#cb604-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1_70)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = HR70 ~ RD70 + PS70 + MA70 + DV70 + UE70, data = ncovr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -21.12  -3.14  -1.02   1.90  69.75 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.1376     0.7602   14.65   &lt;2e-16 ***
## RD70          4.1541     0.1147   36.23   &lt;2e-16 ***
## PS70          1.1449     0.1165    9.82   &lt;2e-16 ***
## MA70         -0.2080     0.0233   -8.94   &lt;2e-16 ***
## DV70          1.4066     0.1064   13.22   &lt;2e-16 ***
## UE70         -0.4268     0.0497   -8.59   &lt;2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.03 on 3079 degrees of freedom
## Multiple R-squared:  0.328,  Adjusted R-squared:  0.327 
## F-statistic:  301 on 5 and 3079 DF,  p-value: &lt;2e-16</code></pre>
<p>A simple visualisation of the residuals suggest the model may not be optimal for the entire study region:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="spatial-heterogeneity-and-regression.html#cb606-1" aria-hidden="true" tabindex="-1"></a>ncovr<span class="sc">$</span>res_fit1 <span class="ot">&lt;-</span> fit1_70<span class="sc">$</span>residuals</span>
<span id="cb606-2"><a href="spatial-heterogeneity-and-regression.html#cb606-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ncovr, <span class="fu">aes</span>(<span class="at">x =</span> res_fit1, <span class="at">colour =</span> <span class="fu">as.factor</span>(SOUTH))) <span class="sc">+</span> </span>
<span id="cb606-3"><a href="spatial-heterogeneity-and-regression.html#cb606-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb606-4"><a href="spatial-heterogeneity-and-regression.html#cb606-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> </span>
<span id="cb606-5"><a href="spatial-heterogeneity-and-regression.html#cb606-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="at">name =</span> <span class="st">&quot;Region (1 = South)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb606-6"><a href="spatial-heterogeneity-and-regression.html#cb606-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-373"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-373-1.png" alt="Distribution of residuals by study region (South v North)" width="672" />
<p class="caption">
FIGURE 13.1: Distribution of residuals by study region (South v North)
</p>
</div>
<p>To be able to fit these spatial regimes, that will allow for separate coefficients for counties in the North and those in the South, first we need to define a dummy for the Northern counties, and we create a vector of 1.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="spatial-heterogeneity-and-regression.html#cb607-1" aria-hidden="true" tabindex="-1"></a>ncovr<span class="sc">$</span>NORTH <span class="ot">&lt;-</span> <span class="fu">recode</span>(ncovr<span class="sc">$</span>SOUTH, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb607-2"><a href="spatial-heterogeneity-and-regression.html#cb607-2" aria-hidden="true" tabindex="-1"></a>ncovr<span class="sc">$</span>ONE <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>Having created these new columns we can fit a standard OLS model interacting the inputs with our dummies and setting the intercept to 0, so that each regime is allowed its own intercept:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="spatial-heterogeneity-and-regression.html#cb608-1" aria-hidden="true" tabindex="-1"></a>fit2_70_sr <span class="ot">&lt;-</span> <span class="fu">lm</span>(HR70 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> (ONE <span class="sc">+</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70)<span class="sc">:</span>(SOUTH <span class="sc">+</span> NORTH), </span>
<span id="cb608-2"><a href="spatial-heterogeneity-and-regression.html#cb608-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> ncovr)</span>
<span id="cb608-3"><a href="spatial-heterogeneity-and-regression.html#cb608-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2_70_sr)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = HR70 ~ 0 + (ONE + RD70 + PS70 + MA70 + DV70 + UE70):(SOUTH + 
##     NORTH), data = ncovr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -17.47  -2.79  -0.76   1.71  65.60 
## 
## Coefficients:
##            Estimate Std. Error t value Pr(&gt;|t|)    
## ONE:SOUTH   15.0305     1.0714   14.03  &lt; 2e-16 ***
## ONE:NORTH    6.6485     1.1308    5.88  4.6e-09 ***
## RD70:SOUTH   3.2364     0.1884   17.18  &lt; 2e-16 ***
## RD70:NORTH   2.9523     0.2745   10.75  &lt; 2e-16 ***
## PS70:SOUTH   0.9953     0.2114    4.71  2.6e-06 ***
## PS70:NORTH   0.8428     0.1402    6.01  2.0e-09 ***
## MA70:SOUTH  -0.1656     0.0338   -4.90  1.0e-06 ***
## MA70:NORTH  -0.1749     0.0325   -5.37  8.2e-08 ***
## DV70:SOUTH   0.6271     0.1750    3.58  0.00034 ***
## DV70:NORTH   1.4263     0.1313   10.86  &lt; 2e-16 ***
## UE70:SOUTH  -0.7916     0.0817   -9.69  &lt; 2e-16 ***
## UE70:NORTH  -0.0293     0.0631   -0.46  0.64265    
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.81 on 3073 degrees of freedom
## Multiple R-squared:  0.645,  Adjusted R-squared:  0.644 
## F-statistic:  465 on 12 and 3073 DF,  p-value: &lt;2e-16</code></pre>
<p>We can see a higher intercept for the South, reflecting the higher level of homicide in these counties. Aside from this, the two more notable differences are, on the one hand, the insignificant effect of unemployment in the North, and the higher impact of the divorce rate in the North.</p>
</div>
<div id="running-the-chow-test" class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Running the Chow test<a href="spatial-heterogeneity-and-regression.html#running-the-chow-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Chow Test is often used in econometrics to determine whether the independent variables have different impacts on different subgroups of the population. <span class="citation">Anselin (<a href="#ref-Anselin_2007" role="doc-biblioref">2007</a>)</span> provides an implementation for this test, that extracts the residuals and the degrees of freedom from the constrained (the simpler oLS model) and the unconstrained models (the less parsimonious spatial regime), and then computes the test based on the F distribution.</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="spatial-heterogeneity-and-regression.html#cb610-1" aria-hidden="true" tabindex="-1"></a>chow.test <span class="ot">&lt;-</span> <span class="cf">function</span>(rest,unrest)</span>
<span id="cb610-2"><a href="spatial-heterogeneity-and-regression.html#cb610-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb610-3"><a href="spatial-heterogeneity-and-regression.html#cb610-3" aria-hidden="true" tabindex="-1"></a>er <span class="ot">&lt;-</span> <span class="fu">residuals</span>(rest)</span>
<span id="cb610-4"><a href="spatial-heterogeneity-and-regression.html#cb610-4" aria-hidden="true" tabindex="-1"></a>eu <span class="ot">&lt;-</span> <span class="fu">residuals</span>(unrest)</span>
<span id="cb610-5"><a href="spatial-heterogeneity-and-regression.html#cb610-5" aria-hidden="true" tabindex="-1"></a>er2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(er<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb610-6"><a href="spatial-heterogeneity-and-regression.html#cb610-6" aria-hidden="true" tabindex="-1"></a>eu2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(eu<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb610-7"><a href="spatial-heterogeneity-and-regression.html#cb610-7" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> rest<span class="sc">$</span>rank</span>
<span id="cb610-8"><a href="spatial-heterogeneity-and-regression.html#cb610-8" aria-hidden="true" tabindex="-1"></a>n2k <span class="ot">&lt;-</span> rest<span class="sc">$</span>df.residual <span class="sc">-</span> k</span>
<span id="cb610-9"><a href="spatial-heterogeneity-and-regression.html#cb610-9" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> ((er2 <span class="sc">-</span> eu2)<span class="sc">/</span>k) <span class="sc">/</span> (eu2 <span class="sc">/</span> n2k)</span>
<span id="cb610-10"><a href="spatial-heterogeneity-and-regression.html#cb610-10" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">pf</span>(c,k,n2k,<span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span>
<span id="cb610-11"><a href="spatial-heterogeneity-and-regression.html#cb610-11" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(c,pc,k,n2k)</span>
<span id="cb610-12"><a href="spatial-heterogeneity-and-regression.html#cb610-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>With the function in our environment we can then run the test, which will yield the test statistic, the p value, and two degrees of freedom.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="spatial-heterogeneity-and-regression.html#cb611-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">chow.test</span>(fit1_70,fit2_70_sr)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 40.16
## 
## [[2]]
## [1] 2.674e-47
## 
## [[3]]
## [1] 6
## 
## [[4]]
## [1] 3073</code></pre>
<p>How we interpret this test? When the Chow test is significant, as here, this provides evidence of spatial heterogeneity and in favour of fitting a spatial regime model, allowing for non-constant coefficients across the discrete subsets of data that we have specified.</p>
</div>
<div id="spatial-dependence-with-spatial-heterogeneity" class="section level3 hasAnchor" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> Spatial dependence with spatial heterogeneity<a href="spatial-heterogeneity-and-regression.html#spatial-dependence-with-spatial-heterogeneity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far we have only adjusted for a form of spatial heterogeneity in our model, but we may still have to deal with spatial dependence. Here what we covered in the previous chapter, still applies. We can run the various specification tests and then select a model that adjust for spatial dependence.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="spatial-heterogeneity-and-regression.html#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm.LMtests</span>(fit2_70_sr, rwm, <span class="at">test =</span> <span class="fu">c</span>(<span class="st">&quot;LMerr&quot;</span>,<span class="st">&quot;LMlag&quot;</span>,<span class="st">&quot;RLMerr&quot;</span>,<span class="st">&quot;RLMlag&quot;</span>)))</span></code></pre></div>
<pre><code>##  Lagrange multiplier diagnostics for spatial
##  dependence
## data:  
## model: lm(formula = HR70 ~ 0 + (ONE + RD70 +
## PS70 + MA70 + DV70 + UE70):(SOUTH + NORTH), data
## = ncovr)
## weights: rwm
##  
##        statistic parameter p.value    
## LMerr     227.20         1 &lt; 2e-16 ***
## LMlag     252.00         1 &lt; 2e-16 ***
## RLMerr      5.25         1   0.022 *  
## RLMlag     30.05         1 4.2e-08 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The Lagrange multiplier tests, according to Anselin suggestions for how to interpret these, point to a spatial lag model (since RLMlag is several orders more significant than the error alternative).</p>
<p>We could then fit this model using <code>sp</code></p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="spatial-heterogeneity-and-regression.html#cb615-1" aria-hidden="true" tabindex="-1"></a>fit3_70_sr_sar <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(HR70 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> </span>
<span id="cb615-2"><a href="spatial-heterogeneity-and-regression.html#cb615-2" aria-hidden="true" tabindex="-1"></a>                             (ONE <span class="sc">+</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70)<span class="sc">:</span>(SOUTH <span class="sc">+</span> NORTH), </span>
<span id="cb615-3"><a href="spatial-heterogeneity-and-regression.html#cb615-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> ncovr, rwm)</span>
<span id="cb615-4"><a href="spatial-heterogeneity-and-regression.html#cb615-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit3_70_sr_sar)</span></code></pre></div>
<pre><code>## 
## Call:
## lagsarlm(formula = HR70 ~ 0 + (ONE + RD70 + PS70 + MA70 + DV70 + 
##     UE70):(SOUTH + NORTH), data = ncovr, listw = rwm)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -17.15273  -2.66726  -0.67209   1.49219  65.86918 
## 
## Type: lag 
## Coefficients: (asymptotic standard errors) 
##             Estimate Std. Error z value  Pr(&gt;|z|)
## ONE:SOUTH   8.391260   1.103507  7.6042 2.864e-14
## ONE:NORTH   4.903963   1.091437  4.4931 7.019e-06
## RD70:SOUTH  2.355243   0.191445 12.3025 &lt; 2.2e-16
## RD70:NORTH  2.669956   0.266521 10.0178 &lt; 2.2e-16
## PS70:SOUTH  0.653640   0.203791  3.2074 0.0013394
## PS70:NORTH  0.778913   0.135054  5.7674 8.050e-09
## MA70:SOUTH -0.100568   0.032699 -3.0756 0.0021009
## MA70:NORTH -0.138235   0.031328 -4.4126 1.022e-05
## DV70:SOUTH  0.636867   0.168184  3.7867 0.0001527
## DV70:NORTH  1.157985   0.128559  9.0074 &lt; 2.2e-16
## UE70:SOUTH -0.522353   0.079210 -6.5945 4.267e-11
## UE70:NORTH -0.039129   0.060706 -0.6446 0.5192148
## 
## Rho: 0.3957, LR test value: 181.8, p-value: &lt; 2.22e-16
## Asymptotic standard error: 0.02846
##     z-value: 13.9, p-value: &lt; 2.22e-16
## Wald statistic: 193.3, p-value: &lt; 2.22e-16
## 
## Log likelihood: -9710 for lag model
## ML residual variance (sigma squared): 31.21, (sigma: 5.587)
## Number of observations: 3085 
## Number of parameters estimated: 14 
## AIC: 19448, (AIC for lm: 19628)
## LM test for residual autocorrelation
## test value: 0.7147, p-value: 0.39789</code></pre>
<p>We see that the AIC is better than for the non-spatial model and that there is no more residual autocorrelation. We could explore other specifications (ie spatial Durbin model) and the same caveats about interpreting coefficients in a spatial lag model we raised in the previous chapter would apply here. If the Lagrange multiplier tests had suggested a spatial error model, we could also have fitted the model in the way we have also already covered simply adjusting the regression formula as in this section.</p>
<p>We can now also run a Chow test, only in this case, we need to adjust the previous one to account for spatial dependence. <span class="citation">Anselin (<a href="#ref-Anselin_2007" role="doc-biblioref">2007</a>)</span> also provides for an implementation of this test in R with the following ad-hoc function:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="spatial-heterogeneity-and-regression.html#cb617-1" aria-hidden="true" tabindex="-1"></a>spatialchow.test <span class="ot">&lt;-</span> <span class="cf">function</span>(rest,unrest)</span>
<span id="cb617-2"><a href="spatial-heterogeneity-and-regression.html#cb617-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb617-3"><a href="spatial-heterogeneity-and-regression.html#cb617-3" aria-hidden="true" tabindex="-1"></a>lrest <span class="ot">&lt;-</span> rest<span class="sc">$</span>LL</span>
<span id="cb617-4"><a href="spatial-heterogeneity-and-regression.html#cb617-4" aria-hidden="true" tabindex="-1"></a>lunrest <span class="ot">&lt;-</span> unrest<span class="sc">$</span>LL</span>
<span id="cb617-5"><a href="spatial-heterogeneity-and-regression.html#cb617-5" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> rest<span class="sc">$</span>parameters <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb617-6"><a href="spatial-heterogeneity-and-regression.html#cb617-6" aria-hidden="true" tabindex="-1"></a>spchow <span class="ot">&lt;-</span> <span class="sc">-</span> <span class="fl">2.0</span> <span class="sc">*</span> (lrest <span class="sc">-</span> lunrest)</span>
<span id="cb617-7"><a href="spatial-heterogeneity-and-regression.html#cb617-7" aria-hidden="true" tabindex="-1"></a>pchow <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(spchow,k,<span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span>
<span id="cb617-8"><a href="spatial-heterogeneity-and-regression.html#cb617-8" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(spchow,pchow,k)</span>
<span id="cb617-9"><a href="spatial-heterogeneity-and-regression.html#cb617-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This function will test a spatial lag model for the whole country as a whole with the spatial lag model with our data partitions. So first we need to estimate the appropriate lag model to be our constrained model:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="spatial-heterogeneity-and-regression.html#cb618-1" aria-hidden="true" tabindex="-1"></a>fit4_70_sar <span class="ot">&lt;-</span> <span class="fu">lagsarlm</span>(HR70 <span class="sc">~</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70, <span class="at">data =</span> ncovr,</span>
<span id="cb618-2"><a href="spatial-heterogeneity-and-regression.html#cb618-2" aria-hidden="true" tabindex="-1"></a>                    rwm)</span></code></pre></div>
<p>Which we can then use in the newly created function:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="spatial-heterogeneity-and-regression.html#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spatialchow.test</span>(fit4_70_sar, fit3_70_sr_sar)</span></code></pre></div>
<pre><code>## [[1]]
##       [,1]
## [1,] 58.59
## 
## [[2]]
##           [,1]
## [1,] 8.712e-11
## 
## [[3]]
## [1] 6</code></pre>
<p>The test is again highly significant providing evidence for the spatial lag model with the spatial regimes.</p>
</div>
</div>
<div id="geographically-weighted-regression" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Geographically Weighted Regression<a href="spatial-heterogeneity-and-regression.html#geographically-weighted-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The basic idea behind Geographically Weighted Regression (GWR) is to explore how the relationship between a dependent variable (<span class="math inline">\(Y\)</span>) and one or more independent variables (the <span class="math inline">\(X\)</span>s) might vary geographically. Instead of assuming that a single model can be fitted to the entire study region, it looks for geographical differences in the relationship. This is achieved by fitting a regression equation to every feature in the dataset. We construct these separate equations by incorporating the dependent and explanatory variables of the features falling within the neighborhood of each target feature.</p>
<p>Geographically Weighted Regression can be used for a variety of applications, including the following:</p>
<ul>
<li>Is the relationship between homicide rate and resource deprivation consistent across the study area?</li>
<li>What are the key variables that explain high homicide rates?</li>
<li>Where are the counties in which we see high homicide rates? What characteristics seem to be associated with these? Where is each characteristic most important?</li>
<li>Are the factors influencing higher homicide rates consistent across the study area?</li>
</ul>
<p>GWR provides three types of regression models: Continuous, Binary, and Count. These types of regression are known in statistical literature as Gaussian, Logistic, and Poisson, respectively. The Model Type for your analysis should be chosen based on the level of measurement of the Dependent Variable <span class="math inline">\(Y\)</span>.</p>
<p>So to illustrate, let us first build our linear model once again, regressing homicide rate in the 1970s for each county against resource deprivation (RD70), population structure (PS70), median age (MA70), divorce rate (DV70), and unemployment rate (UE70).</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="spatial-heterogeneity-and-regression.html#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make linear model</span></span>
<span id="cb621-2"><a href="spatial-heterogeneity-and-regression.html#cb621-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(HR70 <span class="sc">~</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70, <span class="at">data =</span> ncovr)</span>
<span id="cb621-3"><a href="spatial-heterogeneity-and-regression.html#cb621-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = HR70 ~ RD70 + PS70 + MA70 + DV70 + UE70, data = ncovr)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -21.12  -3.14  -1.02   1.90  69.75 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.1376     0.7602   14.65   &lt;2e-16 ***
## RD70          4.1541     0.1147   36.23   &lt;2e-16 ***
## PS70          1.1449     0.1165    9.82   &lt;2e-16 ***
## MA70         -0.2080     0.0233   -8.94   &lt;2e-16 ***
## DV70          1.4066     0.1064   13.22   &lt;2e-16 ***
## UE70         -0.4268     0.0497   -8.59   &lt;2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.03 on 3079 degrees of freedom
## Multiple R-squared:  0.328,  Adjusted R-squared:  0.327 
## F-statistic:  301 on 5 and 3079 DF,  p-value: &lt;2e-16</code></pre>
<p>And now, to get an idea of how our model might perform differently in different area, we can map the residuals across each county:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="spatial-heterogeneity-and-regression.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map residuals</span></span>
<span id="cb623-2"><a href="spatial-heterogeneity-and-regression.html#cb623-2" aria-hidden="true" tabindex="-1"></a>ncovr<span class="sc">$</span>resids <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb623-3"><a href="spatial-heterogeneity-and-regression.html#cb623-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(ncovr, <span class="at">fill =</span> <span class="st">&quot;resids&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-384"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-384-1.png" alt="Map of model residuals" width="672" />
<p class="caption">
FIGURE 13.2: Map of model residuals
</p>
</div>
<p>If we see that there is a geographic pattern in the residuals, it is possible that an unobserved variable may be influencing the dependent variable, and there might be some sort of spatial variation in our model’s performance. This is what GWR allows us to explore, whether the relationship between our variables is stable over space.</p>
<div id="calculate-kernel-bandwidth" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Calculate kernel bandwidth<a href="spatial-heterogeneity-and-regression.html#calculate-kernel-bandwidth" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The big assumption on which the GWR model is based is the kernel bandwitdh. As mentioned earlier, in order to calculate local coefficients for our study regions, GWR takes into account the data points within our specified bandwith, weighting them appropriately. The bendwidth we choose will determine our results. If we choose something too large, we might mask variation, and get resuls similar to the global results. If we choose something too small, we might get spikes, and lots of small scale variation, but also possibly large standard errors and unreliable estimates. Therefore, the process of choosing an appropriate bandwidth is paramount to GWR.</p>
<p>It is possible that we choose bandwidth manually, based on some prior knowledge, or theoretically based argument. However, if we do not have such ideas to start, we can use data-driven processes to inform our selection. The most frequently used approach is to use cross validation. Other approaches include Akaike Information Criteria, and maximum likelihood.</p>
<p>Here we use <code>gwr.sel()</code> which uses cross validation method for selecting optimal method for GWR. The function finds a bandwidth for a given geographically weighted regression by optimizing a selected function. For cross-validation, this scores the root mean square prediction error for the geographically weighted regressions, choosing the bandwidth minimizing this quantity.</p>
<p>With adapt function you can choose whether you want the bandwidth to adapt (i.e. find the proportion between 0 and 1 of observations to include in weighting scheme (k-nearest neighbours)) or whether you want to find a global bandwidth. A global bandwidth might make sense where the areas of interest are of equal size, and equally spaced, however if we have variation, for example like in the case of the counties of the United States, it makes sense to adjust the bandwidth for each observation. Here we set to adapt.</p>
<p>Another important consideration is the function for the geographical weighting. We mentioned this above. In the <code>gwr.sel()</code> function you can set this with the <code>gweight=</code> parameter. By default, this is set to a Gaussian function. We will keep it that way here.</p>
<p>With an sf object (whcih our data are in), one of the parameters required is a coordinate point for each one of our observations. In this case, what we can do is grab the centroid of each one of our polygons. To do this, we can use the <code>st_coordinates()</code> function:</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="spatial-heterogeneity-and-regression.html#cb624-1" aria-hidden="true" tabindex="-1"></a>ncovr <span class="ot">&lt;-</span> ncovr <span class="sc">%&gt;%</span> </span>
<span id="cb624-2"><a href="spatial-heterogeneity-and-regression.html#cb624-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cent_coords =</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(.)))</span></code></pre></div>
<p>Now that we have our centroids, we can calculate our optimal bandwith, and save this into an object called <code>gwr_bandwidth</code>.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="spatial-heterogeneity-and-regression.html#cb625-1" aria-hidden="true" tabindex="-1"></a>gwr_bandwidth <span class="ot">&lt;-</span> <span class="fu">gwr.sel</span>(HR70 <span class="sc">~</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70, </span>
<span id="cb625-2"><a href="spatial-heterogeneity-and-regression.html#cb625-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> ncovr, </span>
<span id="cb625-3"><a href="spatial-heterogeneity-and-regression.html#cb625-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">coords =</span> ncovr<span class="sc">$</span>cent_coords, </span>
<span id="cb625-4"><a href="spatial-heterogeneity-and-regression.html#cb625-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">adapt =</span> T)</span></code></pre></div>
<pre><code>## Adaptive q: 0.382 CV score: 109039 
## Adaptive q: 0.618 CV score: 110549 
## Adaptive q: 0.2361 CV score: 107560 
## Adaptive q: 0.1459 CV score: 105925 
## Adaptive q: 0.09017 CV score: 104176 
## Adaptive q: 0.05573 CV score: 102283 
## Adaptive q: 0.03444 CV score: 100199 
## Adaptive q: 0.02129 CV score: 98707 
## Adaptive q: 0.01316 CV score: 98388 
## Adaptive q: 0.01161 CV score: 98447 
## Adaptive q: 0.01475 CV score: 98373 
## Adaptive q: 0.0145 CV score: 98390 
## Adaptive q: 0.01725 CV score: 98566 
## Adaptive q: 0.01571 CV score: 98411 
## Adaptive q: 0.01512 CV score: 98356 
## Adaptive q: 0.01534 CV score: 98364 
## Adaptive q: 0.01508 CV score: 98358 
## Adaptive q: 0.01517 CV score: 98354 
## Adaptive q: 0.01524 CV score: 98351 
## Adaptive q: 0.01528 CV score: 98356 
## Adaptive q: 0.01524 CV score: 98351</code></pre>
<p>So we now have our bandwidth. It is:</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="spatial-heterogeneity-and-regression.html#cb627-1" aria-hidden="true" tabindex="-1"></a>gwr_bandwidth</span></code></pre></div>
<pre><code>## [1] 0.01524</code></pre>
<p>As our data are in WGS84 this value is in degrees.</p>
</div>
<div id="building-the-geographically-weighted-model" class="section level3 hasAnchor" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Building the geographically weighted model<a href="spatial-heterogeneity-and-regression.html#building-the-geographically-weighted-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we can build our model. The <code>gwr()</code> function implements the basic geographically weighted regression approach to exploring spatial non-stationarity for given bandwidth and chosen weighting scheme. We specify the formula and our data soucre, as with the linear and spatial regressions, and the coords of the centroids, as we did in the bandwidth calculation above, but now we also specify our bandwith, which we created earlier, but we do this with the <code>adapt=</code> parameter. This is because, by default, the function takes a global bandwidth with the <code>bandwidth=</code> parameter, and we have created an adaptive bandwidth, so we shall use this <code>adapt=</code> parameter to include our <code>GWRbandwidth</code> object. We also set the <code>hatmatrix =</code> parameter to <code>TRUE</code>, to return the hatmatrix as a component of the result, and the <code>se.fit=</code> parameter to <code>TRUE</code> to return local coefficient standard errors - as we set hatmatrix to <code>TRUE</code>, two effective degrees of freedom sigmas will be used to generate alternative coefficient standard errors.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="spatial-heterogeneity-and-regression.html#cb629-1" aria-hidden="true" tabindex="-1"></a>gwr_model <span class="ot">=</span> <span class="fu">gwr</span>(HR70 <span class="sc">~</span> RD70 <span class="sc">+</span> PS70 <span class="sc">+</span> MA70 <span class="sc">+</span> DV70 <span class="sc">+</span> UE70, <span class="at">data =</span> ncovr,</span>
<span id="cb629-2"><a href="spatial-heterogeneity-and-regression.html#cb629-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">coords =</span> ncovr<span class="sc">$</span>cent_coords,</span>
<span id="cb629-3"><a href="spatial-heterogeneity-and-regression.html#cb629-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">adapt=</span>gwr_bandwidth,</span>
<span id="cb629-4"><a href="spatial-heterogeneity-and-regression.html#cb629-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">hatmatrix=</span><span class="cn">TRUE</span>,</span>
<span id="cb629-5"><a href="spatial-heterogeneity-and-regression.html#cb629-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">se.fit=</span><span class="cn">TRUE</span>) </span>
<span id="cb629-6"><a href="spatial-heterogeneity-and-regression.html#cb629-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb629-7"><a href="spatial-heterogeneity-and-regression.html#cb629-7" aria-hidden="true" tabindex="-1"></a>gwr_model</span></code></pre></div>
<pre><code>## Call:
## gwr(formula = HR70 ~ RD70 + PS70 + MA70 + DV70 + UE70, data = ncovr, 
##     coords = ncovr$cent_coords, adapt = gwr_bandwidth, hatmatrix = TRUE, 
##     se.fit = TRUE)
## Kernel function: gwr.Gauss 
## Adaptive quantile: 0.01524 (about 47 of 3085 data points)
## Summary of GWR coefficient estimates at data points:
##                 Min. 1st Qu.  Median 3rd Qu.    Max.
## X.Intercept. -4.2897  4.4361  7.4395 12.3212 30.1335
## RD70         -0.3625  2.0168  2.8788  3.8206  6.6405
## PS70         -4.0630  0.2914  1.0987  1.9019  3.4998
## MA70         -0.6831 -0.2072 -0.1028 -0.0186  0.2971
## DV70         -0.7513  0.5368  0.9652  1.4351  3.1027
## UE70         -1.4895 -0.4286 -0.1787 -0.0220  1.8486
##              Global
## X.Intercept.  11.14
## RD70           4.15
## PS70           1.14
## MA70          -0.21
## DV70           1.41
## UE70          -0.43
## Number of data points: 3085 
## Effective number of parameters (residual: 2traceS - traceS&#39;S): 244 
## Effective degrees of freedom (residual: 2traceS - traceS&#39;S): 2841 
## Sigma (residual: 2traceS - traceS&#39;S): 5.405 
## Effective number of parameters (model: traceS): 171.2 
## Effective degrees of freedom (model: traceS): 2914 
## Sigma (model: traceS): 5.337 
## Sigma (ML): 5.186 
## AICc (GWR p. 61, eq 2.33; p. 96, eq. 4.21): 19276 
## AIC (GWR p. 96, eq. 4.22): 19082 
## Residual sum of squares: 82986 
## Quasi-global R2: 0.5022</code></pre>
<p>This output tells us the 5-number summary for the coefficients (<span class="math inline">\(Y\)</span>) for each predictor variable <span class="math inline">\(X\)</span>. We can see for all predictor variables, some counties have negative values, while other counties have positive values. Evidently there is some variation locally in the relationships between these independent variables and our dependent variable.</p>
<p>For this to be informative however, we should map this variation - this is where we can gain insight into how the relationships may change over our study area. In our <code>gwr_model</code> object we have a <em>S</em>patial <em>D</em>ata <em>F</em>rame. This is a <em>SpatialPointsDataFrame</em> or <em>SpatialPolygonsDataFrame</em> object which contains fit.points, weights, GWR coefficient estimates, R-squared, and coefficient standard errors in its “data” slot. Let’s extract this into another object called <code>gwr_results</code>:</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="spatial-heterogeneity-and-regression.html#cb631-1" aria-hidden="true" tabindex="-1"></a>gwr_results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwr_model<span class="sc">$</span>SDF)</span></code></pre></div>
<p>To map this, we can join these results back to our original data frame.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="spatial-heterogeneity-and-regression.html#cb632-1" aria-hidden="true" tabindex="-1"></a>gwr_results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ncovr, gwr_results)</span></code></pre></div>
<p>Now we can begin to map our results. First, let’s see how well the model performs across the different counties of the United States. To do this, we can map the <code>localR2</code> value which contains the local <span class="math inline">\(R^2\)</span> value for each observation.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="spatial-heterogeneity-and-regression.html#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(gwr_results, <span class="at">fill =</span>  <span class="st">&quot;localR2&quot;</span> )</span></code></pre></div>
<pre><code>## old-style crs object detected; please recreate object with a recent sf::st_crs()
## old-style crs object detected; please recreate object with a recent sf::st_crs()
## old-style crs object detected; please recreate object with a recent sf::st_crs()
## old-style crs object detected; please recreate object with a recent sf::st_crs()
## old-style crs object detected; please recreate object with a recent sf::st_crs()</code></pre>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-386"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-386-1.png" alt="Map of local R-square value for each county" width="672" />
<p class="caption">
FIGURE 13.3: Map of local R-square value for each county
</p>
</div>
<p>We can see some really neat spatial patterns in how well our model performs in various regions of the United States. Our model performs really well in the North East for example, but not so well in the South.</p>
<p>We can also map the coefficients for specific variables. Let’s say we’re interested in how the relationship between Resource deprivation (RD70) and homicide rate.</p>
<blockquote>
<p><strong>NOTE:</strong> In our <code>gwr_results</code> data frame we have a varaible called <code>RD70</code>, this contains the observed resource deprivation value for the county. We then have <code>RD70.1</code> this is the coefficient value for each county. In the results contained in the SDF element of our model (<code>gwr_model$SDF</code>) it was named <code>RD70</code> but when we joined the two object, the <code>.1</code> was appended to allow us to differentiate between the two.</p>
</blockquote>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="spatial-heterogeneity-and-regression.html#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(gwr_results, <span class="at">fill =</span>  <span class="st">&quot;RD70.1&quot;</span> )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-387"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-387-1.png" alt="Map of coefficient for resource deprivation value for each county" width="672" />
<p class="caption">
FIGURE 13.4: Map of coefficient for resource deprivation value for each county
</p>
</div>
<p>We can see in this map again some regional patterns in the coefficient of Resource deprivation. There are even counties, in Texas, and in Florida, where the direction of this relationship flips, that is we have negative coefficients - so resource deprivation is associated with <em>lower</em> homicide rates in these counties.</p>
<p>This may be interesting and raise questions, however, it is important to consider not only the coefficients, but also the <em>standard errors</em> associated with them, so we can get some ideas behind the reliability of these estimates. So let us have a look by mapping the standard errors for these coefficients, which are contained in the <code>RD70_se</code> variable.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="spatial-heterogeneity-and-regression.html#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(gwr_results, <span class="at">fill =</span>  <span class="st">&quot;RD70_se&quot;</span> )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-388"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-388-1.png" alt="Map of standard error for resource deprivation value for each county" width="672" />
<p class="caption">
FIGURE 13.5: Map of standard error for resource deprivation value for each county
</p>
</div>
<p>Higher standard errors mean that our estimates may be less reliable. So it is important to keep in mind both maps, the one with the coefficients, and the one showing the standard errors, when drawing conclusions from our GWR results.</p>
</div>
<div id="using-gwr" class="section level3 hasAnchor" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> Using GWR<a href="spatial-heterogeneity-and-regression.html#using-gwr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Overall, GWR is a good <strong>exploratory</strong> tool which can help illustrate how a particular model might apply differently in different regions of your study area, or how relationships between variables may vary spatially. This technique can be extended, for example to count models, or logit models, but (following the lead of Luc Anselin) we stop here, and pause to highlight some issues. Specifically, our <em>results are very sensitive to our choice of bandwidth</em>. The results we achieve with this approach might not show up when we use other bandwiths. Additionally, GWR does not really <em>explain</em> anything. What we do, is demonstrate that the relationship between our variables is not stable over space. But we cannot with this technique explain <em>why</em> it is not stable over space.</p>
<p>Nevertheless it is a great technique to identify spatial variation, which, unlike spatial regimes, does not rely on our a-priory segmentation of our study region, but instead allows for the variation to emerge from the data themselves.</p>
</div>
</div>
<div id="summary-and-further-reading-9" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Summary and further reading<a href="spatial-heterogeneity-and-regression.html#summary-and-further-reading-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter has tackled some of the issues of spatial heterogeneity in regression results. When applying regression in a spatial context, it is possible to encounter situations where we might observe a different effect on our variables in different parts of our study area. SPecifically, we covered two approaches to exploring this. The first one was to impose some a-priori segmentation to our data, based on contextual knowledge and possible patterns in our regression results. We illustrated this by imposing spatial regimes in our NCOVR data set, splitting into separate North and South USA, as was done by the original authors of the paper <span class="citation">Baller et al. (<a href="#ref-Baller_2001" role="doc-biblioref">2001</a>)</span>. The second approach was to explore how the coefficients may vary across our study space by applying Geographically Weighted Regression to our study area. We provided a high-level overview of this process and recommended it as an illustrative, exploratory technique to raise questions about possible spatial heterogeneity in the processes we are trying to model in our study region.</p>
<p>To delve into greater detail on the topic of spatial heterogeneity, Chapters 8 and 9 in <span class="citation">Anselin (<a href="#ref-Anselin_2007" role="doc-biblioref">2007</a>)</span> discuss specification of spatial heterogeneity. This is particularly helpful as an introduction to the issues and solutions we have discussed in this chapter. For more details and applications of Geographically Weighted Regression, we recommend <span class="citation">Fotheringham, Brunsdon, and Charlton (<a href="#ref-Fotheringham_2003" role="doc-biblioref">2003</a>)</span>. For applications and an illustration of the importance to consider spatial variation within the context of criminology and crime analysis, read <span class="citation">Cahill and Mulligan (<a href="#ref-Cahill_2007" role="doc-biblioref">2007</a>)</span> and <span class="citation">Andresen and Ha (<a href="#ref-Andresen_2020b" role="doc-biblioref">2020</a>)</span> as good examples.</p>
<p>And for those wishing to explore additional ways to model spatial interactions, such as CAR and Bayesian models, we suggest to read <span class="citation">Banerjee, Carlin, and Gelfand (<a href="#ref-Banerjee_2014" role="doc-biblioref">2014</a>)</span> as well as Chapters 9 and 10 in <span class="citation">Bivand, Pebesma, and Gómez-Rubio (<a href="#ref-Bivand_2013" role="doc-biblioref">2013</a>)</span>.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Andresen_2020b" class="csl-entry">
Andresen, Martin, and Olivia Ha. 2020. <span>“Spatially Varying Relationships Between Immigration Measures and Property Crime Types in Vancouver Census Tracts, 2016.”</span> <em>The British Journal of Criminology</em> 60 (5): 1342–67.
</div>
<div id="ref-Anselin_2007" class="csl-entry">
———. 2007. <em>Spatial Regression Analysis in r: A Workbook</em>. Center for Spatially Integrated Social Science.
</div>
<div id="ref-Baller_2001" class="csl-entry">
Baller, Robert, Luc Anselin, Steven Messner, Glenn Deane, and Darnell Hawkins. 2001. <span>“Structural Covariates of US County Homicide Rates: Incorporating Spatial Effects.”</span> <em>Criminology</em> 39 (3): 561–88.
</div>
<div id="ref-Banerjee_2014" class="csl-entry">
Banerjee, Sudipto, Bradley Carlin, and Alan Gelfand. 2014. <em>Hierarchical Modeling and Analysis for Spatial Data</em>. CRC press.
</div>
<div id="ref-Bivand_2013" class="csl-entry">
Bivand, Roger, Edzer Pebesma, and Virgilio Gómez-Rubio. 2013. <em>Applied Spatial Data Analysis with r</em>. 2nd ed. New York: Springer.
</div>
<div id="ref-Cahill_2007" class="csl-entry">
Cahill, Meagan, and Gordon Mulligan. 2007. <span>“Using Geographically Weighted Regression to Explore Local Crime Patterns.”</span> <em>Social Science Computer Review</em> 25 (2): 174–93.
</div>
<div id="ref-Fotheringham_2003" class="csl-entry">
Fotheringham, AS, Chriss Brunsdon, and Martin Charlton. 2003. <em>Geographically Weighted Regression: The Analysis of Spatially Varying Relationships</em>. John Wiley &amp; Sons.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial-regression-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-a-quick-intro-to-r-and-rstudio.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/12-GWR.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["crime_mapping.pdf", "crime_mapping.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
