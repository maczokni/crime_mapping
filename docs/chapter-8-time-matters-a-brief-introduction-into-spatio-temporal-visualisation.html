<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation | Crime Mapping and Spatial Data Analysis using R</title>
  <meta name="description" content="Chapter 6 Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation | Crime Mapping and Spatial Data Analysis using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 6 Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="github-repo" content="maczokni/crime_mapping" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation | Crime Mapping and Spatial Data Analysis using R" />
  
  <meta name="twitter:description" content="Chapter 6 Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation | Crime Mapping and Spatial Data Analysis using R" />
  

<meta name="author" content="Juanjo Medina and Reka Solymosi" />


<meta name="date" content="2021-05-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-5-visualisation-good-cartographic-design.html"/>

<script src="libs/header-attrs-2.7.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Crime Mapping and Spatial Data Analysis using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble: how to use this book</a></li>
<li class="chapter" data-level="1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html"><i class="fa fa-check"></i><b>1</b> Producing your first crime map</a>
<ul>
<li class="chapter" data-level="1.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#geospatial-perspective-key-terms-and-ideas"><i class="fa fa-check"></i><b>1.2</b> Geospatial Perspective: key terms and ideas</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#place"><i class="fa fa-check"></i><b>1.2.1</b> Place</a></li>
<li class="chapter" data-level="1.2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#attributes"><i class="fa fa-check"></i><b>1.2.2</b> Attributes</a></li>
<li class="chapter" data-level="1.2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#spatial-objects"><i class="fa fa-check"></i><b>1.2.3</b> Spatial objects</a></li>
<li class="chapter" data-level="1.2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#networks"><i class="fa fa-check"></i><b>1.2.4</b> Networks</a></li>
<li class="chapter" data-level="1.2.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#maps-and-their-types"><i class="fa fa-check"></i><b>1.2.5</b> Maps and their types</a></li>
<li class="chapter" data-level="1.2.6" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#map-projections-and-geographic-coordinate-systems"><i class="fa fa-check"></i><b>1.2.6</b> Map projections and geographic coordinate systems</a></li>
<li class="chapter" data-level="1.2.7" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#summary"><i class="fa fa-check"></i><b>1.2.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#getting-started-with-crime-data"><i class="fa fa-check"></i><b>1.3</b> Getting started with crime data</a></li>
<li class="chapter" data-level="1.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#from-dataframes-to-spatial-objects"><i class="fa fa-check"></i><b>1.4</b> From dataframes to spatial objects</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-point"><i class="fa fa-check"></i><b>1.4.1</b> The point</a></li>
<li class="chapter" data-level="1.4.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-line"><i class="fa fa-check"></i><b>1.4.2</b> The line</a></li>
<li class="chapter" data-level="1.4.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-polygon"><i class="fa fa-check"></i><b>1.4.3</b> The polygon</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-simple-features-framework"><i class="fa fa-check"></i><b>1.5</b> The simple features framework</a></li>
<li class="chapter" data-level="1.6" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#plotting-data-with-ggplot2"><i class="fa fa-check"></i><b>1.6</b> Plotting data with ggplot2</a></li>
<li class="chapter" data-level="1.7" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-points"><i class="fa fa-check"></i><b>1.7</b> Mapping crime data as points</a></li>
<li class="chapter" data-level="1.8" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-polygons"><i class="fa fa-check"></i><b>1.8</b> Mapping crime data as polygons</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#finding-boundary-data"><i class="fa fa-check"></i><b>1.8.1</b> Finding boundary data</a></li>
<li class="chapter" data-level="1.8.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#reading-shapefiles-into-r"><i class="fa fa-check"></i><b>1.8.2</b> Reading shapefiles into R</a></li>
<li class="chapter" data-level="1.8.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>1.8.3</b> Data wrangling with dplyr</a></li>
<li class="chapter" data-level="1.8.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#join-data-to-sf-object"><i class="fa fa-check"></i><b>1.8.4</b> Join data to sf object</a></li>
<li class="chapter" data-level="1.8.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#putting-polygon-data-on-the-map"><i class="fa fa-check"></i><b>1.8.5</b> Putting polygon data on the map</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#summary-and-further-reading"><i class="fa fa-check"></i><b>1.9</b> Summary and Further reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html"><i class="fa fa-check"></i><b>2</b> Chapter 2: Basic geospatial operations in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#exploring-the-relationship-between-alcohol-outlets-and-crime"><i class="fa fa-check"></i><b>2.2</b> Exploring the relationship between alcohol outlets and crime</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#get-the-data"><i class="fa fa-check"></i><b>2.3</b> Get the data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#reading-in-crime-data"><i class="fa fa-check"></i><b>2.3.1</b> Reading in crime data</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#meet-a-new-format-geojson"><i class="fa fa-check"></i><b>2.3.2</b> Meet a new format: geojson</a></li>
<li class="chapter" data-level="2.3.3" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#open-street-map-and-points-of-interest"><i class="fa fa-check"></i><b>2.3.3</b> Open Street Map and points of interest</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#attribute-operations"><i class="fa fa-check"></i><b>2.4</b> Attribute operations</a></li>
<li class="chapter" data-level="2.5" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#spatial-operations"><i class="fa fa-check"></i><b>2.5</b> Spatial operations</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#reprojecting-coordinates"><i class="fa fa-check"></i><b>2.5.1</b> Reprojecting coordinates</a></li>
<li class="chapter" data-level="2.5.2" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#subsetting-points"><i class="fa fa-check"></i><b>2.5.2</b> Subsetting points</a></li>
<li class="chapter" data-level="2.5.3" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#building-buffers"><i class="fa fa-check"></i><b>2.5.3</b> Building buffers</a></li>
<li class="chapter" data-level="2.5.4" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#counting-points-within-a-polygon"><i class="fa fa-check"></i><b>2.5.4</b> Counting Points within a Polygon</a></li>
<li class="chapter" data-level="2.5.5" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#distances-finding-the-nearest-point"><i class="fa fa-check"></i><b>2.5.5</b> Distances: Finding the nearest point</a></li>
<li class="chapter" data-level="2.5.6" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#measuring-distances"><i class="fa fa-check"></i><b>2.5.6</b> Measuring distances</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#plotting-interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>2.6</b> Plotting interactive maps with leaflet</a></li>
<li class="chapter" data-level="2.7" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#geocoding"><i class="fa fa-check"></i><b>2.7</b> Geocoding</a></li>
<li class="chapter" data-level="2.8" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#measuring-distance-more-thoroughly"><i class="fa fa-check"></i><b>2.8</b> Measuring distance more thoroughly</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#how-far-are-police-stations-in-madrid"><i class="fa fa-check"></i><b>2.8.1</b> How far are police stations in Madrid?</a></li>
<li class="chapter" data-level="2.8.2" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#distance-in-geographical-space"><i class="fa fa-check"></i><b>2.8.2</b> Distance in geographical space</a></li>
<li class="chapter" data-level="2.8.3" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#a-practical-example-to-evaluate-distance"><i class="fa fa-check"></i><b>2.8.3</b> A practical example to evaluate distance</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="chapter-2-basic-geospatial-operations-in-r.html"><a href="chapter-2-basic-geospatial-operations-in-r.html#further-reading"><i class="fa fa-check"></i><b>2.9</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><i class="fa fa-check"></i><b>3</b> Chapter 3: Mapping rates and counts: choropleth and proportional symbol maps</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#thematic-maps-key-terms-and-ideas"><i class="fa fa-check"></i><b>3.2</b> Thematic maps: key terms and ideas</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#choropleth-maps"><i class="fa fa-check"></i><b>3.2.1</b> Choropleth maps</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#what-do-we-use-choropleth-maps-for"><i class="fa fa-check"></i><b>3.2.2</b> What do we use choropleth maps for?</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#proportional-and-graduate-symbol-maps-mapping-crime-counts"><i class="fa fa-check"></i><b>3.2.3</b> Proportional and graduate symbol maps: mapping crime counts</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#creating-proportional-symbol-maps-mapping-count-data-with-tmap"><i class="fa fa-check"></i><b>3.3</b> Creating proportional symbol maps: mapping count data with tmap</a></li>
<li class="chapter" data-level="3.4" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#mapping-rates-rather-than-counts"><i class="fa fa-check"></i><b>3.4</b> Mapping rates rather than counts</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#generating-the-rates"><i class="fa fa-check"></i><b>3.4.1</b> Generating the rates</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#creating-a-choropleth-map-with-tmap"><i class="fa fa-check"></i><b>3.4.2</b> Creating a choropleth map with tmap</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#classification-systems-for-thematic-maps"><i class="fa fa-check"></i><b>3.5</b> Classification systems for thematic maps</a></li>
<li class="chapter" data-level="3.6" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#interactive-mapping-with-tmap"><i class="fa fa-check"></i><b>3.6</b> Interactive mapping with tmap</a></li>
<li class="chapter" data-level="3.7" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#smoothing-rates-adjusting-for-small-sample-noise"><i class="fa fa-check"></i><b>3.7</b> Smoothing rates: adjusting for small sample noise</a></li>
<li class="chapter" data-level="3.8" data-path="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html"><a href="chapter-3-mapping-rates-and-counts-choropleth-and-proportional-symbol-maps.html#further-reading-1"><i class="fa fa-check"></i><b>3.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html"><i class="fa fa-check"></i><b>4</b> Chapter 4: Variations of thematic mapping</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#binning-points"><i class="fa fa-check"></i><b>4.2</b> Binning points</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#the-binning-process"><i class="fa fa-check"></i><b>4.2.1</b> The Binning Process</a></li>
<li class="chapter" data-level="4.2.2" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#different-binning-techniques"><i class="fa fa-check"></i><b>4.2.2</b> Different Binning Techniques</a></li>
<li class="chapter" data-level="4.2.3" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#benefits-of-binning"><i class="fa fa-check"></i><b>4.2.3</b> Benefits of Binning</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#transforming-polygons"><i class="fa fa-check"></i><b>4.3</b> Transforming polygons</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#dorling-cartogram"><i class="fa fa-check"></i><b>4.3.1</b> Dorling Cartogram</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#bivariate-maps"><i class="fa fa-check"></i><b>4.4</b> Bivariate Maps</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#step-1-bin-our-variables-of-interest"><i class="fa fa-check"></i><b>4.4.1</b> Step 1: Bin our variables of interest</a></li>
<li class="chapter" data-level="4.4.2" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#step-2-new-variable"><i class="fa fa-check"></i><b>4.4.2</b> Step 2: New variable</a></li>
<li class="chapter" data-level="4.4.3" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#step-3-create-colour-scheme"><i class="fa fa-check"></i><b>4.4.3</b> Step 3: Create colour scheme</a></li>
<li class="chapter" data-level="4.4.4" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#step-4-join-colour-scheme"><i class="fa fa-check"></i><b>4.4.4</b> Step 4: Join colour scheme</a></li>
<li class="chapter" data-level="4.4.5" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#step-5-create-legend"><i class="fa fa-check"></i><b>4.4.5</b> Step 5: Create legend</a></li>
<li class="chapter" data-level="4.4.6" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#step-6-map"><i class="fa fa-check"></i><b>4.4.6</b> Step 6: Map</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#a-note-of-caution-maup"><i class="fa fa-check"></i><b>4.5</b> A note of caution: MAUP</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#why-does-maup-matter"><i class="fa fa-check"></i><b>4.5.1</b> Why does MAUP matter?</a></li>
<li class="chapter" data-level="4.5.2" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#what-can-we-do"><i class="fa fa-check"></i><b>4.5.2</b> What can we do?</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#references-and-further-reading"><i class="fa fa-check"></i><b>4.6</b> References and further reading</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#binning"><i class="fa fa-check"></i><b>4.6.1</b> Binning</a></li>
<li class="chapter" data-level="4.6.2" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#maup"><i class="fa fa-check"></i><b>4.6.2</b> MAUP</a></li>
<li class="chapter" data-level="4.6.3" data-path="chapter-4-variations-of-thematic-mapping.html"><a href="chapter-4-variations-of-thematic-mapping.html#transforming-polygons-1"><i class="fa fa-check"></i><b>4.6.3</b> Transforming polygons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html"><i class="fa fa-check"></i><b>5</b> Chapter 5: Visualisation: good cartographic design</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#data-representation"><i class="fa fa-check"></i><b>5.2</b> Data representation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#thematic-maps"><i class="fa fa-check"></i><b>5.2.1</b> Thematic maps</a></li>
<li class="chapter" data-level="5.2.2" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#symbols"><i class="fa fa-check"></i><b>5.2.2</b> Symbols</a></li>
<li class="chapter" data-level="5.2.3" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#rate-v-count"><i class="fa fa-check"></i><b>5.2.3</b> Rate v count</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#colour"><i class="fa fa-check"></i><b>5.3</b> Colour</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#text"><i class="fa fa-check"></i><b>5.4</b> Text</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#titles-and-subtitles"><i class="fa fa-check"></i><b>5.4.1</b> Titles and subtitles</a></li>
<li class="chapter" data-level="5.4.2" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#legend"><i class="fa fa-check"></i><b>5.4.2</b> Legend</a></li>
<li class="chapter" data-level="5.4.3" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#annotation"><i class="fa fa-check"></i><b>5.4.3</b> Annotation</a></li>
<li class="chapter" data-level="5.4.4" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#production-notes"><i class="fa fa-check"></i><b>5.4.4</b> Production notes</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#composition"><i class="fa fa-check"></i><b>5.5</b> Composition</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#orientation-and-scale-indicators"><i class="fa fa-check"></i><b>5.5.1</b> Orientation and scale indicators</a></li>
<li class="chapter" data-level="5.5.2" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#strip-away-grids"><i class="fa fa-check"></i><b>5.5.2</b> Strip away grids</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#context"><i class="fa fa-check"></i><b>5.6</b> Context</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#basemap"><i class="fa fa-check"></i><b>5.6.1</b> Basemap</a></li>
<li class="chapter" data-level="5.6.2" data-path="chapter-5-visualisation-good-cartographic-design.html"><a href="chapter-5-visualisation-good-cartographic-design.html#inset-maps"><i class="fa fa-check"></i><b>5.6.2</b> Inset maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><i class="fa fa-check"></i><b>6</b> Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#getting-time-series-data-into-r-and-plotting-it"><i class="fa fa-check"></i><b>6.1</b> Getting time series data into R and plotting it</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#lubridate-your-guardian-angel-when-it-comes-to-working-with-temporal-data"><i class="fa fa-check"></i><b>6.2</b> Lubridate: your guardian angel when it comes to working with temporal data</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#calendar-heatmaps"><i class="fa fa-check"></i><b>6.3</b> Calendar heatmaps</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#decomposing-time-series"><i class="fa fa-check"></i><b>6.4</b> Decomposing time series</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#static-maps-with-ggplot2"><i class="fa fa-check"></i><b>6.5</b> Static maps with ggplot2</a></li>
<li class="chapter" data-level="6.6" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#small-multiples-to-show-temporal-variation"><i class="fa fa-check"></i><b>6.6</b> Small multiples to show temporal variation</a></li>
<li class="chapter" data-level="6.7" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#spaghetti-plots"><i class="fa fa-check"></i><b>6.7</b> Spaghetti plots</a></li>
<li class="chapter" data-level="6.8" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#animations"><i class="fa fa-check"></i><b>6.8</b> Animations!!!</a></li>
<li class="chapter" data-level="6.9" data-path="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#further-reading-2"><i class="fa fa-check"></i><b>6.9</b> Further reading</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime Mapping and Spatial Data Analysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Chapter 8: Time matters: a brief introduction into spatio-temporal visualisation</h1>
<p>The importance of place in criminology and crime analysis is widely recognise. We know certain areas can be crime hotspots. However time is just as important as place. We often hear that crime is “going up” or “going down” over time. These variations on the levels of crime along time also vary by space. These spatio temporal variations are of crucial importance for crime analysis, explanation, and prevention; yet traditionally the temporal and spatial analysis of crime has not been done in a combined manner. Although a great deal of energy has been devoted to produce accessible training material for crime analysts on geographic information systems and spatial analysis, most criminology degrees (even at postgraduate level) and training packages for crime analysis devote a very limited space (if any) to the appropriate visualisation and analysis of temporal and spatiotemporal data. Therefore, before we discuss the spatio temporal, we have to introduce a few key ideas and concepts about temporal crime analysis.</p>
<p><strong>Temporal crime analysis</strong> looks at trends in crime or incidents. A crime or incident trend is a broad direction or pattern that specific types or general crime and/or incidents are following. Three types of trend can be identified:</p>
<ul>
<li><em>overall trend</em> – highlights if the problem is getting worse, better or staying the same over a period of time</li>
<li><em>seasonal, monthly, weekly or daily cycles of offences</em> – identified by comparing previous time periods with the same period being analysed</li>
<li><em>random fluctuations</em> – caused by a large number of minor influences, or a one-off event, and can include displacement of crime from neighbouring areas due to partnership activity or crime initiatives.</li>
</ul>
<p>Decomposing these trends is an important part of what <strong>time series</strong> analysis is all about. We will see some examples.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic reading and data carpentry</span></span>
<span id="cb315-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb315-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb315-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># adds functionality for better handling of temporal data</span></span>
<span id="cb315-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-6"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for handling spatial data</span></span>
<span id="cb315-7"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb315-8"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spacetime)</span>
<span id="cb315-9"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb315-10"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-11"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-11" aria-hidden="true" tabindex="-1"></a><span class="co"># General visualisation and ggplot plugins for temporal data</span></span>
<span id="cb315-12"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb315-13"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb315-14"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggTimeSeries)</span>
<span id="cb315-15"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggseas)</span>
<span id="cb315-16"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb315-17"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb315-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span></code></pre></div>
<div id="getting-time-series-data-into-r-and-plotting-it" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Getting time series data into R and plotting it</h2>
<p>We are going to start with fairly simple data. We are just going to look at monthly counts of crime for Greater Manchester obtained from the Police.UK website. We have aggregated 36 months of data into a file for you to use. Grab the data using the following code:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb316-1" aria-hidden="true" tabindex="-1"></a>data_url <span class="ot">&lt;-</span><span class="st">&quot;https://raw.githubusercontent.com/maczokni/crimemapping_textbook_bookdown/master/data/gmp_month.csv&quot;</span></span>
<span id="cb316-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb316-2" aria-hidden="true" tabindex="-1"></a>gmp_month <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(data_url))</span></code></pre></div>
<p>If you view the data you will see it has two columns, the date and the count of crimes for that month. Once you have read the time series data into R, the next step is to store the data in a time series object in R, so that you can use R’s many functions for analysing time series data. To store the data in a time series object, we use the <code>stats::ts()</code> function in R.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First we select the relevant column</span></span>
<span id="cb317-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb317-2" aria-hidden="true" tabindex="-1"></a>gmp_month_c <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(gmp_month, count)</span>
<span id="cb317-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Then we create the time series object</span></span>
<span id="cb317-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb317-4" aria-hidden="true" tabindex="-1"></a>gmp_timeseries <span class="ot">&lt;-</span> <span class="fu">ts</span>(gmp_month_c)</span></code></pre></div>
<p>You can auto print to see the result:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb318-1" aria-hidden="true" tabindex="-1"></a>gmp_timeseries</span></code></pre></div>
<p>Sometimes the time series data set that you have may have been collected at regular intervals that were less than one year, for example, monthly or quarterly. In this case, you can specify the number of times that data was collected per year by using the <code>frequency</code> parameter in the <code>ts()</code> function. For monthly time series data, you set <code>frequency=12</code>, while for quarterly time series data, you set <code>frequency=4.</code></p>
<p>You can also specify the first year that the data was collected, and the first interval in that year by using the <code>start</code> parameter in the <code>ts()</code> function. So, in our case, we would do as follows:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb319-1" aria-hidden="true" tabindex="-1"></a>gmp_timeseries <span class="ot">&lt;-</span> <span class="fu">ts</span>(gmp_month_c, <span class="at">frequency=</span><span class="dv">12</span>, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2016</span>,<span class="dv">2</span>))</span></code></pre></div>
<p>Once you have read a time series into R, the next step is usually to make a plot of the time series data, which you can do with the <code>stats::plot.ts()</code> function in R.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(gmp_timeseries)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/plot.ts_8a-1.png" width="672" /></p>
<p>We can of course also use <code>ggplot2</code>to plot a time series like the one we just did but here we would need a variable encoding the date (and preferably a full date, not just month and year as here). If you look a “gmp_month” you will see the name of the variables are not optimal, so we will rename them first.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb321-1" aria-hidden="true" tabindex="-1"></a>gmp_month <span class="ot">&lt;-</span> <span class="fu">rename</span>(gmp_month, <span class="at">date =</span> as.factor.Month., <span class="at">crime =</span> count)</span>
<span id="cb321-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>gmp_month, <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>crime, <span class="at">group=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb321-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb321-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb321-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb321-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb321-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb321-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/ggplot_8a-1.png" width="672" /></p>
<p>If we had a date vector rather than a factor encoding our date we would need to adapt our code. See <a href="http://www.sthda.com/english/articles/32-r-graphics-essentials/128-plot-time-series-data-using-ggplot/">here</a> for further details.</p>
<p>Alternatively we can use <code>ggfortify</code>, an extension to <code>ggplot2</code> that would allow us to use <code>ts</code> objects as inputs. For this we use the <code>ggplot2::autoplot()</code> function, which can be used to draw a particular plot for an object of a particular class in a single command.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(gmp_timeseries)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/autoplot_8a-1.png" width="672" /></p>
</div>
<div id="lubridate-your-guardian-angel-when-it-comes-to-working-with-temporal-data" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Lubridate: your guardian angel when it comes to working with temporal data</h2>
<p>As you saw, the data from Police.Uk is aggregated by months. We do not know when the offences happened, only the month, but nothing more granular than that. American police data publicly released, on the other hand, is much more granular.</p>
<p>Here, we will be looking at crimes from New York City on aggravated assault. The data comes from an open source initiative maintained by Matt Ashby <a href="https://osf.io/zyaqn/">here</a>. We have already filter and selected the data so that we are only working with aggravated assaults from New York for a period of five years.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb323-1" aria-hidden="true" tabindex="-1"></a>agassault_ny<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/maczokni/crimemapping_textbook_bookdown/master/data/agassault.csv&quot;</span>)</span></code></pre></div>
<p>When you read the data into R, you will see that there is a column for date called <strong>date_single</strong>. The date is in the format dd/mm/yyyy and h/m/s. So the first date on there you can see is <em>2014-01-01 00:03:00</em>. What kind of variable is this?</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(agassault_ny<span class="sc">$</span>date_single)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p>Our date and time variables are of class <code>POSIXct</code> and <code>POSIXt</code>. These are the two basic classes of date/times. Class “POSIXct” represents the (signed) <a href="https://en.wikipedia.org/wiki/Unix_time">number of seconds since the beginning of 1970</a> as a numeric vector. Class “POSIXt” is a named list of vectors representing seconds (0–61), minutes (0–59), hours (0–23), day of the month (1–31), months after the first of the year (0–11), years since 1900, day of the week, starting on Sunday (0–6), and a flag for whether it is daylight savings time or not (positive if in force, zero if not, negative if unknown).</p>
<p>Let’s plot this data:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb326-1" aria-hidden="true" tabindex="-1"></a>agassault_ny <span class="sc">%&gt;%</span> </span>
<span id="cb326-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date_single)) <span class="sc">+</span> </span>
<span id="cb326-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">7</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>) <span class="co"># 7 days in seconds</span></span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/ggplot_8b-1.png" width="672" /></p>
<p>Notice what <code>geom_freqpoly()</code> is doing. We have a dataframe with rows for each case. The data is not aggregated in any form. But this function counts on the fly the number of cases (of rows) for each of the bins as we define them. It is, thus, a convenient function that saves us from having to first do that aggregation ourselves when we want to plot it.</p>
<p>An alternative approach to plotting individual components is to round the date to a nearby unit of time, with <code>floor_date()</code>, <code>round_date()</code>, and <code>ceiling_date()</code>. Each function takes a vector of dates to adjust and then the name of the unit round down (floor), round up (ceiling), or round to. So to agregate per month we will code as:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb327-1" aria-hidden="true" tabindex="-1"></a>agassault_ny <span class="sc">%&gt;%</span> </span>
<span id="cb327-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">month =</span> <span class="fu">floor_date</span>(date_single, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(month, n)) <span class="sc">+</span></span>
<span id="cb327-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb327-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/ggplot_rounding_8b-1.png" width="672" /></p>
<p>What if I asked you the question: which year had the most aggravated assaults? Or what if I want to know if aggravated assaults happen more in the weekday, when people are at work, or in the weekends, maybe when people are away for a holiday? You have the date, so you should be able to answer these questions, right?</p>
<p>Well you need to be able to have the right variables to answer these questions. To know what year saw the most aggravated assaults, you need to have a variable for year. To know what day of the week has the most aggravated assaults, you need to have a variable for day of the week. So how can we extract these variables from your date column? Well luckily the <code>lubridate</code> package can help us do this. We can use the <code>lubridate::year()</code>, <code>lubridate::month()</code>, <code>lubridate::day()</code>, and <code>lubridate::wday()</code> to extract these components of a date-time.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb328-1" aria-hidden="true" tabindex="-1"></a>agassault_ny<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">year</span>(agassault_ny<span class="sc">$</span>date_single)</span>
<span id="cb328-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb328-2" aria-hidden="true" tabindex="-1"></a>agassault_ny<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">month</span>(agassault_ny<span class="sc">$</span>date_single, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>)</span>
<span id="cb328-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb328-3" aria-hidden="true" tabindex="-1"></a>agassault_ny<span class="sc">$</span>day <span class="ot">&lt;-</span> <span class="fu">day</span>(agassault_ny<span class="sc">$</span>date_single)</span>
<span id="cb328-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb328-4" aria-hidden="true" tabindex="-1"></a>agassault_ny<span class="sc">$</span>wday <span class="ot">&lt;-</span> <span class="fu">wday</span>(agassault_ny<span class="sc">$</span>date_single, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>And as you can see now you have a set of additional variables that have extracted information from your original time of occurrence variable. We can now, for example, look at the distribution of events per day of the week.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb329-1" aria-hidden="true" tabindex="-1"></a>agassault_ny <span class="sc">%&gt;%</span> </span>
<span id="cb329-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wday =</span> <span class="fu">wday</span>(date_single, <span class="at">label=</span><span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb329-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wday)) <span class="sc">+</span></span>
<span id="cb329-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb329-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/assaults_per_wday-1.png" width="672" /></p>
<p>The <code>lubridate</code> package is incredibly helpful for anything date related. There is also a more recent package <code>clock</code> that has only recently being released and solves some problems with… [[[]]]
[[[]]]</p>
</div>
<div id="calendar-heatmaps" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Calendar heatmaps</h2>
<p>We can also parse the temporal information that is available in our date variable. For the next chart we introduce we only need date, month, and year. We don’t need the time. We can use base functions <code>format()</code> and <code>as.POSIXct()</code> to create a character vector with only the temporal components that we need, as shown below.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb330-1" aria-hidden="true" tabindex="-1"></a>agassault_ny<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.POSIXct</span>(agassault_ny<span class="sc">$</span>date_single,<span class="at">format=</span><span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>),<span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb330-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(agassault_ny<span class="sc">$</span>date)</span></code></pre></div>
<pre><code>## [1] &quot;2014-01-01&quot; &quot;2014-01-01&quot; &quot;2014-01-01&quot; &quot;2014-01-01&quot; &quot;2014-01-01&quot;
## [6] &quot;2014-01-01&quot;</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(agassault_ny<span class="sc">$</span>date)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>On this character vector can now use <code>dplyr</code> to counts the events per day.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb334-1" aria-hidden="true" tabindex="-1"></a>agassault_ny_d <span class="ot">&lt;-</span> agassault_ny <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb334-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb334-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summarise</span>(<span class="at">assaults =</span> <span class="fu">n</span>())</span></code></pre></div>
<p>We will now use a <code>ggplot2</code> extension, <code>ggTimeSeries</code>, that allows us to produce calendar heat visualisations.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-1" aria-hidden="true" tabindex="-1"></a>agassault_ny_d<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(agassault_ny_d<span class="sc">$</span>date) <span class="co"># we parse the date again from the character vector we made. If you open the help function on this command, you can see that you can also load any other order than the year, month, and date order we used here</span></span>
<span id="cb335-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot_calendar_heatmap</span>(</span>
<span id="cb335-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-4" aria-hidden="true" tabindex="-1"></a>   agassault_ny_d,</span>
<span id="cb335-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;date&#39;</span>,</span>
<span id="cb335-6"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;assaults&#39;</span>)</span>
<span id="cb335-7"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Now we customise the plot a bit more</span></span>
<span id="cb335-8"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span></span>
<span id="cb335-9"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb335-10"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb335-11"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_continuous</span>(<span class="at">low =</span> <span class="st">&#39;green&#39;</span>, <span class="at">high =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb335-12"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb335-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="sc">~</span>Year, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
<p>There are many things that peak on certain days of the week. If you’re interested in some more examples, <a href="https://www.theguardian.com/lifeandstyle/2013/may/29/most-dangerous-day-of-week">read this article in the Guardian about the most dangerous days of the week</a>.</p>
</div>
<div id="decomposing-time-series" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Decomposing time series</h2>
<p>Decomposing a time series means separating it into its constituent components, which are usually a trend component and an irregular component, and if it is a seasonal time series, a seasonal component. Let’s get some fresh data. These are intimate partner femicides from Spain.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb336-1" aria-hidden="true" tabindex="-1"></a>fem <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://github.com/maczokni/crimemapping_textbook_bookdown/raw/master/data/fem.csv&quot;</span>)</span>
<span id="cb336-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fem)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;femicidios&quot;</span>)</span>
<span id="cb336-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb336-3" aria-hidden="true" tabindex="-1"></a>fem_timeseries <span class="ot">&lt;-</span> <span class="fu">ts</span>(fem, <span class="at">frequency=</span><span class="dv">12</span>, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2003</span>,<span class="dv">1</span>))</span>
<span id="cb336-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(fem_timeseries)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/load_plot_data_8c-1.png" width="672" /></p>
<p>As you can see it is very noisy. Fortunately, the annual count for intimate partner femicides is low in Spain. There seems to be some seasonality too.</p>
<p>A seasonal time series consists of a trend component, a seasonal component and an irregular component. Decomposing the time series means separating the time series into these three components: that is, using statistics to estimate these three components.</p>
<p>To estimate the trend component and seasonal component of a seasonal time series that can be described using an additive model, we can use the <code>stats::decompose()</code> function in R. This function estimates the trend, seasonal, and irregular components of a time series using moving averages. It deals with additive or multiplicative seasonal components (the default is additive).</p>
<p>The function <code>decompose()</code> returns a list object as its result, where the estimates of the seasonal component, trend component and irregular component are stored in named elements of that list objects, called “seasonal,” “trend,” and “random” respectively.</p>
<p>To estimate the trend, seasonal and irregular components of this time series, we type:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb337-1" aria-hidden="true" tabindex="-1"></a>fem_timeseriescomponents <span class="ot">&lt;-</span> <span class="fu">decompose</span>(fem_timeseries)</span></code></pre></div>
<p>The estimated values of the seasonal, trend and irregular components are now stored in variables <code>fem_timeseriescomponents$seasonal</code>, <code>fem_timeseriescomponents$trend</code> and <code>fem_timeseriescomponents$random</code>. For example, we can print out the estimated values of the seasonal component by typing:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb338-1" aria-hidden="true" tabindex="-1"></a>fem_timeseriescomponents<span class="sc">$</span>seasonal</span></code></pre></div>
<p>The estimated seasonal factors are given for the months January-December, and are the same for each year. The largest seasonal factor is for July (about 0.70), and the lowest is for February (about -0.76), indicating that there seems to be a peak in femicides in July and a trough in femicides in February each year. We can plot the estimated trend, seasonal, and irregular components of the time series by using the <code>plot()</code> function, for example:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fem_timeseriescomponents)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
<p>Once we remove the noise and the seasonal components, it becomes easier to see the estimated trend. Notice that while random and seasonal components still look messy, their scales are different and centred around zero.</p>
<p>We can adapt this code and what we learn in previous sections to decompose and estimate the trends for the aggravated assault data for NYC that we used earlier</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb340-1" aria-hidden="true" tabindex="-1"></a>agassault_ny_d2 <span class="ot">&lt;-</span>dplyr<span class="sc">::</span><span class="fu">select</span>(agassault_ny_d, assaults)</span>
<span id="cb340-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb340-2" aria-hidden="true" tabindex="-1"></a>ny_timeseries <span class="ot">&lt;-</span> <span class="fu">ts</span>(agassault_ny_d2, <span class="at">frequency=</span><span class="dv">365</span>, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2014</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb340-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb340-3" aria-hidden="true" tabindex="-1"></a>ny_timeseriescomponents <span class="ot">&lt;-</span> <span class="fu">decompose</span>(ny_timeseries)</span>
<span id="cb340-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb340-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ny_timeseriescomponents)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/decompose_8b-1.png" width="672" /></p>
<p>We can also use <code>ggplot2</code> for these purposes. In particular we can use the <code>ggseas</code> extension which allows for seasonal decomposition within <code>ggplot</code> — see <a href="https://github.com/ellisp/ggseas">here</a> for details. First I use the <code>ggseas::tsdf()</code> function that turns the <code>ts</code> object we just created into a dataframe and then plot the series.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb341-1" aria-hidden="true" tabindex="-1"></a>ny_df <span class="ot">&lt;-</span> <span class="fu">tsdf</span>(ny_timeseries)</span>
<span id="cb341-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsdc</span>(ny_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">method =</span> <span class="st">&quot;decompose&quot;</span>) <span class="sc">+</span></span>
<span id="cb341-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb341-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/ggseas-1.png" width="672" /></p>
</div>
<div id="static-maps-with-ggplot2" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Static maps with ggplot2</h2>
<p>So far we have seen how we can produce maps with <code>tmap</code>for thematic maps and <code>leaflet</code> for interactive maps. But we can also use static maps with <code>ggplot2</code>. For the next set of exercises we are going to look at temporal variations on burglary across Greater Manchester. We are going to focus on wards as the unit of analysis. You will likely work with this dataset for crime for your assignment and you may use wards or smaller geographies. So we will focus on this data for this illustration of basic plotting and spatial operations (in the next section).</p>
<p>To load the ward shapefiles for Manchester into a <code>sf</code> object we use code we had already used in a previous session.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb342-1" aria-hidden="true" tabindex="-1"></a>manchester_ward <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;https://raw.githubusercontent.com/RUMgroup/Spatial-data-in-R/master/rumgroup/data/wards.geojson&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `wards&#39; from data source `https://raw.githubusercontent.com/RUMgroup/Spatial-data-in-R/master/rumgroup/data/wards.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 215 features and 12 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 351664 ymin: 381168.6 xmax: 406087.5 ymax: 421039.8
## Projected CRS: OSGB 1936 / British National Grid</code></pre>
<p>With this data in our environment we can plot a map using <code>ggplot2</code>. We use the <code>geom_sf</code> function to tell <code>ggplot2</code> we are dealing with a <code>sf</code> object.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> manchester_ward, <span class="fu">aes</span>()) <span class="sc">+</span></span>
<span id="cb344-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb344-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-169-1.png" width="672" /></p>
<p>We can also plot objects that are not <code>sf</code> but have geographic coordinates.</p>
<p>Let’s load the data with the burglaries for Greater Manchester.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb345-1" aria-hidden="true" tabindex="-1"></a>gmp_bur <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/maczokni/crimemapping_textbook_bookdown/master/data/gmp_bur.csv&quot;</span>)</span></code></pre></div>
<p>You can see there is a column with the longitude and another with latitude. For this we can use the standard <code>geom_point</code> function specifying X and Y as our longitude and latitude. Given the number of points in the data I am also modifying the transparency and size of the points to deal with overplotting.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb346-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gmp_bur, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude), </span>
<span id="cb346-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb346-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb346-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb346-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-171-1.png" width="672" /></p>
<p>You could try to have a map with two layers, the points and the wards, so combining what we have done so far.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> manchester_ward, <span class="fu">aes</span>()) <span class="sc">+</span> </span>
<span id="cb347-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gmp_bur, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude)) <span class="sc">+</span> </span>
<span id="cb347-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb347-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>)<span class="sc">+</span></span>
<span id="cb347-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb347-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-172-1.png" width="672" /></p>
<p>Ooops. What happened? Can you think of what is going on here? This is something we have already covered in previous lab sessions.</p>
<p>In week 4 we explained how it is important to check that spatial operations that use two spatial objects rely on both objects having the same coordinate reference system, otherwise funny things may happen. We can check the coordinate reference system with the <code>st_crs</code> function from <code>sf</code>.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(manchester_ward)</span></code></pre></div>
<p>What is <code>EPGS: 27700</code>? You can check <a href="https://epsg.io/27700">here</a>. This is the British National Grid. How about the police data? Well, we don’t have a <code>sf</code> object, we have a dataframe for the burglaries. But if we look at the documentation for this data from the Police.UK website we can learn that they use WGS1984 instead. What do we do? First we need to create a <code>sf</code> object for the police data specifying the coordinate system (we covered how to do this in week 3).</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb349-1" aria-hidden="true" tabindex="-1"></a>burglary_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="at">x =</span> gmp_bur, </span>
<span id="cb349-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb349-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>),</span>
<span id="cb349-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb349-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span></code></pre></div>
<p>If we now check:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(burglary_sf)</span>
<span id="cb350-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(manchester_ward) <span class="sc">==</span> <span class="fu">st_crs</span>(burglary_sf)</span></code></pre></div>
<p>We can see the code 4326, which is basically the code for WGS84. And that the coordinate system across our two <code>sf</code> objects is different. We also covered this in week 4 but take this as a helpful refresher for the kind of things it is likely you need to do for your assignment. Essentially, we need to use the <code>st_transform</code> function. We need to make sure we translate one of these layers into the other coordinate reference system.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb351-1" aria-hidden="true" tabindex="-1"></a>wards_WGS84 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(manchester_ward, <span class="dv">4326</span>)</span>
<span id="cb351-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(wards_WGS84) <span class="sc">==</span> <span class="fu">st_crs</span>(burglary_sf)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Try now plotting the map.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> wards_WGS84, <span class="fu">aes</span>()) <span class="sc">+</span> </span>
<span id="cb353-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gmp_bur, <span class="fu">aes</span>(<span class="at">x =</span> Longitude, <span class="at">y =</span> Latitude),</span>
<span id="cb353-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb353-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb353-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb353-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>)<span class="sc">+</span></span>
<span id="cb353-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb353-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
</div>
<div id="small-multiples-to-show-temporal-variation" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Small multiples to show temporal variation</h2>
<p>We have covered small multiples before. You can indeed use facets to show how things change (or don’t change) across time. Let’s just focus on 2018 to simplify things a bit.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb354-1" aria-hidden="true" tabindex="-1"></a>bur_sf_2018 <span class="ot">&lt;-</span> <span class="fu">filter</span>(burglary_sf, stringr<span class="sc">::</span><span class="fu">str_detect</span>(Month, <span class="st">&#39;2018&#39;</span>)) <span class="co"># detect if there is 2018 anywhere in the Month value of a crime</span></span>
<span id="cb354-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bur_sf_2018<span class="sc">$</span>Month)</span></code></pre></div>
<pre><code>## 
## 2018-01 2018-02 2018-03 2018-04 2018-05 2018-06 2018-07 2018-08 2018-09 2018-10 
##    2649    2316    2566    2463    2534    2410    2458    2476    2450    2582 
## 2018-11 2018-12 
##    2701    2593</code></pre>
<p>Let’s simplify further by focusing just in Manchester City.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb356-1" aria-hidden="true" tabindex="-1"></a>mc_wards_WGS864 <span class="ot">&lt;-</span> <span class="fu">filter</span>(wards_WGS84, lad16nm <span class="sc">==</span> <span class="st">&quot;Manchester&quot;</span>)</span></code></pre></div>
<p>Ok, let’s do a point in polygon operation, count the number of burglaries per ward, so that we can display choropleth maps. Again, this is something we cover in week 4.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb357-1" aria-hidden="true" tabindex="-1"></a>bur_per_ward <span class="ot">&lt;-</span> bur_sf_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb357-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb357-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(mc_wards_WGS864, ., <span class="at">left =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb357-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb357-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(wd16nm)</span></code></pre></div>
<p>The code above only counts for the whole year. But if we want to have a map per month we don’t need the total counts for the whole year but rather the monthly counts.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb358-1" aria-hidden="true" tabindex="-1"></a>bur_per_ward <span class="ot">&lt;-</span> bur_sf_2018 <span class="sc">%&gt;%</span> </span>
<span id="cb358-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(mc_wards_WGS864, ., <span class="at">left =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb358-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(wd16nm, Month) <span class="co"># by default, this saves the count to a column named &#39;n&#39;</span></span></code></pre></div>
<p>As noted by <span class="citation"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Pebesma_2012" role="doc-biblioref">Pebesma</a> (<a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Pebesma_2012" role="doc-biblioref">2012</a>)</span>, spatio-temporal data often come in the form of single tables expressed in one of the three followingformats:
-<em>time-wide</em> where different columns reflect different moments in time,
-<em>space-wide</em> where different columns reflect different measurement locations or areas, or
-<em>long formats</em> where each record reflects a single time and space combination.</p>
<p>What we have in “bur_per_ward” if we view the data frame is a table expressed in the long format, where each row represents a single month and ward combination. We can see as well this is not simple a data table but a <code>sf</code>object which embeds the geographical information that allow us to place it in a map. We can now try to produce the small multiples.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bur_per_ward) <span class="sc">+</span> </span>
<span id="cb359-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb359-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;n&quot;</span>) <span class="sc">+</span></span>
<span id="cb359-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb359-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>() <span class="sc">+</span></span>
<span id="cb359-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb359-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="st">&quot;Month&quot;</span>, <span class="at">free.coords=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-182-1.png" width="672" /></p>
</div>
<div id="spaghetti-plots" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Spaghetti plots</h2>
<p>In longitudinal studies and in studies looking at areas over time, sometimes researchers use spaghetti plots. On their own they are not great, but they can used when one wants to put a trajectory within a broader context or when comparing different trajectories. You can read more about them <a href="https://www.storytellingwithdata.com/blog/2013/03/avoiding-spaghetti-graph">here</a>. Let’s first get rid of the “spatial component” for the data.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb360-1" aria-hidden="true" tabindex="-1"></a>spa_df <span class="ot">&lt;-</span> bur_per_ward</span>
<span id="cb360-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(spa_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb360-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb360-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(spa_df)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>To produce a simple spaghetti plot we can use <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spa_df, <span class="fu">aes</span>(<span class="at">x=</span>Month, <span class="at">y=</span>n, <span class="at">group =</span> wd16nm)) <span class="sc">+</span> </span>
<span id="cb362-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb362-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">colour=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Observation Time Point&quot;</span>) <span class="sc">+</span></span>
<span id="cb362-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Y&quot;</span>) <span class="sc">+</span></span>
<span id="cb362-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-184-1.png" width="672" /></p>
<p>As you can see we are grouping by ward. So in this case each line is the trend in crime for a single ward. We can use some of the power of <code>ggplot2</code> for example to extract the mean of Y and plot it along the trajectories. And we can also customise the graphic a bit.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spa_df, <span class="fu">aes</span>(<span class="at">x=</span>Month, <span class="at">y=</span>n, <span class="at">group=</span>wd16nm)) <span class="sc">+</span> </span>
<span id="cb363-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb363-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;darkgrey&quot;</span>) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">colour=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Observation Time Point&quot;</span>) <span class="sc">+</span> </span>
<span id="cb363-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb363-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">fun.y =</span> mean, <span class="at">shape =</span> <span class="dv">17</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb363-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb363-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-185-1.png" width="672" /></p>
<p>The <code>stat_summary</code> function is very helpful and we can use it to obtain other statistical summaries. See, for example, how we would plot the first and third quartile.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spa_df, <span class="fu">aes</span>(<span class="at">x=</span>Month, <span class="at">y=</span>n, <span class="at">group=</span>wd16nm)) <span class="sc">+</span> </span>
<span id="cb364-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb364-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;darkgrey&quot;</span>) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">colour=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Observation Time Point&quot;</span>) <span class="sc">+</span> </span>
<span id="cb364-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb364-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">fun.y =</span> quantile, </span>
<span id="cb364-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb364-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.args=</span>(<span class="fu">list</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))), <span class="at">shape =</span> <span class="dv">17</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb364-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb364-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-186-1.png" width="672" /></p>
<p>We can also obtained a smoothed representation of the average trend:</p>
<p>But typically you may want to use this kind of plots in different ways (see the article we linked to above). Here we are going to produce a plot highlighting the trajectory in Fallowfield. Before I do that I will create a new variable identifying Fallowfield.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb365-1" aria-hidden="true" tabindex="-1"></a>spa_df<span class="sc">$</span>fallowfield <span class="ot">&lt;-</span> <span class="st">&quot;No&quot;</span></span>
<span id="cb365-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb365-2" aria-hidden="true" tabindex="-1"></a>spa_df<span class="sc">$</span>fallowfield[spa_df<span class="sc">$</span>wd16nm<span class="sc">==</span><span class="st">&quot;Fallowfield&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Yes&quot;</span></span>
<span id="cb365-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(spa_df<span class="sc">$</span>fallowfield)</span></code></pre></div>
<pre><code>## 
##  No Yes 
## 372  12</code></pre>
<p>Now I can use this variable to plot the distinct trajectory of Fallowfield.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb367-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb367-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span> spa_df, <span class="fu">aes</span>(<span class="at">x=</span>Month, <span class="at">y=</span>n, <span class="at">group=</span>wd16nm), <span class="at">color=</span><span class="st">&quot;darkgrey&quot;</span>) <span class="sc">+</span></span>
<span id="cb367-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb367-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">data=</span> <span class="fu">subset</span>(spa_df, fallowfield<span class="sc">==</span><span class="st">&quot;Yes&quot;</span>), <span class="fu">aes</span>(<span class="at">x=</span>Month, <span class="at">y=</span>n, <span class="at">group=</span><span class="dv">1</span>),</span>
<span id="cb367-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb367-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>, <span class="at">size =</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb367-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb367-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Observation Time Point&quot;</span>) <span class="sc">+</span> </span>
<span id="cb367-6"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb367-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-189-1.png" width="672" /></p>
<p>Cool! Well, you haven’t seen it all yet.</p>
</div>
<div id="animations" class="section level2" number="6.8">
<h2><span class="header-section-number">6.8</span> Animations!!!</h2>
<p>You want a data viz person get excited? Mention animations! Now they are brought to <code>ggplot2</code> thanks to the <code>gganimate</code> extension.</p>
<p>The next one is a non-spatial plot, in that we do not show a map. However we will show the varying rate of burglaries per month within each ward. It is interesting to see this as an animation over time, rather than in the small multiples format, because it can better drive home the message of change (and also it looks very cool!).</p>
<p>So first thing we do is to load the <code>gganimate</code> package. Then, we need to make sure that our temporal variable is a date object. We can use the <code>ymd()</code> function, from the fantastic <code>lubridate</code> package (really I cannot praise this package enough, it makes handling dates so easy…!) to make sure that our Month variable is a date object.</p>
<p>But we have no day you say! Only month! How can we use <code>ymd()</code> which clearly requires <em>y</em>ear <em>m</em>onth ad <em>day</em>! Well, one approach is to make this up, and just say that everything in our data happened on the 1st of the month. We can use the <code>paste0()</code> function to do this:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb368-1" aria-hidden="true" tabindex="-1"></a>bur_per_ward<span class="sc">$</span>date_month <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="fu">paste0</span>(bur_per_ward<span class="sc">$</span>Month, <span class="st">&quot;-01&quot;</span>))</span></code></pre></div>
<p>Now, we can create a simple static plot, the way we already know how. Let’s plot the number of burglaries per ward, and save this in an object called <code>anim</code>:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-1" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bur_per_ward, <span class="fu">aes</span>(<span class="at">x =</span> wd16nm, <span class="at">y =</span> n, <span class="at">fill=</span><span class="fu">ifelse</span>(wd16nm<span class="sc">==</span><span class="st">&quot;Fallowfield&quot;</span>, <span class="st">&#39;Fallowfield&#39;</span>, <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb369-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb369-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb369-4"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb369-5"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Fallowfield&#39;</span> <span class="ot">=</span> <span class="st">&#39;blue&#39;</span>), <span class="at">na.value=</span><span class="st">&#39;gray50&#39;</span>, <span class="at">guide=</span>F) <span class="sc">+</span> <span class="co"># we&#39;re highlighting Fallowfield!</span></span>
<span id="cb369-6"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Burglary counts,&quot;</span>,</span>
<span id="cb369-7"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb369-8"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb369-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p>Now, finally, we can animate this graph. Take the object of the static graph (anim) and add a form of transition, which will be used to animate the graph. In this case, we can use <code>transition_states()</code>. This transition splits your data into multiple states based on the levels in a given column, much like <code>ggplot2::facet_wrap()</code> splits up the data in multiple panels. It then shifts between the defined states and pauses at each state. Layers with data without the specified column will be kept constant during the animation (again, mimicking facet_wrap). States are the unquoted name of the column holding the state levels in the data. You can then use the <code>closest_state</code> to dynamically label the graph:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb370-1" aria-hidden="true" tabindex="-1"></a>anim <span class="sc">+</span> <span class="fu">transition_states</span>(date_month, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb370-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Month: {closest_state}&quot;</span>)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-192-1.gif" /><!-- --></p>
<p>How cool is that!?</p>
<p>We can do this for maps as well. However, to apply <code>gganimate</code> to <code>sf</code> objects, you need to have a package called <code>transformr</code> installed. Install this package, and then we can apply <code>gganimate</code> to a map of burglaries.</p>
<p>Again make a static map:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb371-1" aria-hidden="true" tabindex="-1"></a>anim_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bur_per_ward, <span class="fu">aes</span>(<span class="at">fill =</span> n, <span class="at">color =</span> n)) <span class="sc">+</span> </span>
<span id="cb371-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb371-3"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span><span class="fu">subset</span>(bur_per_ward, wd16nm<span class="sc">==</span><span class="st">&#39;Fallowfield&#39;</span>), <span class="at">color=</span><span class="st">&#39;black&#39;</span>, <span class="at">fill=</span><span class="cn">NA</span>) <span class="co"># and we are drawing a black boundary around fallowfield this time</span></span></code></pre></div>
<p>And use <code>transition_states()</code> to animate by month.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb372-1" aria-hidden="true" tabindex="-1"></a>anim_map <span class="sc">+</span> <span class="fu">transition_states</span>(date_month, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb372-2"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#cb372-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Month: {closest_state}&quot;</span>)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-194-1.gif" /><!-- --></p>
</div>
<div id="further-reading-2" class="section level2" number="6.9">
<h2><span class="header-section-number">6.9</span> Further reading</h2>
<p>As noted there are packages that provide functionality for better handling of dates and time. It is worth to go over the details of ´lubridate´ in the official page (<a href="https://lubridate.tidyverse.org/" class="uri">https://lubridate.tidyverse.org/</a>) or in tutorials for this package (such as <a href="https://mikoontz.github.io/data-carpentry-week/lesson_lubridate.html" class="uri">https://mikoontz.github.io/data-carpentry-week/lesson_lubridate.html</a>). The relevant chapter in <span class="citation"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Wickham_2017" role="doc-biblioref">Wickham and Grolemund</a> (<a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Wickham_2017" role="doc-biblioref">2017</a>)</span> is also very helpful. There is a brand new package <code>clock</code> that aims to improve on <code>lubridate</code> and that is also worth exploring (for details see here: <a href="https://www.tidyverse.org/blog/2021/03/clock-0-1-0/" class="uri">https://www.tidyverse.org/blog/2021/03/clock-0-1-0/</a>). There is ample literature as well that dwells on the analysis and visualisation of time series data with R, such as <span class="citation"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Chatfield_2019" role="doc-biblioref">Chatfield and Xing</a> (<a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Chatfield_2019" role="doc-biblioref">2019</a>)</span> or <span class="citation">(<a href="#ref-Hyndman_2012" role="doc-biblioref"><strong>Hyndman_2012?</strong></a>)</span>, with the latter offering a free online version (<a href="https://otexts.com/fpp3/" class="uri">https://otexts.com/fpp3/</a>).</p>
<p>We have relied on standard packages to explore our spatial and temporal data. But there are also packages that specialise in providing methods for handling spatio-temporal data in R. Central among them is <code>spacetime</code>, which takes as inputs older <code>sp</code> objects (although work in <code>sftime</code>, to work with <code>sf</code> objects is ongoing). You can read more about <code>spacetime</code> in <span class="citation"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Pebesma_2012" role="doc-biblioref">Pebesma</a> (<a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Pebesma_2012" role="doc-biblioref">2012</a>)</span>. <span class="citation"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Pebesma_2012" role="doc-biblioref">Pebesma</a> (<a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Pebesma_2012" role="doc-biblioref">2012</a>)</span> also offers a very thoughtful introduction to how spatio-temporal data layouts appear and useful graphs for spatio temporal data. For additional details in how to visualise space-time data with R we suggest <span class="citation"><a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Perpiñan_2014" role="doc-biblioref">Lamigueiro</a> (<a href="chapter-8-time-matters-a-brief-introduction-into-spatio-temporal-visualisation.html#ref-Perpiñan_2014" role="doc-biblioref">2014</a>)</span> and Chapter 2 of <span class="citation">(<a href="#ref-Wikkle_2019" role="doc-biblioref"><strong>Wikkle_2019?</strong></a>)</span>.</p>
<p>[[All crimes occur at a specific date and time, however such definite temporal information is only available when victims or witnesses are present, alarms are triggered, etc., at the time of occurrence. This specific temporal data is most often available in crimes against persons. The great majority of reported events, however, are crimes against property. In these cases, there are seldom victims or witnesses present. These events may present the analyst with ‘ranged’ temporal data, that is, an event reported as occurring over a range of hours or even days. This presents particular challenges for analysts. [[[In the case of ranged temporal data, analysis is possible through use of equal chance or probability methods. If an event was reported as having occurred from Monday to Tuesday, in the absence of evidence to the contrary, it is assumed the event had an equal chance or probability of occurring on each of the two days, or .5 (%50). In the same manner, if an event was reported as having occurred over a 10 hour span there is a 10% chance the event occurred during any one of the hours. This technique requires a reasonable number of events in the data set to be effective. The resulting probabilities are totalled in each category and graphed or cross-tabulated. This produces a comparison of relative frequency, by weekday or hour <a href="http://cradpdf.drdc-rddc.gc.ca/PDFS/unc76/p530054.pdf">source</a>.]]]</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Andresen_2011" class="csl-entry">
Andresen, Martin. 2011. <span>“The Ambient Population and Crime Analysis.”</span> <em>The Professional Geographer</em> 63 (2): 193–212.
</div>
<div id="ref-Andresen_2020" class="csl-entry">
Andresen, Martin, Nick Malleson, Wouter Steenbek, Michael Townsley, and Christophe Vandeviver. 2020. <span>“Minimum Geocoding Match Rates: An International Study of the Impact of Data and Areal Unit Sizes.”</span> <em>International Journal of Geographical Information Science</em> 34 (7): 1306–22.
</div>
<div id="ref-Bolstad_2019" class="csl-entry">
Bolstad, Paul. 2019. <em>GIS Fundamentals: A First Text on Geographic Information Systems</em>. 6th ed. White Bear Lake, MN: Eider Press.
</div>
<div id="ref-Bowers_2021" class="csl-entry">
Bowers, Kate. n.d. <span>“Risky Places: Crime Absorbers, Crime Radiators as Risky Places.”</span> <a href="https://play.kth.se/media/Risky+PlacesA+Crime+absorbers,+crime+radiators+as+risky+places,+Prof+Kate+Bowers,+UCL/0_zya4j354">https://play.kth.se/media/Risky+PlacesA+Crime+absorbers,+crime+radiators+as+risky+places,+Prof+Kate+Bowers,+UCL/0_zya4j354</a>.
</div>
<div id="ref-Brantingham_1982" class="csl-entry">
Brantingham, Patricia L, and Paul J Brantingham. 1982. <span>“Mobility, Notoriety and Crime: A Study of Crime Patterns in Urban Nodal Points.”</span> <em>Journal of Environmental Systems</em> 11 (1): 89–99.
</div>
<div id="ref-Brantingham_1995" class="csl-entry">
Brantingham, Patricia, and Paul Brantingham. 1995. <span>“Criminality of Place: Crime Generators and Crime Attractors.”</span> <em>European Journal on Criminal Policy and Research</em> 3: 5–26.
</div>
<div id="ref-Brewer_2006" class="csl-entry">
Brewer, Cynthia. 2006. <span>“Basic Mapping Principles for Visualizing Cancer Data Using Geographic Information Systems (GIS).”</span> <em>American Journal of Preventive Medicine</em> 30 (2S): S25–36.
</div>
<div id="ref-Briggs_2017" class="csl-entry">
Briggs, Daniel, and Rubén Monge Gamero. 2017. <em>Dead-End Lives: Drugs and Violence in the City Shadows</em>. Bristol, UK: Policy Press.
</div>
<div id="ref-Bruinsma_2018" class="csl-entry">
Bruinsma, Gerben J. N., and Shane Johnson, eds. 2018. <em>The Oxford Handbook of Environmental Criminology</em>. Oxford, England: Oxford Univerisity Press.
</div>
<div id="ref-Buil-Gil_2021" class="csl-entry">
Buil-Gil, David, Juanjo Medina, and Natalie Shlomo. 2021. <span>“Measuring the Dark Figure of Crime in Geographic Areas: Small Area Estimation from the Crime Survey for England and Wales.”</span> <em>British Journal of Criminology</em> 61 (2): 364–88.
</div>
<div id="ref-Cairo_2016" class="csl-entry">
Cairo, Alberto. 2016. <em>The Truthful Art: Data, Charts, and Maps for Communication</em>. New Riders.
</div>
<div id="ref-Cameron_2005" class="csl-entry">
Cameron, James. 2005. In <em>Mapping Crime: Understanding Hot Spots</em>, edited by John Eck, Spencer Chainey, James Cameron, Michael Leitner, and Ronald Wilson, 35–64. Washington, DC: National Institute of Justice.
</div>
<div id="ref-Camoes_2016" class="csl-entry">
Camoes, Jorge. 2016. <em>Data at Work: Best Practices for Creating Effective Charts and Information Graphics in Microsoft Excel</em>. New Riders.
</div>
<div id="ref-Carr_2010" class="csl-entry">
Carr, Daniel, and Linda Pickle. 2010. <em>Visualizing Data Patterns with Micromaps</em>. Boca Raton, CA: CRC Press.
</div>
<div id="ref-Chainey_2005" class="csl-entry">
Chainey, Spencer, and Jerry Rattcliffe. 2005. <em>GIS and Crime Mapping</em>. Chichester, England: John Wiley; Sons.
</div>
<div id="ref-Chatfield_2019" class="csl-entry">
Chatfield, Chris, and Haipeng Xing. 2019. <em>The Analysis of Time Series: An Introduction with r</em>. 7th ed. Boca Ratón, CA: CRC Press.
</div>
<div id="ref-Cohen_1979" class="csl-entry">
Cohen, Lawrence E, and Marcus Felson. 1979. <span>“Social Change and Crime Rate Trends: A Routine Activity Approach.”</span> <em>American Sociological Review</em>, 588–608.
</div>
<div id="ref-HMIC_2014" class="csl-entry">
Constabulary, Her Majesty Inspectorate of. 2014. <span>“Crime Recording: Making the Victim Count.”</span> Final Report. HMIC.
</div>
<div id="ref-Cornish_1986" class="csl-entry">
Cornish, Derek B, and Ronald V Clarke. 1986. <span>“The Reasoning Criminal: Rational Choice Perspectives on Offending.”</span>
</div>
<div id="ref-Dorling_1996" class="csl-entry">
Dorling, D. 1996. <span>“Area Cartograms: Their Use and Creation, Concepts and Techniques in Modern Geography.”</span>
</div>
<div id="ref-Dougenik_1985" class="csl-entry">
Dougenik, James A, Nicholas R Chrisman, and Duane R Niemeyer. 1985. <span>“An Algorithm to Construct Continuous Area Cartograms.”</span> <em>The Professional Geographer</em> 37 (1): 75–81.
</div>
<div id="ref-Eck_2015" class="csl-entry">
Eck, John, and David L Weisburd. 2015. <span>“Crime Places in Crime Theory.”</span> <em>Crime and Place: Crime Prevention Studies</em> 4.
</div>
<div id="ref-Field_2018" class="csl-entry">
Field, Kenneth. 2018. <em>Cartography</em>. Redlands, CA: ESRI Press.
</div>
<div id="ref-Field_2012" class="csl-entry">
Field, Kenneth, and Damien Demaj. 2012. <span>“Reasserting Design Relevance in Cartography: Some Concepts.”</span> <em>The Cartographic Journal</em> 49 (1): 70–76.
</div>
<div id="ref-Field_2016" class="csl-entry">
Field, Kenneth, and Danny Dorling. 2016. <span>“UK Election Cartography.”</span> <em>International Journal of Cartography</em> 2: 202–32.
</div>
<div id="ref-Gelman_1999" class="csl-entry">
Gelman, Andrew, and Phillip Price. 1999. <span>“All Maps of Parameters Estimates Are Misleading.”</span> <em>Statistics in Medicine</em> 18: 3221–34.
</div>
<div id="ref-Goudriaan_2006" class="csl-entry">
Goudriaan, Heike, Karin Witterbrood, and Paul Nieuwbeerta. 2006. <span>“Neigbourhood Characteristics and Reporting Crime.”</span> <em>British Journal of Criminology</em> 46: 719–42.
</div>
<div id="ref-Grossenbacher_2019" class="csl-entry">
Grossenbacher, Timo. 2019. <span>“Bivariate Maps with Ggplot2 and Sf.”</span> Blog. Tamedia. <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/">https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/</a>.
</div>
<div id="ref-Guerry_1833" class="csl-entry">
Guerry, Andre-Michelle. 1833. <span>“Essay on the Moral Statistics of France, Trans. HP Whitt and VW Reinking.”</span> Lewiston, NY: Edwin Mellen Press.
</div>
<div id="ref-Harries_1999" class="csl-entry">
Harries, Keith. 1999. <span>“Mapping Crime: Principle and Practice.”</span> Research Report. National Institute of Justice.
</div>
<div id="ref-Hart_2012" class="csl-entry">
Hart, Timothy, and Paul Zandbergen. 2012. <span>“Effects of Data Quality on Predictive Hotspot Mapping.”</span> Final Report. National Institute of Justice.
</div>
<div id="ref-Healy_2019" class="csl-entry">
Healy, Kieran. 2019. <em>Data Visualization. A Practical Introduction</em>. Princeto, NJ: Princeton University Press.
</div>
<div id="ref-Jiang_2013" class="csl-entry">
Jiang, Bin. 2013. <span>“Head/Tail Breaks: A New Classification Scheme for Data with a Heavy-Tailed Distribution.”</span> <em>The Professional Geographer</em> 65 (3): 482–94.
</div>
<div id="ref-Kirk_2016" class="csl-entry">
Kirk, Andy. 2016. <em>Data Visualisation: A Handbook for Data Driven Design</em>. London, UK: Sage.
</div>
<div id="ref-Perpiñan_2014" class="csl-entry">
Lamigueiro, Oscar Perpiñan. 2014. <em>Displaying Time Series, Spatial, and Space-Time Data with r</em>. Boca Raton, CA: CRC Press.
</div>
<div id="ref-Lawson_2021a" class="csl-entry">
Lawson, Andrew. 2021a. <em>Bayesian Disease Mapping</em>. 3rd ed. Boca Raton, CA: CRC Press.
</div>
<div id="ref-Lawson_2006" class="csl-entry">
———. 2021b. <em>Statistical Methods in Spatial Epidemiology</em>. 2nd ed. Chichester, UK: John Wiley; Sons.
</div>
<div id="ref-Lawson_2021b" class="csl-entry">
———. 2021c. <em>Using r for Bayesian Spatial and Spatio-Temporal Health Modeling</em>. Boca Raton, CA: CRC Press.
</div>
<div id="ref-Lovelace_2019" class="csl-entry">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019. <em>Geocomputation with r</em>. Boca Raton, Florida: Chapman; Hall/CRC Press.
</div>
<div id="ref-Marshall_1991" class="csl-entry">
Marshall, Roger. 1991. <span>“Mapping Disease and Mortality Rates Using Empirical Bayes Estimators.”</span> <em>Applied Statistics</em> 40 (2): 283–94.
</div>
<div id="ref-Mayhew_1861" class="csl-entry">
Mayhew, Henry. 1861. <em>London Labour and the London Poor: A Cyclopaedia of the Condition and Earnings of Those That Will Work, Those That Cannot Work, and Those That Will Not Work. Those That Will Not Work: Comprising Prostitutes, Thieves, Swindlers, Beggars/by Several Contributors; with Introductory Essay on the Agencies at Present in Operation in the Metropolis for the Suppression of Vice and Crime by William Tuckniss; with Illustrations</em>. Charles Griffin.
</div>
<div id="ref-Monmonier_1993" class="csl-entry">
Monmonier, Mark. 1993. <em>Mapping It Out: Expository Cartography for the Humanities and Social Sciences</em>. Chicago: The University of Chicago Press.
</div>
<div id="ref-Monmonier_1996" class="csl-entry">
———. 1996. <em>How to Lie with Maps</em>. 2nd ed. Chicago: The University of Chicago Press.
</div>
<div id="ref-Newton_2018" class="csl-entry">
Newton, Andrew David. 2018. <span>“Macro-Level Generators of Crime, Including Parks, Stadiums, and Transit Stations.”</span> In <em>The Oxford Handbook of Environmental Criminology</em>, edited by Gerben J N Bruinsma and Shane D Johnson, 497–517. Oxford: Oxford University Press.
</div>
<div id="ref-OSullivan_2010" class="csl-entry">
O´Sullivan, David, and David J. Unwin. 2010. <em>Geographic Information Analysis</em>. 2nd ed. Hoboken, NJ: John Wiley; Sons.
</div>
<div id="ref-Park_1925" class="csl-entry">
Park, Robert E, and Ernest W Burgess. 1925. <em>The City</em>. University of Chicago Press.
</div>
<div id="ref-Pebesma_2012" class="csl-entry">
Pebesma, Edzer. 2012. <span>“Spacetime: Spatio-Temporal Data in r.”</span> <em>Journal of Statistical Software</em> 51 (7): 1–30.
</div>
<div id="ref-Pebesma_2018" class="csl-entry">
———. 2018. <span>“Simple Features for r: Standardized Support for Spatial Vector Data.”</span> <em>The R Journal</em> 10 (1): 439–46.
</div>
<div id="ref-Quetelet_1842" class="csl-entry">
Quetelet, Adolphe. 1842. <em>Instructions Pour l’observation Des Ph<span>é</span>nom<span>è</span>nes p<span>é</span>riodiques</em>. Vol. 1. 22.
</div>
<div id="ref-Ratcliffe_2004" class="csl-entry">
Ratcliffe, Jerry. 2004. <span>“Geocoding Crime and a First Estimate of a Minimum Acceptable Hit Rate.”</span> <em>International Journal of Geographical Information Science</em> 18 (1): 61–72.
</div>
<div id="ref-Ratcliffe_2010" class="csl-entry">
———. 2010. <span>“Crime Mapping: Spatial and Temporal Challenges.”</span> In <em>Handbook of Quantitative Criminology</em>, edited by Alex Piquero and David Weisburd, 5–24. New York, NY: Springer.
</div>
<div id="ref-Rengert_2009" class="csl-entry">
Rengert, George F, and Brian Lockwood. 2009. <span>“Geographical Units of Analysis and the Analysis of Crime.”</span> In <em>Putting Crime in Its Place</em>, edited by David Weisburd, Wim Bernasco, and Gerben J. N. Bruinsma, 109–22. New York, NY: Springer.
</div>
<div id="ref-Boba_2013" class="csl-entry">
Santos, Rachel Boba. 2013. <em>Crime Analysis with Crime Mapping</em>. 3rd ed. Thousand Oaks, CA: Sage.
</div>
<div id="ref-Schwabish_2021" class="csl-entry">
Schwabish, Jonathan. 2021. <em>Better Data Visualizations. A Guide for Scholars, Researchers, and Wonks</em>. New York: Columbia University Press.
</div>
<div id="ref-Shaw_1942" class="csl-entry">
Shaw, Clifford Robe, and Henry Donald McKay. 1942. <span>“Juvenile Delinquency and Urban Areas.”</span>
</div>
<div id="ref-Haining_2020" class="csl-entry">
Spatial, Modelling, and Spatial-Temporal Data. A Bayesian Approach. 2020. <em>Robert Haining and Guangquan Li</em>. Boca Raton, FL: CRC Press.
</div>
<div id="ref-Stevens_2015" class="csl-entry">
Stevens, Joshua. 2015. <span>“Bivariate Choropleth Maps: A How-to Guide.”</span> Blog. NASA’s Earth Observatory. <a href="https://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/">https://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/</a>.
</div>
<div id="ref-Tanimura_2006" class="csl-entry">
Tanimura, Susumu, Chusi Kuroiwa, and Tsutomu Mizota. 2006. <span>“Propotional Symbol Mapping in r.”</span> <em>Journal of Statistical Software</em> 15 (5): 1–7.
</div>
<div id="ref-Tukey_1979" class="csl-entry">
Tukey, John. 1979. <span>“Statistical Mapping: What Should Not Be Plotted.”</span> In <em>Proceedings of the 1976 Workshop on Automated Cartography and Epidemiology</em>, edited by DHEW, 18–21. Washington, DC: US Department of Health, Education,; Welfare.
</div>
<div id="ref-Waller_2004" class="csl-entry">
Waller, HLance, and Carol Gotway. 2004. <em>Applied Spatial Statistics for Public Health Data</em>. Chichester, UK: John Wiley; Sons.
</div>
<div id="ref-Wickham_2010" class="csl-entry">
Wickham, Hadley. 2010. <span>“A Layered Grammar of Graphics.”</span> <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3–28.
</div>
<div id="ref-Wickham_2017" class="csl-entry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for Data Science: Import, Tidy, Transform, Visualize, and Model Data</em>. Boston, MA: O´Reilly.
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-5-visualisation-good-cartographic-design.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/06-time_matters.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["crime_mapping.pdf", "crime_mapping.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
