<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R</title>
  <meta name="description" content="Chapter 9 Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapter 9 Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="github-repo" content="maczokni/crime_mapping" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  
  <meta name="twitter:description" content="Chapter 9 Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  

<meta name="author" content="Juanjo Medina and Reka Solymosi" />


<meta name="date" content="2022-07-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial-point-patterns-of-crime-events.html"/>
<link rel="next" href="spatial-dependence-and-autocorrelation.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet/leaflet.js"></script>
<link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4/proj4.min.js"></script>
<script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding/leaflet.js"></script>
<script src="libs/leaflet-providers/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
<script src="libs/burglary_raster_cc_9107d3/data_stars_burglary_raster_cc983ce5.txt"></script>
<script src="libs/joda/joda.js"></script>
<script src="libs/joda/addImageQuery-bindings.js"></script>
<script src="libs/clipboard/setClipboardText.js"></script>
<link href="libs/HomeButton/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton/home-button.js"></script>
<script src="libs/HomeButton/easy-button-src.min.js"></script>
<link href="libs/mapviewCSS/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS/mapview.css" rel="stylesheet" />
<script src="libs/Leaflet.Sync/L.Map.Sync.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Crime Mapping and Spatial Data Analysis using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble: how to use this book</a></li>
<li class="chapter" data-level="2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html"><i class="fa fa-check"></i><b>2</b> Producing your first crime map</a>
<ul>
<li class="chapter" data-level="2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#geospatial-perspective-key-terms-and-ideas"><i class="fa fa-check"></i><b>2.2</b> Geospatial Perspective: key terms and ideas</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#place"><i class="fa fa-check"></i><b>2.2.1</b> Place</a></li>
<li class="chapter" data-level="2.2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#attributes"><i class="fa fa-check"></i><b>2.2.2</b> Attributes</a></li>
<li class="chapter" data-level="2.2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#spatial-objects"><i class="fa fa-check"></i><b>2.2.3</b> Spatial objects</a></li>
<li class="chapter" data-level="2.2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#networks"><i class="fa fa-check"></i><b>2.2.4</b> Networks</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#maps-and-their-types"><i class="fa fa-check"></i><b>2.3</b> Maps and their types</a></li>
<li class="chapter" data-level="2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#map-projections-and-geographic-coordinate-systems"><i class="fa fa-check"></i><b>2.4</b> Map projections and geographic coordinate systems</a></li>
<li class="chapter" data-level="2.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#key-terms-summary"><i class="fa fa-check"></i><b>2.5</b> Key terms summary</a></li>
<li class="chapter" data-level="2.6" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#getting-started-with-crime-data"><i class="fa fa-check"></i><b>2.6</b> Getting started with crime data</a></li>
<li class="chapter" data-level="2.7" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#from-dataframes-to-spatial-objects"><i class="fa fa-check"></i><b>2.7</b> From dataframes to spatial objects</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-point"><i class="fa fa-check"></i><b>2.7.1</b> The point</a></li>
<li class="chapter" data-level="2.7.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-line"><i class="fa fa-check"></i><b>2.7.2</b> The line</a></li>
<li class="chapter" data-level="2.7.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-polygon"><i class="fa fa-check"></i><b>2.7.3</b> The polygon</a></li>
<li class="chapter" data-level="2.7.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#choosing-the-ideal-unit-of-analysis"><i class="fa fa-check"></i><b>2.7.4</b> Choosing the ideal unit of analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-simple-features-framework"><i class="fa fa-check"></i><b>2.8</b> The simple features framework</a></li>
<li class="chapter" data-level="2.9" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#plotting-data-with-ggplot2"><i class="fa fa-check"></i><b>2.9</b> Plotting data with ggplot2</a></li>
<li class="chapter" data-level="2.10" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-points"><i class="fa fa-check"></i><b>2.10</b> Mapping crime data as points</a></li>
<li class="chapter" data-level="2.11" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-polygons"><i class="fa fa-check"></i><b>2.11</b> Mapping crime data as polygons</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#finding-boundary-data"><i class="fa fa-check"></i><b>2.11.1</b> Finding boundary data</a></li>
<li class="chapter" data-level="2.11.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#reading-shapefiles-into-r"><i class="fa fa-check"></i><b>2.11.2</b> Reading shapefiles into R</a></li>
<li class="chapter" data-level="2.11.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>2.11.3</b> Data wrangling with dplyr</a></li>
<li class="chapter" data-level="2.11.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#join-data-to-sf-object"><i class="fa fa-check"></i><b>2.11.4</b> Join data to sf object</a></li>
<li class="chapter" data-level="2.11.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#putting-polygon-data-on-the-map"><i class="fa fa-check"></i><b>2.11.5</b> Putting polygon data on the map</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#summary-and-further-reading"><i class="fa fa-check"></i><b>2.12</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html"><i class="fa fa-check"></i><b>3</b> Basic geospatial operations in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#exploring-the-relationship-between-alcohol-outlets-and-crime"><i class="fa fa-check"></i><b>3.2</b> Exploring the relationship between alcohol outlets and crime</a></li>
<li class="chapter" data-level="3.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#acquiring-relevant-data"><i class="fa fa-check"></i><b>3.3</b> Acquiring relevant data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#reading-in-crime-data"><i class="fa fa-check"></i><b>3.3.1</b> Reading in crime data</a></li>
<li class="chapter" data-level="3.3.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#meet-a-new-format-geojson"><i class="fa fa-check"></i><b>3.3.2</b> Meet a new format: geoJSON</a></li>
<li class="chapter" data-level="3.3.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#open-street-map-and-points-of-interest"><i class="fa fa-check"></i><b>3.3.3</b> Open Street Map and points of interest</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#attribute-operations"><i class="fa fa-check"></i><b>3.4</b> Attribute operations</a></li>
<li class="chapter" data-level="3.5" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#spatial-operations"><i class="fa fa-check"></i><b>3.5</b> Spatial operations</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#reprojecting-coordinates"><i class="fa fa-check"></i><b>3.5.1</b> Reprojecting coordinates</a></li>
<li class="chapter" data-level="3.5.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#subsetting-points"><i class="fa fa-check"></i><b>3.5.2</b> Subsetting points</a></li>
<li class="chapter" data-level="3.5.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#building-buffers"><i class="fa fa-check"></i><b>3.5.3</b> Building buffers</a></li>
<li class="chapter" data-level="3.5.4" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#counting-points-within-a-polygon"><i class="fa fa-check"></i><b>3.5.4</b> Counting Points within a Polygon</a></li>
<li class="chapter" data-level="3.5.5" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#distances-finding-the-nearest-point"><i class="fa fa-check"></i><b>3.5.5</b> Distances: Finding the nearest point</a></li>
<li class="chapter" data-level="3.5.6" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#measuring-distances"><i class="fa fa-check"></i><b>3.5.6</b> Measuring distances</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#plotting-interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>3.6</b> Plotting interactive maps with leaflet</a></li>
<li class="chapter" data-level="3.7" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#geocoding"><i class="fa fa-check"></i><b>3.7</b> Geocoding</a></li>
<li class="chapter" data-level="3.8" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#measuring-distance-more-thoroughly"><i class="fa fa-check"></i><b>3.8</b> Measuring distance more thoroughly</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#how-far-are-police-stations-in-madrid"><i class="fa fa-check"></i><b>3.8.1</b> How far are police stations in Madrid?</a></li>
<li class="chapter" data-level="3.8.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#distance-in-geographical-space"><i class="fa fa-check"></i><b>3.8.2</b> Distance in geographical space</a></li>
<li class="chapter" data-level="3.8.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#a-practical-example-to-evaluate-distance"><i class="fa fa-check"></i><b>3.8.3</b> A practical example to evaluate distance</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#summary-and-further-reading-1"><i class="fa fa-check"></i><b>3.9</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html"><i class="fa fa-check"></i><b>4</b> Mapping rates and counts</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#thematic-maps-key-terms-and-ideas"><i class="fa fa-check"></i><b>4.2</b> Thematic maps: key terms and ideas</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#choropleth-maps"><i class="fa fa-check"></i><b>4.2.1</b> Choropleth maps</a></li>
<li class="chapter" data-level="4.2.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#what-do-we-use-choropleth-maps-for"><i class="fa fa-check"></i><b>4.2.2</b> What do we use choropleth maps for?</a></li>
<li class="chapter" data-level="4.2.3" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#proportional-and-graduate-symbol-maps-mapping-crime-counts"><i class="fa fa-check"></i><b>4.2.3</b> Proportional and graduate symbol maps: mapping crime counts</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#creating-proportional-symbol-maps"><i class="fa fa-check"></i><b>4.3</b> Creating proportional symbol maps</a></li>
<li class="chapter" data-level="4.4" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#mapping-rates-rather-than-counts"><i class="fa fa-check"></i><b>4.4</b> Mapping rates rather than counts</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#generating-the-rates"><i class="fa fa-check"></i><b>4.4.1</b> Generating the rates</a></li>
<li class="chapter" data-level="4.4.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#creating-a-choropleth-map-with-tmap"><i class="fa fa-check"></i><b>4.4.2</b> Creating a choropleth map with tmap</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#classification-systems-for-thematic-maps"><i class="fa fa-check"></i><b>4.5</b> Classification systems for thematic maps</a></li>
<li class="chapter" data-level="4.6" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#interactive-mapping-with-tmap"><i class="fa fa-check"></i><b>4.6</b> Interactive mapping with tmap</a></li>
<li class="chapter" data-level="4.7" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#smoothing-rates-adjusting-for-small-sample-noise"><i class="fa fa-check"></i><b>4.7</b> Smoothing rates: adjusting for small sample noise</a></li>
<li class="chapter" data-level="4.8" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#summary-and-further-reading-2"><i class="fa fa-check"></i><b>4.8</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html"><i class="fa fa-check"></i><b>5</b> Variations of thematic mapping</a>
<ul>
<li class="chapter" data-level="5.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#binning-points"><i class="fa fa-check"></i><b>5.2</b> Binning points</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#the-binning-process"><i class="fa fa-check"></i><b>5.2.1</b> The Binning Process</a></li>
<li class="chapter" data-level="5.2.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#different-binning-techniques"><i class="fa fa-check"></i><b>5.2.2</b> Different Binning Techniques</a></li>
<li class="chapter" data-level="5.2.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#benefits-of-binning"><i class="fa fa-check"></i><b>5.2.3</b> Benefits of Binning</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#transforming-polygons-cartograms"><i class="fa fa-check"></i><b>5.3</b> Transforming polygons: cartograms</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#dorling-cartogram"><i class="fa fa-check"></i><b>5.3.1</b> Dorling Cartogram</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#bivariate-maps"><i class="fa fa-check"></i><b>5.4</b> Bivariate Maps</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-1-bin-our-variables-of-interest"><i class="fa fa-check"></i><b>5.4.1</b> Step 1: Bin our variables of interest</a></li>
<li class="chapter" data-level="5.4.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-2-new-variable"><i class="fa fa-check"></i><b>5.4.2</b> Step 2: New variable</a></li>
<li class="chapter" data-level="5.4.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-3-create-colour-scheme"><i class="fa fa-check"></i><b>5.4.3</b> Step 3: Create colour scheme</a></li>
<li class="chapter" data-level="5.4.4" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-4-join-colour-scheme"><i class="fa fa-check"></i><b>5.4.4</b> Step 4: Join colour scheme</a></li>
<li class="chapter" data-level="5.4.5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-5-create-legend"><i class="fa fa-check"></i><b>5.4.5</b> Step 5: Create legend</a></li>
<li class="chapter" data-level="5.4.6" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-6-map"><i class="fa fa-check"></i><b>5.4.6</b> Step 6: Map</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#a-note-of-caution-maup"><i class="fa fa-check"></i><b>5.5</b> A note of caution: MAUP</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#why-does-maup-matter"><i class="fa fa-check"></i><b>5.5.1</b> Why does MAUP matter?</a></li>
<li class="chapter" data-level="5.5.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#what-can-we-do"><i class="fa fa-check"></i><b>5.5.2</b> What can we do?</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#summary-and-further-reading-3"><i class="fa fa-check"></i><b>5.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html"><i class="fa fa-check"></i><b>6</b> Basics of cartographic design: elements of a map</a>
<ul>
<li class="chapter" data-level="6.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#data-representation"><i class="fa fa-check"></i><b>6.2</b> Data representation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#thematic-maps"><i class="fa fa-check"></i><b>6.2.1</b> Thematic maps</a></li>
<li class="chapter" data-level="6.2.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#symbols"><i class="fa fa-check"></i><b>6.2.2</b> Symbols</a></li>
<li class="chapter" data-level="6.2.3" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#rate-vs-count"><i class="fa fa-check"></i><b>6.2.3</b> Rate vs count</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#colour"><i class="fa fa-check"></i><b>6.3</b> Colour</a></li>
<li class="chapter" data-level="6.4" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#text"><i class="fa fa-check"></i><b>6.4</b> Text</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#titles-and-subtitles"><i class="fa fa-check"></i><b>6.4.1</b> Titles and subtitles</a></li>
<li class="chapter" data-level="6.4.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#legend"><i class="fa fa-check"></i><b>6.4.2</b> Legend</a></li>
<li class="chapter" data-level="6.4.3" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#annotation"><i class="fa fa-check"></i><b>6.4.3</b> Annotation</a></li>
<li class="chapter" data-level="6.4.4" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#production-notes"><i class="fa fa-check"></i><b>6.4.4</b> Production notes</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#composition"><i class="fa fa-check"></i><b>6.5</b> Composition</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#orientation-indicators"><i class="fa fa-check"></i><b>6.5.1</b> Orientation indicators</a></li>
<li class="chapter" data-level="6.5.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#scale-indicators"><i class="fa fa-check"></i><b>6.5.2</b> Scale indicators</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#context"><i class="fa fa-check"></i><b>6.6</b> Context</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#basemap"><i class="fa fa-check"></i><b>6.6.1</b> Basemap</a></li>
<li class="chapter" data-level="6.6.2" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#inset-maps"><i class="fa fa-check"></i><b>6.6.2</b> Inset maps</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="basics-of-cartographic-design-elements-of-a-map.html"><a href="basics-of-cartographic-design-elements-of-a-map.html#summary-and-further-reading-4"><i class="fa fa-check"></i><b>6.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="time-matters.html"><a href="time-matters.html"><i class="fa fa-check"></i><b>7</b> Time matters</a>
<ul>
<li class="chapter" data-level="7.1" data-path="time-matters.html"><a href="time-matters.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="time-matters.html"><a href="time-matters.html#temporal-data-in-crime-analysis"><i class="fa fa-check"></i><b>7.2</b> Temporal data in crime analysis</a></li>
<li class="chapter" data-level="7.3" data-path="time-matters.html"><a href="time-matters.html#temporal-data-wrangling"><i class="fa fa-check"></i><b>7.3</b> Temporal data wrangling</a></li>
<li class="chapter" data-level="7.4" data-path="time-matters.html"><a href="time-matters.html#visualising-time-data"><i class="fa fa-check"></i><b>7.4</b> Visualising time data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="time-matters.html"><a href="time-matters.html#how-not-to-present-time"><i class="fa fa-check"></i><b>7.4.1</b> How (not) to present time</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="time-matters.html"><a href="time-matters.html#time-series-analysis"><i class="fa fa-check"></i><b>7.5</b> Time series analysis</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="time-matters.html"><a href="time-matters.html#plotting-time-series-data"><i class="fa fa-check"></i><b>7.5.1</b> Plotting time series data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="time-matters.html"><a href="time-matters.html#spatio-temporal-data-visualisation"><i class="fa fa-check"></i><b>7.6</b> Spatio-temporal data visualisation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="time-matters.html"><a href="time-matters.html#small-multiples-to-show-temporal-variation"><i class="fa fa-check"></i><b>7.6.1</b> Small multiples to show temporal variation</a></li>
<li class="chapter" data-level="7.6.2" data-path="time-matters.html"><a href="time-matters.html#spaghetti-plots"><i class="fa fa-check"></i><b>7.6.2</b> Spaghetti plots</a></li>
<li class="chapter" data-level="7.6.3" data-path="time-matters.html"><a href="time-matters.html#animations"><i class="fa fa-check"></i><b>7.6.3</b> Animations</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="time-matters.html"><a href="time-matters.html#summary-and-further-reading-5"><i class="fa fa-check"></i><b>7.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html"><i class="fa fa-check"></i><b>8</b> Spatial point patterns of crime events</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#mapping-crime-intensity-with-isarithmic-maps"><i class="fa fa-check"></i><b>8.1</b> Mapping crime intensity with isarithmic maps</a></li>
<li class="chapter" data-level="8.2" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#burglaries-in-nyc"><i class="fa fa-check"></i><b>8.2</b> Burglaries in NYC</a></li>
<li class="chapter" data-level="8.3" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#using-the-spatstat-package"><i class="fa fa-check"></i><b>8.3</b> Using the <code>spatstat</code> package</a></li>
<li class="chapter" data-level="8.4" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#homogeneous-or-spatially-varying-intensity"><i class="fa fa-check"></i><b>8.4</b> Homogeneous or spatially varying intensity?</a></li>
<li class="chapter" data-level="8.5" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#mapping-intensity-estimates-with-spatstat"><i class="fa fa-check"></i><b>8.5</b> Mapping intensity estimates with <code>spatstat</code></a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#basics-of-kernel-density-estimation-kde"><i class="fa fa-check"></i><b>8.5.1</b> Basics of kernel density estimation (KDE)</a></li>
<li class="chapter" data-level="8.5.2" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#selecting-the-appropriate-bandwith-for-kde"><i class="fa fa-check"></i><b>8.5.2</b> Selecting the appropriate bandwith for KDE</a></li>
<li class="chapter" data-level="8.5.3" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#selecting-the-smoothing-kernel"><i class="fa fa-check"></i><b>8.5.3</b> Selecting the smoothing kernel</a></li>
<li class="chapter" data-level="8.5.4" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#weighted-kernel-density-estimates"><i class="fa fa-check"></i><b>8.5.4</b> Weighted kernel density estimates</a></li>
<li class="chapter" data-level="8.5.5" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#better-kde-maps-using-leaflet"><i class="fa fa-check"></i><b>8.5.5</b> Better KDE maps using <code>leaflet</code></a></li>
<li class="chapter" data-level="8.5.6" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#problems-with-kde"><i class="fa fa-check"></i><b>8.5.6</b> Problems with KDE</a></li>
<li class="chapter" data-level="8.5.7" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#other-packages-for-kde"><i class="fa fa-check"></i><b>8.5.7</b> Other packages for KDE</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="spatial-point-patterns-of-crime-events.html"><a href="spatial-point-patterns-of-crime-events.html#summary-and-further-reading-6"><i class="fa fa-check"></i><b>8.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html"><i class="fa fa-check"></i><b>9</b> Crime along spatial networks</a>
<ul>
<li class="chapter" data-level="9.1" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#constructing-and-storing-a-spatial-linear-network"><i class="fa fa-check"></i><b>9.2</b> Constructing and storing a spatial linear network</a></li>
<li class="chapter" data-level="9.3" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#density-estimation-along-networks"><i class="fa fa-check"></i><b>9.3</b> Density estimation along networks</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#adding-context"><i class="fa fa-check"></i><b>9.3.1</b> Adding context</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#visualising-crime-distribution-along-networks"><i class="fa fa-check"></i><b>9.4</b> Visualising crime distribution along networks</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#hot-routes"><i class="fa fa-check"></i><b>9.4.1</b> Hot Routes</a></li>
<li class="chapter" data-level="9.4.2" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#street-profile-analysis"><i class="fa fa-check"></i><b>9.4.2</b> Street Profile Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#quantifying-crime-concentration-at-micro-places"><i class="fa fa-check"></i><b>9.5</b> Quantifying crime concentration at micro-places</a></li>
<li class="chapter" data-level="9.6" data-path="crime-along-spatial-networks.html"><a href="crime-along-spatial-networks.html#summary-and-further-reading-7"><i class="fa fa-check"></i><b>9.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html"><i class="fa fa-check"></i><b>10</b> Spatial dependence and autocorrelation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#exploring-spatial-dependence-in-point-pattern-data"><i class="fa fa-check"></i><b>10.2</b> Exploring spatial dependence in point pattern data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#the-empirical-k-function"><i class="fa fa-check"></i><b>10.2.1</b> The empirical K function</a></li>
<li class="chapter" data-level="10.2.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#homicide-in-buenos-aires"><i class="fa fa-check"></i><b>10.2.2</b> Homicide in Buenos Aires</a></li>
<li class="chapter" data-level="10.2.3" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#estimating-and-plotting-the-k-function"><i class="fa fa-check"></i><b>10.2.3</b> Estimating and plotting the K-function</a></li>
<li class="chapter" data-level="10.2.4" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#network-constrained-k-function"><i class="fa fa-check"></i><b>10.2.4</b> Network constrained K function</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#exploring-spatial-autocorrelation-in-lattice-data"><i class="fa fa-check"></i><b>10.3</b> Exploring spatial autocorrelation in lattice data</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#burglary-in-manchester"><i class="fa fa-check"></i><b>10.3.1</b> Burglary in Manchester</a></li>
<li class="chapter" data-level="10.3.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#what-is-a-neighbour"><i class="fa fa-check"></i><b>10.3.2</b> What is a neighbour?</a></li>
<li class="chapter" data-level="10.3.3" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#creating-a-list-of-neighbours-based-on-contiguity"><i class="fa fa-check"></i><b>10.3.3</b> Creating a list of neighbours based on contiguity</a></li>
<li class="chapter" data-level="10.3.4" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#generating-the-weight-matrix"><i class="fa fa-check"></i><b>10.3.4</b> Generating the weight matrix</a></li>
<li class="chapter" data-level="10.3.5" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#spatial-weight-matrix-based-on-distance"><i class="fa fa-check"></i><b>10.3.5</b> Spatial weight matrix based on distance</a></li>
<li class="chapter" data-level="10.3.6" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#spatial-weight-matrix-based-on-k-neighbors"><i class="fa fa-check"></i><b>10.3.6</b> Spatial weight matrix based on k-neighbors</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#choosing-the-correct-matrix"><i class="fa fa-check"></i><b>10.4</b> Choosing the correct matrix</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#measuring-global-autocorrelation"><i class="fa fa-check"></i><b>10.4.1</b> Measuring global autocorrelation</a></li>
<li class="chapter" data-level="10.4.2" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#the-rgeoda-and-sfweight-packages"><i class="fa fa-check"></i><b>10.4.2</b> The <code>rgeoda</code> and <code>sfweight</code> packages</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="spatial-dependence-and-autocorrelation.html"><a href="spatial-dependence-and-autocorrelation.html#further-reading"><i class="fa fa-check"></i><b>10.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html"><i class="fa fa-check"></i><b>11</b> Detecting hot spots and repeats</a>
<ul>
<li class="chapter" data-level="11.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#clusters-hot-spots-of-crime-and-near-repeat-victimisation"><i class="fa fa-check"></i><b>11.1.1</b> Clusters, hot spots of crime, and near repeat victimisation</a></li>
<li class="chapter" data-level="11.1.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#burglaries-in-manchester"><i class="fa fa-check"></i><b>11.1.2</b> Burglaries in Manchester</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#using-raster-micro-grid-cells-to-spot-hot-spots"><i class="fa fa-check"></i><b>11.2</b> Using <code>raster</code> micro grid cells to spot hot spots</a></li>
<li class="chapter" data-level="11.3" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#local-getis-ord"><i class="fa fa-check"></i><b>11.3</b> Local Getis-Ord</a></li>
<li class="chapter" data-level="11.4" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#local-morans-i-and-moran-scaterplot"><i class="fa fa-check"></i><b>11.4</b> Local Moran’s I and Moran scaterplot</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#computing-the-local-morans-i"><i class="fa fa-check"></i><b>11.4.1</b> Computing the local Moran’s I</a></li>
<li class="chapter" data-level="11.4.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#creating-a-lisa-map"><i class="fa fa-check"></i><b>11.4.2</b> Creating a LISA map</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#scan-satistics"><i class="fa fa-check"></i><b>11.5</b> Scan satistics</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#the-dcluster-package"><i class="fa fa-check"></i><b>11.5.1</b> The <code>DCluster</code> package</a></li>
<li class="chapter" data-level="11.5.2" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#openshaws-gam"><i class="fa fa-check"></i><b>11.5.2</b> Openshaw’s GAM</a></li>
<li class="chapter" data-level="11.5.3" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#kulldorfs-scan-statistic"><i class="fa fa-check"></i><b>11.5.3</b> Kulldorf’s Scan Statistic</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#exploring-near-repeat-victimisation"><i class="fa fa-check"></i><b>11.6</b> Exploring near repeat victimisation</a></li>
<li class="chapter" data-level="11.7" data-path="detecting-hot-spots-and-repeats.html"><a href="detecting-hot-spots-and-repeats.html#further-reading-1"><i class="fa fa-check"></i><b>11.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html"><i class="fa fa-check"></i><b>12</b> Spatial regression models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#challenges-for-regression-with-spatial-data"><i class="fa fa-check"></i><b>12.2</b> Challenges for regression with spatial data</a></li>
<li class="chapter" data-level="12.3" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-a-non-spatial-regression-model-with-r"><i class="fa fa-check"></i><b>12.3</b> Fitting a non-spatial regression model with R</a></li>
<li class="chapter" data-level="12.4" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#looking-at-the-residuals-and-testing-for-spatial-autocorrelation-in-regression"><i class="fa fa-check"></i><b>12.4</b> Looking at the residuals and testing for spatial autocorrelation in regression</a></li>
<li class="chapter" data-level="12.5" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i><b>12.5</b> Choosing a spatial regression model</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#the-basic-spatial-models"><i class="fa fa-check"></i><b>12.5.1</b> The basic spatial models</a></li>
<li class="chapter" data-level="12.5.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#lagrange-multipliers-the-bottom-up-approach-to-select-a-model"><i class="fa fa-check"></i><b>12.5.2</b> Lagrange multipliers: the bottom-up approach to select a model</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-and-interpreting-a-spatial-error-model"><i class="fa fa-check"></i><b>12.6</b> Fitting and interpreting a spatial error model</a></li>
<li class="chapter" data-level="12.7" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-and-interpreting-a-spatially-lagged-model"><i class="fa fa-check"></i><b>12.7</b> Fitting and interpreting a spatially lagged model</a></li>
<li class="chapter" data-level="12.8" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#beyond-the-sar-and-sem-models"><i class="fa fa-check"></i><b>12.8</b> Beyond the SAR and SEM models</a></li>
<li class="chapter" data-level="12.9" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#summary-and-further-reading-8"><i class="fa fa-check"></i><b>12.9</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html"><i class="fa fa-check"></i><b>13</b> Spatial heterogeneity and regression</a>
<ul>
<li class="chapter" data-level="13.1" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#spatial-regimes"><i class="fa fa-check"></i><b>13.2</b> Spatial regimes</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#fitting-the-constrained-and-the-unconstrained-models"><i class="fa fa-check"></i><b>13.2.1</b> Fitting the constrained and the unconstrained models</a></li>
<li class="chapter" data-level="13.2.2" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#running-the-chow-test"><i class="fa fa-check"></i><b>13.2.2</b> Running the Chow test</a></li>
<li class="chapter" data-level="13.2.3" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#spatial-dependence-with-spatial-heterogeneity"><i class="fa fa-check"></i><b>13.2.3</b> Spatial dependence with spatial heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#geographically-weighted-regression"><i class="fa fa-check"></i><b>13.3</b> Geographically Weighted Regression</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#calculate-kernel-bandwidth"><i class="fa fa-check"></i><b>13.3.1</b> Calculate kernel bandwidth</a></li>
<li class="chapter" data-level="13.3.2" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#building-the-geographically-weighted-model"><i class="fa fa-check"></i><b>13.3.2</b> Building the geographically weighted model</a></li>
<li class="chapter" data-level="13.3.3" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#using-gwr"><i class="fa fa-check"></i><b>13.3.3</b> Using GWR</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="spatial-heterogeneity-and-regression.html"><a href="spatial-heterogeneity-and-regression.html#summary-and-further-reading-9"><i class="fa fa-check"></i><b>13.4</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>14</b> Appendix: A quick intro to R and RStudio</a>
<ul>
<li class="chapter" data-level="14.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#exploring-rstudio"><i class="fa fa-check"></i><b>14.1</b> Exploring RStudio</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#the-four-panes-of-r-studio"><i class="fa fa-check"></i><b>14.1.1</b> The four panes of R Studio</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#customising-the-rstudio-look"><i class="fa fa-check"></i><b>14.2</b> Customising the RStudio look</a></li>
<li class="chapter" data-level="14.3" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#elements-of-r-grammar"><i class="fa fa-check"></i><b>14.3</b> Elements of R grammar</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#functions"><i class="fa fa-check"></i><b>14.3.1</b> Functions</a></li>
<li class="chapter" data-level="14.3.2" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#objects"><i class="fa fa-check"></i><b>14.3.2</b> Objects</a></li>
<li class="chapter" data-level="14.3.3" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#types-of-objects"><i class="fa fa-check"></i><b>14.3.3</b> Types of objects</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#packages"><i class="fa fa-check"></i><b>14.4</b> Packages</a></li>
<li class="chapter" data-level="14.5" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#exploring-data-with-r"><i class="fa fa-check"></i><b>14.5</b> Exploring data with R</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#playing-around-with-data"><i class="fa fa-check"></i><b>14.5.1</b> Playing around with data</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#getting-organised-r-projects"><i class="fa fa-check"></i><b>14.6</b> Getting organised: R Projects</a></li>
<li class="chapter" data-level="14.7" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#summary-and-further-reading-10"><i class="fa fa-check"></i><b>14.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html"><i class="fa fa-check"></i><b>15</b> Appendix B: Regression analysis (a refresher)</a>
<ul>
<li class="chapter" data-level="15.1" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#introduction-11"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#motivating-regression"><i class="fa fa-check"></i><b>15.2</b> Motivating regression</a></li>
<li class="chapter" data-level="15.3" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-a-simple-regression-model"><i class="fa fa-check"></i><b>15.3</b> Fitting a simple regression model</a></li>
<li class="chapter" data-level="15.4" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#residuals-revisited-r-squared"><i class="fa fa-check"></i><b>15.4</b> Residuals revisited: R squared</a></li>
<li class="chapter" data-level="15.5" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#inference-with-regression"><i class="fa fa-check"></i><b>15.5</b> Inference with regression</a></li>
<li class="chapter" data-level="15.6" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-regression-with-categorical-predictors"><i class="fa fa-check"></i><b>15.6</b> Fitting regression with categorical predictors</a></li>
<li class="chapter" data-level="15.7" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#motivating-multiple-regression"><i class="fa fa-check"></i><b>15.7</b> Motivating multiple regression</a></li>
<li class="chapter" data-level="15.8" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-and-interpreting-a-multiple-regression-model"><i class="fa fa-check"></i><b>15.8</b> Fitting and interpreting a multiple regression model</a></li>
<li class="chapter" data-level="15.9" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#presenting-your-regression-results."><i class="fa fa-check"></i><b>15.9</b> Presenting your regression results.</a></li>
<li class="chapter" data-level="15.10" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#rescaling-input-variables-to-assist-interpretation"><i class="fa fa-check"></i><b>15.10</b> Rescaling input variables to assist interpretation</a></li>
<li class="chapter" data-level="15.11" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#testing-conditional-hypothesis-interactions"><i class="fa fa-check"></i><b>15.11</b> Testing conditional hypothesis: interactions</a></li>
<li class="chapter" data-level="15.12" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#model-building-and-variable-selection"><i class="fa fa-check"></i><b>15.12</b> Model building and variable selection</a></li>
<li class="chapter" data-level="15.13" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#regression-assumptions"><i class="fa fa-check"></i><b>15.13</b> Regression assumptions</a></li>
<li class="chapter" data-level="15.14" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#summary-and-further-reading-11"><i class="fa fa-check"></i><b>15.14</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><i class="fa fa-check"></i><b>16</b> Appendix C: sourcing geographical data for crime analysis</a>
<ul>
<li class="chapter" data-level="16.1" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#the-rnaturalearth-package"><i class="fa fa-check"></i><b>16.1</b> The rnaturalearth package</a></li>
<li class="chapter" data-level="16.2" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#data-from-apis"><i class="fa fa-check"></i><b>16.2</b> Data from APIs</a></li>
<li class="chapter" data-level="16.3" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#data-from-data-repositories"><i class="fa fa-check"></i><b>16.3</b> Data from data repositories</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#international-resources"><i class="fa fa-check"></i><b>16.3.1</b> International resources</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#open-street-map"><i class="fa fa-check"></i><b>16.4</b> Open Street Map</a></li>
<li class="chapter" data-level="16.5" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#summary-and-further-reading-12"><i class="fa fa-check"></i><b>16.5</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime Mapping and Spatial Data Analysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="crime-along-spatial-networks" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Crime along spatial networks<a href="crime-along-spatial-networks.html#crime-along-spatial-networks" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-6" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Introduction<a href="crime-along-spatial-networks.html#introduction-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous chapter we explored how the techniques for spatial pattern analysis can be used to study the varying intensity of crime across space. We introduce the key idea of spatial randomness. These methods were developed to study locations in a continuous plane and are also referred to as <strong>planar spatial analysis</strong>. Point crime data, however, has an inherent structure to it. There are parts of our study region where it cannot appear. Since typically the data will be geocoded at the street level address, crime data almost always will appear alongside the spatial network of roads and streets. Crimes won’t appear randomly anywhere in our 2 dimensional representation of the city, they will only appear along the street network covering this city. We can see this in the following example from Chicago using data from <code>spatstat</code>:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-217"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-217-1.png" alt="Crime along street networkin Chicago" width="672" />
<p class="caption">
FIGURE 9.1: Crime along street networkin Chicago
</p>
</div>
<p>Clearly the offenses are constrained to only occur along the street network. This is not a homogeneous Poisson process along the whole study surface, because there is an underlying structure. If we want to investigate heterogeneity on intensity, for example, we would need to account for that underlying structure, the fact that the points can only be located along the network and not in other parts of the study region. Several authors have argued that crime is best represented and predicted if we focus in the street network rather than other kind of level of aggregation and that this has clear implications for operational policing <span class="citation">(<a href="#ref-Singleton_2014" role="doc-biblioref">Singleton and Brunsdon 2014</a>; <a href="#ref-Rosser_2017" role="doc-biblioref">Roser et al. 2017</a>)</span>. It is clear that if our crime occurrences are collected and represented along a spatial network we need to ensure we use techniques of analysis and visualisation that respect this existing underlying structure in our data.</p>
<p>The software infrastructure for spatial analysis along networks, however, is still not as developed and consolidated. Partly this is to do with the statistical and computational challenges when we move from planar to linear network analysis. There is some software such as <a href="http://sanet.csis.u-tokyo.ac.jp/">SANET</a> that was originally conceived as a toolbox for ArcGIS but with a beta standalone version already available <span class="citation">(<a href="#ref-Okabe_2012" role="doc-biblioref">Okabe and Sugihara 2012</a>)</span>. R users and developers are working to expand the functionality of R in this regard. It was only in 2020 that Lucas van der Meer, a Dutch spatial data scientist, published the first release of the <code>sfnetworks</code> package to facilitate the creation and analysis of spatial networks. Two other useful packages (<code>SpNetPrep</code> and <code>DRHotNet</code>) developed by Briz-Redón and colleagues are also only a couple of years old <span class="citation">(<a href="#ref-BrizRedon_2019a" role="doc-biblioref">Briz-Redón, Martı́nez-Ruiz, and Montes 2019a</a>, <a href="#ref-BrizRedon_2019b" role="doc-biblioref">2019b</a>)</span>. Another recent package, released in 2021, is <code>spNetwork</code> by Jeremy Gelb and Philippe Apparicio that can be used for kernel density estimation along networks <span class="citation">(<a href="#ref-Gelb_2021" role="doc-biblioref">Gelb 2021</a>)</span>. Finally, the package <code>spatstat</code>, that we covered in the last chapter, also provides functionality for the analysis of events along spatial networks.</p>
<p>In this chapter we will provide an introduction to the study of crime along networks by exploring the following:</p>
<ul>
<li>the creation of network representations from geographical vector objects</li>
<li>linking data to meaningful micro-places such as <strong>street segment</strong> (or in in a transportation example, train line segment) or <strong>street junction</strong> (or for transport research a train or bus station)</li>
<li>introducing the idea of <strong>hot routes</strong></li>
<li>evaluating crime concentration in these types of micro places using <strong>Gini coefficient</strong> and <strong>Lorenz curve</strong></li>
<li><strong>street profile analysis</strong> - an alternative (non-spatial) way to visualise crime along a network</li>
<li>introducing the functionallity of <code>spatstat</code> for the analysis of events along networks</li>
</ul>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="crime-along-spatial-networks.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for reading data and data carpentry</span></span>
<span id="cb374-2"><a href="crime-along-spatial-networks.html#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb374-3"><a href="crime-along-spatial-networks.html#cb374-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb374-4"><a href="crime-along-spatial-networks.html#cb374-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb374-5"><a href="crime-along-spatial-networks.html#cb374-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb374-6"><a href="crime-along-spatial-networks.html#cb374-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb374-7"><a href="crime-along-spatial-networks.html#cb374-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb374-8"><a href="crime-along-spatial-networks.html#cb374-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb374-9"><a href="crime-along-spatial-networks.html#cb374-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-10"><a href="crime-along-spatial-networks.html#cb374-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for handling spatial data</span></span>
<span id="cb374-11"><a href="crime-along-spatial-networks.html#cb374-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb374-12"><a href="crime-along-spatial-networks.html#cb374-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span>
<span id="cb374-13"><a href="crime-along-spatial-networks.html#cb374-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sfnetworks)</span>
<span id="cb374-14"><a href="crime-along-spatial-networks.html#cb374-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb374-15"><a href="crime-along-spatial-networks.html#cb374-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.linnet)</span>
<span id="cb374-16"><a href="crime-along-spatial-networks.html#cb374-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptools) </span>
<span id="cb374-17"><a href="crime-along-spatial-networks.html#cb374-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: maptools is still required for the as.linnet.SpatialLines() function, </span></span>
<span id="cb374-18"><a href="crime-along-spatial-networks.html#cb374-18" aria-hidden="true" tabindex="-1"></a><span class="co"># but will be retired by the end of 2023. Look out for where </span></span>
<span id="cb374-19"><a href="crime-along-spatial-networks.html#cb374-19" aria-hidden="true" tabindex="-1"></a><span class="co"># as.linnet.SpatialLines() function will migrate!</span></span>
<span id="cb374-20"><a href="crime-along-spatial-networks.html#cb374-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-21"><a href="crime-along-spatial-networks.html#cb374-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Package for computing Lorenz curve</span></span>
<span id="cb374-22"><a href="crime-along-spatial-networks.html#cb374-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ineq)</span>
<span id="cb374-23"><a href="crime-along-spatial-networks.html#cb374-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-24"><a href="crime-along-spatial-networks.html#cb374-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for visualisation and mapping</span></span>
<span id="cb374-25"><a href="crime-along-spatial-networks.html#cb374-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb374-26"><a href="crime-along-spatial-networks.html#cb374-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb374-27"><a href="crime-along-spatial-networks.html#cb374-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb374-28"><a href="crime-along-spatial-networks.html#cb374-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb374-29"><a href="crime-along-spatial-networks.html#cb374-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-30"><a href="crime-along-spatial-networks.html#cb374-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages providing accesss to data</span></span>
<span id="cb374-31"><a href="crime-along-spatial-networks.html#cb374-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb374-32"><a href="crime-along-spatial-networks.html#cb374-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span></code></pre></div>
<p>It is not only in the case of street networks that understanding spatial point patterns along a network might be more meaningful, there are other networks we might want to consider. Transport networks are a good example of this and are receiving an increasing interest in criminology and crime analysis <span class="citation">(<a href="#ref-Newton_2008" role="doc-biblioref">Newton 2008</a>; <a href="#ref-Tompson_2009" role="doc-biblioref">Tompson, Partridge, and Shepherd 2009</a>; <a href="#ref-Ceccato_2013" role="doc-biblioref">Ceccato 2013</a>)</span>.</p>
</div>
<div id="constructing-and-storing-a-spatial-linear-network" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Constructing and storing a spatial linear network<a href="crime-along-spatial-networks.html#constructing-and-storing-a-spatial-linear-network" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first difficulty one encounters when wanting to do analysis along spatial networks is to get the data for such geographical element in the proper shape. It is fairly straightforward to get files with the administrative boundaries for census geographies, as we have seen in previous chapters. This kind of geographical data is widely available in official and open repositories (see also <em>Appendix C: sourcing geographical data for crime analysis</em>). Getting data for spatial networks used to be a little bit trickier, although it is getting better. One could, for example, use the <code>osmdata</code> package to access Open Street Map data for a road network (we also discuss this in greater detail in <em>Appendix C</em>). Or, if you analyse data from the United States, you could use the <code>tigris</code> package to extract geometries which represent road networks.</p>
<p>Below we show how to obtain this data for Kensington, a popular neighbourhood in Toronto city centre through <code>osmdata</code> and for Manhattan using <code>tigris</code>. As we’re querying data from Open Street Map, first we draw a bounding box around the area we are interested in, then select “highways” as the feature to extract (see <em>Appendix C</em> for details on building OSM queries). As discussed by <span class="citation">Abad, Lovelace, and Meer (<a href="#ref-Abad_2019" role="doc-biblioref">2019</a>)</span>, the <code>osmdata</code> package turns streets that form loops into polygons, to ensure we end up with lines we use <code>osm_poly2line</code>.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="crime-along-spatial-networks.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using osm data</span></span>
<span id="cb375-2"><a href="crime-along-spatial-networks.html#cb375-2" aria-hidden="true" tabindex="-1"></a>highways_heswall <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="st">&quot;Heswall, UK&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb375-3"><a href="crime-along-spatial-networks.html#cb375-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&quot;highway&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb375-4"><a href="crime-along-spatial-networks.html#cb375-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb375-5"><a href="crime-along-spatial-networks.html#cb375-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-6"><a href="crime-along-spatial-networks.html#cb375-6" aria-hidden="true" tabindex="-1"></a>heswall_lines <span class="ot">&lt;-</span> highways_heswall<span class="sc">$</span>osm_lines</span></code></pre></div>
<p>Now let’s use the <code>tigris</code> package to get TIGER/Line shapefiles from the United States Census Bureau. The <code>roads()</code> function returns the content of the all roads shapefile - which includes primary roads, secondary roads, local neighborhood roads, rural roads, city streets, vehicular trails (4WD), ramps, service drives, walkways, stairways, alleys, and private roads. It returns these as an <code>sf</code> object.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="crime-along-spatial-networks.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using tigris</span></span>
<span id="cb376-2"><a href="crime-along-spatial-networks.html#cb376-2" aria-hidden="true" tabindex="-1"></a>manhattan_roads <span class="ot">&lt;-</span> <span class="fu">roads</span>(<span class="st">&quot;NY&quot;</span>, <span class="st">&quot;New York&quot;</span>)</span></code></pre></div>
<p>We can now plot these two side by side</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="crime-along-spatial-networks.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot results </span></span>
<span id="cb377-2"><a href="crime-along-spatial-networks.html#cb377-2" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(heswall_lines) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb377-3"><a href="crime-along-spatial-networks.html#cb377-3" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(manhattan_roads) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb377-4"><a href="crime-along-spatial-networks.html#cb377-4" aria-hidden="true" tabindex="-1"></a>figure_1 <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(plot_1, plot_2, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Heswall&quot;</span>, <span class="st">&quot;Manhattan&quot;</span>),</span>
<span id="cb377-5"><a href="crime-along-spatial-networks.html#cb377-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb377-6"><a href="crime-along-spatial-networks.html#cb377-6" aria-hidden="true" tabindex="-1"></a>figure_1</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-219"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-219-1.png" alt="Street network geometries for Salford in Toronto, CA and Manhattan, in New York, USA" width="672" />
<p class="caption">
FIGURE 9.2: Street network geometries for Salford in Toronto, CA and Manhattan, in New York, USA
</p>
</div>
<p>What we have is two <code>sf</code> object containing linestrings. Linear networks indeed can be represented in R by simple features wit <code>sf</code> as here, or with the class <code>SpatialLines</code> of package <code>sp</code>. However, for us to be able to do particular kind analysis and some geospatial operations on this network we often will need a clear topology, we will need the data to be stored as a network graph. In other words, We need to move from linestrings to a linear graphical network representation, with edges (for example, representing street segments) and nodes (vertices indicating where they start and end).</p>
<p>This can be done by virtue of manual editing, which in large networks may be prohibitive, fully automatized, or automatized with manual edits just to correct errors. Explaining how to do this in detail with R would require space we do not have. Luckily, there are some good tutorials out there that you can consult for this data pre-processing work.</p>
<ul>
<li><span class="citation">Abad, Lovelace, and Meer (<a href="#ref-Abad_2019" role="doc-biblioref">2019</a>)</span> explain how to use the packages <code>rgrass7</code> and <code>link2GI</code> for this purpose. These packages bridge R to GRASS GIS software. So for this approach to work you would require this software also installed in your machine. Fortunately, GRASS GIS is freely available.</li>
<li>The vignettes for <code>sfnetworks</code> also cover how to turn a linestring <code>sf</code> object into a network. The function <code>as_sfnetwork()</code> provides the basic functionality for this. This package also includes several additional functions for cleaning the resulting network and there is a specific vignette documenting these <span class="citation">(<a href="#ref-Vandemeer_2021" role="doc-biblioref">van der Meer et al. 2021</a>)</span>.</li>
<li><span class="citation">Briz-Redón, Martı́nez-Ruiz, and Montes (<a href="#ref-BrizRedon_2019a" role="doc-biblioref">2019a</a>)</span> developed the <code>SpNetPrep</code> (“Spatial Network Preprocessing”). This package will open a Shiny application in RStudio that will allows for network creation and edition, network direction endowment and point pattern revision and modiﬁcation. The key aim of this package is to allow for manual edits of the constructed network to correct for errors.</li>
</ul>
<p>We quickly below show the <code>as_sfnetwork()</code> function with the road network in Kensington (which will generate an object of class <code>sfnetwork</code>) so that you get a sense for the look of a spatial network, but for further details on network construction and pre-processing it is important you see the documentation, as well as the other materials cited above.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="crime-along-spatial-networks.html#cb378-1" aria-hidden="true" tabindex="-1"></a>heswall_ntwk <span class="ot">&lt;-</span> <span class="fu">as_sfnetwork</span>(heswall_lines)</span>
<span id="cb378-2"><a href="crime-along-spatial-networks.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(heswall_ntwk)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-220"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-220-1.png" alt="Heswall as a spatial network" width="672" />
<p class="caption">
FIGURE 9.3: Heswall as a spatial network
</p>
</div>
<p>Once you have a spatial network that has been properly cleaned and prepared as discussed in the references above, there are a number of things you can do with it. You can apply geospatial operations, such as blending points into the edges, segmenting the edges, running spatial filters, etc. You can also apply standard social network analysis techniques and measures (such as centrality, measuring shortest path). Illustration of these applications are available in the vignettes for <code>sfnetworks</code> <span class="citation">(<a href="#ref-Vandemeer_2021" role="doc-biblioref">van der Meer et al. 2021</a>)</span> and in <span class="citation">Abad, Lovelace, and Meer (<a href="#ref-Abad_2019" role="doc-biblioref">2019</a>)</span>.</p>
<p>Another format for linear networks in R is <code>linnet</code> used by the package <code>spatstat</code>. When what we want is to do analysis not of the network itself, but of the location of points (such as crime events) along the network <code>spatstat</code> is the way to go and so we would need to ensure we store the data in formats that are required by this package. Statistical analysis of events along these networks is of key interest for crime analysts. In the next section we will explain how to perform density estimation along networks.</p>
</div>
<div id="density-estimation-along-networks" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Density estimation along networks<a href="crime-along-spatial-networks.html#density-estimation-along-networks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One way of estimating the intensity of crime along spatial networks is to use kernel density estimation methods. You could, as we did in Chapter 7, use standard kernel density estimation methods, but this ignores the underlying structure in the data. As Jeremy Gelb indicates in the vignette for <code>spNetwork</code>, there are a number of problems with this cruder approach:</p>
<blockquote>
<p>“Calculating density values for locations outside the network is meaningless and the Euclidean distance underestimates the real distance between two objects on the network. Moreover, networks are not isotropic spaces. In other words, it is not possible to move in every direction, but only along the edges of the network” <span class="citation">(<a href="#ref-Gelb_2021" role="doc-biblioref">Gelb 2021</a>)</span>.</p>
</blockquote>
<p>Smoothing through kernel density estimation in linear networks is an area of active development and a number of approaches have been proposed over recent years, some of which provide a pragmatic (heuristic) solution, but “their properties are not well understood, statistical insight is lacking,” and “computational cost is high” <span class="citation">(<a href="#ref-McSwiggan_2016" role="doc-biblioref">McSwiggan, Baddeley, and Nair 2016</a>: 325)</span>. The existing software implementation of the “traditional” algorithms that have been developed can deal with small datasets, but may become prohibitive when dealing with larger datasets. More recent algorithms aim to provide faster solutions for larger datasets without seriously compromising performance (see <span class="citation">Rakshit et al. (<a href="#ref-Rakshit_2019" role="doc-biblioref">2019</a>)</span>). You can currently do this in R with at least two separate packages <code>spatstat</code> and the newer <code>spNetwork</code>. For reasons of space, given that it provides a more general framework for point pattern analysis and a wider selection of (more principled) approaches, we will only cover <code>spatstat</code> here.</p>
<p>In <code>spatstat</code> a point pattern on a linear network is represented by an object of class <code>lpp</code> (stands for point pattern in a linear network). The functions <code>lpp()</code> and <code>as.lpp()</code> convert raw data into an object of class <code>lpp</code>. The two needed arguments are a matrix or data frame with the coordinates of the points (or alternatively a <code>ppp</code> object that we discussed in chapter 7) and a liner network of class <code>linnet</code>).</p>
<p>The <code>linnet</code> object will represent the network of a set of line segments, containing information about each of these segments (edges) and its vertices (nodes). You can generate a <code>linnet</code> object from a <code>SpatialLines</code> (<code>sp</code>) object using <code>as.linnet.SpatialLines()</code>. If you need to process this network before is ready you can do so with some functions from <code>spatstat</code> or <code>SpnetPrep</code> as preferable (and only then create your <code>linnet</code> object).</p>
<p>We will show here how to transform a <code>SpatialLines</code> object into <code>linnet</code> and how, then, we generate a <code>lpp</code> object.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="crime-along-spatial-networks.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to projected coordinages (British National Grid)</span></span>
<span id="cb379-2"><a href="crime-along-spatial-networks.html#cb379-2" aria-hidden="true" tabindex="-1"></a>heswall_lines <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(heswall_lines, <span class="at">crs =</span> <span class="dv">27700</span>)</span>
<span id="cb379-3"><a href="crime-along-spatial-networks.html#cb379-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make into sp object</span></span>
<span id="cb379-4"><a href="crime-along-spatial-networks.html#cb379-4" aria-hidden="true" tabindex="-1"></a>heswall_roads_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(heswall_lines, <span class="st">&#39;Spatial&#39;</span>)</span>
<span id="cb379-5"><a href="crime-along-spatial-networks.html#cb379-5" aria-hidden="true" tabindex="-1"></a><span class="co"># turn into line network (linnet)</span></span>
<span id="cb379-6"><a href="crime-along-spatial-networks.html#cb379-6" aria-hidden="true" tabindex="-1"></a>heswall_roads_linnet <span class="ot">&lt;-</span> <span class="fu">as.linnet.SpatialLines</span>(heswall_roads_sp)</span></code></pre></div>
<p>Now let’s get some crime data to link to this line network. We can find this from the open data portal data.police.uk and choose to get data from Merseyside police, who cover this area. For the sake of practice here, one years’ worth of data is included with the datasets available with this textbook (see preamble). The file is <code>merseyside_asb.csv</code>.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="crime-along-spatial-networks.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in asb data</span></span>
<span id="cb380-2"><a href="crime-along-spatial-networks.html#cb380-2" aria-hidden="true" tabindex="-1"></a>shoplifting <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/merseyside_shoplifting.csv&quot;</span>)</span></code></pre></div>
<pre><code>## New names:
## Rows: 7930 Columns: 14
## ── Column specification
## ─────────────────────────────── Delimiter: &quot;,&quot; chr
## (9): crime_id, month, reported_by, falls_within... dbl
## (4): ...1, ...2, longitude, latitude lgl (1): context
## ℹ Use `spec()` to retrieve the full column
## specification for this data. ℹ Specify the column
## types or set `show_col_types = FALSE` to quiet this
## message.
## • `` -&gt; `...1`
## • `...1` -&gt; `...2`</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="crime-along-spatial-networks.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to spatial object</span></span>
<span id="cb382-2"><a href="crime-along-spatial-networks.html#cb382-2" aria-hidden="true" tabindex="-1"></a>shoplifting_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(shoplifting, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb382-3"><a href="crime-along-spatial-networks.html#cb382-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to match projection of lines</span></span>
<span id="cb382-4"><a href="crime-along-spatial-networks.html#cb382-4" aria-hidden="true" tabindex="-1"></a>shoplifting_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(shoplifting_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(heswall_lines))</span>
<span id="cb382-5"><a href="crime-along-spatial-networks.html#cb382-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot them together to have a look</span></span>
<span id="cb382-6"><a href="crime-along-spatial-networks.html#cb382-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb382-7"><a href="crime-along-spatial-networks.html#cb382-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> heswall_lines) <span class="sc">+</span> </span>
<span id="cb382-8"><a href="crime-along-spatial-networks.html#cb382-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> shoplifting_sf, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb382-9"><a href="crime-along-spatial-networks.html#cb382-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:getheswallcrimedata"></span>
<img src="crime_mapping_files/figure-html/getheswallcrimedata-1.png" alt="All shoplifting incidents in Merseyside May 2019 - April 2020" width="672" />
<p class="caption">
FIGURE 9.4: All shoplifting incidents in Merseyside May 2019 - April 2020
</p>
</div>
<p>We can see that Merseyside Police cover a lot more than just Heswall, so we can use the bounding box around the roads to subset our crime data:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="crime-along-spatial-networks.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a bounding box around the heswall lines geometry</span></span>
<span id="cb383-2"><a href="crime-along-spatial-networks.html#cb383-2" aria-hidden="true" tabindex="-1"></a>heswall_bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(heswall_lines) <span class="sc">%&gt;%</span> <span class="fu">st_as_sfc</span>()</span>
<span id="cb383-3"><a href="crime-along-spatial-networks.html#cb383-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset using the bounding box</span></span>
<span id="cb383-4"><a href="crime-along-spatial-networks.html#cb383-4" aria-hidden="true" tabindex="-1"></a>heswall_shoplifting <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(shoplifting_sf, heswall_bb)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be
## spatially constant throughout all geometries</code></pre>
<p>Now we have the line network and the shoplifting incidents in heswall we can create our lpp object. First we create a ppp (point pattern) object, following the steps we learned in the previuos chapter on spatial point patterns:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="crime-along-spatial-networks.html#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a window</span></span>
<span id="cb385-2"><a href="crime-along-spatial-networks.html#cb385-2" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(heswall_roads_linnet)</span>
<span id="cb385-3"><a href="crime-along-spatial-networks.html#cb385-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract coordinates</span></span>
<span id="cb385-4"><a href="crime-along-spatial-networks.html#cb385-4" aria-hidden="true" tabindex="-1"></a>shoplifting_coords <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(heswall_shoplifting<span class="sc">$</span>geometry), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T)</span>
<span id="cb385-5"><a href="crime-along-spatial-networks.html#cb385-5" aria-hidden="true" tabindex="-1"></a><span class="co"># make into pppt </span></span>
<span id="cb385-6"><a href="crime-along-spatial-networks.html#cb385-6" aria-hidden="true" tabindex="-1"></a>shoplifting_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> shoplifting_coords[,<span class="dv">1</span>], <span class="at">y =</span> shoplifting_coords[,<span class="dv">2</span>],</span>
<span id="cb385-7"><a href="crime-along-spatial-networks.html#cb385-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">window =</span> window, <span class="at">check =</span> T)</span></code></pre></div>
<pre><code>## Warning: data contain duplicated points</code></pre>
<p>Now that we have the <code>ppp</code> object we can use it to create our <code>lpp</code> object (notice that, as noted above, there are other ways to input your points when creating a <code>lpp</code> object) and then plot it. There are a 264 locations, some of which represent up to 6 incidents. This is likely the result of geomasking due to privacy concerns <span class="citation">(<a href="#ref-Tompson_2015" role="doc-biblioref">Tompson et al. 2015</a>)</span>.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="crime-along-spatial-networks.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now use this and previously created linnet to make lpp object</span></span>
<span id="cb387-2"><a href="crime-along-spatial-networks.html#cb387-2" aria-hidden="true" tabindex="-1"></a>shoplifting_lpp <span class="ot">&lt;-</span> <span class="fu">lpp</span>(shoplifting_ppp, heswall_roads_linnet, <span class="at">window =</span> window)</span></code></pre></div>
<p>Now we can calculate the density and visualise. Like we did before, we can estimate the density of data points along the networks using Kernel estimation with <code>density.lpp()</code>. This is an area of <code>spatstat</code> that has seen significant development in the latest release. Depending on the arguments passed to the function a different algorithm will be employed to estimate the density.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="crime-along-spatial-networks.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate density</span></span>
<span id="cb388-2"><a href="crime-along-spatial-networks.html#cb388-2" aria-hidden="true" tabindex="-1"></a>d100 <span class="ot">&lt;-</span> <span class="fu">density.lpp</span>(shoplifting_lpp, <span class="dv">100</span>, <span class="at">finespacing=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning in as.data.frame.hyperframe(x$data[, chosen,
## drop = FALSE]): 1 variable discarded in conversion to
## data frame</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="crime-along-spatial-networks.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb390-2"><a href="crime-along-spatial-networks.html#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d100)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:densitylpp"></span>
<img src="crime_mapping_files/figure-html/densitylpp-1.png" alt="Network density map with defaults" width="672" />
<p class="caption">
FIGURE 9.5: Network density map with defaults
</p>
</div>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="crime-along-spatial-networks.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d100, <span class="at">style=</span><span class="st">&quot;width&quot;</span>, <span class="at">fig.cap=</span><span class="st">&#39;Network density map with defaults with line width&#39;</span>)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-221-1.png" width="672" /></p>
<p>A <code>lpp</code> object contains the linear network information, the spatial coordinates of the data points, and any number of columns of <em>marks</em> (in this case the mark is telling us the type of crime we are dealing with). It also contains the local coordinates <code>seg</code> and <code>tp</code> for the data points. The local coordinate <code>seg</code> is an integer identifying the particular street segment the data point is located in. A segment is each of the sections of a street between two vertices (marking the intersection with another segment). The local coordinate <code>tp</code> is a real number between 0 and 1 indicating the position of the point within the segment: <code>tp=0</code> corresponds to the first endpoint and <code>tp=1</code> correspond to the second endpoint.</p>
<p>The visual inspection of the map suggest that the intensity of crime along the network is not spatially uniform. Alternatively one could use the new specific functions for each of these different algorithms: <code>densityQuick()</code> (see <span class="citation">Rakshit et al. (<a href="#ref-Rakshit_2019" role="doc-biblioref">2019</a>)</span>), <code>densityEqualSplit()</code> (see <span class="citation">Okabe and Sugihara (<a href="#ref-Okabe_2012" role="doc-biblioref">2012</a>)</span>), or <code>densityHeat()</code> (see <span class="citation">McSwiggan, Baddeley, and Nair (<a href="#ref-McSwiggan_2016" role="doc-biblioref">2016</a>)</span>).</p>
<p>The Okabe-Suhigara method was the first to be developed for this kind of applications and can be invoked with <code>densityEqualSplit()</code>. We can specify the kernel (the default is <code>epanechnikov</code>) and the smoothing bandwidth, sigma (the standard deviation of the kernel). Above, we used 100 meters for illustration, but see <em>Chapter 7: Spatial point patterns of crime events</em> in this book for details on these parameters). There are two versions of this algorithm, the continuous that is excruciatingly slow (particularly for larger datasets) and the discontinuous that is a bit quicker but has less desirable statistical properties. We are using the number of events per point as the weight for computation, and wrapping everything on <code>system.time()</code> to provide a notion of computation time. We will only show the discontinuous version.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="crime-along-spatial-networks.html#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d_okabe <span class="ot">&lt;-</span> <span class="fu">densityEqualSplit</span>(shoplifting_lpp, </span>
<span id="cb392-2"><a href="crime-along-spatial-networks.html#cb392-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">weights =</span> <span class="fu">marks</span>(shoplifting_lpp), </span>
<span id="cb392-3"><a href="crime-along-spatial-networks.html#cb392-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sigma =</span> <span class="dv">100</span>,</span>
<span id="cb392-4"><a href="crime-along-spatial-networks.html#cb392-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">continuous =</span> <span class="cn">FALSE</span>,</span>
<span id="cb392-5"><a href="crime-along-spatial-networks.html#cb392-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">verbose=</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   9.230   0.319   9.551</code></pre>
<p>And to visualise:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="crime-along-spatial-networks.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_okabe, <span class="at">main=</span><span class="st">&quot;Okabe-Suhigara (disc.)&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-222"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-222-1.png" alt="Network density map (Okabe-Suhigara (disc.) method)" width="672" />
<p class="caption">
FIGURE 9.6: Network density map (Okabe-Suhigara (disc.) method)
</p>
</div>
<p><span class="citation">McSwiggan, Baddeley, and Nair (<a href="#ref-McSwiggan_2016" role="doc-biblioref">2016</a>)</span> subsequently developed an algorithm that is equivalent to the Okabe-Suhigara method using the continuous rule applied to the Gaussian kernel, and therefore has more desirable properties than the equal split discontinuous, but that runs faster (than the Okabe-Suhigara equal split continuous version).</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="crime-along-spatial-networks.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d_mcswiggan <span class="ot">&lt;-</span> <span class="fu">densityHeat.lpp</span>(shoplifting_lpp, </span>
<span id="cb395-2"><a href="crime-along-spatial-networks.html#cb395-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">weights =</span> <span class="fu">marks</span>(shoplifting_lpp), </span>
<span id="cb395-3"><a href="crime-along-spatial-networks.html#cb395-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sigma =</span> <span class="dv">100</span>, </span>
<span id="cb395-4"><a href="crime-along-spatial-networks.html#cb395-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">finespacing=</span><span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.044   0.004   1.048</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="crime-along-spatial-networks.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_mcswiggan, <span class="at">main=</span><span class="st">&quot;McSwiggan&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-223"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-223-1.png" alt="Network density map (McSwiggan Gaussian method)" width="672" />
<p class="caption">
FIGURE 9.7: Network density map (McSwiggan Gaussian method)
</p>
</div>
<p>Finally, as noted above, <span class="citation">Rakshit et al. (<a href="#ref-Rakshit_2019" role="doc-biblioref">2019</a>)</span> developed a fast algorithm, using a convolution method, that is particularly helpful with large datasets. The analysis of the authors suggest this estimator “is consistent, and its statistical efficiency is only slightly suboptimal” <span class="citation">(<a href="#ref-Rakshit_2019" role="doc-biblioref">Rakshit et al. 2019</a>)</span>.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="crime-along-spatial-networks.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d_rakshit <span class="ot">&lt;-</span> <span class="fu">densityQuick.lpp</span>(shoplifting_lpp, </span>
<span id="cb398-2"><a href="crime-along-spatial-networks.html#cb398-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">weights =</span> <span class="fu">marks</span>(shoplifting_lpp), </span>
<span id="cb398-3"><a href="crime-along-spatial-networks.html#cb398-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sigma =</span> <span class="dv">100</span>,</span>
<span id="cb398-4"><a href="crime-along-spatial-networks.html#cb398-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">edge2D =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.245   0.003   0.249</code></pre>
<p>We can now plot the data and compare the results:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="crime-along-spatial-networks.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_rakshit, <span class="at">main=</span><span class="st">&quot;Rakshit&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-224"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-224-1.png" alt="Network density map (Rakshit method)" width="672" />
<p class="caption">
FIGURE 9.8: Network density map (Rakshit method)
</p>
</div>
<p>So these are some ways in which we can create a density map of crime along networks. You can compare the three maps to see how choice of method affects conclusions. This is something we must always reflect on, when applying these techniques.</p>
<div id="adding-context" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Adding context<a href="crime-along-spatial-networks.html#adding-context" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another thing you might like to do is add some context to explore where these hotspots are. Similar to how we did this with our KDE in continuous space in chapter 7, we can use the raster and leaflet packages here too. One difference, we must also use the <code>as.im()</code> function to make sure our heatmap is of class “im”.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="crime-along-spatial-networks.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to raster wrapped inside as.im() function</span></span>
<span id="cb401-2"><a href="crime-along-spatial-networks.html#cb401-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">as.im</span>(d_mcswiggan))</span>
<span id="cb401-3"><a href="crime-along-spatial-networks.html#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="co">#remove very low density values</span></span>
<span id="cb401-4"><a href="crime-along-spatial-networks.html#cb401-4" aria-hidden="true" tabindex="-1"></a>r1[r1 <span class="sc">&lt;</span> <span class="fl">0.0001</span> ] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb401-5"><a href="crime-along-spatial-networks.html#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set CRS</span></span>
<span id="cb401-6"><a href="crime-along-spatial-networks.html#cb401-6" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(r1) <span class="ot">&lt;-</span> <span class="st">&quot;EPSG:27700&quot;</span></span>
<span id="cb401-7"><a href="crime-along-spatial-networks.html#cb401-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-8"><a href="crime-along-spatial-networks.html#cb401-8" aria-hidden="true" tabindex="-1"></a><span class="co">#create a colour palet</span></span>
<span id="cb401-9"><a href="crime-along-spatial-networks.html#cb401-9" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="fu">c</span>(<span class="st">&quot;#0C2C84&quot;</span>, <span class="st">&quot;#41B6C4&quot;</span>, <span class="st">&quot;#FFFFCC&quot;</span>), </span>
<span id="cb401-10"><a href="crime-along-spatial-networks.html#cb401-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">values</span>(r1), <span class="at">na.color =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb401-11"><a href="crime-along-spatial-networks.html#cb401-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-12"><a href="crime-along-spatial-networks.html#cb401-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-13"><a href="crime-along-spatial-networks.html#cb401-13" aria-hidden="true" tabindex="-1"></a><span class="co">#and then make map!</span></span>
<span id="cb401-14"><a href="crime-along-spatial-networks.html#cb401-14" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb401-15"><a href="crime-along-spatial-networks.html#cb401-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb401-16"><a href="crime-along-spatial-networks.html#cb401-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addRasterImage</span>(r1, <span class="at">colors =</span> pal, <span class="at">opacity =</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb401-17"><a href="crime-along-spatial-networks.html#cb401-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(<span class="at">pal =</span> pal, <span class="at">values =</span> <span class="fu">values</span>(r1),</span>
<span id="cb401-18"><a href="crime-along-spatial-networks.html#cb401-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Shoplifting map&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:addbaseheswall"></span>
<div id="htmlwidget-e34bb98183bd56fa1c87" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-e34bb98183bd56fa1c87">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAHOUlEQVR4nO2dS2xUVRjH/+fcO9OZwjxaWh5VfJto4sxQqAZUoiREXbhw48KNazcmvql2Z7wzBcTXwpi4M2504RoSE4KiIA9FWLgwKgHKq4U+mc7j3vu5GAqNVG0703tP7/f9Nk26mDlzzu9+55zvPK4iIghLx+sHD9Ghvefw43vPq7DLMhc67AJEnT2Pb1HQRrY9AEBJBAiGe7Z/RH9++4pxJkgECIip8So6NhSNe9pEgIC4fHSHMjHYShfAHIkAzBEBmCMCMEcEYI4IwBwRgDmsBEjlHCPnvN2bBmnd5l2hlG3BAtyxdY+RlThfsoUidfcN0tpHwqnwuRg+3q8AhTAkWHAi6P5nPiErbuH86TFMnBxQmXyRfCJMnhowLs89F529JbIsBUtrEBE8n+B5BNfzQ/8N6zbvoguH3wq0DPMWoGvTIMVsjXjCRiLdhqvnJ2HZGq7rY+R4/7Jo/Nl09pYIALRWcF0fY7++E/hv6Owt0dVf3g617uYtQMeGErW1WZiuuAABPhFWJGO4eCRYY4XWsqi1gHTeISKEHjKF5pHFIOawmgYKtyICMEcEYI4I0ASmZhYXggiwSLo2DpJWrZsE3fbo7lBkklnAPEjnHZo42ZjyPrvvB7pyYAgjP1/C73tfXpQBqZxDWim0t9tIroxDaw3P9eG5Ps5891qgU2uJAPMgm03gwNkj5NFxGngoDqXVohsfuJk/mZ52cXW4jMq1GqAQeOMDEgHmzcMvf0lW0gZ8wuH3X2hZQ82OLmEgAiyAbKFIYawZLCXsBUjlHLK0AhFARJhglt5mPwZIJmxksgkkEzZitkbHhhKrJ8IOuwAzZAtFam+P4Vq5jvEAw6zvE1JrVkANl1Eb88Dq8YdBAigFdPSk0Gkp9L30BR377MVA2qJW82DFLZze/yq3tgdgUBcweuIdlS2sRtfTdyP1aA8ee/ebQEKx1gpDv43c8v9Mvkj3PvUxAY2RehBlCQPjBoFPfr6Pxr4/h79+vRRYV7Cqt0RKqxs7mzp7SxSzNVKdSdTKdUyX6/B8Qti7d5YC4wQAbmbKxk+GN+Xq2jhI2lKwr297u3x0R+QaHzBUABPI5Btn+cOUMAhEAOYYMwgUwkEEYI4IwBwRgDkiAHNEAOZEToB0zqFMoUgz6dsobNxcSiKVB+je1Mjeaa1Qq3nwPArl0OdywpjVwMWSyjmkFKCVgm1paK1h2xqViocIub1kLPsuYPYBVQKhWnVx9uDriogin8ZtBZHqAoSFs+wjgNAcIgBz2AiQyjkkU8JbYSHA5h1fUTJhwzL4zR1h0bQAM5ctmcq2r/fTbdvXQ2slOYE5aEkEWN230zgJ0jmH0jmHAIXRqo+LP8llVnPRsmlgz5bdVK97qNX9QPf1/xfdfYPUfUcG9bKLS0MT7E79zIeWjQEqFRee15Ap3eRgK3X96W12O/bwsX41NTKN4QuTzXxMpGlpIiiVc2jy1ICa+bvYz+naNEhEBNcjkM/vvF6QGJcJ7OwtkdYKCkA9pBs8OWHeYhA1zusRyUpeEBgXAYRgYZEIEv4dEYA5IgBz2AqQKRQpUzDvXb5Bw3YQmC0UKduRRHtnAuf/GIV/vR7CvLErDJZFBJidFezYUKRsoUgzp3cXS1vcQixh4+JfY1izPn1jpZDbkrHxESCVc0ihcZNHzNYgaiSIFrvfL513KNFmo2t9GiNnJlCre7AshXjcQrnsYinef5TON+47MDGvYbwAQKMCLa1gWRrkE640eVNHOu9QNpNAtepCa4VKxYXr3Wz41X07qVr3WrKotX7rHnLrHjyXUHd9jJ4w65aRZSEA0Aj9ltbwqVGRQHOvrEnnHIICYrbGipVtmJqsIp1JYHysgpitUat7IKAlEjz43Kc0PV7F9FQNlwy7aWTZCDCbZhebZpPOO5RM2Eh1JOG7PkavlBGPW6hWPfhELRsU3vnEB+TWfQz9+IYIYDIzg81/vhRr1cZB8n0yLoQ3iwgwT2YE8Dw/UsvTy2IaGDa3P/Y+EVEk7xKOdAS47+lPqDxRxflDbzbdaK0cd5hEpAXo2bKbWtH4USbSXcDUVC3sIhhPpCOA8P9EOgII/48IwBwRgDnm7QoOgbCneD1bdjfOQdR9+ES48nNw2Ub2g8BUziHbUli1eiUIhGvjVVSrLkZPBPSugo0lisctAIDr+hg+1h+oiOwjwOSpAXXXtg/JbrNgtTU2iUwMlwP57nTeIVtrXDgc3sFV9gKkcg7F7MZQaO0D6xDvWYmOy8EIAAKuhry4JF1AzrlxFI0ISCZtVkfJ2QvAHZkGMkcEYI4IwBwRgDkiAHNEAOaIAMwRAZgjAjBHBGCOCMAcEYA5IgBzRADmiADMEQGYIwIwRwRgjgjAHBGAOSIAc0QA5ogAzBEBmCMCMEcEYI4IwBwRgDkiAHNEAOaIAMwRAZgjAjBHBGCOCMAcEYA5IgBzRADmiADMEQGYIwIwRwRgzt+IuQ2eyEBAjQAAAABJRU5ErkJggg==",[[53.3785938316799,-3.15153170809042],[53.2823958235235,-3.04249562639619]],0.8,null,null,null]},{"method":"addLegend","args":[{"colors":["#0C2C84 , #274D94 12.6861822531096%, #3670A5 25.5006726448532%, #3E94B5 38.3151630365967%, #48B8C4 51.1296534283403%, #85CAC7 63.9441438200838%, #B4DDC9 76.7586342118274%, #DEF0CB 89.5731246035709%, #FFFFCC "],"labels":["0.01","0.02","0.03","0.04","0.05","0.06","0.07"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"numeric","title":"Shoplifting map","extra":{"p_1":0.126861822531096,"p_n":0.895731246035709},"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[53.2823958235235,53.3785938316799],"lng":[-3.15153170809042,-3.04249562639619]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
FIGURE 9.9: Add interactive basemap to explore hotspots
</p>
</div>
</div>
</div>
<div id="visualising-crime-distribution-along-networks" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Visualising crime distribution along networks<a href="crime-along-spatial-networks.html#visualising-crime-distribution-along-networks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To demonstrate some simpler approaches to visualising crime distribution along networks, we can zoom in a little bit on Heswall town centre. The coordinates for that are: 53.3281041,-3.1025683. Let’s build a buffer.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="crime-along-spatial-networks.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a df of one central point</span></span>
<span id="cb402-2"><a href="crime-along-spatial-networks.html#cb402-2" aria-hidden="true" tabindex="-1"></a>heswall_tc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">longitude =</span> <span class="sc">-</span><span class="fl">3.1025683</span>, </span>
<span id="cb402-3"><a href="crime-along-spatial-networks.html#cb402-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">latitude =</span> <span class="fl">53.3281041</span>)</span>
<span id="cb402-4"><a href="crime-along-spatial-networks.html#cb402-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-5"><a href="crime-along-spatial-networks.html#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a buffer by making point into sf object</span></span>
<span id="cb402-6"><a href="crime-along-spatial-networks.html#cb402-6" aria-hidden="true" tabindex="-1"></a>heswall_tc_buffer <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(heswall_tc, </span>
<span id="cb402-7"><a href="crime-along-spatial-networks.html#cb402-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>),</span>
<span id="cb402-8"><a href="crime-along-spatial-networks.html#cb402-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb402-9"><a href="crime-along-spatial-networks.html#cb402-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(., <span class="dv">27700</span>) <span class="sc">%&gt;%</span> <span class="co"># project to BNG (for meters)</span></span>
<span id="cb402-10"><a href="crime-along-spatial-networks.html#cb402-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(., <span class="dv">1000</span>)  <span class="co"># build 1km buffer</span></span></code></pre></div>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="crime-along-spatial-networks.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select roads that go through town centre</span></span>
<span id="cb403-2"><a href="crime-along-spatial-networks.html#cb403-2" aria-hidden="true" tabindex="-1"></a>heswall_tc <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(heswall_tc_buffer, heswall_lines)</span>
<span id="cb403-3"><a href="crime-along-spatial-networks.html#cb403-3" aria-hidden="true" tabindex="-1"></a>heswall_tc <span class="ot">&lt;-</span> heswall_lines[<span class="fu">unlist</span>(heswall_tc),]</span>
<span id="cb403-4"><a href="crime-along-spatial-networks.html#cb403-4" aria-hidden="true" tabindex="-1"></a><span class="co"># select shoplifting incidents in town centre</span></span>
<span id="cb403-5"><a href="crime-along-spatial-networks.html#cb403-5" aria-hidden="true" tabindex="-1"></a>tc_shoplifting <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(heswall_tc_buffer, heswall_shoplifting)</span>
<span id="cb403-6"><a href="crime-along-spatial-networks.html#cb403-6" aria-hidden="true" tabindex="-1"></a>tc_shoplifting <span class="ot">&lt;-</span> heswall_shoplifting[<span class="fu">unlist</span>(tc_shoplifting),]</span>
<span id="cb403-7"><a href="crime-along-spatial-networks.html#cb403-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-8"><a href="crime-along-spatial-networks.html#cb403-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb403-9"><a href="crime-along-spatial-networks.html#cb403-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> heswall_tc) <span class="sc">+</span> </span>
<span id="cb403-10"><a href="crime-along-spatial-networks.html#cb403-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tc_shoplifting, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb403-11"><a href="crime-along-spatial-networks.html#cb403-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> heswall_tc_buffer, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb403-12"><a href="crime-along-spatial-networks.html#cb403-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-225"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-225-1.png" alt="Narrow focus on Heswall town centre" width="672" />
<p class="caption">
FIGURE 9.10: Narrow focus on Heswall town centre
</p>
</div>
<div id="hot-routes" class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Hot Routes<a href="crime-along-spatial-networks.html#hot-routes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to map hot spots along a network, we can use a technique called <em>hot routes</em>. Hot Routes were devised to be a straightforward spatial technique that analyses crime patterns that are associated with a linear network (e.g. streets and other transportation networks). It allows an analyst to map crime concentrations along different segments of the network and visualise this through colour. We can create a Hot Routes visualisation by thematically shading each street segment with a colour (and line thickness if desired) that corresponds to the range of the rate of crime per metre. It was used by <span class="citation">Newton (<a href="#ref-Newton_2008" role="doc-biblioref">2008</a>)</span> to map crime and disorder on the bus network in Merseyside. A useful how-to guide on using hot routes was later produced by <span class="citation">Tompson, Partridge, and Shepherd (<a href="#ref-Tompson_2009" role="doc-biblioref">2009</a>)</span>. In it they break down the process into four stages:</p>
<pre><code>- Step 1. Preparing the network layer
- Step 2. Linking crime events to street segments
- Step 3. Calculating a rate
- Step 4. Visualising the results</code></pre>
<p>We can follow those steps here.</p>
<div id="preparing-the-network-layer" class="section level4 hasAnchor" number="9.4.1.1">
<h4><span class="header-section-number">9.4.1.1</span> Preparing the network layer<a href="crime-along-spatial-networks.html#preparing-the-network-layer" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The pre-requisite to visualising hot routes is to have a network layer which meets certain conditions. For exmaple, <span class="citation">Tompson, Partridge, and Shepherd (<a href="#ref-Tompson_2009" role="doc-biblioref">2009</a>)</span> advise that since network layers typically contain streets of unequal length, longer segments might show up as hot simply because they have more space to contain more crimes. Therefore in such cases it is advisable in this analysis to use equal length street segments, where possible. To address this they segment their studiy area into 1 meter length segments using a grid overlay. Another approach is to calculate a rate per meter, instead of count, so that’s the approach we will take here.</p>
<p>Another requirement is that the network layer has a unique identifier for each segment. One quick way to do this, if your data don’t already contain such a column is to create a column that just numbers each row from 1 to the number of observations (rows) in the dataframe. Even if you have such a unique id, having the row name to a numeric column is required for joining the crimes to the street segments in the next step.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="crime-along-spatial-networks.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create numeric unique id column</span></span>
<span id="cb405-2"><a href="crime-along-spatial-networks.html#cb405-2" aria-hidden="true" tabindex="-1"></a>heswall_tc<span class="sc">$</span>unique_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(heswall_tc)</span></code></pre></div>
</div>
<div id="link-crime-events-to-street-segments" class="section level4 hasAnchor" number="9.4.1.2">
<h4><span class="header-section-number">9.4.1.2</span> Link crime events to street segments<a href="crime-along-spatial-networks.html#link-crime-events-to-street-segments" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One approach to solve this is to snap each shoplifting incident to the nearest street segment. We can use the <code>st_nearest_feature()</code> function that will create a list of the id number of the nearest street segment for each crime incident in our <code>tc_shoplifting</code> object.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="crime-along-spatial-networks.html#cb406-1" aria-hidden="true" tabindex="-1"></a>nearest_segments <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(tc_shoplifting, heswall_tc)</span></code></pre></div>
<p>This new object is simply a list of the ID numbers of matched line segments for each of the ASB incidents. For example here is the ID number of the nearest street segment for the first 5 ASB incidents in our data:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="crime-along-spatial-networks.html#cb407-1" aria-hidden="true" tabindex="-1"></a>nearest_segments[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] 315 315  65 317 317</code></pre>
<p>We can use this to create a frequency table which counds the number of ASB incidents linked to each street segment (by virtue of being nearest to it).</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="crime-along-spatial-networks.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make list of nearest into df of frequency</span></span>
<span id="cb409-2"><a href="crime-along-spatial-networks.html#cb409-2" aria-hidden="true" tabindex="-1"></a>nearest_freq <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(nearest_segments))</span>
<span id="cb409-3"><a href="crime-along-spatial-networks.html#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="co">#make sure id is numeric</span></span>
<span id="cb409-4"><a href="crime-along-spatial-networks.html#cb409-4" aria-hidden="true" tabindex="-1"></a>nearest_freq<span class="sc">$</span>nearest_segments <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(nearest_freq<span class="sc">$</span>nearest_segments))</span>
<span id="cb409-5"><a href="crime-along-spatial-networks.html#cb409-5" aria-hidden="true" tabindex="-1"></a>nearest_freq[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##   nearest_segments Freq
## 1                1    1
## 2               17    3
## 3               27    3</code></pre>
<p>We can see here some examples of the number of shoplifting incidents snapped to each segment. Now we can join this to our spatial layer:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="crime-along-spatial-networks.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co">#join to sections object and replace NAs with 0s</span></span>
<span id="cb411-2"><a href="crime-along-spatial-networks.html#cb411-2" aria-hidden="true" tabindex="-1"></a>heswall_tc <span class="ot">&lt;-</span> <span class="fu">left_join</span>(heswall_tc, </span>
<span id="cb411-3"><a href="crime-along-spatial-networks.html#cb411-3" aria-hidden="true" tabindex="-1"></a>                       nearest_freq,</span>
<span id="cb411-4"><a href="crime-along-spatial-networks.html#cb411-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;unique_id&quot;</span> <span class="ot">=</span> <span class="st">&quot;nearest_segments&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb411-5"><a href="crime-along-spatial-networks.html#cb411-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Freq =</span> <span class="fu">replace_na</span>(Freq, <span class="dv">0</span>)) </span></code></pre></div>
<p>We can produce a quick visialisation to check that everything linked OK before moving on to compute a rate normalising for length of street segment.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="crime-along-spatial-networks.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb412-2"><a href="crime-along-spatial-networks.html#cb412-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> heswall_tc, </span>
<span id="cb412-3"><a href="crime-along-spatial-networks.html#cb412-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">colour =</span> Freq), <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb412-4"><a href="crime-along-spatial-networks.html#cb412-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb412-5"><a href="crime-along-spatial-networks.html#cb412-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Number of shoplifting incidents&quot;</span>, </span>
<span id="cb412-6"><a href="crime-along-spatial-networks.html#cb412-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">1</span>,</span>
<span id="cb412-7"><a href="crime-along-spatial-networks.html#cb412-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#2166ac&quot;</span>, </span>
<span id="cb412-8"><a href="crime-along-spatial-networks.html#cb412-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mid =</span> <span class="st">&quot;#d1e5f0&quot;</span>, </span>
<span id="cb412-9"><a href="crime-along-spatial-networks.html#cb412-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">high =</span> <span class="st">&quot;#b2182b&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-231"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-231-1.png" alt="Check that crimes are linked to street segments" width="672" />
<p class="caption">
FIGURE 9.11: Check that crimes are linked to street segments
</p>
</div>
<p>Looks like we joined the shoplifting incidents to our network layer successfully. Now to normalise for the varying lenght of the street segments.</p>
</div>
<div id="calculating-a-rate" class="section level4 hasAnchor" number="9.4.1.3">
<h4><span class="header-section-number">9.4.1.3</span> Calculating a rate<a href="crime-along-spatial-networks.html#calculating-a-rate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In order to calculate a rate we need the numerator, number of shoplifting incidents, which we joined above, and a denominator to divide by. To control for varying length of the street segments we might want to consider this length as a suitable denominator. So we need to calculate this for each segment. To achieve this we can use the <code>st_length()</code> function.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="crime-along-spatial-networks.html#cb413-1" aria-hidden="true" tabindex="-1"></a>heswall_tc<span class="sc">$</span>length <span class="ot">&lt;-</span> <span class="fu">st_length</span>(heswall_tc)</span></code></pre></div>
<p>Now we have a column in the data which shows the length of each segment in meters (as we are working with projected coordinates). The class of this variable is units. We can see this if we print out one of the values:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="crime-along-spatial-networks.html#cb414-1" aria-hidden="true" tabindex="-1"></a>heswall_tc<span class="sc">$</span>length[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## 729.8 [m]</code></pre>
<p>To use it in our calculation, we need this to be a numeric variable, so let’s transform it, and then use it as our denominator to calculate our rate of crimes per meter of street segment length:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="crime-along-spatial-networks.html#cb416-1" aria-hidden="true" tabindex="-1"></a>heswall_tc<span class="sc">$</span>length <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(heswall_tc<span class="sc">$</span>length)</span>
<span id="cb416-2"><a href="crime-along-spatial-networks.html#cb416-2" aria-hidden="true" tabindex="-1"></a>heswall_tc<span class="sc">$</span>shoplifting_rate <span class="ot">&lt;-</span> heswall_tc<span class="sc">$</span>Freq <span class="sc">/</span>heswall_tc<span class="sc">$</span>length</span></code></pre></div>
<p>Now we have a measure of incidents per meter. Finally we can move to visualise the results.</p>
</div>
<div id="visualise-the-results" class="section level4 hasAnchor" number="9.4.1.4">
<h4><span class="header-section-number">9.4.1.4</span> Visualise the results<a href="crime-along-spatial-networks.html#visualise-the-results" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Very similar to how we carried out a visual check earlier, but this time using our rate as the value to present.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="crime-along-spatial-networks.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb417-2"><a href="crime-along-spatial-networks.html#cb417-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> heswall_tc, <span class="fu">aes</span>(<span class="at">colour =</span> shoplifting_rate), </span>
<span id="cb417-3"><a href="crime-along-spatial-networks.html#cb417-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb417-4"><a href="crime-along-spatial-networks.html#cb417-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb417-5"><a href="crime-along-spatial-networks.html#cb417-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Shoplifting incidents per meter&quot;</span>, </span>
<span id="cb417-6"><a href="crime-along-spatial-networks.html#cb417-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="fu">mean</span>(heswall_tc<span class="sc">$</span>shoplifting_rate),</span>
<span id="cb417-7"><a href="crime-along-spatial-networks.html#cb417-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#2166ac&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#d1e5f0&quot;</span>, </span>
<span id="cb417-8"><a href="crime-along-spatial-networks.html#cb417-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">high =</span> <span class="st">&quot;#b2182b&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-235"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-235-1.png" alt="Hot routes map displaying rate of crimes per meter for each segment" width="672" />
<p class="caption">
FIGURE 9.12: Hot routes map displaying rate of crimes per meter for each segment
</p>
</div>
<p>We can now see that that longer road there (Telegraph Road) is no longer so dominant once we’ve controlled for length.</p>
<p>Now this might also be as if it’s a long road it will have a bigger denominator, and as we’re dealing with few crimes here, it might be that artifically dilutes the crime rate. If you suspect this might be the case, then the segmentation might be a better approach, and then refer back to the paper by <span class="citation">Tompson, Partridge, and Shepherd (<a href="#ref-Tompson_2009" role="doc-biblioref">2009</a>)</span> for guidance on that.</p>
<p>In any case, we have now created a hot routes visualisation, that helps us map where crime rates are higher along a network. We can add some variations to this if we like, for example we could adjust the width of the segments as well as the colour, although this doesn’t always look the best as it distorts the street network:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="crime-along-spatial-networks.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb418-2"><a href="crime-along-spatial-networks.html#cb418-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> heswall_tc, <span class="fu">aes</span>(<span class="at">colour =</span> shoplifting_rate, <span class="at">size =</span> shoplifting_rate), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb418-3"><a href="crime-along-spatial-networks.html#cb418-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb418-4"><a href="crime-along-spatial-networks.html#cb418-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Shoplifting incidents per meter&quot;</span>, </span>
<span id="cb418-5"><a href="crime-along-spatial-networks.html#cb418-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="fu">mean</span>(heswall_tc<span class="sc">$</span>shoplifting_rate),</span>
<span id="cb418-6"><a href="crime-along-spatial-networks.html#cb418-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#2166ac&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#d1e5f0&quot;</span>, </span>
<span id="cb418-7"><a href="crime-along-spatial-networks.html#cb418-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">high =</span> <span class="st">&quot;#b2182b&quot;</span>) <span class="sc">+</span></span>
<span id="cb418-8"><a href="crime-along-spatial-networks.html#cb418-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Rate of crimes per meter (width)&quot;</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-236"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-236-1.png" alt="Hot routes map displaying rate of crimes per meter for each segment with line width as well as colour" width="672" />
<p class="caption">
FIGURE 9.13: Hot routes map displaying rate of crimes per meter for each segment with line width as well as colour
</p>
</div>
</div>
</div>
<div id="street-profile-analysis" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Street Profile Analysis<a href="crime-along-spatial-networks.html#street-profile-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Visualising crime along networks presents an important first step in identifying crime concentration. It may not always be necessary to include the geographic component of a spatial network for the purposes of crime analysis in these networks. Instead, another approach could be to make use of street profile analysis introduced by <span class="citation">Spicer et al. (<a href="#ref-Spicer_2016" role="doc-biblioref">2016</a>)</span>. Street profile analysis was initially developed as a method for visualising temporal and spatial crime patterns along major roadways in metropolitan areas. The idea is that the geographical location of the street may not actually be as important as the ability to visualise data from multiple years in a comparable way. So the approach is to treat the street in question as the x-axis of a graph, with a start point (A) and end point (B) breaking it into some interval. Then, you can visualise how crime is distributed along this street by plotting count or rate of crimes on the y-axis, and have multiple lines for different years for example. You can add context by re-introducing some key intersections, or other points of interest. In their paper, Spicer and colleagues demonstrate this using the example of Kingsway Avenue in Vancouver, BC. In this section we will go through how we can apply street profile analysis in R. We will follow the same 4 steps we did for the hot routes tutorial:</p>
<pre><code>- Step 1: Prepare the network layer
- Step 2. Link crime events to points of interest
- Step 3: Calculate a rate
- Step 4: Visualise the results</code></pre>
<div id="prepare-the-network-layer" class="section level4 hasAnchor" number="9.4.2.1">
<h4><span class="header-section-number">9.4.2.1</span> Prepare the network layer<a href="crime-along-spatial-networks.html#prepare-the-network-layer" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The strength of this approach is to focus in on one area of interest. Here let’s choose Telegraph Road. It is a long street which runs through the town centre. To subset it, we can use the names provided by the volunteers of Open Street Map, available in the <code>name</code> column:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="crime-along-spatial-networks.html#cb420-1" aria-hidden="true" tabindex="-1"></a>telegraph_rd <span class="ot">&lt;-</span> heswall_tc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Telegraph Road&quot;</span>) </span></code></pre></div>
<p>The geometry we have is already separated into 7 segments. This is just how we downloaded from OSM. We see there are 7 segments, but they don’t necessarily correspond to anything specific. In Street Profile Analysis we want to be conscious about how we divide up the segment. In their paper, <span class="citation">Spicer et al. (<a href="#ref-Spicer_2016" role="doc-biblioref">2016</a>)</span> just segment into 100m lengths. Another thing we might be interested in is to slice into segments wherever there is an intersection with another road. Here let’s use the intersections as a way to divide our street into segments.</p>
<p>To do this, we create an object of the intersecting streets, let’s call this object <code>tr_intersects</code>.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="crime-along-spatial-networks.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and select also the cross streets into separate object</span></span>
<span id="cb421-2"><a href="crime-along-spatial-networks.html#cb421-2" aria-hidden="true" tabindex="-1"></a>tr_intersects <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(telegraph_rd, heswall_tc)</span>
<span id="cb421-3"><a href="crime-along-spatial-networks.html#cb421-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subsetting</span></span>
<span id="cb421-4"><a href="crime-along-spatial-networks.html#cb421-4" aria-hidden="true" tabindex="-1"></a>tr_intersects <span class="ot">&lt;-</span> heswall_tc[<span class="fu">unlist</span>(tr_intersects),]</span>
<span id="cb421-5"><a href="crime-along-spatial-networks.html#cb421-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove Telegraph Road itself</span></span>
<span id="cb421-6"><a href="crime-along-spatial-networks.html#cb421-6" aria-hidden="true" tabindex="-1"></a>tr_intersects <span class="ot">&lt;-</span> tr_intersects <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&quot;Telegraph Road&quot;</span>)</span></code></pre></div>
<p>We can plot our segments to see whether they correspond to these intersections:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="crime-along-spatial-networks.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb422-2"><a href="crime-along-spatial-networks.html#cb422-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tr_intersects, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb422-3"><a href="crime-along-spatial-networks.html#cb422-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> telegraph_rd, <span class="fu">aes</span>(<span class="at">colour =</span> osm_id), <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb422-4"><a href="crime-along-spatial-networks.html#cb422-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-239"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-239-1.png" alt="Default OSM segments of Telegraph Road vs intersections" width="672" />
<p class="caption">
FIGURE 9.14: Default OSM segments of Telegraph Road vs intersections
</p>
</div>
<p>We can see that they do not correspond to all the intersections. Unfortunately, we will have to carry out some data cleaning. To do this, first we unite the entire street into one, and then use the intersections to divide into the appropriate segments.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="crime-along-spatial-networks.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unite the segments into one long street</span></span>
<span id="cb423-2"><a href="crime-along-spatial-networks.html#cb423-2" aria-hidden="true" tabindex="-1"></a>telegraph_rd_u <span class="ot">&lt;-</span> telegraph_rd <span class="sc">%&gt;%</span> </span>
<span id="cb423-3"><a href="crime-along-spatial-networks.html#cb423-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb423-4"><a href="crime-along-spatial-networks.html#cb423-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb423-5"><a href="crime-along-spatial-networks.html#cb423-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">&quot;LINESTRING&quot;</span>)</span>
<span id="cb423-6"><a href="crime-along-spatial-networks.html#cb423-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-7"><a href="crime-along-spatial-networks.html#cb423-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use st_split and st_combine to split into parts by intersecting roads</span></span>
<span id="cb423-8"><a href="crime-along-spatial-networks.html#cb423-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span>
<span id="cb423-9"><a href="crime-along-spatial-networks.html#cb423-9" aria-hidden="true" tabindex="-1"></a>parts <span class="ot">&lt;-</span> <span class="fu">st_split</span>(telegraph_rd_u, <span class="fu">st_combine</span>(tr_intersects<span class="sc">$</span>geometry)) <span class="sc">%&gt;%</span> <span class="fu">st_collection_extract</span>(<span class="st">&quot;LINESTRING&quot;</span>)</span>
<span id="cb423-10"><a href="crime-along-spatial-networks.html#cb423-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-11"><a href="crime-along-spatial-networks.html#cb423-11" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the parts into one shapefile</span></span>
<span id="cb423-12"><a href="crime-along-spatial-networks.html#cb423-12" aria-hidden="true" tabindex="-1"></a>datalist <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb423-13"><a href="crime-along-spatial-networks.html#cb423-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(parts)) {</span>
<span id="cb423-14"><a href="crime-along-spatial-networks.html#cb423-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb423-15"><a href="crime-along-spatial-networks.html#cb423-15" aria-hidden="true" tabindex="-1"></a>  datalist[[i]] <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">data.frame</span>(<span class="at">section =</span> i), <span class="at">geometry =</span> <span class="fu">st_geometry</span>(parts[i]))</span>
<span id="cb423-16"><a href="crime-along-spatial-networks.html#cb423-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb423-17"><a href="crime-along-spatial-networks.html#cb423-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb423-18"><a href="crime-along-spatial-networks.html#cb423-18" aria-hidden="true" tabindex="-1"></a>tr_sections <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, datalist)</span></code></pre></div>
<p>In the above code we do a lot but it means we end up with a geometry where the segments were defined by us, with the rationale that we should segment at each intersection. Whether you use this method, or divide at some set interval like every 100m is up to you, but as long as there is a decision made and justified is usually better than relying on defaults, such as the segments from OSM.</p>
<p>Let’s plot the new segments to see if they correspond to intersections.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="crime-along-spatial-networks.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb424-2"><a href="crime-along-spatial-networks.html#cb424-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tr_intersects, <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb424-3"><a href="crime-along-spatial-networks.html#cb424-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tr_sections, <span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">as.character</span>(section)), <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb424-4"><a href="crime-along-spatial-networks.html#cb424-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-241"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-241-1.png" alt="Telegraph Road segmented at each intersection" width="672" />
<p class="caption">
FIGURE 9.15: Telegraph Road segmented at each intersection
</p>
</div>
<p>Looks good. Now we can move to the next step and link our shoplifting incidents to these segments.</p>
</div>
<div id="linking-events-to-street-segments" class="section level4 hasAnchor" number="9.4.2.2">
<h4><span class="header-section-number">9.4.2.2</span> Linking events to street segments<a href="crime-along-spatial-networks.html#linking-events-to-street-segments" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To link the shoplifting incidents first we should filter those crimes which will be relevant. For this we build a 400m buffer around the road, and include only those shoplifting incidents which fall within this buffer (for more about buffers see <em>Chapter 2 Basic geospatial operations in R</em>).</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="crime-along-spatial-networks.html#cb425-1" aria-hidden="true" tabindex="-1"></a>tr_buffer <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(telegraph_rd_u, <span class="dv">400</span>)</span>
<span id="cb425-2"><a href="crime-along-spatial-networks.html#cb425-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-3"><a href="crime-along-spatial-networks.html#cb425-3" aria-hidden="true" tabindex="-1"></a><span class="co"># select shoplifting incidents in town centre</span></span>
<span id="cb425-4"><a href="crime-along-spatial-networks.html#cb425-4" aria-hidden="true" tabindex="-1"></a>tr_shoplifting <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(tr_buffer, tc_shoplifting)</span>
<span id="cb425-5"><a href="crime-along-spatial-networks.html#cb425-5" aria-hidden="true" tabindex="-1"></a>tr_shoplifting <span class="ot">&lt;-</span> tc_shoplifting[<span class="fu">unlist</span>(tr_shoplifting),]</span></code></pre></div>
<p>The strength of street profiles comes out in comparing different sources of data, so let’s split our shoplifting incidents by season. Let’s compare summer and winter.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="crime-along-spatial-networks.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split seasonally (to compare later) let&#39;s focus on winter and summer</span></span>
<span id="cb426-2"><a href="crime-along-spatial-networks.html#cb426-2" aria-hidden="true" tabindex="-1"></a>summer_sl <span class="ot">&lt;-</span> tr_shoplifting <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2019-06&quot;</span>, <span class="st">&quot;2019-07&quot;</span>, <span class="st">&quot;2019-08&quot;</span>))</span>
<span id="cb426-3"><a href="crime-along-spatial-networks.html#cb426-3" aria-hidden="true" tabindex="-1"></a>winter_sl <span class="ot">&lt;-</span> tr_shoplifting <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2019-12&quot;</span>, <span class="st">&quot;2020-01&quot;</span>, <span class="st">&quot;2020-02&quot;</span>))</span></code></pre></div>
<p>Then, the steps for linking the crimes are the same as we followed for hot routes above, using the <code>st_nearest_feature()</code> function.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="crime-along-spatial-networks.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach summer shoplifting incidents</span></span>
<span id="cb427-2"><a href="crime-along-spatial-networks.html#cb427-2" aria-hidden="true" tabindex="-1"></a>nearest_segments_summer <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(summer_sl, tr_sections)</span>
<span id="cb427-3"><a href="crime-along-spatial-networks.html#cb427-3" aria-hidden="true" tabindex="-1"></a>nearest_freq_summer <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(nearest_segments_summer))</span>
<span id="cb427-4"><a href="crime-along-spatial-networks.html#cb427-4" aria-hidden="true" tabindex="-1"></a>nearest_freq_summer <span class="ot">&lt;-</span> nearest_freq_summer <span class="sc">%&gt;%</span> </span>
<span id="cb427-5"><a href="crime-along-spatial-networks.html#cb427-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nearest_segments_summer =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(nearest_freq_summer<span class="sc">$</span>nearest_segments_summer))) <span class="sc">%&gt;%</span> </span>
<span id="cb427-6"><a href="crime-along-spatial-networks.html#cb427-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">summer_sl =</span> Freq)</span>
<span id="cb427-7"><a href="crime-along-spatial-networks.html#cb427-7" aria-hidden="true" tabindex="-1"></a>tr_sections <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tr_sections, </span>
<span id="cb427-8"><a href="crime-along-spatial-networks.html#cb427-8" aria-hidden="true" tabindex="-1"></a>                       nearest_freq_summer,</span>
<span id="cb427-9"><a href="crime-along-spatial-networks.html#cb427-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;section&quot;</span> <span class="ot">=</span> <span class="st">&quot;nearest_segments_summer&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb427-10"><a href="crime-along-spatial-networks.html#cb427-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">summer_sl =</span> <span class="fu">replace_na</span>(summer_sl, <span class="dv">0</span>))</span>
<span id="cb427-11"><a href="crime-along-spatial-networks.html#cb427-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-12"><a href="crime-along-spatial-networks.html#cb427-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-13"><a href="crime-along-spatial-networks.html#cb427-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-14"><a href="crime-along-spatial-networks.html#cb427-14" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat for the winter</span></span>
<span id="cb427-15"><a href="crime-along-spatial-networks.html#cb427-15" aria-hidden="true" tabindex="-1"></a>nearest_segments_winter <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(winter_sl, tr_sections)</span>
<span id="cb427-16"><a href="crime-along-spatial-networks.html#cb427-16" aria-hidden="true" tabindex="-1"></a>nearest_freq_winter <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(nearest_segments_winter))</span>
<span id="cb427-17"><a href="crime-along-spatial-networks.html#cb427-17" aria-hidden="true" tabindex="-1"></a>nearest_freq_winter <span class="ot">&lt;-</span> nearest_freq_winter <span class="sc">%&gt;%</span> </span>
<span id="cb427-18"><a href="crime-along-spatial-networks.html#cb427-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nearest_segments_winter =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(nearest_freq_winter<span class="sc">$</span>nearest_segments_winter))) <span class="sc">%&gt;%</span> </span>
<span id="cb427-19"><a href="crime-along-spatial-networks.html#cb427-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">winter_sl =</span> Freq)</span>
<span id="cb427-20"><a href="crime-along-spatial-networks.html#cb427-20" aria-hidden="true" tabindex="-1"></a>tr_sections <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tr_sections, </span>
<span id="cb427-21"><a href="crime-along-spatial-networks.html#cb427-21" aria-hidden="true" tabindex="-1"></a>                       nearest_freq_winter,</span>
<span id="cb427-22"><a href="crime-along-spatial-networks.html#cb427-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;section&quot;</span> <span class="ot">=</span> <span class="st">&quot;nearest_segments_winter&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb427-23"><a href="crime-along-spatial-networks.html#cb427-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">winter_sl =</span> <span class="fu">replace_na</span>(winter_sl, <span class="dv">0</span>))</span></code></pre></div>
<p>Similarly to how we did with hot routes, we can carry out a visual check to make sure they linked OK. We can also try to compare the two seasons on these side-by-side maps.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="crime-along-spatial-networks.html#cb428-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb428-2"><a href="crime-along-spatial-networks.html#cb428-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tr_sections, <span class="fu">aes</span>(<span class="at">colour =</span> summer_sl), <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb428-3"><a href="crime-along-spatial-networks.html#cb428-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb428-4"><a href="crime-along-spatial-networks.html#cb428-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Shoplifting in summer&quot;</span>, </span>
<span id="cb428-5"><a href="crime-along-spatial-networks.html#cb428-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">1</span>,</span>
<span id="cb428-6"><a href="crime-along-spatial-networks.html#cb428-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#2166ac&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#d1e5f0&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#b2182b&quot;</span>)</span>
<span id="cb428-7"><a href="crime-along-spatial-networks.html#cb428-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb428-8"><a href="crime-along-spatial-networks.html#cb428-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tr_sections, <span class="fu">aes</span>(<span class="at">colour =</span> winter_sl), <span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb428-9"><a href="crime-along-spatial-networks.html#cb428-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb428-10"><a href="crime-along-spatial-networks.html#cb428-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Shoplifting in winter&quot;</span>, </span>
<span id="cb428-11"><a href="crime-along-spatial-networks.html#cb428-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> <span class="dv">1</span>,</span>
<span id="cb428-12"><a href="crime-along-spatial-networks.html#cb428-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#2166ac&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#d1e5f0&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#b2182b&quot;</span>)</span>
<span id="cb428-13"><a href="crime-along-spatial-networks.html#cb428-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-14"><a href="crime-along-spatial-networks.html#cb428-14" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1,p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-245"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-245-1.png" alt="Shoplifting in summer and winter months" width="672" />
<p class="caption">
FIGURE 9.16: Shoplifting in summer and winter months
</p>
</div>
<p>We can see there may be some differences between winter and summer, but it is unclear how much.</p>
</div>
<div id="calculating-a-rate." class="section level4 hasAnchor" number="9.4.2.3">
<h4><span class="header-section-number">9.4.2.3</span> Calculating a rate.<a href="crime-along-spatial-networks.html#calculating-a-rate." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is the same process we used in the hot routes example above, we get a length for each segment, and then use this to calculate a rate for summer and winter:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="crime-along-spatial-networks.html#cb429-1" aria-hidden="true" tabindex="-1"></a>tr_sections<span class="sc">$</span>length <span class="ot">&lt;-</span> <span class="fu">st_length</span>(tr_sections)</span>
<span id="cb429-2"><a href="crime-along-spatial-networks.html#cb429-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-3"><a href="crime-along-spatial-networks.html#cb429-3" aria-hidden="true" tabindex="-1"></a>tr_sections<span class="sc">$</span>summer_rate <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tr_sections<span class="sc">$</span>summer_sl <span class="sc">/</span> tr_sections<span class="sc">$</span>length)</span>
<span id="cb429-4"><a href="crime-along-spatial-networks.html#cb429-4" aria-hidden="true" tabindex="-1"></a>tr_sections<span class="sc">$</span>winter_rate <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tr_sections<span class="sc">$</span>winter_sl <span class="sc">/</span> tr_sections<span class="sc">$</span>length)</span></code></pre></div>
</div>
<div id="visualise" class="section level4 hasAnchor" number="9.4.2.4">
<h4><span class="header-section-number">9.4.2.4</span> Visualise<a href="crime-along-spatial-networks.html#visualise" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Finally, we reach the visualisation stage. To do this, we need to find the “Point A” location, which will serve as our starting point to travel down Telegraph Road. Most likely you will have to do this manually. In the case of a bus or railway route, you know the terminus stations, so you can use these. In the case of street segments, it might be more arbitrary. Here I have identified “section 3” as our starting point. Note that it’s not section 1 or 20, which means that the segments are not numbered sequentially. This means we will have to assign an order.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-247"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-247-1.png" alt="Find starting point &quot;point a&quot; on the street" width="672" />
<p class="caption">
FIGURE 9.17: Find starting point “point a” on the street
</p>
</div>
<p>To assign this order, we can take our starting point (labelled “Start here”) and for each line segment we can calculate the distance to this. The idea is that we can then use this distance to order them from nearest to furthest.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="crime-along-spatial-networks.html#cb430-1" aria-hidden="true" tabindex="-1"></a>datalist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb430-2"><a href="crime-along-spatial-networks.html#cb430-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb430-3"><a href="crime-along-spatial-networks.html#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(segment_id <span class="cf">in</span> tr_sections<span class="sc">$</span>section){</span>
<span id="cb430-4"><a href="crime-along-spatial-networks.html#cb430-4" aria-hidden="true" tabindex="-1"></a>  datalist[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">section =</span> segment_id, </span>
<span id="cb430-5"><a href="crime-along-spatial-networks.html#cb430-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">dist_from_a =</span> <span class="fu">st_distance</span>(</span>
<span id="cb430-6"><a href="crime-along-spatial-networks.html#cb430-6" aria-hidden="true" tabindex="-1"></a>                                tr_sections <span class="sc">%&gt;%</span> <span class="fu">filter</span>(section <span class="sc">==</span> <span class="dv">3</span>),</span>
<span id="cb430-7"><a href="crime-along-spatial-networks.html#cb430-7" aria-hidden="true" tabindex="-1"></a>                                tr_sections <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(section <span class="sc">==</span> segment_id)))</span>
<span id="cb430-8"><a href="crime-along-spatial-networks.html#cb430-8" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span>  </span>
<span id="cb430-9"><a href="crime-along-spatial-networks.html#cb430-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb430-10"><a href="crime-along-spatial-networks.html#cb430-10" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, datalist)</span>
<span id="cb430-11"><a href="crime-along-spatial-networks.html#cb430-11" aria-hidden="true" tabindex="-1"></a>tr_sections <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tr_sections, dist_matrix)</span></code></pre></div>
<pre><code>## Joining, by = &quot;section&quot;</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="crime-along-spatial-networks.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># finally give our anchor point &quot;a&quot; a value of -1</span></span>
<span id="cb432-2"><a href="crime-along-spatial-networks.html#cb432-2" aria-hidden="true" tabindex="-1"></a>tr_sections<span class="sc">$</span>dist_from_a[tr_sections<span class="sc">$</span>section <span class="sc">==</span> <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span></code></pre></div>
<p>Now we can arrange the segments in order from point A to point B.</p>
<p>Let’s plot the summer shoplifting incidents using the street profile approach. This is a ggplot where the x-axis is the sequence of segments, and the y-axis is the crime rate we want to portray.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="crime-along-spatial-networks.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tr_sections, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(<span class="fu">as.character</span>(section), </span>
<span id="cb433-2"><a href="crime-along-spatial-networks.html#cb433-2" aria-hidden="true" tabindex="-1"></a>                                  dist_from_a), </span>
<span id="cb433-3"><a href="crime-along-spatial-networks.html#cb433-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> summer_rate, </span>
<span id="cb433-4"><a href="crime-along-spatial-networks.html#cb433-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb433-5"><a href="crime-along-spatial-networks.html#cb433-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb433-6"><a href="crime-along-spatial-networks.html#cb433-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb433-7"><a href="crime-along-spatial-networks.html#cb433-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Telegraph Road&quot;</span>) <span class="sc">+</span> </span>
<span id="cb433-8"><a href="crime-along-spatial-networks.html#cb433-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Shoplifting incidents&quot;</span>) <span class="sc">+</span> </span>
<span id="cb433-9"><a href="crime-along-spatial-networks.html#cb433-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb433-10"><a href="crime-along-spatial-networks.html#cb433-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-249"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-249-1.png" alt="Street profile with unlabelled segments" width="672" />
<p class="caption">
FIGURE 9.18: Street profile with unlabelled segments
</p>
</div>
<p>You might notice here that the labels are not very meaningful. We could manually recode each one to something better, or another approach is to try to get the name of the intersecting road in order to give some meaning. To do this, we can use a little loop below which will cycle through each segment, and find the nearest intersecting road from the <code>tr_intersects</code> object.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="crime-along-spatial-networks.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label the cross streests from 1 to n</span></span>
<span id="cb434-2"><a href="crime-along-spatial-networks.html#cb434-2" aria-hidden="true" tabindex="-1"></a>x_streets <span class="ot">&lt;-</span> tr_intersects <span class="sc">%&gt;%</span> </span>
<span id="cb434-3"><a href="crime-along-spatial-networks.html#cb434-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">xst_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb434-4"><a href="crime-along-spatial-networks.html#cb434-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-5"><a href="crime-along-spatial-networks.html#cb434-5" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through each segment and find the nearest intersecting road</span></span>
<span id="cb434-6"><a href="crime-along-spatial-networks.html#cb434-6" aria-hidden="true" tabindex="-1"></a>datalist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb434-7"><a href="crime-along-spatial-networks.html#cb434-7" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb434-8"><a href="crime-along-spatial-networks.html#cb434-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(segment_id <span class="cf">in</span> tr_sections<span class="sc">$</span>section){</span>
<span id="cb434-9"><a href="crime-along-spatial-networks.html#cb434-9" aria-hidden="true" tabindex="-1"></a>  datalist[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">section =</span> segment_id,</span>
<span id="cb434-10"><a href="crime-along-spatial-networks.html#cb434-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x_street =</span> <span class="fu">st_nearest_feature</span>(</span>
<span id="cb434-11"><a href="crime-along-spatial-networks.html#cb434-11" aria-hidden="true" tabindex="-1"></a>                      tr_sections <span class="sc">%&gt;%</span></span>
<span id="cb434-12"><a href="crime-along-spatial-networks.html#cb434-12" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(section <span class="sc">==</span> segment_id), x_streets))</span>
<span id="cb434-13"><a href="crime-along-spatial-networks.html#cb434-13" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span>  </span>
<span id="cb434-14"><a href="crime-along-spatial-networks.html#cb434-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb434-15"><a href="crime-along-spatial-networks.html#cb434-15" aria-hidden="true" tabindex="-1"></a><span class="co"># bind into a df</span></span>
<span id="cb434-16"><a href="crime-along-spatial-networks.html#cb434-16" aria-hidden="true" tabindex="-1"></a>nearest_matrix <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, datalist)</span>
<span id="cb434-17"><a href="crime-along-spatial-networks.html#cb434-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-18"><a href="crime-along-spatial-networks.html#cb434-18" aria-hidden="true" tabindex="-1"></a><span class="co"># join the intersections to the street dataframe</span></span>
<span id="cb434-19"><a href="crime-along-spatial-networks.html#cb434-19" aria-hidden="true" tabindex="-1"></a>nearest_matrix <span class="ot">&lt;-</span> <span class="fu">left_join</span>(nearest_matrix,</span>
<span id="cb434-20"><a href="crime-along-spatial-networks.html#cb434-20" aria-hidden="true" tabindex="-1"></a>                            x_streets <span class="sc">%&gt;%</span> </span>
<span id="cb434-21"><a href="crime-along-spatial-networks.html#cb434-21" aria-hidden="true" tabindex="-1"></a>                              dplyr<span class="sc">::</span><span class="fu">select</span>(xst_id, name) <span class="sc">%&gt;%</span></span>
<span id="cb434-22"><a href="crime-along-spatial-networks.html#cb434-22" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">st_drop_geometry</span>(),</span>
<span id="cb434-23"><a href="crime-along-spatial-networks.html#cb434-23" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;x_street&#39;</span> <span class="ot">=</span> <span class="st">&#39;xst_id&#39;</span>))</span>
<span id="cb434-24"><a href="crime-along-spatial-networks.html#cb434-24" aria-hidden="true" tabindex="-1"></a>tr_sections <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tr_sections, nearest_matrix, </span>
<span id="cb434-25"><a href="crime-along-spatial-networks.html#cb434-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;section&quot;</span> <span class="ot">=</span> <span class="st">&quot;section&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb434-26"><a href="crime-along-spatial-networks.html#cb434-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">make.unique</span>(name))</span></code></pre></div>
<p>Once this is done, we can use this label on the x axis instead of the segment id, to provide a little more context.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="crime-along-spatial-networks.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tr_sections, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, </span>
<span id="cb435-2"><a href="crime-along-spatial-networks.html#cb435-2" aria-hidden="true" tabindex="-1"></a>                                  dist_from_a), </span>
<span id="cb435-3"><a href="crime-along-spatial-networks.html#cb435-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> summer_rate, </span>
<span id="cb435-4"><a href="crime-along-spatial-networks.html#cb435-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb435-5"><a href="crime-along-spatial-networks.html#cb435-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb435-6"><a href="crime-along-spatial-networks.html#cb435-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb435-7"><a href="crime-along-spatial-networks.html#cb435-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Telegraph Road&quot;</span>) <span class="sc">+</span> </span>
<span id="cb435-8"><a href="crime-along-spatial-networks.html#cb435-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Shoplifting incidents&quot;</span>) <span class="sc">+</span> </span>
<span id="cb435-9"><a href="crime-along-spatial-networks.html#cb435-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb435-10"><a href="crime-along-spatial-networks.html#cb435-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-251"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-251-1.png" alt="Street profile using intersecting roads on x axis" width="672" />
<p class="caption">
FIGURE 9.19: Street profile using intersecting roads on x axis
</p>
</div>
<p>Now you may notice that there are some repeated names (e.g. “Thurstaston Road” and “Thurstaston Road.1”) where the same intersection was snapped as “nearest” to two segments. In these cases the only solution is to go back to manual data cleaning unfortunately. However already, this is a nice point from which to start.</p>
<p>Finally, the power of the street profile analysis comes from the ease of comparison of data across the route. For example, here we can compare shoplifting between winter and summer:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="crime-along-spatial-networks.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb436-2"><a href="crime-along-spatial-networks.html#cb436-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> tr_sections, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, </span>
<span id="cb436-3"><a href="crime-along-spatial-networks.html#cb436-3" aria-hidden="true" tabindex="-1"></a>                                  dist_from_a), </span>
<span id="cb436-4"><a href="crime-along-spatial-networks.html#cb436-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> summer_rate, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;#2166ac&quot;</span>) <span class="sc">+</span> </span>
<span id="cb436-5"><a href="crime-along-spatial-networks.html#cb436-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> tr_sections, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, </span>
<span id="cb436-6"><a href="crime-along-spatial-networks.html#cb436-6" aria-hidden="true" tabindex="-1"></a>                                  dist_from_a), </span>
<span id="cb436-7"><a href="crime-along-spatial-networks.html#cb436-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> summer_rate, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;#2166ac&quot;</span>) <span class="sc">+</span> </span>
<span id="cb436-8"><a href="crime-along-spatial-networks.html#cb436-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> tr_sections, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, </span>
<span id="cb436-9"><a href="crime-along-spatial-networks.html#cb436-9" aria-hidden="true" tabindex="-1"></a>                                  dist_from_a), </span>
<span id="cb436-10"><a href="crime-along-spatial-networks.html#cb436-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> winter_rate, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;#b2182b&quot;</span>) <span class="sc">+</span> </span>
<span id="cb436-11"><a href="crime-along-spatial-networks.html#cb436-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span>  tr_sections, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(name, </span>
<span id="cb436-12"><a href="crime-along-spatial-networks.html#cb436-12" aria-hidden="true" tabindex="-1"></a>                                  dist_from_a), </span>
<span id="cb436-13"><a href="crime-along-spatial-networks.html#cb436-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> winter_rate, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;#b2182b&quot;</span>) <span class="sc">+</span> </span>
<span id="cb436-14"><a href="crime-along-spatial-networks.html#cb436-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#2166ac&quot;</span>, <span class="st">&quot;#b2182b&quot;</span>), </span>
<span id="cb436-15"><a href="crime-along-spatial-networks.html#cb436-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Winter&quot;</span>)) <span class="sc">+</span></span>
<span id="cb436-16"><a href="crime-along-spatial-networks.html#cb436-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Telegraph Road&quot;</span>) <span class="sc">+</span>  <span class="fu">ylab</span>(<span class="st">&quot;Shoplifting incidents&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb436-17"><a href="crime-along-spatial-networks.html#cb436-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb436-18"><a href="crime-along-spatial-networks.html#cb436-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">&quot;Season&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-252"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-252-1.png" alt="Street profile comparing summer and winter months" width="672" />
<p class="caption">
FIGURE 9.20: Street profile comparing summer and winter months
</p>
</div>
<p>The analyst could also add the other two seasons of Spring and Autumn, or compare multiple sources of data about the same thing to identify where there might be areas of underreporting in certain sources. For example I used this to map fare evasion along London bus routes from 3 different data sources. Similarly, we could compare different crime types along the road, to see if robbery also peaks in these areas, or maybe elsewhere. The possibilities are many, and this is where the strength of this method is evident, over a map, where only one variable at one time can be displayed.</p>
</div>
</div>
</div>
<div id="quantifying-crime-concentration-at-micro-places" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Quantifying crime concentration at micro-places<a href="crime-along-spatial-networks.html#quantifying-crime-concentration-at-micro-places" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far we have shows ways to visualise crime along a network but what if we want to actually quantify the extent to which crime concentrates in these micro places. In crime and place literature we explore the concentration of crime at micro places. “Perhaps the first and most important empirical observation in the criminology of place is that crime concentrates at very small units of geography” <span class="citation">(<a href="#ref-Weisburd_2015" role="doc-biblioref">Weisburd 2015, 135</a>)</span>. A significant proportion of crime concentrates around a small proportion of micro places.</p>
<p>One way to measure inequality in the distribution of a quantitative variable is to use Lorenz curve, and associated Gini coefficient. The Lorenz curve is a probability plot (a P–P plot) comparing the distribution of a variable against a hypothetical uniform distribution of that variable. It can usually be represented by a function <span class="math inline">\(L(F)\)</span>, where <span class="math inline">\(F\)</span>, the cumulative portion of the population, is represented by the horizontal axis, and <span class="math inline">\(L\)</span>, the cumulative portion of the variable of interest (e.g. crime), is represented by the vertical axis. While Lorenz curves are used typically to graph inequality of distribution of wealth they can be applied in this case to explore unequal distribution of crimes between micro-places. A perfectly equal distribution would be depicted by the straight line <span class="math inline">\(y = x\)</span>. <span class="citation">Zeileis, Kleiber, and Zeileis (<a href="#ref-zeileis2012package" role="doc-biblioref">2012</a>)</span>. The corresponding Gini coefficient represents the ratio of the area between the line of perfect equality and the observed Lorenz curve to the area between the line of perfect equality and the line of perfect inequality <span class="citation">(<a href="#ref-gastwirth1972estimation" role="doc-biblioref">Gastwirth 1972</a>)</span>. The closer the coefficient is to 1, the more unequal the distribution is <span class="citation">(<a href="#ref-zeileis2012package" role="doc-biblioref">Zeileis, Kleiber, and Zeileis 2012</a>)</span>.</p>
<p>In R we can implement these tests using the functions in the <code>ineq</code> package. To obtain a Lorenz curve, we can use the <code>Lc()</code> function. <code>Lc()</code> computes the (empirical) ordinary and generalized Lorenz curve of a vector <span class="math inline">\(x\)</span> (in this case, our <code>crimes_per_m</code> variable). The function also computes a generalized Lorenz curve ( <span class="math inline">\(= \text{ordinary Lorenz curve} * mean(x)\)</span>). The result can be interpreted like this: <span class="math inline">\(p*100\)</span> percent account for <span class="math inline">\(L(p)*100\)</span> percent of <span class="math inline">\(x\)</span>.</p>
<p>Let’s illustrate this again with the segments of Telegraph Road again:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="crime-along-spatial-networks.html#cb437-1" aria-hidden="true" tabindex="-1"></a>tr_lorenz <span class="ot">&lt;-</span> <span class="fu">Lc</span>(tr_sections<span class="sc">$</span>summer_rate)</span></code></pre></div>
<p>Our resulting <code>tr_lorenz</code> object has 3 elements. First, the <code>p</code> represents the cumulative percent of crimes (per meter) for each line segment. Then, <code>L</code> contains the values of the ordinary Lorenz curve, while the <code>L.general</code> element the values for the generalised Lorenz curve. We can plot the Lorenz curve with the <code>plot()</code> function from base R.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="crime-along-spatial-networks.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tr_lorenz)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-254-1.png" width="672" /></p>
<p>Upon seeing this, we can consider that many of the segments of the Telegraph Road contribute very little to overall crimes, and it is instead the top few (less than the top 20%) which contribute all the shoplifting incidents. From a visual inspection, it appears that the Telegraph Road very precisely fits (and exceeds) the Pareto Principle, whereby 20% of the segments seem to account for 80% of the crimes (per meter length of the segment). We can quantify this further using the Gini coefficient.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="crime-along-spatial-networks.html#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ineq</span>(tr_sections<span class="sc">$</span>summer_rate, <span class="at">type=</span><span class="st">&quot;Gini&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.9</code></pre>
<p>This score of 90% is quite high. The Gini Index is calculated from the Lorenz curve, by taking the area between the line of equality and the Lorenz curve, and dividing this by the total area under the line of equality. This number is bounded between 0 (perfect equality where the Lorenz curve sits right on top of the line of equality) and 1 (perfect inequality, where the Lorenz curve sits right on top of the x axis and bends at right angle), so the closer we get to 1 the higher the inequality in the distribution in our value of interest, in this case crimes per meter. Clearly we see crime concentrate in certain segments of Telegraph Road.</p>
</div>
<div id="summary-and-further-reading-7" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Summary and further reading<a href="crime-along-spatial-networks.html#summary-and-further-reading-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The focus in this chapter has been to introduce the issue of crime events along a network. There has been increasing recognition in recent years that the spatial existence of many phenomena is constrained by networks. We have discussed some of the issues associated with the storage, handling, and visualisation of this kind of data. Chapter 1 of <span class="citation">Okabe and Sugihara (<a href="#ref-Okabe_2012" role="doc-biblioref">2012</a>)</span> provides a fairly accessible introduction to the relevance of point pattern data along a network, whereas Chapter 3 offers a slightly more technical discussion of the computational issues associated with the statistical analysis of points along a network. The first few sections of Chapter 17 of <span class="citation">Baddeley, Rubak, and Turner (<a href="#ref-Baddeley_2016" role="doc-biblioref">2015</a>)</span> provides background and very useful detail on the way that <code>spatstat</code> handles and stores point pattern data in a network. <span class="citation">Baddeley et al. (<a href="#ref-Baddeley_2021" role="doc-biblioref">2021</a>)</span> offers an excellent overview of the challenges of analysing this kind of data and the available methods we have. This overview can also offers an excellent framework to understand the issues of clustering and detection of local clusters along networks to which we will return in the next two chapters.</p>
<p>But spatial networks analysis is a more general area, with various other applications that we could not explore in detail here. <span class="citation">O´Sullivan (<a href="#ref-OSullivan_2014" role="doc-biblioref">2014</a>)</span> provides an introduction to spatial network analysis, basically a translation of social network metrics and concepts applied to spatial networks. This kind of perspective is particularly helpful within transport, routing, and similar applications. See, for example, the kind of functionality and applications provided by <code>stplanr</code>. We are also witnessing cross fertilisation between social network analysis and spatial analysis. In epidemiology, for example, we see how this is done for studying the transmission of disease through personal and geographic networks (see, for example, <span class="citation">Emch et al. (<a href="#ref-Emch_2010" role="doc-biblioref">2010</a>)</span>). Whereas <span class="citation">Radil, Flint, and Tita (<a href="#ref-Radil_2010" role="doc-biblioref">2010</a>)</span> and <span class="citation">Tita and Radil (<a href="#ref-Tita_2011" role="doc-biblioref">2011</a>)</span> offer some criminological examples (focused on the study of gangs) linking social network analysis and spatial analysis. Along these lines, the package <code>spnet</code> facilitates the rendering of social network data into a geographical space. Some of these applications can be relevant for investigative crime analysis and other criminological uses. Finally, another way in which social networks are being used within the context of environmental criminology is in contributing to the alternative specifications of neighbourhoods that aim to move beyond the traditional use of census geographies (see <span class="citation">Hipp, Faris, and Boessen (<a href="#ref-Hipp_2012" role="doc-biblioref">2012</a>)</span> and <span class="citation">Hipp and Boessen (<a href="#ref-Hipp_2013" role="doc-biblioref">2013</a>)</span>). Finally, it is also worth exploring the literature on <strong>space syntax</strong> and crime, and the various analysis that are looking at the structural characteristics of the street network (such as betweenness) and how it influences crime <span class="citation">(<a href="#ref-Davies_2018" role="doc-biblioref">Toby Davies and Bowers 2018</a>; <a href="#ref-Kim_2019" role="doc-biblioref">Kim and Hipp 2019</a>)</span>.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Abad_2019" class="csl-entry">
Abad, Lorena, Robin Lovelace, and Lucas van der Meer. 2019. <span>“Spatial Networks in r with Sf and Tidygraph.”</span> <a href="https://r-spatial.org/r/2019/09/26/spatial-networks.html" class="uri">https://r-spatial.org/r/2019/09/26/spatial-networks.html</a>.
</div>
<div id="ref-Baddeley_2021" class="csl-entry">
Baddeley, Adrian, Gopalan Nair, Suman Rakshit, Greg McSwiggan, and Tilman Davies. 2021. <span>“Analysing Point Patterns on Networks — a Review.”</span> <em>Spatial Statistics</em> 42: doi.org/10.1016/j.spasta.2020.100435.
</div>
<div id="ref-Baddeley_2016" class="csl-entry">
Baddeley, Adrian, Ege Rubak, and Rolf Turner. 2015. <em>Spatial Point Patterns: Methodology and Applications with r</em>. Boca Ratón: CRC Press.
</div>
<div id="ref-BrizRedon_2019a" class="csl-entry">
Briz-Redón, Álvaro, Francisco Martı́nez-Ruiz, and Francisco Montes. 2019a. <span>“DRHotNet: An r Package for Detecting Differential Risk Hotspots on a Linear Network.”</span> <a href="https://arxiv.org/abs/1911.07827">https://arxiv.org/abs/1911.07827</a>.
</div>
<div id="ref-BrizRedon_2019b" class="csl-entry">
———. 2019b. <span>“Identification of Differential Risk Hotspots for Collision and Vehicle Type in a Directed Linear Network.”</span> <em>Accident Analysis and Prevention</em>, doi.org/10.1016/j.aap.2019.105278.
</div>
<div id="ref-Ceccato_2013" class="csl-entry">
Ceccato, Vania. 2013. <em>Moving Safely: Crime and Perceived Safety in Stockholm’s Subway Stations</em>. Lanham: Lexington Books.
</div>
<div id="ref-Davies_2018" class="csl-entry">
Davies, Toby, and Kate Bowers. 2018. <span>“Street Networks and Crime.”</span> In <em>The Oxford Handbook of Environmental Criminology</em>, edited by Gerben Bruinsma and Shane Johnson, 545–78. New York: Oxford University Press.
</div>
<div id="ref-Emch_2010" class="csl-entry">
Emch, Michael, Elisabeth Root, Sophia Giebultowicz, Mohammad Ali, Carolina Perez-Heydrich, and Mohammad Yunus. 2010. <span>“<a href="">Integration of Spatial and Social Network Analysis in Disease Transmission Studies</a>.”</span> <em>CAnnals of the Association of American Geographers</em> 102 (5): 1004–15.
</div>
<div id="ref-gastwirth1972estimation" class="csl-entry">
Gastwirth, Joseph. 1972. <span>“The Estimation of the Lorenz Curve and Gini Index.”</span> <em>The Review of Economics and Statistics</em>, 306–16.
</div>
<div id="ref-Gelb_2021" class="csl-entry">
Gelb, Jeremy. 2021. <em>spNetwork: Spatial Analysis on Network</em>. <a href="https://CRAN.R-project.org/package=spNetwork">https://CRAN.R-project.org/package=spNetwork</a>.
</div>
<div id="ref-Hipp_2013" class="csl-entry">
Hipp, John, and Adam Boessen. 2013. <span>“<a href="">Egohoods as Waves Washing Across the City: A New Measure of "Neighborhoods"</a>.”</span> <em>Criminology</em> 51 (2): 287–327.
</div>
<div id="ref-Hipp_2012" class="csl-entry">
Hipp, John, Robert Faris, and Adam Boessen. 2012. <span>“<a href="">Measuring <span>‘Neighborhood’</span>: Constructing Network Neighborhoods</a>.”</span> <em>Social Networks</em> 34 (1): 128–40.
</div>
<div id="ref-Kim_2019" class="csl-entry">
Kim, Young‑A, and John Hipp. 2019. <span>“Pathways: Examining Street Network Configurations, Structural Characteristics and Spatial Crime Patterns in Street Segments.”</span> <em>Journal of Quantitative Criminology</em> 36: 725–52.
</div>
<div id="ref-McSwiggan_2016" class="csl-entry">
McSwiggan, Greg, Adrian Baddeley, and Gopalan Nair. 2016. <span>“Kernel Density Estimation on a Linear Network.”</span> <em>Scandinavian Journal of Statistics</em> 44 (2): 324–45.
</div>
<div id="ref-Newton_2008" class="csl-entry">
Newton, Andrew. 2008. <span>“A Study of Bus Route Crime Risk in Urban Areas: The Changing Environs of a Bus Journey.”</span> <em>Built Environment</em> 34 (1): 88–103.
</div>
<div id="ref-Okabe_2012" class="csl-entry">
Okabe, Atsuyuki, and Kokichi Sugihara. 2012. <em>Spatial Analysis Along Networks</em>. Chichester: John Wiley; Sons.
</div>
<div id="ref-OSullivan_2014" class="csl-entry">
O´Sullivan, David. 2014. <span>“Spatial Network Analysis.”</span> In <em>Handbook of Regional Science</em>, edited by Manfred Fische and Peter Nijkamp, 1253–73. Heidelberg: Springer.
</div>
<div id="ref-Radil_2010" class="csl-entry">
Radil, Steven, Colin Flint, and George Tita. 2010. <span>“<a href="">Spatializing Social Networks: Using Social Network Analysis to Investigate Geographies of Gang Rivalry, Territoriality, and Violence in Los Angeles</a>.”</span> <em>Annals of the Association of American Geographers</em> 100 (2): 307–26.
</div>
<div id="ref-Rakshit_2019" class="csl-entry">
Rakshit, Suman, Tilman Davies, M Mehdi-Moradi, Greg McSwiggan, Gopalan Nair, Jorge Mateu, and Adrian Baddeley. 2019. <span>“Fast Kernel Smoothing of Point Patterns on a Large Network Using Two-Dimensional Convolution.”</span> <em>International Statistical Review</em> 87 (3): 531–56.
</div>
<div id="ref-Rosser_2017" class="csl-entry">
Roser, Gabriel, Toby Davies, Kate Bowers, Shane Johnson, and Tao Cheng. 2017. <span>“Predictive Crime Mapping: Arbitrary Grids or Street Networks?”</span> <em>Journal of Quantitative Criminology</em> 33: 569–94.
</div>
<div id="ref-Singleton_2014" class="csl-entry">
Singleton, Alex, and Chris Brunsdon. 2014. <span>“Escaping the Pushpin Paradigm in Geographic Information Science: (Re)presenting National Crime Data.”</span> <em>Area</em> 46 (3): 294–304.
</div>
<div id="ref-Spicer_2016" class="csl-entry">
Spicer, Valerie, Justin Song, Patricia Brantingham, Andrew Park, and Martin Andresen. 2016. <span>“Street Profile Analysis: A New Method for Mapping Crime on Major Roadways.”</span> <em>Applied Geography</em> 69: 65–74.
</div>
<div id="ref-Tita_2011" class="csl-entry">
———. 2011. <span>“<a href="">Spatializing the Social Networks of Gangs to Explore Patterns of Violence</a>.”</span> <em>Journal of Quantitative Criminology</em> 27: 521–45.
</div>
<div id="ref-Tompson_2015" class="csl-entry">
Tompson, Lisa, Shane Johnson, Matthew Ashby, Chloe Perkins, and Philip Edwards. 2015. <span>“UK Open Source Crime Data: Accuracy and Possibilities for Research.”</span> <em>Cartography and Geographic Information Science</em> 42 (2): 97–111.
</div>
<div id="ref-Tompson_2009" class="csl-entry">
Tompson, Lisa, Henry Partridge, and Naomi Shepherd. 2009. <span>“Hot Routes: Developing a New Technique for the Spatial Analysis of Crime.”</span> <em>Crime Mapping: A Journal of Research and Practice</em> 1 (1): 77–96.
</div>
<div id="ref-Vandemeer_2021" class="csl-entry">
van der Meer, Lucas, Lorena Abad, Andrea Gilardi, and Robin Lovelace. 2021. <em>Sfnetworks: Tidy Geospatial Networks</em>. <a href="https://CRAN.R-project.org/package=sfnetworks">https://CRAN.R-project.org/package=sfnetworks</a>.
</div>
<div id="ref-Weisburd_2015" class="csl-entry">
Weisburd, David. 2015. <span>“The Law of Crime Concentration and the Criminology of Place.”</span> <em>Criminology</em> 53 (2): 133–57.
</div>
<div id="ref-zeileis2012package" class="csl-entry">
Zeileis, Achim, Christian Kleiber, and Achim Zeileis. 2012. <span>“Package <span>‘Ineq’</span>.”</span> <em>Vienna: Comprehensive R Archive Network</em>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial-point-patterns-of-crime-events.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-dependence-and-autocorrelation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/08-spatial_networks.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["crime_mapping.pdf", "crime_mapping.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
