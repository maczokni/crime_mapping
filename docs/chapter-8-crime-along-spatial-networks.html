<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Chapter 8: Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R</title>
  <meta name="description" content="Chapter 9 Chapter 8: Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Chapter 8: Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 9 Chapter 8: Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  <meta name="github-repo" content="maczokni/crime_mapping" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Chapter 8: Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  
  <meta name="twitter:description" content="Chapter 9 Chapter 8: Crime along spatial networks | Crime Mapping and Spatial Data Analysis using R" />
  

<meta name="author" content="Juanjo Medina and Reka Solymosi" />


<meta name="date" content="2021-11-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-7-spatial-point-patterns-of-crime-events.html"/>
<link rel="next" href="chapter-9-spatial-dependence-and-autocorrelation.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet/leaflet.js"></script>
<link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4/proj4.min.js"></script>
<script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding/leaflet.js"></script>
<script src="libs/leaflet-providers/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
<script src="libs/burglary_raster_cc_9107d3/data_stars_burglary_raster_cc983ce5.txt"></script>
<script src="libs/joda/joda.js"></script>
<script src="libs/joda/addImageQuery-bindings.js"></script>
<script src="libs/clipboard/setClipboardText.js"></script>
<link href="libs/HomeButton/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton/home-button.js"></script>
<script src="libs/HomeButton/easy-button-src.min.js"></script>
<link href="libs/mapviewCSS/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS/mapview.css" rel="stylesheet" />
<script src="libs/Leaflet.Sync/L.Map.Sync.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Crime Mapping and Spatial Data Analysis using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble: how to use this book</a></li>
<li class="chapter" data-level="2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html"><i class="fa fa-check"></i><b>2</b> Producing your first crime map</a>
<ul>
<li class="chapter" data-level="2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#geospatial-perspective-key-terms-and-ideas"><i class="fa fa-check"></i><b>2.2</b> Geospatial Perspective: key terms and ideas</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#place"><i class="fa fa-check"></i><b>2.2.1</b> Place</a></li>
<li class="chapter" data-level="2.2.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#attributes"><i class="fa fa-check"></i><b>2.2.2</b> Attributes</a></li>
<li class="chapter" data-level="2.2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#spatial-objects"><i class="fa fa-check"></i><b>2.2.3</b> Spatial objects</a></li>
<li class="chapter" data-level="2.2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#networks"><i class="fa fa-check"></i><b>2.2.4</b> Networks</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#maps-and-their-types"><i class="fa fa-check"></i><b>2.3</b> Maps and their types</a></li>
<li class="chapter" data-level="2.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#map-projections-and-geographic-coordinate-systems"><i class="fa fa-check"></i><b>2.4</b> Map projections and geographic coordinate systems</a></li>
<li class="chapter" data-level="2.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#key-terms-summary"><i class="fa fa-check"></i><b>2.5</b> Key terms summary</a></li>
<li class="chapter" data-level="2.6" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#getting-started-with-crime-data"><i class="fa fa-check"></i><b>2.6</b> Getting started with crime data</a></li>
<li class="chapter" data-level="2.7" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#from-dataframes-to-spatial-objects"><i class="fa fa-check"></i><b>2.7</b> From dataframes to spatial objects</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-point"><i class="fa fa-check"></i><b>2.7.1</b> The point</a></li>
<li class="chapter" data-level="2.7.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-line"><i class="fa fa-check"></i><b>2.7.2</b> The line</a></li>
<li class="chapter" data-level="2.7.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-polygon"><i class="fa fa-check"></i><b>2.7.3</b> The polygon</a></li>
<li class="chapter" data-level="2.7.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#choosing-the-ideal-unit-of-analysis"><i class="fa fa-check"></i><b>2.7.4</b> Choosing the ideal unit of analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#the-simple-features-framework"><i class="fa fa-check"></i><b>2.8</b> The simple features framework</a></li>
<li class="chapter" data-level="2.9" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#plotting-data-with-ggplot2"><i class="fa fa-check"></i><b>2.9</b> Plotting data with ggplot2</a></li>
<li class="chapter" data-level="2.10" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-points"><i class="fa fa-check"></i><b>2.10</b> Mapping crime data as points</a></li>
<li class="chapter" data-level="2.11" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#mapping-crime-data-as-polygons"><i class="fa fa-check"></i><b>2.11</b> Mapping crime data as polygons</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#finding-boundary-data"><i class="fa fa-check"></i><b>2.11.1</b> Finding boundary data</a></li>
<li class="chapter" data-level="2.11.2" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#reading-shapefiles-into-r"><i class="fa fa-check"></i><b>2.11.2</b> Reading shapefiles into R</a></li>
<li class="chapter" data-level="2.11.3" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>2.11.3</b> Data wrangling with dplyr</a></li>
<li class="chapter" data-level="2.11.4" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#join-data-to-sf-object"><i class="fa fa-check"></i><b>2.11.4</b> Join data to sf object</a></li>
<li class="chapter" data-level="2.11.5" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#putting-polygon-data-on-the-map"><i class="fa fa-check"></i><b>2.11.5</b> Putting polygon data on the map</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="producing-your-first-crime-map.html"><a href="producing-your-first-crime-map.html#summary-and-further-reading"><i class="fa fa-check"></i><b>2.12</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html"><i class="fa fa-check"></i><b>3</b> Basic geospatial operations in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#exploring-the-relationship-between-alcohol-outlets-and-crime"><i class="fa fa-check"></i><b>3.2</b> Exploring the relationship between alcohol outlets and crime</a></li>
<li class="chapter" data-level="3.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#acquiring-relevant-data"><i class="fa fa-check"></i><b>3.3</b> Acquiring relevant data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#reading-in-crime-data"><i class="fa fa-check"></i><b>3.3.1</b> Reading in crime data</a></li>
<li class="chapter" data-level="3.3.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#meet-a-new-format-geojson"><i class="fa fa-check"></i><b>3.3.2</b> Meet a new format: geoJSON</a></li>
<li class="chapter" data-level="3.3.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#open-street-map-and-points-of-interest"><i class="fa fa-check"></i><b>3.3.3</b> Open Street Map and points of interest</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#attribute-operations"><i class="fa fa-check"></i><b>3.4</b> Attribute operations</a></li>
<li class="chapter" data-level="3.5" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#spatial-operations"><i class="fa fa-check"></i><b>3.5</b> Spatial operations</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#reprojecting-coordinates"><i class="fa fa-check"></i><b>3.5.1</b> Reprojecting coordinates</a></li>
<li class="chapter" data-level="3.5.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#subsetting-points"><i class="fa fa-check"></i><b>3.5.2</b> Subsetting points</a></li>
<li class="chapter" data-level="3.5.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#building-buffers"><i class="fa fa-check"></i><b>3.5.3</b> Building buffers</a></li>
<li class="chapter" data-level="3.5.4" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#counting-points-within-a-polygon"><i class="fa fa-check"></i><b>3.5.4</b> Counting Points within a Polygon</a></li>
<li class="chapter" data-level="3.5.5" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#distances-finding-the-nearest-point"><i class="fa fa-check"></i><b>3.5.5</b> Distances: Finding the nearest point</a></li>
<li class="chapter" data-level="3.5.6" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#measuring-distances"><i class="fa fa-check"></i><b>3.5.6</b> Measuring distances</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#plotting-interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>3.6</b> Plotting interactive maps with leaflet</a></li>
<li class="chapter" data-level="3.7" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#geocoding"><i class="fa fa-check"></i><b>3.7</b> Geocoding</a></li>
<li class="chapter" data-level="3.8" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#measuring-distance-more-thoroughly"><i class="fa fa-check"></i><b>3.8</b> Measuring distance more thoroughly</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#how-far-are-police-stations-in-madrid"><i class="fa fa-check"></i><b>3.8.1</b> How far are police stations in Madrid?</a></li>
<li class="chapter" data-level="3.8.2" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#distance-in-geographical-space"><i class="fa fa-check"></i><b>3.8.2</b> Distance in geographical space</a></li>
<li class="chapter" data-level="3.8.3" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#a-practical-example-to-evaluate-distance"><i class="fa fa-check"></i><b>3.8.3</b> A practical example to evaluate distance</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="basic-geospatial-operations-in-r.html"><a href="basic-geospatial-operations-in-r.html#summary-and-further-reading-1"><i class="fa fa-check"></i><b>3.9</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html"><i class="fa fa-check"></i><b>4</b> Mapping rates and counts</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#thematic-maps-key-terms-and-ideas"><i class="fa fa-check"></i><b>4.2</b> Thematic maps: key terms and ideas</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#choropleth-maps"><i class="fa fa-check"></i><b>4.2.1</b> Choropleth maps</a></li>
<li class="chapter" data-level="4.2.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#what-do-we-use-choropleth-maps-for"><i class="fa fa-check"></i><b>4.2.2</b> What do we use choropleth maps for?</a></li>
<li class="chapter" data-level="4.2.3" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#proportional-and-graduate-symbol-maps-mapping-crime-counts"><i class="fa fa-check"></i><b>4.2.3</b> Proportional and graduate symbol maps: mapping crime counts</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#creating-proportional-symbol-maps"><i class="fa fa-check"></i><b>4.3</b> Creating proportional symbol maps</a></li>
<li class="chapter" data-level="4.4" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#mapping-rates-rather-than-counts"><i class="fa fa-check"></i><b>4.4</b> Mapping rates rather than counts</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#generating-the-rates"><i class="fa fa-check"></i><b>4.4.1</b> Generating the rates</a></li>
<li class="chapter" data-level="4.4.2" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#creating-a-choropleth-map-with-tmap"><i class="fa fa-check"></i><b>4.4.2</b> Creating a choropleth map with tmap</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#classification-systems-for-thematic-maps"><i class="fa fa-check"></i><b>4.5</b> Classification systems for thematic maps</a></li>
<li class="chapter" data-level="4.6" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#interactive-mapping-with-tmap"><i class="fa fa-check"></i><b>4.6</b> Interactive mapping with tmap</a></li>
<li class="chapter" data-level="4.7" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#smoothing-rates-adjusting-for-small-sample-noise"><i class="fa fa-check"></i><b>4.7</b> Smoothing rates: adjusting for small sample noise</a></li>
<li class="chapter" data-level="4.8" data-path="mapping-rates-and-counts.html"><a href="mapping-rates-and-counts.html#summary-and-further-reading-2"><i class="fa fa-check"></i><b>4.8</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html"><i class="fa fa-check"></i><b>5</b> Variations of thematic mapping</a>
<ul>
<li class="chapter" data-level="5.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#binning-points"><i class="fa fa-check"></i><b>5.2</b> Binning points</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#the-binning-process"><i class="fa fa-check"></i><b>5.2.1</b> The Binning Process</a></li>
<li class="chapter" data-level="5.2.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#different-binning-techniques"><i class="fa fa-check"></i><b>5.2.2</b> Different Binning Techniques</a></li>
<li class="chapter" data-level="5.2.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#benefits-of-binning"><i class="fa fa-check"></i><b>5.2.3</b> Benefits of Binning</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#transforming-polygons"><i class="fa fa-check"></i><b>5.3</b> Transforming polygons</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#dorling-cartogram"><i class="fa fa-check"></i><b>5.3.1</b> Dorling Cartogram</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#bivariate-maps"><i class="fa fa-check"></i><b>5.4</b> Bivariate Maps</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-1-bin-our-variables-of-interest"><i class="fa fa-check"></i><b>5.4.1</b> Step 1: Bin our variables of interest</a></li>
<li class="chapter" data-level="5.4.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-2-new-variable"><i class="fa fa-check"></i><b>5.4.2</b> Step 2: New variable</a></li>
<li class="chapter" data-level="5.4.3" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-3-create-colour-scheme"><i class="fa fa-check"></i><b>5.4.3</b> Step 3: Create colour scheme</a></li>
<li class="chapter" data-level="5.4.4" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-4-join-colour-scheme"><i class="fa fa-check"></i><b>5.4.4</b> Step 4: Join colour scheme</a></li>
<li class="chapter" data-level="5.4.5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-5-create-legend"><i class="fa fa-check"></i><b>5.4.5</b> Step 5: Create legend</a></li>
<li class="chapter" data-level="5.4.6" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#step-6-map"><i class="fa fa-check"></i><b>5.4.6</b> Step 6: Map</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#a-note-of-caution-maup"><i class="fa fa-check"></i><b>5.5</b> A note of caution: MAUP</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#why-does-maup-matter"><i class="fa fa-check"></i><b>5.5.1</b> Why does MAUP matter?</a></li>
<li class="chapter" data-level="5.5.2" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#what-can-we-do"><i class="fa fa-check"></i><b>5.5.2</b> What can we do?</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="variations-of-thematic-mapping.html"><a href="variations-of-thematic-mapping.html#summary-and-further-reading-3"><i class="fa fa-check"></i><b>5.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html"><i class="fa fa-check"></i><b>6</b> Visualisation: good cartographic design</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#data-representation"><i class="fa fa-check"></i><b>6.2</b> Data representation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#thematic-maps"><i class="fa fa-check"></i><b>6.2.1</b> Thematic maps</a></li>
<li class="chapter" data-level="6.2.2" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#symbols"><i class="fa fa-check"></i><b>6.2.2</b> Symbols</a></li>
<li class="chapter" data-level="6.2.3" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#rate-vs-count"><i class="fa fa-check"></i><b>6.2.3</b> Rate vs count</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#colour"><i class="fa fa-check"></i><b>6.3</b> Colour</a></li>
<li class="chapter" data-level="6.4" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#text"><i class="fa fa-check"></i><b>6.4</b> Text</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#titles-and-subtitles"><i class="fa fa-check"></i><b>6.4.1</b> Titles and subtitles</a></li>
<li class="chapter" data-level="6.4.2" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#legend"><i class="fa fa-check"></i><b>6.4.2</b> Legend</a></li>
<li class="chapter" data-level="6.4.3" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#annotation"><i class="fa fa-check"></i><b>6.4.3</b> Annotation</a></li>
<li class="chapter" data-level="6.4.4" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#production-notes"><i class="fa fa-check"></i><b>6.4.4</b> Production notes</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#composition"><i class="fa fa-check"></i><b>6.5</b> Composition</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#orientation-indicators"><i class="fa fa-check"></i><b>6.5.1</b> Orientation indicators</a></li>
<li class="chapter" data-level="6.5.2" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#scale-indicators"><i class="fa fa-check"></i><b>6.5.2</b> Scale indicators</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#context"><i class="fa fa-check"></i><b>6.6</b> Context</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#basemap"><i class="fa fa-check"></i><b>6.6.1</b> Basemap</a></li>
<li class="chapter" data-level="6.6.2" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#inset-maps"><i class="fa fa-check"></i><b>6.6.2</b> Inset maps</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="visualisation-good-cartographic-design.html"><a href="visualisation-good-cartographic-design.html#summary-and-further-reading-4"><i class="fa fa-check"></i><b>6.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="time-matters.html"><a href="time-matters.html"><i class="fa fa-check"></i><b>7</b> Time matters</a>
<ul>
<li class="chapter" data-level="7.1" data-path="time-matters.html"><a href="time-matters.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="time-matters.html"><a href="time-matters.html#temporal-data-in-crime-analysis"><i class="fa fa-check"></i><b>7.2</b> Temporal data in crime analysis</a></li>
<li class="chapter" data-level="7.3" data-path="time-matters.html"><a href="time-matters.html#temporal-data-wrangling"><i class="fa fa-check"></i><b>7.3</b> Temporal data wrangling</a></li>
<li class="chapter" data-level="7.4" data-path="time-matters.html"><a href="time-matters.html#visualising-time-data"><i class="fa fa-check"></i><b>7.4</b> Visualising time data</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="time-matters.html"><a href="time-matters.html#how-not-to-present-time"><i class="fa fa-check"></i><b>7.4.1</b> How (not) to present time</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="time-matters.html"><a href="time-matters.html#time-series-analysis"><i class="fa fa-check"></i><b>7.5</b> Time series analysis</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="time-matters.html"><a href="time-matters.html#plotting-time-series-data"><i class="fa fa-check"></i><b>7.5.1</b> Plotting time series data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="time-matters.html"><a href="time-matters.html#spatio-temporal-data-visualisation"><i class="fa fa-check"></i><b>7.6</b> Spatio-temporal data visualisation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="time-matters.html"><a href="time-matters.html#small-multiples-to-show-temporal-variation"><i class="fa fa-check"></i><b>7.6.1</b> Small multiples to show temporal variation</a></li>
<li class="chapter" data-level="7.6.2" data-path="time-matters.html"><a href="time-matters.html#spaghetti-plots"><i class="fa fa-check"></i><b>7.6.2</b> Spaghetti plots</a></li>
<li class="chapter" data-level="7.6.3" data-path="time-matters.html"><a href="time-matters.html#animations"><i class="fa fa-check"></i><b>7.6.3</b> Animations</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="time-matters.html"><a href="time-matters.html#summary-and-further-reading-5"><i class="fa fa-check"></i><b>7.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html"><i class="fa fa-check"></i><b>8</b> Chapter 7: Spatial point patterns of crime events</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#mapping-crime-intensity-with-isarithmic-maps"><i class="fa fa-check"></i><b>8.1</b> Mapping crime intensity with isarithmic maps</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#burglaries-in-nyc"><i class="fa fa-check"></i><b>8.2</b> Burglaries in NYC</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#using-the-spatstat-package"><i class="fa fa-check"></i><b>8.3</b> Using the <code>spatstat</code> package</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#homogeneous-or-spatially-varying-intensity"><i class="fa fa-check"></i><b>8.4</b> Homogeneous or spatially varying intensity?</a></li>
<li class="chapter" data-level="8.5" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#mapping-intensity-estimates-with-spatstat"><i class="fa fa-check"></i><b>8.5</b> Mapping intensity estimates with <code>spatstat</code></a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#basics-of-kernel-density-estimation-kde"><i class="fa fa-check"></i><b>8.5.1</b> Basics of kernel density estimation (KDE)</a></li>
<li class="chapter" data-level="8.5.2" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#selecting-the-appropriate-bandwith-for-kde"><i class="fa fa-check"></i><b>8.5.2</b> Selecting the appropriate bandwith for KDE</a></li>
<li class="chapter" data-level="8.5.3" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#selecting-the-smoothing-kernel"><i class="fa fa-check"></i><b>8.5.3</b> Selecting the smoothing kernel</a></li>
<li class="chapter" data-level="8.5.4" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#weighted-kernel-density-estimates"><i class="fa fa-check"></i><b>8.5.4</b> Weighted kernel density estimates</a></li>
<li class="chapter" data-level="8.5.5" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#better-kde-maps-using-leaflet"><i class="fa fa-check"></i><b>8.5.5</b> Better KDE maps using <code>leaflet</code></a></li>
<li class="chapter" data-level="8.5.6" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#problems-with-kde"><i class="fa fa-check"></i><b>8.5.6</b> Problems with KDE</a></li>
<li class="chapter" data-level="8.5.7" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#other-packages-for-kde"><i class="fa fa-check"></i><b>8.5.7</b> Other packages for KDE</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chapter-7-spatial-point-patterns-of-crime-events.html"><a href="chapter-7-spatial-point-patterns-of-crime-events.html#summary-and-further-reading-6"><i class="fa fa-check"></i><b>8.6</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html"><i class="fa fa-check"></i><b>9</b> Chapter 8: Crime along spatial networks</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#constructing-and-storing-a-spatial-linear-network"><i class="fa fa-check"></i><b>9.2</b> Constructing and storing a spatial linear network</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#visualising-crime-distribution-along-networks"><i class="fa fa-check"></i><b>9.3</b> Visualising crime distribution along networks</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#selecting-relevant-crimes-for-micro-places"><i class="fa fa-check"></i><b>9.3.1</b> Selecting relevant crimes for micro-places</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#assigning-joining-crimes-to-micro-places"><i class="fa fa-check"></i><b>9.3.2</b> Assigning (joining) crimes to micro-places</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#calculating-a-crime-rate"><i class="fa fa-check"></i><b>9.3.3</b> Calculating a crime rate</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#hot-routes"><i class="fa fa-check"></i><b>9.3.4</b> Hot Routes</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#quantifying-crime-concentration-at-micro-places"><i class="fa fa-check"></i><b>9.4</b> Quantifying crime concentration at micro-places</a></li>
<li class="chapter" data-level="9.5" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#street-profile-analysis"><i class="fa fa-check"></i><b>9.5</b> Street Profile Analysis</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#linking-data-to-nodes"><i class="fa fa-check"></i><b>9.5.1</b> Linking data to nodes</a></li>
<li class="chapter" data-level="9.5.2" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#calculating-a-rate-for-nodes"><i class="fa fa-check"></i><b>9.5.2</b> Calculating a rate for nodes</a></li>
<li class="chapter" data-level="9.5.3" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#visualising-with-street-profile-analysis"><i class="fa fa-check"></i><b>9.5.3</b> Visualising with Street Profile Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#density-estimation-along-networks"><i class="fa fa-check"></i><b>9.6</b> Density estimation along networks</a></li>
<li class="chapter" data-level="9.7" data-path="chapter-8-crime-along-spatial-networks.html"><a href="chapter-8-crime-along-spatial-networks.html#summary-and-further-reading-7"><i class="fa fa-check"></i><b>9.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html"><i class="fa fa-check"></i><b>10</b> Chapter 9: Spatial dependence and autocorrelation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#exploring-spatial-dependence-in-point-pattern-data"><i class="fa fa-check"></i><b>10.2</b> Exploring spatial dependence in point pattern data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#the-empirical-k-function"><i class="fa fa-check"></i><b>10.2.1</b> The empirical K function</a></li>
<li class="chapter" data-level="10.2.2" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#homicide-in-buenos-aires"><i class="fa fa-check"></i><b>10.2.2</b> Homicide in Buenos Aires</a></li>
<li class="chapter" data-level="10.2.3" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#estimating-and-plotting-the-k-function"><i class="fa fa-check"></i><b>10.2.3</b> Estimating and plotting the K-function</a></li>
<li class="chapter" data-level="10.2.4" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#network-constrained-k-function"><i class="fa fa-check"></i><b>10.2.4</b> Network constrained K function</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#exploring-spatial-autocorrelation-in-lattice-data"><i class="fa fa-check"></i><b>10.3</b> Exploring spatial autocorrelation in lattice data</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#burglary-in-manchester"><i class="fa fa-check"></i><b>10.3.1</b> Burglary in Manchester</a></li>
<li class="chapter" data-level="10.3.2" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#what-is-a-neighbour"><i class="fa fa-check"></i><b>10.3.2</b> What is a neighbour?</a></li>
<li class="chapter" data-level="10.3.3" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#creating-a-list-of-neighbours-based-on-contiguity"><i class="fa fa-check"></i><b>10.3.3</b> Creating a list of neighbours based on contiguity</a></li>
<li class="chapter" data-level="10.3.4" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#generating-the-weight-matrix"><i class="fa fa-check"></i><b>10.3.4</b> Generating the weight matrix</a></li>
<li class="chapter" data-level="10.3.5" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#spatial-weight-matrix-based-on-distance"><i class="fa fa-check"></i><b>10.3.5</b> Spatial weight matrix based on distance</a></li>
<li class="chapter" data-level="10.3.6" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#spatial-weight-matrix-based-on-k-neighbors"><i class="fa fa-check"></i><b>10.3.6</b> Spatial weight matrix based on k-neighbors</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#choosing-the-correct-matrix"><i class="fa fa-check"></i><b>10.4</b> Choosing the correct matrix</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#measuring-global-autocorrelation"><i class="fa fa-check"></i><b>10.4.1</b> Measuring global autocorrelation</a></li>
<li class="chapter" data-level="10.4.2" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#the-rgeoda-and-sfweight-packages"><i class="fa fa-check"></i><b>10.4.2</b> The <code>rgeoda</code> and <code>sfweight</code> packages</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chapter-9-spatial-dependence-and-autocorrelation.html"><a href="chapter-9-spatial-dependence-and-autocorrelation.html#further-reading"><i class="fa fa-check"></i><b>10.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html"><i class="fa fa-check"></i><b>11</b> Chapter 10: Detecting hot spots and repeats</a>
<ul>
<li class="chapter" data-level="11.1" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#clusters-hot-spots-of-crime-and-near-repeat-victimisation"><i class="fa fa-check"></i><b>11.1.1</b> Clusters, hot spots of crime, and near repeat victimisation</a></li>
<li class="chapter" data-level="11.1.2" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#burglaries-in-manchester"><i class="fa fa-check"></i><b>11.1.2</b> Burglaries in Manchester</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#using-raster-micro-grid-cells-to-spot-hot-spots"><i class="fa fa-check"></i><b>11.2</b> Using <code>raster</code> micro grid cells to spot hot spots</a></li>
<li class="chapter" data-level="11.3" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#local-getis-ord"><i class="fa fa-check"></i><b>11.3</b> Local Getis-Ord</a></li>
<li class="chapter" data-level="11.4" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#local-morans-i-and-moran-scaterplot"><i class="fa fa-check"></i><b>11.4</b> Local Moran’s I and Moran scaterplot</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#computing-the-local-morans-i"><i class="fa fa-check"></i><b>11.4.1</b> Computing the local Moran’s I</a></li>
<li class="chapter" data-level="11.4.2" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#creating-a-lisa-map"><i class="fa fa-check"></i><b>11.4.2</b> Creating a LISA map</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#scan-satistics"><i class="fa fa-check"></i><b>11.5</b> Scan satistics</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#the-dcluster-package"><i class="fa fa-check"></i><b>11.5.1</b> The <code>DCluster</code> package</a></li>
<li class="chapter" data-level="11.5.2" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#openshaws-gam"><i class="fa fa-check"></i><b>11.5.2</b> Openshaw’s GAM</a></li>
<li class="chapter" data-level="11.5.3" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#kulldorfs-scan-statistic"><i class="fa fa-check"></i><b>11.5.3</b> Kulldorf’s Scan Statistic</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#exploring-near-repeat-victimisation"><i class="fa fa-check"></i><b>11.6</b> Exploring near repeat victimisation</a></li>
<li class="chapter" data-level="11.7" data-path="chapter-10-detecting-hot-spots-and-repeats.html"><a href="chapter-10-detecting-hot-spots-and-repeats.html#further-reading-1"><i class="fa fa-check"></i><b>11.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html"><i class="fa fa-check"></i><b>12</b> Chapter 11: Spatial regression models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#challenges-for-regression-with-spatial-data"><i class="fa fa-check"></i><b>12.2</b> Challenges for regression with spatial data</a></li>
<li class="chapter" data-level="12.3" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#fitting-a-non-spatial-regression-model-with-r"><i class="fa fa-check"></i><b>12.3</b> Fitting a non-spatial regression model with R</a></li>
<li class="chapter" data-level="12.4" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#looking-at-the-residuals-and-testing-for-spatial-autocorrelation-in-regression"><i class="fa fa-check"></i><b>12.4</b> Looking at the residuals and testing for spatial autocorrelation in regression</a></li>
<li class="chapter" data-level="12.5" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i><b>12.5</b> Choosing a spatial regression model</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#the-basic-spatial-models"><i class="fa fa-check"></i><b>12.5.1</b> The basic spatial models</a></li>
<li class="chapter" data-level="12.5.2" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#lagrange-multipliers-the-bottom-up-approach-to-select-a-model"><i class="fa fa-check"></i><b>12.5.2</b> Lagrange multipliers: the bottom-up approach to select a model</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#fitting-and-interpreting-a-spatial-error-model"><i class="fa fa-check"></i><b>12.6</b> Fitting and interpreting a spatial error model</a></li>
<li class="chapter" data-level="12.7" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#fitting-and-interpreting-a-spatially-lagged-model"><i class="fa fa-check"></i><b>12.7</b> Fitting and interpreting a spatially lagged model</a></li>
<li class="chapter" data-level="12.8" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#beyond-the-sar-and-sem-models"><i class="fa fa-check"></i><b>12.8</b> Beyond the SAR and SEM models</a></li>
<li class="chapter" data-level="12.9" data-path="chapter-11-spatial-regression-models.html"><a href="chapter-11-spatial-regression-models.html#summary-and-further-reading-8"><i class="fa fa-check"></i><b>12.9</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html"><i class="fa fa-check"></i><b>13</b> Chapter 12: Spatial heterogeneity and regression</a>
<ul>
<li class="chapter" data-level="13.1" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#spatial-regimes"><i class="fa fa-check"></i><b>13.2</b> Spatial regimes</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#fitting-the-constrained-and-the-unconstrained-models"><i class="fa fa-check"></i><b>13.2.1</b> Fitting the constrained and the unconstrained models</a></li>
<li class="chapter" data-level="13.2.2" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#running-the-chow-test"><i class="fa fa-check"></i><b>13.2.2</b> Running the Chow test</a></li>
<li class="chapter" data-level="13.2.3" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#spatial-dependence-with-spatial-heterogeneity"><i class="fa fa-check"></i><b>13.2.3</b> Spatial dependence with spatial heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#geographically-weighted-regression"><i class="fa fa-check"></i><b>13.3</b> Geographically Weighted Regression</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#calculate-kernel-bandwidth"><i class="fa fa-check"></i><b>13.3.1</b> Calculate kernel bandwidth</a></li>
<li class="chapter" data-level="13.3.2" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#building-the-geographically-weighted-model"><i class="fa fa-check"></i><b>13.3.2</b> Building the geographically weighted model</a></li>
<li class="chapter" data-level="13.3.3" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#using-gwr"><i class="fa fa-check"></i><b>13.3.3</b> Using GWR</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="chapter-12-spatial-heterogeneity-and-regression.html"><a href="chapter-12-spatial-heterogeneity-and-regression.html#summary-and-further-reading-9"><i class="fa fa-check"></i><b>13.4</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>14</b> Appendix: A quick intro to R and RStudio</a>
<ul>
<li class="chapter" data-level="14.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#exploring-rstudio"><i class="fa fa-check"></i><b>14.1</b> Exploring RStudio</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#the-four-panes-of-r-studio"><i class="fa fa-check"></i><b>14.1.1</b> The four panes of R Studio</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#customising-the-rstudio-look"><i class="fa fa-check"></i><b>14.2</b> Customising the RStudio look</a></li>
<li class="chapter" data-level="14.3" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#elements-of-r-grammar"><i class="fa fa-check"></i><b>14.3</b> Elements of R grammar</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#functions"><i class="fa fa-check"></i><b>14.3.1</b> Functions</a></li>
<li class="chapter" data-level="14.3.2" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#objects"><i class="fa fa-check"></i><b>14.3.2</b> Objects</a></li>
<li class="chapter" data-level="14.3.3" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#types-of-objects"><i class="fa fa-check"></i><b>14.3.3</b> Types of objects</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#packages"><i class="fa fa-check"></i><b>14.4</b> Packages</a></li>
<li class="chapter" data-level="14.5" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#exploring-data-with-r"><i class="fa fa-check"></i><b>14.5</b> Exploring data with R</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#playing-around-with-data"><i class="fa fa-check"></i><b>14.5.1</b> Playing around with data</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#getting-organised-r-projects"><i class="fa fa-check"></i><b>14.6</b> Getting organised: R Projects</a></li>
<li class="chapter" data-level="14.7" data-path="appendix-a-quick-intro-to-r-and-rstudio.html"><a href="appendix-a-quick-intro-to-r-and-rstudio.html#summary-and-further-reading-10"><i class="fa fa-check"></i><b>14.7</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html"><i class="fa fa-check"></i><b>15</b> Appendix B: Regression analysis (a refresher)</a>
<ul>
<li class="chapter" data-level="15.1" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#introduction-11"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#motivating-regression"><i class="fa fa-check"></i><b>15.2</b> Motivating regression</a></li>
<li class="chapter" data-level="15.3" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-a-simple-regression-model"><i class="fa fa-check"></i><b>15.3</b> Fitting a simple regression model</a></li>
<li class="chapter" data-level="15.4" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#residuals-revisited-r-squared"><i class="fa fa-check"></i><b>15.4</b> Residuals revisited: R squared</a></li>
<li class="chapter" data-level="15.5" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#inference-with-regression"><i class="fa fa-check"></i><b>15.5</b> Inference with regression</a></li>
<li class="chapter" data-level="15.6" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-regression-with-categorical-predictors"><i class="fa fa-check"></i><b>15.6</b> Fitting regression with categorical predictors</a></li>
<li class="chapter" data-level="15.7" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#motivating-multiple-regression"><i class="fa fa-check"></i><b>15.7</b> Motivating multiple regression</a></li>
<li class="chapter" data-level="15.8" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#fitting-and-interpreting-a-multiple-regression-model"><i class="fa fa-check"></i><b>15.8</b> Fitting and interpreting a multiple regression model</a></li>
<li class="chapter" data-level="15.9" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#presenting-your-regression-results."><i class="fa fa-check"></i><b>15.9</b> Presenting your regression results.</a></li>
<li class="chapter" data-level="15.10" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#rescaling-input-variables-to-assist-interpretation"><i class="fa fa-check"></i><b>15.10</b> Rescaling input variables to assist interpretation</a></li>
<li class="chapter" data-level="15.11" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#testing-conditional-hypothesis-interactions"><i class="fa fa-check"></i><b>15.11</b> Testing conditional hypothesis: interactions</a></li>
<li class="chapter" data-level="15.12" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#model-building-and-variable-selection"><i class="fa fa-check"></i><b>15.12</b> Model building and variable selection</a></li>
<li class="chapter" data-level="15.13" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#regression-assumptions"><i class="fa fa-check"></i><b>15.13</b> Regression assumptions</a></li>
<li class="chapter" data-level="15.14" data-path="appendix-b-regression-analysis-a-refresher.html"><a href="appendix-b-regression-analysis-a-refresher.html#summary-and-further-reading-11"><i class="fa fa-check"></i><b>15.14</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><i class="fa fa-check"></i><b>16</b> Appendix C: sourcing geographical data for crime analysis</a>
<ul>
<li class="chapter" data-level="16.1" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#the-rnaturalearth-package"><i class="fa fa-check"></i><b>16.1</b> The rnaturalearth package</a></li>
<li class="chapter" data-level="16.2" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#data-from-apis"><i class="fa fa-check"></i><b>16.2</b> Data from APIs</a></li>
<li class="chapter" data-level="16.3" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#data-from-data-repositories"><i class="fa fa-check"></i><b>16.3</b> Data from data repositories</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#international-resources"><i class="fa fa-check"></i><b>16.3.1</b> International resources</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#open-street-map"><i class="fa fa-check"></i><b>16.4</b> Open Street Map</a></li>
<li class="chapter" data-level="16.5" data-path="appendix-c-sourcing-geographical-data-for-crime-analysis.html"><a href="appendix-c-sourcing-geographical-data-for-crime-analysis.html#summary-and-further-reading-12"><i class="fa fa-check"></i><b>16.5</b> Summary and further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime Mapping and Spatial Data Analysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-8-crime-along-spatial-networks" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Chapter 8: Crime along spatial networks</h1>
<div id="introduction-6" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p>In the previous chapter we explored how the techniques for spatial pattern analysis can be used to study the varying intensity of crime across space. We introduce the key idea of spatial randomness. These methods were developed to study locations in a continuous plane and are also referred to as <strong>planar spatial analysis</strong>. Point crime data, however, has an inherent structure to it. There are parts of our study region where it cannot appear. Since typically the data will be geocoded at the street level address, crime data almost always will appear alongside the spatial network of roads and streets. Crime won’t appear randomly anywhere in our 2 dimensional representation of the city, they will only appear along the street network covering this city. We can see this in the following example from Chicago using data from <code>spatstat</code>:</p>
<div class="figure"><span id="fig:unnamed-chunk-215"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-215-1.png" alt="Crime along street networkin Chicago" width="672" />
<p class="caption">
FIGURE 9.1: Crime along street networkin Chicago
</p>
</div>
<p>Clearly the offenses are constrained to only occur along the street network. This has implications. This is not a homogeneous Poisson process along the whole study surface, because there is an underlying structure. If we want to investigate heterogeneity on intensity, for example, we would need to account for that underlying structure, the fact that the points can only be located along the network and not in other parts of the study region. Several authors have argued that crime is best represented and predicted if we focus in the street network rather than other kind of level of aggregation and that this has clear implications for operational policing <span class="citation">(<a href="#ref-Singleton_2014" role="doc-biblioref">Singleton and Brunsdon 2014</a>; <a href="#ref-Rosser_2017" role="doc-biblioref">Roser et al. 2017</a>)</span>. It is clear that if our crime occurrences are collected and represented along a spatial network we need to ensure we use techniques of analysis and visualisation that respect this existing underlying structure in our data.</p>
<p>The software infrastructure for spatial analysis along networks, however, is still not as developed and consolidated. Partly this is to do with the statistical and computational challenges when we move from planar to linear network analysis. There is some software such as <a href="http://sanet.csis.u-tokyo.ac.jp/">SANET</a> that was originally conceived as a toolbox for ArGIS but with a beta standalone version already available <span class="citation">(<a href="#ref-Okabe_2012" role="doc-biblioref">Okabe and Sugihara 2012</a>)</span>. R users and developers are working to expand the functionality of R in this regard. It was only in 2020 that Lucas van der Meer, a Dutch spatial data scientist, published the first release of the <code>sfnetworks</code> package to facilitate the creation and analysis of spatial networks. Two other useful packages (<code>SpNetPrep</code> and <code>DRHotNet</code>) developed by Briz-Redón and colleagues are also only a couple of years old <span class="citation">(<a href="#ref-BrizRedon_2019a" role="doc-biblioref">Briz-Redón, Martı́nez-Ruiz, and Montes 2019a</a>, <a href="#ref-BrizRedon_2019b" role="doc-biblioref">2019b</a>)</span>. Another recent package, released in 2021, is <code>spNetwork</code> by Jeremy Gelb and Philippe Apparicio that can be used for kernel density estimation along networks <span class="citation">(<a href="#ref-Gelb_2021" role="doc-biblioref">Gelb 2021</a>)</span>. Finally, the package <code>spatstat</code>, that we covered in the last chapter, also provides functionality for the analysis of events along spatial networks.</p>
<p>In this chapter we will provide an introduction to the study of crime along networks by exploring the following:</p>
<ul>
<li>the creation of network representations from geographical vector objects</li>
<li>linking data to meaningful micro-places such as <strong>street segment</strong> (or in this case, underground line segment) or <strong>street junction</strong> (or in this case underground station)</li>
<li>introducing the idea of <strong>hot routes</strong></li>
<li>evaluating crime concentration in these types of micro places using <strong>Gini coefficient</strong> and <strong>Lorenz curve</strong></li>
<li><strong>street profile analysis</strong> - an alternative (non-spatial) way to visualise crime along a network</li>
<li>introducing the functionallity of <code>spatstat</code> for the analysis of events along networks</li>
</ul>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="chapter-8-crime-along-spatial-networks.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for reading data and data carpentry</span></span>
<span id="cb362-2"><a href="chapter-8-crime-along-spatial-networks.html#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb362-3"><a href="chapter-8-crime-along-spatial-networks.html#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb362-4"><a href="chapter-8-crime-along-spatial-networks.html#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb362-5"><a href="chapter-8-crime-along-spatial-networks.html#cb362-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb362-6"><a href="chapter-8-crime-along-spatial-networks.html#cb362-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb362-7"><a href="chapter-8-crime-along-spatial-networks.html#cb362-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb362-8"><a href="chapter-8-crime-along-spatial-networks.html#cb362-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-9"><a href="chapter-8-crime-along-spatial-networks.html#cb362-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for handling spatial data</span></span>
<span id="cb362-10"><a href="chapter-8-crime-along-spatial-networks.html#cb362-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb362-11"><a href="chapter-8-crime-along-spatial-networks.html#cb362-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span>
<span id="cb362-12"><a href="chapter-8-crime-along-spatial-networks.html#cb362-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sfnetworks)</span>
<span id="cb362-13"><a href="chapter-8-crime-along-spatial-networks.html#cb362-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb362-14"><a href="chapter-8-crime-along-spatial-networks.html#cb362-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.linnet)</span>
<span id="cb362-15"><a href="chapter-8-crime-along-spatial-networks.html#cb362-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb362-16"><a href="chapter-8-crime-along-spatial-networks.html#cb362-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptools)</span>
<span id="cb362-17"><a href="chapter-8-crime-along-spatial-networks.html#cb362-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-18"><a href="chapter-8-crime-along-spatial-networks.html#cb362-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Package for computing Lorenz curve</span></span>
<span id="cb362-19"><a href="chapter-8-crime-along-spatial-networks.html#cb362-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ineq)</span>
<span id="cb362-20"><a href="chapter-8-crime-along-spatial-networks.html#cb362-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-21"><a href="chapter-8-crime-along-spatial-networks.html#cb362-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages for visualisation and mapping</span></span>
<span id="cb362-22"><a href="chapter-8-crime-along-spatial-networks.html#cb362-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb362-23"><a href="chapter-8-crime-along-spatial-networks.html#cb362-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb362-24"><a href="chapter-8-crime-along-spatial-networks.html#cb362-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb362-25"><a href="chapter-8-crime-along-spatial-networks.html#cb362-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-26"><a href="chapter-8-crime-along-spatial-networks.html#cb362-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages providing accesss to spatial data</span></span>
<span id="cb362-27"><a href="chapter-8-crime-along-spatial-networks.html#cb362-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb362-28"><a href="chapter-8-crime-along-spatial-networks.html#cb362-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb362-29"><a href="chapter-8-crime-along-spatial-networks.html#cb362-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb362-30"><a href="chapter-8-crime-along-spatial-networks.html#cb362-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crimedata)</span></code></pre></div>
<p>It is not only in the case of street networks that understanding spatial point patterns along a network might be more meaningful, there are other networks we might want to consider. Transport networks are a good example of this and are receiving an increasing interest in criminology and crime analysis <span class="citation">(<a href="#ref-Newton_2008" role="doc-biblioref">Newton 2008</a>; <a href="#ref-Tompson_2009" role="doc-biblioref">Tompson, Partridge, and Shepherd 2009</a>; <a href="#ref-Ceccato_2013" role="doc-biblioref">Ceccato 2013</a>)</span>. Therefore we will focus on transport network scenarios throughout this chapter.</p>
</div>
<div id="constructing-and-storing-a-spatial-linear-network" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Constructing and storing a spatial linear network</h2>
<p>The first difficulty one encounters when wanting to do analysis along spatial networks is to get the data for such geographical element in the proper shape. It is fairly straightforward to get files with the administrative boundaries for census geographies, as we have seen in previous chapters. This kind of geographical data is widely available in official and open repositories (see also <em>Appendix C: sourcing geographical data for crime analysis</em>). Getting data for spatial networks used to be a little bit trickier, although it is getting better. One could, for example, use the <code>osmdata</code> package to access Open Street Map data for a road network (we also discuss this in greater detail on <em>Appendix C</em>). Or, if you analyse data from the United States, you could use the <code>tigris</code> package to extract geometries which represent road networks.</p>
<p>Below we show how to obtain this data for Kensington, a popular neighbourhood in Toronto city centre through <code>osmdata</code> and for Manhattan using <code>tigris</code>.</p>
<p>Let’s start with Toronto. As we’re querying data from Open Street Map, first we draw a bounding box around the area we are interested in, then select “highways” as the feature to extract (see <em>Appendix C</em> for details on building OSM queries). As discussed by <span class="citation"><a href="#ref-Abad_2019" role="doc-biblioref">Abad, Lovelace, and Meer</a> (<a href="#ref-Abad_2019" role="doc-biblioref">2019</a>)</span>, the <code>osmdata</code> package turns streets that form loops into polygons, to ensure we end up with lines we use <code>osm_poly2line</code>.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="chapter-8-crime-along-spatial-networks.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using osm data</span></span>
<span id="cb363-2"><a href="chapter-8-crime-along-spatial-networks.html#cb363-2" aria-hidden="true" tabindex="-1"></a>kensington_osm <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bbox =</span>  <span class="fu">c</span>(<span class="sc">-</span><span class="fl">79.40772</span>, <span class="fl">43.64726</span>, <span class="sc">-</span><span class="fl">79.38672</span>, <span class="fl">43.65986</span> )) <span class="sc">%&gt;%</span></span>
<span id="cb363-3"><a href="chapter-8-crime-along-spatial-networks.html#cb363-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&#39;highway&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb363-4"><a href="chapter-8-crime-along-spatial-networks.html#cb363-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb363-5"><a href="chapter-8-crime-along-spatial-networks.html#cb363-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osm_poly2line</span>()</span>
<span id="cb363-6"><a href="chapter-8-crime-along-spatial-networks.html#cb363-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-7"><a href="chapter-8-crime-along-spatial-networks.html#cb363-7" aria-hidden="true" tabindex="-1"></a>kensington_lines <span class="ot">&lt;-</span> kensington_osm<span class="sc">$</span>osm_lines <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(highway)</span></code></pre></div>
<p>Now let’s use the <code>tigris</code> package to get TIGER/Line shapefiles from the United States Census Bureau. The <code>roads()</code> function returns the content of the all roads shapefile - which includes primary roads, secondary roads, local neighborhood roads, rural roads, city streets, vehicular trails (4WD), ramps, service drives, walkways, stairways, alleys, and private roads. It returns these as an <code>sf</code> object.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="chapter-8-crime-along-spatial-networks.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using tigris</span></span>
<span id="cb364-2"><a href="chapter-8-crime-along-spatial-networks.html#cb364-2" aria-hidden="true" tabindex="-1"></a>manhattan_roads <span class="ot">&lt;-</span> <span class="fu">roads</span>(<span class="st">&quot;NY&quot;</span>, <span class="st">&quot;New York&quot;</span>)</span></code></pre></div>
<p>We can now plot these two side by side</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="chapter-8-crime-along-spatial-networks.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot results </span></span>
<span id="cb365-2"><a href="chapter-8-crime-along-spatial-networks.html#cb365-2" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(kensington_lines) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb365-3"><a href="chapter-8-crime-along-spatial-networks.html#cb365-3" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(manhattan_roads) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb365-4"><a href="chapter-8-crime-along-spatial-networks.html#cb365-4" aria-hidden="true" tabindex="-1"></a>figure_1 <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(plot_1, plot_2, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Kensington&quot;</span>, <span class="st">&quot;Manhattan&quot;</span>),</span>
<span id="cb365-5"><a href="chapter-8-crime-along-spatial-networks.html#cb365-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb365-6"><a href="chapter-8-crime-along-spatial-networks.html#cb365-6" aria-hidden="true" tabindex="-1"></a>figure_1</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-219"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-219-1.png" alt="Street network geometries for Kensington in Toronto, CA and Manhattan, in New York, USA" width="672" />
<p class="caption">
FIGURE 9.2: Street network geometries for Kensington in Toronto, CA and Manhattan, in New York, USA
</p>
</div>
<p>What we have is two <code>sf</code> object containing linestrings. Linear networks indeed can be represented in R by simple features wit <code>sf</code> as here, or with the class <code>SpatialLines</code> of package <code>sp</code>. However, for us to be able to do particular kind analysis and some geospatial operations on this network we often will need a clear topology, we will need the data to be stored as a network graph. In other words, We need to move from linestrings to a linear graphical network representation, with edges (for example, representing street segments) and nodes (vertices indicating where they start and end).</p>
<p>This can be done by virtue of manual editing, which in large networks may be prohibitive, fully automatized, or automatized with manual edits just to correct errors. Explaining how to do this in detail with R would require space we do not have. Luckily, there are some good tutorials out there that you can consult for this data pre-processing work.</p>
<ul>
<li><span class="citation"><a href="#ref-Abad_2019" role="doc-biblioref">Abad, Lovelace, and Meer</a> (<a href="#ref-Abad_2019" role="doc-biblioref">2019</a>)</span> explain how to use the packages <code>rgrass7</code> and <code>link2GI</code> for this purpose. These packages bridge R to GRASS GIS software. So for this approach to work you would require this software also installed in your machine. Fortunately, GRASS GIS is freely available.</li>
<li>The vignettes for <code>sfnetworks</code> also cover how to turn a linestring <code>sf</code> object into a network. The function <code>as_sfnetwork()</code> provides the basic functionality for this. This package also includes several additional functions for cleaning the resulting network and there is a specific vignette documenting these <span class="citation">(<a href="#ref-Vandemeer_2021" role="doc-biblioref">van der Meer et al. 2021</a>)</span>.</li>
<li><span class="citation"><a href="#ref-BrizRedon_2019a" role="doc-biblioref">Briz-Redón, Martı́nez-Ruiz, and Montes</a> (<a href="#ref-BrizRedon_2019a" role="doc-biblioref">2019a</a>)</span> developed the <code>SpNetPrep</code> (“Spatial Network Preprocessing”). This package will open a Shiny application in RStudio that will allows for network creation and edition, network direction endowment and point pattern revision and modiﬁcation. The key aim of this package is to allow for manual edits of the constructed network to correct for errors.</li>
</ul>
<p>We quickly below show the <code>as_sfnetwork()</code> function with the road network in Kensington (which will generate an object of class <code>sfnetwork</code>) so that you get a sense for the look of a spatial network, but for further details on network construction and pre-processing it is important you see the documentation, as well as the other materials cited above.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="chapter-8-crime-along-spatial-networks.html#cb366-1" aria-hidden="true" tabindex="-1"></a>kensigton_ntwk <span class="ot">&lt;-</span> <span class="fu">as_sfnetwork</span>(kensington_lines)</span>
<span id="cb366-2"><a href="chapter-8-crime-along-spatial-networks.html#cb366-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kensigton_ntwk)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-220-1.png" width="672" /></p>
<p>Once you have a spatial network that has been properly cleaned and prepared as discussed in the references above, there are a number of things you can do with it. You can apply geospatial operations, such as blending points into the edges, segmenting the edges, running spatial filters, etc. You can also apply standard social network analysis techniques and measures (such as centrality, measuring shortest path). Illustration of these applications are available in the vignettes for <code>sfnetworks</code> <span class="citation">(<a href="#ref-Vandemeer_2021" role="doc-biblioref">van der Meer et al. 2021</a>)</span> and in <span class="citation"><a href="#ref-Abad_2019" role="doc-biblioref">Abad, Lovelace, and Meer</a> (<a href="#ref-Abad_2019" role="doc-biblioref">2019</a>)</span>.</p>
<p>Another format for linear networks in R is <code>linnet</code> used by the package <code>spatstat</code>. When what we want is to do analysis not of the network itself, but of the location of points (such as crime events) along the network <code>spatstat</code> is the way to go and so we would need to ensure we store the data in formats that are required by this package. Statistical analysis of events along these networks is of key interest for crime analysts. Later in this chapter we will, for example, explain how to perform density estimation along networks. Until we get to that final section we will introduce applications of interest to crime analysis using, for convenience, slightly more standard and familiar data structures.</p>
</div>
<div id="visualising-crime-distribution-along-networks" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Visualising crime distribution along networks</h2>
<p>To demonstrate some simpler approaches to visualising crime distribution along networks, we take open data from the British Transport Police (BTP), a national special police force that polices railways and light-rail systems in England, Wales and Scotland. Specifically, we will focus on crimes recorded by BTP on the London Underground system.</p>
<p>Again, the data are available through the <a href="https://data.police.uk/">UK open police data portal</a> and the geometry data from the <a href="https://api.tfl.gov.uk/">Transport for London Open API</a>, but we have also packaged these up with the data available for this textbook.</p>
<p>Let’s start with the crime data. Here the file you need is <code>btp_crimes_2019.csv</code>. We’ll also get a boundary for London for illustration purposes using the <code>rnaturalearth</code> package (see <em>Appendix C</em> for details on this package).</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="chapter-8-crime-along-spatial-networks.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get crimes data and clean up names</span></span>
<span id="cb367-2"><a href="chapter-8-crime-along-spatial-networks.html#cb367-2" aria-hidden="true" tabindex="-1"></a>btp_crimes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/btp_crimes_2019.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>()</span>
<span id="cb367-3"><a href="chapter-8-crime-along-spatial-networks.html#cb367-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-4"><a href="chapter-8-crime-along-spatial-networks.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make the crimes data spatial and transform to projected coordinates</span></span>
<span id="cb367-5"><a href="chapter-8-crime-along-spatial-networks.html#cb367-5" aria-hidden="true" tabindex="-1"></a>btp_crimes <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(btp_crimes, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>),</span>
<span id="cb367-6"><a href="chapter-8-crime-along-spatial-networks.html#cb367-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">agr =</span> <span class="st">&quot;constant&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb367-7"><a href="chapter-8-crime-along-spatial-networks.html#cb367-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">27700</span>) <span class="co"># transform to projected coords</span></span>
<span id="cb367-8"><a href="chapter-8-crime-along-spatial-networks.html#cb367-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-9"><a href="chapter-8-crime-along-spatial-networks.html#cb367-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get a boundary for London from rnaturalearth package</span></span>
<span id="cb367-10"><a href="chapter-8-crime-along-spatial-networks.html#cb367-10" aria-hidden="true" tabindex="-1"></a>ldn <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">country =</span> <span class="st">&quot;united kingdom&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb367-11"><a href="chapter-8-crime-along-spatial-networks.html#cb367-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;London&quot;</span>, type_en) <span class="sc">&amp;</span> name <span class="sc">!=</span> <span class="st">&quot;Derry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb367-12"><a href="chapter-8-crime-along-spatial-networks.html#cb367-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">27700</span>) <span class="co"># transform to projected coords</span></span></code></pre></div>
<p>Now we can have a look at our data by plotting it quickly</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="chapter-8-crime-along-spatial-networks.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the bountary and the crimes</span></span>
<span id="cb368-2"><a href="chapter-8-crime-along-spatial-networks.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ldn))</span>
<span id="cb368-3"><a href="chapter-8-crime-along-spatial-networks.html#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(btp_crimes),  <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-222-1.png" width="672" /></p>
<p>Here we can see the latitude and longitude locations of crimes in London recorded by British Transport Police. However, we know these must take place along the underground and rail network. So let’s see how we account for this in our analysis. For simplicity sake let’s focus on only one of the London Underground lines. We’ve picked the bakerloo line here. This is saved for you in two files. First the stations along the bakerloo line is in <code>bakerloo_stops.csv</code>, while the line is in the file <code>bakerloo_line.geojson</code>.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="chapter-8-crime-along-spatial-networks.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="co">#read stops csv file</span></span>
<span id="cb369-2"><a href="chapter-8-crime-along-spatial-networks.html#cb369-2" aria-hidden="true" tabindex="-1"></a>bakerloo_stops <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/bakerloo_stops.csv&quot;</span>)</span>
<span id="cb369-3"><a href="chapter-8-crime-along-spatial-networks.html#cb369-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-4"><a href="chapter-8-crime-along-spatial-networks.html#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make sf object</span></span>
<span id="cb369-5"><a href="chapter-8-crime-along-spatial-networks.html#cb369-5" aria-hidden="true" tabindex="-1"></a>bakerloo_stops <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bakerloo_stops, </span>
<span id="cb369-6"><a href="chapter-8-crime-along-spatial-networks.html#cb369-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;stn_lon&quot;</span>, <span class="st">&quot;stn_lat&quot;</span>), </span>
<span id="cb369-7"><a href="chapter-8-crime-along-spatial-networks.html#cb369-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb369-8"><a href="chapter-8-crime-along-spatial-networks.html#cb369-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">27700</span>) <span class="co"># transform to projected coordinates</span></span>
<span id="cb369-9"><a href="chapter-8-crime-along-spatial-networks.html#cb369-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-10"><a href="chapter-8-crime-along-spatial-networks.html#cb369-10" aria-hidden="true" tabindex="-1"></a><span class="co"># read bakerloo line geojson</span></span>
<span id="cb369-11"><a href="chapter-8-crime-along-spatial-networks.html#cb369-11" aria-hidden="true" tabindex="-1"></a>bakerloo_line <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/bakerloo_line.geojson&quot;</span>, </span>
<span id="cb369-12"><a href="chapter-8-crime-along-spatial-networks.html#cb369-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">quiet=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb369-13"><a href="chapter-8-crime-along-spatial-networks.html#cb369-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">27700</span>) <span class="co"># transform to projected coordinates</span></span></code></pre></div>
<p>You can visualise the Bakerloo line here using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="chapter-8-crime-along-spatial-networks.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span> </span>
<span id="cb370-2"><a href="chapter-8-crime-along-spatial-networks.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_stops) <span class="sc">+</span> </span>
<span id="cb370-3"><a href="chapter-8-crime-along-spatial-networks.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_line) <span class="sc">+</span> </span>
<span id="cb370-4"><a href="chapter-8-crime-along-spatial-networks.html#cb370-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ldn, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb370-5"><a href="chapter-8-crime-along-spatial-networks.html#cb370-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() </span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-224"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-224-1.png" alt="Bakerloo line in London" width="672" />
<p class="caption">
FIGURE 9.3: Bakerloo line in London
</p>
</div>
<p>We can clearly see the nodes and the edges in this simplified network, all along this route.</p>
<div id="selecting-relevant-crimes-for-micro-places" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Selecting relevant crimes for micro-places</h3>
<p>For our demonstration, we will also need to select only those crimes which we can consider to have happened on (or near the Bakerloo Line). When carrying out your analysis you may have some flag or other variable in the data which indicates whether or not a crime occurred on or near a specific location. In the case of the police.uk data we have a column that we consider them to have happened on or near a specific location. This is the <code>location</code> column. If we have a glance you could see the sort of information it contains:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="chapter-8-crime-along-spatial-networks.html#cb371-1" aria-hidden="true" tabindex="-1"></a>btp_crimes <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(location) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<p>We can see that these crimes occurred on or near Putney Bridge (Lu Station), Streatham Common (Station), Clapham Junction (Station). We can use this information to include only those stations which are on the Bakerloo line. We first need a list of all the station names. We can get this from our <code>bakerloo_stops</code> object which contains the names of the stations in the <code>stn_name</code> variable. In order to search for <em>any</em> of these station names, we can collapse them into an <em>or</em> string (separated by the <code>|</code> operator, which means <em>or</em>):</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="chapter-8-crime-along-spatial-networks.html#cb372-1" aria-hidden="true" tabindex="-1"></a>bk_sntns_list <span class="ot">&lt;-</span> <span class="fu">paste</span>(bakerloo_stops<span class="sc">$</span>stn_name, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>)</span></code></pre></div>
<p>We can then use the <code>grepl()</code> function, which is a pattern matching function, which returns <code>TRUE</code> when a particular string is contained within another string. In other words, if the station name is in the location column. For example, if we are looking for crimes which occurred on or near Baker Street <em>or</em> Embankment we can paste them together with the or operator like this: <code>Baker Street|Embankment</code>, and then use this to find cases where either of these appear. If for example the location text said “On or near Oxford Circus,” we would not select this crime:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="chapter-8-crime-along-spatial-networks.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;Baker Street|Embankment&quot;</span>, <span class="st">&quot;On or near Oxford Circus&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>But if the crime occurred “On or near Baker Street” then we would:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="chapter-8-crime-along-spatial-networks.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">&quot;Baker Street|Embankment&quot;</span>, <span class="st">&quot;On or near Baker Street&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Using the <code>bk_sntns_list</code> object we created above, which has all the stops along the Bakerloo Line, we can filter the whole <code>btp_crimes</code> object to include only those which occurred on or near them.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="chapter-8-crime-along-spatial-networks.html#cb377-1" aria-hidden="true" tabindex="-1"></a>bakerloo_crimes <span class="ot">&lt;-</span> btp_crimes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(bk_sntns_list, location))</span></code></pre></div>
<p>We can see a total of 4207 crimes can be attributed to having occurred on or near the stops of the Bakerloo Line. However, not all data sets will have such a handy <code>location</code> variable in the data set, and then we need to consider other ways of filtering only those crimes which are relevant to our specific micro places. One way is to use the spatial information available with our data, and perform spatial operations such as building a buffer and subsetting only those points which fall within a 200 meter buffer. (If not sure about the code below, see <em>Chapter 2 Basic geospatial operations in R</em> of this textbook for more detail and explanations for what is going on).</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="chapter-8-crime-along-spatial-networks.html#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a buffer around the bakerloo_line object </span></span>
<span id="cb378-2"><a href="chapter-8-crime-along-spatial-networks.html#cb378-2" aria-hidden="true" tabindex="-1"></a>bakerloo_line_buff <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(bakerloo_line, <span class="dv">200</span>)</span>
<span id="cb378-3"><a href="chapter-8-crime-along-spatial-networks.html#cb378-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-4"><a href="chapter-8-crime-along-spatial-networks.html#cb378-4" aria-hidden="true" tabindex="-1"></a><span class="co"># subset only those crimes which are located within this buffer</span></span>
<span id="cb378-5"><a href="chapter-8-crime-along-spatial-networks.html#cb378-5" aria-hidden="true" tabindex="-1"></a>bakerloo_crimes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(bakerloo_line_buff, btp_crimes)</span></code></pre></div>
<p>You may see with this approach we have ended up with total of 4299 crimes. This number is different to what we got earlier, as we are probably erring on the side of including more crimes with a buffer - it may be that it happened on a station that falls on another line, but within the buffer we created. It is important to be aware of the strengths and limitations of the different approaches, and be explicit when drawing inferences from the data.</p>
</div>
<div id="assigning-joining-crimes-to-micro-places" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Assigning (joining) crimes to micro-places</h3>
<p>Now that we have our relevant crimes, we want to join them to the appropriate micro-places. We will focus on line segments here. First, if we have a look at our line object, we have only one observation for the entire line. What we want is to break our line into sections. How you do this depends really much on what you want to show. In this case, it might be meaningful to consider each segment of the line between stops. In this case, we can use the shapefile of the stops (<code>bakerloo_stops</code>) to break up our line (<code>bakerloo_line</code>). However, as <span class="citation"><a href="#ref-Tompson_2009" role="doc-biblioref">Tompson, Partridge, and Shepherd</a> (<a href="#ref-Tompson_2009" role="doc-biblioref">2009</a>)</span> note, network layers typically contain streets of unequal length. This means that longer segments might show up as hot simply because they have more space to contain more crimes. Therefore in such cases it is advisable in this analysis to use equal length street segments, where possible. In this case however, let’s stick to the stops, as they create meaningful segments in our transport setting. To split our linestring (<code>bakerloo_line</code>) into many linestrings using the stops (<code>bakerloo_stops</code>) we can use the <code>st_split()</code> function from the <code>lwgeom</code> package and <code>st_collection_extract()</code> function from <code>sf</code>. Further, as the <code>st_split()</code> function is expecting a blade argument of length 1, we can use the <code>st_combine()</code> (from <code>sf</code>) function to group our tube stations altogether:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="chapter-8-crime-along-spatial-networks.html#cb379-1" aria-hidden="true" tabindex="-1"></a>parts <span class="ot">&lt;-</span> <span class="fu">st_split</span>(bakerloo_line, <span class="fu">st_combine</span>(bakerloo_stops<span class="sc">$</span>geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb379-2"><a href="chapter-8-crime-along-spatial-networks.html#cb379-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_collection_extract</span>(<span class="st">&quot;LINESTRING&quot;</span>)</span></code></pre></div>
<p>You can see we now have a new object called <code>parts</code> which is a linestring containing 24 features, the segments between our 25 tube stations, all as unique lines. You can also see that this is a geometry set of 24 features, let’s turn it into a simple features collection, and label each of the segments with a number by taking each element of parts and binding it together as a dataframe.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="chapter-8-crime-along-spatial-networks.html#cb380-1" aria-hidden="true" tabindex="-1"></a>datalist <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb380-2"><a href="chapter-8-crime-along-spatial-networks.html#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(parts)) {</span>
<span id="cb380-3"><a href="chapter-8-crime-along-spatial-networks.html#cb380-3" aria-hidden="true" tabindex="-1"></a>  datalist[[i]] <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">data.frame</span>(<span class="at">section =</span> i), </span>
<span id="cb380-4"><a href="chapter-8-crime-along-spatial-networks.html#cb380-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">geometry =</span> <span class="fu">st_geometry</span>(parts)[i])</span>
<span id="cb380-5"><a href="chapter-8-crime-along-spatial-networks.html#cb380-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb380-6"><a href="chapter-8-crime-along-spatial-networks.html#cb380-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb380-7"><a href="chapter-8-crime-along-spatial-networks.html#cb380-7" aria-hidden="true" tabindex="-1"></a>bakerloo_sections <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, datalist)</span></code></pre></div>
<p>We now have the object <code>bakerloo_sections</code> which contains the 24 segments into which we sliced the bakerloo line, using the stops as points. The next step is to assign the points to each segment. Let’s first have a look at our data:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="chapter-8-crime-along-spatial-networks.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span> </span>
<span id="cb381-2"><a href="chapter-8-crime-along-spatial-networks.html#cb381-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_sections) <span class="sc">+</span> </span>
<span id="cb381-3"><a href="chapter-8-crime-along-spatial-networks.html#cb381-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_stops) <span class="sc">+</span> </span>
<span id="cb381-4"><a href="chapter-8-crime-along-spatial-networks.html#cb381-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_crimes, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb381-5"><a href="chapter-8-crime-along-spatial-networks.html#cb381-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb381-6"><a href="chapter-8-crime-along-spatial-networks.html#cb381-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;white&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-230"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-230-1.png" alt="Crimes on or near Bakerloo line stations" width="672" />
<p class="caption">
FIGURE 9.4: Crimes on or near Bakerloo line stations
</p>
</div>
<p>Great, we see that we have the Bakerloo Line, its Stations, and only those crimes which we had deemed relevant. Now what we want to do is snap each one of these crime points to the nearest line section (remember we have the 24 sections in the <code>parts</code> object). To do this, we can use the <code>st_nearest_feature()</code> function. This will return, for each point, the ID of the nearest segment. This function is also covered in greater detail in <em>Chapter 2 Basic geospatial operations in R</em> of this textbook, so we won’t go into too much detail here.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="chapter-8-crime-along-spatial-networks.html#cb382-1" aria-hidden="true" tabindex="-1"></a>bline_segments <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(bakerloo_crimes, bakerloo_sections)</span></code></pre></div>
<p>This new object is simply a list of the ID numbers of matched line segments for each of the 12 crime points in the <code>bakerloo_crimes</code> object. We can use this to create a frequency table and save this in a dataframe to be joined to the linesegment object. We will also need to replace our missing values with 0s, since in this case the segments which do not appear in our frequency table had 0 crimes snapped to them. For this, we use the <code>replace_na()</code> function from the <code>tidyr</code> package.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="chapter-8-crime-along-spatial-networks.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make list of nearest into df of frequency</span></span>
<span id="cb383-2"><a href="chapter-8-crime-along-spatial-networks.html#cb383-2" aria-hidden="true" tabindex="-1"></a>sections_freq <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(bline_segments))</span>
<span id="cb383-3"><a href="chapter-8-crime-along-spatial-networks.html#cb383-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-4"><a href="chapter-8-crime-along-spatial-networks.html#cb383-4" aria-hidden="true" tabindex="-1"></a><span class="co">#make sure id is numeric</span></span>
<span id="cb383-5"><a href="chapter-8-crime-along-spatial-networks.html#cb383-5" aria-hidden="true" tabindex="-1"></a>sections_freq<span class="sc">$</span>bline_segments <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(sections_freq<span class="sc">$</span>bline_segments))</span>
<span id="cb383-6"><a href="chapter-8-crime-along-spatial-networks.html#cb383-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-7"><a href="chapter-8-crime-along-spatial-networks.html#cb383-7" aria-hidden="true" tabindex="-1"></a><span class="co">#join to sections object and replace NAs with 0s</span></span>
<span id="cb383-8"><a href="chapter-8-crime-along-spatial-networks.html#cb383-8" aria-hidden="true" tabindex="-1"></a>bakerloo_sections <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bakerloo_sections, sections_freq, </span>
<span id="cb383-9"><a href="chapter-8-crime-along-spatial-networks.html#cb383-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;section&quot;</span> <span class="ot">=</span> <span class="st">&quot;bline_segments&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb383-10"><a href="chapter-8-crime-along-spatial-networks.html#cb383-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Freq =</span> <span class="fu">replace_na</span>(Freq, <span class="dv">0</span>)) </span></code></pre></div>
<p>Now we have an sf object with each section labelled with the number of crimes that were snapped to it as they were the nearest segment. So essentially, the number of crimes on (and around, depending on your buffer decisions) each segment. We could map this count line:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="chapter-8-crime-along-spatial-networks.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create midpoint object</span></span>
<span id="cb384-2"><a href="chapter-8-crime-along-spatial-networks.html#cb384-2" aria-hidden="true" tabindex="-1"></a>midpoint_crimes <span class="ot">&lt;-</span> <span class="fu">mean</span>(bakerloo_sections<span class="sc">$</span>Freq)</span>
<span id="cb384-3"><a href="chapter-8-crime-along-spatial-networks.html#cb384-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-4"><a href="chapter-8-crime-along-spatial-networks.html#cb384-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-5"><a href="chapter-8-crime-along-spatial-networks.html#cb384-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb384-6"><a href="chapter-8-crime-along-spatial-networks.html#cb384-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_sections, <span class="fu">aes</span>(<span class="at">colour =</span> Freq), <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb384-7"><a href="chapter-8-crime-along-spatial-networks.html#cb384-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_stops) <span class="sc">+</span> </span>
<span id="cb384-8"><a href="chapter-8-crime-along-spatial-networks.html#cb384-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb384-9"><a href="chapter-8-crime-along-spatial-networks.html#cb384-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Number of crimes&quot;</span>, </span>
<span id="cb384-10"><a href="chapter-8-crime-along-spatial-networks.html#cb384-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> midpoint_crimes,</span>
<span id="cb384-11"><a href="chapter-8-crime-along-spatial-networks.html#cb384-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#ffffcc&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#fd8d3c&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#800026&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-231"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-231-1.png" alt="Hot routes map displaying count of crimes per segment" width="672" />
<p class="caption">
FIGURE 9.5: Hot routes map displaying count of crimes per segment
</p>
</div>
<p>But of course we want to account for things like the length of each segment as they are unequal. We turn to that next.</p>
</div>
<div id="calculating-a-crime-rate" class="section level3" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Calculating a crime rate</h3>
<p>For our comparison of crime along a network to be meaningful, we must calculate a crime rate. To calculate a rate we need a denominator. In this case, length may be a good one, so the length of each line segment needs to be calculated. We can do this using the <code>st_length()</code> function. Since our data are all in the British National Grid projection, this will return the length of each segment in meters.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="chapter-8-crime-along-spatial-networks.html#cb385-1" aria-hidden="true" tabindex="-1"></a>bakerloo_sections<span class="sc">$</span>length <span class="ot">&lt;-</span> <span class="fu">st_length</span>(bakerloo_sections)</span></code></pre></div>
<p>Once we have all the lengths, a new column needs to be created in the network layer to record a crime per metre score. This is calculated by dividing the number of crimes linked to a street segment by its length.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="chapter-8-crime-along-spatial-networks.html#cb386-1" aria-hidden="true" tabindex="-1"></a>bakerloo_sections<span class="sc">$</span>crime_per_m <span class="ot">&lt;-</span> bakerloo_sections<span class="sc">$</span>Freq <span class="sc">/</span> bakerloo_sections<span class="sc">$</span>length</span></code></pre></div>
<p>We now have our crimes per meter score. We can then map this to create a proper map of <strong>hot routes</strong>.</p>
</div>
<div id="hot-routes" class="section level3" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> Hot Routes</h3>
<p>In order to map hot spots along a network, we can use a technique called <em>hot routes</em>. It was used by <span class="citation"><a href="#ref-Newton_2008" role="doc-biblioref">Newton</a> (<a href="#ref-Newton_2008" role="doc-biblioref">2008</a>)</span> to map crime and disorder on the bus network in Merseyside. A useful how-to guide was later produced by <span class="citation"><a href="#ref-Tompson_2009" role="doc-biblioref">Tompson, Partridge, and Shepherd</a> (<a href="#ref-Tompson_2009" role="doc-biblioref">2009</a>)</span>. Hot Routes were devised to be a straightforward spatial technique that analyses crime patterns that are associated with a linear network (e.g. streets and other transportation networks). It allows an analyst to map crime concentrations along different segments of the network and visualise this through colour. We can create a Hot Routes visualisation by thematically shading each street segment with a colour (and line thickness if desired) that corresponds to the range of the rate of crime per metre. For this, let’s convert our crimes per meter (<code>crime_per_m</code>) variable to numeric from a “units” object, and then use ggplot once again.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="chapter-8-crime-along-spatial-networks.html#cb387-1" aria-hidden="true" tabindex="-1"></a>bakerloo_sections<span class="sc">$</span>crime_per_m <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(bakerloo_sections<span class="sc">$</span>crime_per_m)</span>
<span id="cb387-2"><a href="chapter-8-crime-along-spatial-networks.html#cb387-2" aria-hidden="true" tabindex="-1"></a>midpoint_rates <span class="ot">&lt;-</span> <span class="fu">mean</span>(bakerloo_sections<span class="sc">$</span>crime_per_m)</span>
<span id="cb387-3"><a href="chapter-8-crime-along-spatial-networks.html#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb387-4"><a href="chapter-8-crime-along-spatial-networks.html#cb387-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_sections, <span class="fu">aes</span>(<span class="at">colour =</span> crime_per_m), <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb387-5"><a href="chapter-8-crime-along-spatial-networks.html#cb387-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_stops) <span class="sc">+</span> </span>
<span id="cb387-6"><a href="chapter-8-crime-along-spatial-networks.html#cb387-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb387-7"><a href="chapter-8-crime-along-spatial-networks.html#cb387-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Rate of crimes per meter&quot;</span>, </span>
<span id="cb387-8"><a href="chapter-8-crime-along-spatial-networks.html#cb387-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> midpoint_rates,</span>
<span id="cb387-9"><a href="chapter-8-crime-along-spatial-networks.html#cb387-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#ffffcc&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#fd8d3c&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#800026&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-232"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-232-1.png" alt="Hot routes map displaying rate of crimes per meter for each segment" width="672" />
<p class="caption">
FIGURE 9.6: Hot routes map displaying rate of crimes per meter for each segment
</p>
</div>
<p>We have now created a hot routes visualisation, that helps us map where crime rates are higher along a network. We can add some variations to this if we like, for example we could adjust the width of the segments as well as the colour:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="chapter-8-crime-along-spatial-networks.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb388-2"><a href="chapter-8-crime-along-spatial-networks.html#cb388-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_sections, <span class="fu">aes</span>(<span class="at">colour =</span> crime_per_m, <span class="at">size =</span> crime_per_m),</span>
<span id="cb388-3"><a href="chapter-8-crime-along-spatial-networks.html#cb388-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.legend =</span> <span class="st">&quot;line&quot;</span>) <span class="sc">+</span> </span>
<span id="cb388-4"><a href="chapter-8-crime-along-spatial-networks.html#cb388-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_stops) <span class="sc">+</span> </span>
<span id="cb388-5"><a href="chapter-8-crime-along-spatial-networks.html#cb388-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb388-6"><a href="chapter-8-crime-along-spatial-networks.html#cb388-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">name =</span> <span class="st">&quot;Rate of crimes per meter (colour)&quot;</span>, </span>
<span id="cb388-7"><a href="chapter-8-crime-along-spatial-networks.html#cb388-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">midpoint =</span> midpoint_rates,</span>
<span id="cb388-8"><a href="chapter-8-crime-along-spatial-networks.html#cb388-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">low =</span> <span class="st">&quot;#ffffcc&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;#fd8d3c&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#800026&quot;</span>) <span class="sc">+</span></span>
<span id="cb388-9"><a href="chapter-8-crime-along-spatial-networks.html#cb388-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Rate of crimes per meter (width)&quot;</span>) </span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-233"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-233-1.png" alt="Hot routes map displaying rate of crimes per meter for each segment with line width as well as colour" width="672" />
<p class="caption">
FIGURE 9.7: Hot routes map displaying rate of crimes per meter for each segment with line width as well as colour
</p>
</div>
<p>Or we could consider alternative denominators besides the length of the segment, such as passengers, or trains, or other measures.</p>
<p>However we choose to display these hot routes maps, we can see they help identify where particular crimes might concentrate along our network of interest. But to what extent do we see crime concentrate on this network? To answer this, in the next section we look to quantify crime concentration at these micro-places.</p>
</div>
</div>
<div id="quantifying-crime-concentration-at-micro-places" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Quantifying crime concentration at micro-places</h2>
<p>In crime and place literature we explore the concentration of crime at micro places. “Perhaps the first and most important empirical observation in the criminology of place is that crime concentrates at very small units of geography” <span class="citation">(<a href="#ref-Weisburd_2015" role="doc-biblioref">Weisburd 2015, 135</a>)</span>. A significant proportion of crime concentrates around a small proportion of micro places.</p>
<p>One way to measure inequality in the distribution of a quantitative variable is to use Lorenz curve, and associated Gini coefficient. The Lorenz curve is a probability plot (a P–P plot) comparing the distribution of a variable against a hypothetical uniform distribution of that variable. It can usually be represented by a function <span class="math inline">\(L(F)\)</span>, where <span class="math inline">\(F\)</span>, the cumulative portion of the population, is represented by the horizontal axis, and <span class="math inline">\(L\)</span>, the cumulative portion of the variable of interest (e.g. crime), is represented by the vertical axis. While Lorenz curves are used typically to graph inequality of distribution of wealth they can be applied in this case to explore unequal distribution of crimes between micro-places. A perfectly equal distribution would be depicted by the straight line <span class="math inline">\(y = x\)</span>. <span class="citation"><a href="#ref-zeileis2012package" role="doc-biblioref">Zeileis, Kleiber, and Zeileis</a> (<a href="#ref-zeileis2012package" role="doc-biblioref">2012</a>)</span>. The corresponding Gini coefficient represents the ratio of the area between the line of perfect equality and the observed Lorenz curve to the area between the line of perfect equality and the line of perfect inequality <span class="citation">(<a href="#ref-gastwirth1972estimation" role="doc-biblioref">Gastwirth 1972</a>)</span>. The closer the coefficient is to 1, the more unequal the distribution is <span class="citation">(<a href="#ref-zeileis2012package" role="doc-biblioref">Zeileis, Kleiber, and Zeileis 2012</a>)</span>.</p>
<p>In R we can implement these tests using the functions in the <code>ineq</code> package. To obtain a Lorenz curve, we can use the <code>Lc()</code> function. <code>Lc()</code> computes the (empirical) ordinary and generalized Lorenz curve of a vector <span class="math inline">\(x\)</span> (in this case, our <code>crimes_per_m</code> variable). The function also computes a generalized Lorenz curve ( <span class="math inline">\(= \text{ordinary Lorenz curve} * mean(x)\)</span>). The result can be interpreted like this: <span class="math inline">\(p*100\)</span> percent account for <span class="math inline">\(L(p)*100\)</span> percent of <span class="math inline">\(x\)</span>. Let’s illustrate with the segments of the Bakerloo line:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="chapter-8-crime-along-spatial-networks.html#cb389-1" aria-hidden="true" tabindex="-1"></a>bk_lorenz <span class="ot">&lt;-</span> <span class="fu">Lc</span>(bakerloo_sections<span class="sc">$</span>crime_per_m)</span></code></pre></div>
<p>Our resulting <code>bk_lorenz</code> object has 3 elements. First, the <code>p</code> represents the cumulative percent of crimes (per meter) for each line segment. Then, <code>L</code> contains the values of the ordinary Lorenz curve, while the <code>L.general</code> element the values for the generalised Lorenz curve. We can plot the Lorenz curve with the <code>plot()</code> function from base R.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="chapter-8-crime-along-spatial-networks.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bk_lorenz)</span></code></pre></div>
<p><img src="crime_mapping_files/figure-html/unnamed-chunk-235-1.png" width="672" /></p>
<p>Upon seeing this, we can consider that many of the segments of the Bakerloo line contribute very little to overall crimes, and it is instead the top few which contribute most of the crimes. From a visual inspection, it appears that the Bakerloo line very precisely fits the Pareto Principle, whereby 20% of the segments seem to account for 80% of the crimes (per meter length of the segment). We can quantify this further using the Gini coefficient.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="chapter-8-crime-along-spatial-networks.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ineq</span>(bakerloo_sections<span class="sc">$</span>crime_per_m, <span class="at">type=</span><span class="st">&quot;Gini&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.7159</code></pre>
<p>This score of 71.6% is quite high. The Gini Index is calculated from the Lorenz curve, by taking the area between the line of equality and the Lorenz curve, and dividing this by the total area under the line of equality. This number is bounded between 0 (perfect equality where the Lorenz curve sits right on top of the line of equality) and 1 (perfect inequality, where the Lorenz curve sits right on top of the x axis and bends at right angle), so the closer we get to 1 the higher the inequality in the distribution in our value of interest, in this case crimes per meter. Clearly we see crime concentrate in certain segments of the Bakerloo line.</p>
</div>
<div id="street-profile-analysis" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Street Profile Analysis</h2>
<p>Visualising crime along networks presents an important first step in identifying crime concentration. It may not always be necessary to include the geographic component of a spatial network for the purposes of crime analysis in these networks. Instead, another approach could be to make use of street profile analysis introduced by <span class="citation"><a href="#ref-Spicer_2016" role="doc-biblioref">Spicer et al.</a> (<a href="#ref-Spicer_2016" role="doc-biblioref">2016</a>)</span>. Street profile analysis was initially developed as a method for visualising temporal and spatial crime patterns along major roadways in metropolitan areas. The idea is that the geographical location of the street may not actually be as important as the ability to visualise data from multiple years in a comparable way. So the approach is to treat the street in question as the x-axis of a graph, with a start point (A) and end point (B) breaking it into some interval. Then, you can visualise how crime is distributed along this street by plotting count or rate of crimes on the y-axis, and have multiple lines for different years for example. You can add context by re-introducing some key intersections, or other points of interest. In their paper, Spicer and colleagues demonstrate this using the example of Kingsway Avenue in Vancouver, BC. In this section we will go through how we can apply street profile analysis in R.</p>
<div id="linking-data-to-nodes" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> Linking data to nodes</h3>
<p>For street profile analysis (or let’s call it network profile analysis here, as we are applying this to the Bakerloo Line example), instead of linking the crimes to the nearest line segment, we actually want to link to the nearest station. To do this, we can go back to the stage where we had our line, our stops, and our relevant crimes:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="chapter-8-crime-along-spatial-networks.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span> </span>
<span id="cb393-2"><a href="chapter-8-crime-along-spatial-networks.html#cb393-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_sections) <span class="sc">+</span> </span>
<span id="cb393-3"><a href="chapter-8-crime-along-spatial-networks.html#cb393-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_stops) <span class="sc">+</span> </span>
<span id="cb393-4"><a href="chapter-8-crime-along-spatial-networks.html#cb393-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bakerloo_crimes, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb393-5"><a href="chapter-8-crime-along-spatial-networks.html#cb393-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb393-6"><a href="chapter-8-crime-along-spatial-networks.html#cb393-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;white&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-237"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-237-1.png" alt="Bakerloo line, stations, and relevant crimes" width="672" />
<p class="caption">
FIGURE 9.8: Bakerloo line, stations, and relevant crimes
</p>
</div>
<p>Like last time, we can use the <code>st_nearest_feature()</code> function to snap the crimes (in blue) to the line segments. This time, we can do the same, but snap to the points (the stations) instead. This will return, for each point, the ID of the nearest station.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="chapter-8-crime-along-spatial-networks.html#cb394-1" aria-hidden="true" tabindex="-1"></a>bk_stn_crimes <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(bakerloo_crimes, bakerloo_stops)</span></code></pre></div>
<p>In this object, we see that we now have the stop ID for the closest stop to each crime incident. Now we need to count the frequency of each stop ID (as this tells us the number of crimes that are close to it, therefore assigned to it), and join this to our stops dataframe, just like we did with the lines earlier:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="chapter-8-crime-along-spatial-networks.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make list of nearest into df of frequency</span></span>
<span id="cb395-2"><a href="chapter-8-crime-along-spatial-networks.html#cb395-2" aria-hidden="true" tabindex="-1"></a>stops_w_crimes <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(bk_stn_crimes))</span>
<span id="cb395-3"><a href="chapter-8-crime-along-spatial-networks.html#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="co">#join to sections object </span></span>
<span id="cb395-4"><a href="chapter-8-crime-along-spatial-networks.html#cb395-4" aria-hidden="true" tabindex="-1"></a>bakerloo_stops <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bakerloo_stops <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">stopid =</span> <span class="fu">rownames</span>(.)), </span>
<span id="cb395-5"><a href="chapter-8-crime-along-spatial-networks.html#cb395-5" aria-hidden="true" tabindex="-1"></a>                            stops_w_crimes, </span>
<span id="cb395-6"><a href="chapter-8-crime-along-spatial-networks.html#cb395-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">c</span>( <span class="st">&quot;stopid&quot;</span> <span class="ot">=</span> <span class="st">&quot;bk_stn_crimes&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb395-7"><a href="chapter-8-crime-along-spatial-networks.html#cb395-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Freq =</span> <span class="fu">replace_na</span>(Freq, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># replace NAs with 0s </span></span>
<span id="cb395-8"><a href="chapter-8-crime-along-spatial-networks.html#cb395-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">num_violent_crimes =</span> Freq) <span class="co"># rename Freq variable to num_crimes</span></span></code></pre></div>
<p>Now we have a dataframe of each stop and the number of crimes that happened closest possibly to it. We could make a street profile of it with this count (in fact we will in a moment) but first let’s discuss about ratesfor nodes.</p>
</div>
<div id="calculating-a-rate-for-nodes" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> Calculating a rate for nodes</h3>
<p>In order to calculate a crime rate for each station, we need to think about what is an acceptable denominator. How can we best estimate the number of opportunities present for the particular crime type we are interested in, and how might that be captured in some available data set? For our line segments, we could use length as a denominator, and we had an outcome of the crimes per meter length of the line segment. However, there is no such value for our stations (and for other nodes, such as street junctions). So instead, we need to get creative in finding an appropriate denominator for our nodes. <span class="citation"><a href="#ref-Solymosi_2017" role="doc-biblioref">Solymosi et al.</a> (<a href="#ref-Solymosi_2017" role="doc-biblioref">2017</a>)</span> considered the various types of denominators that may be available to crime analysts focusing on estimating ambient populations to calculate crime risk. These can be:</p>
<ul>
<li>residential population in the area surrounding the station (available from the Census)</li>
<li>workplace population in the area surrounding the station (also available from the Census)</li>
<li>number of lines passing through each station (available from station information, or even a network map)</li>
<li>number of trains passing through each station (available from station information, maybe a timetable)</li>
<li>number of passengers entering/exiting each station (available from transit authority, maybe via a survey like the Rolling Origin Destination Survey, or smartcard data (eg Oyster card in London))</li>
<li>and possibly some other options that we have not thought of.</li>
</ul>
<p>In the case of London underground, we can make use of the <a href="https://data.london.gov.uk/dataset/tfl-rolling-origin-and-destination-survey">Rolling Origin Destination Survey</a> data, which tells us about the number of people entering, exiting, and travelling through each station. We can download this directly from TfL API portal mentioned above, but here again we have provided it. Specifically we are after the file: <code>Total entries and exits by borough-time of day 2017.xls</code>, which contains entry and exit data for each station. As it is an Excel file, we will use the function <code>read_xls()</code> from the <code>readxl</code> library to import it.</p>
<p>The entry and exit data sets are two separate sheets in this excel file, so we will have to read them in one sheet at a time, using <code>read_xls()</code> function from the <code>readxl</code> package. From having seen the data before, I also know that <strong>1)</strong> the variable names are in line 4 so we can skip up to there (the <code>skip=</code> argument in the <code>read_xls()</code> function), <strong>2) </strong>that the names are messy, so we clean them up using the <code>clean_names()</code> function in the <code>janitor</code> package, and <strong>3)</strong> that for some reason the ‘station’ variable is in two columns, so we have to name these as station number and station name using <code>rename()</code> function in the <code>dplyr</code> library (loaded earlier).</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="chapter-8-crime-along-spatial-networks.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load entries and exits data</span></span>
<span id="cb396-2"><a href="chapter-8-crime-along-spatial-networks.html#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="co">#first entries</span></span>
<span id="cb396-3"><a href="chapter-8-crime-along-spatial-networks.html#cb396-3" aria-hidden="true" tabindex="-1"></a>rods_entries <span class="ot">&lt;-</span> <span class="fu">read_xls</span>(<span class="st">&quot;data/Total entries and exits by borough-time of day 2017.xls&quot;</span>,</span>
<span id="cb396-4"><a href="chapter-8-crime-along-spatial-networks.html#cb396-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="st">&quot;entries&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb396-5"><a href="chapter-8-crime-along-spatial-networks.html#cb396-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span>  <span class="fu">rename</span>(<span class="at">stn_num =</span> station, <span class="at">stn_name =</span> x3)</span>
<span id="cb396-6"><a href="chapter-8-crime-along-spatial-networks.html#cb396-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb396-7"><a href="chapter-8-crime-along-spatial-networks.html#cb396-7" aria-hidden="true" tabindex="-1"></a><span class="co">#then exits</span></span>
<span id="cb396-8"><a href="chapter-8-crime-along-spatial-networks.html#cb396-8" aria-hidden="true" tabindex="-1"></a>rods_exits <span class="ot">&lt;-</span> <span class="fu">read_xls</span>(<span class="st">&quot;data/Total entries and exits by borough-time of day 2017.xls&quot;</span>, </span>
<span id="cb396-9"><a href="chapter-8-crime-along-spatial-networks.html#cb396-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet =</span> <span class="st">&quot;exits&quot;</span>, <span class="at">skip =</span> <span class="dv">4</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb396-10"><a href="chapter-8-crime-along-spatial-networks.html#cb396-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">stn_num =</span> station, <span class="at">stn_name =</span> x3)</span></code></pre></div>
<p>Then finally we can link the entry and exit data together with <code>left_join()</code> from dplyr, and sum them together to get the whole day’s worth of entries and exits (because we don’t care about time of day for our purposes here) using <code>group_by()</code> and <code>summarise()</code>, then create a final variable called <code>total_pax</code> using the <code>mutate()</code> function. The <code>total_pax</code> variable tells us how many trips we can expect to go through that station on a given day, giving us a nice denominator to calculate crime rate!</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="chapter-8-crime-along-spatial-networks.html#cb397-1" aria-hidden="true" tabindex="-1"></a>rods <span class="ot">&lt;-</span> rods_exits <span class="sc">%&gt;%</span>                    </span>
<span id="cb397-2"><a href="chapter-8-crime-along-spatial-networks.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., rods_entries) <span class="sc">%&gt;%</span>   <span class="co"># join up the exit and entry data</span></span>
<span id="cb397-3"><a href="chapter-8-crime-along-spatial-networks.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(borough, stn_num, stn_name) <span class="sc">%&gt;%</span> <span class="co"># sum all time periods within the day</span></span>
<span id="cb397-4"><a href="chapter-8-crime-along-spatial-networks.html#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_exiting =</span> <span class="fu">sum</span>(number_exiting),</span>
<span id="cb397-5"><a href="chapter-8-crime-along-spatial-networks.html#cb397-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_entering =</span> <span class="fu">sum</span>(number_entering)) <span class="sc">%&gt;%</span> </span>
<span id="cb397-6"><a href="chapter-8-crime-along-spatial-networks.html#cb397-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stn_num <span class="sc">!=</span> <span class="st">&quot;Total for borough&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># remove the borough totals</span></span>
<span id="cb397-7"><a href="chapter-8-crime-along-spatial-networks.html#cb397-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_pax =</span> total_exiting <span class="sc">+</span> total_entering) <span class="co"># create grand total of pax trips</span></span></code></pre></div>
<p>Now we have our denominator for calculating the crime rate! Let’s join it to our Bakerloo Line stations to do so.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="chapter-8-crime-along-spatial-networks.html#cb398-1" aria-hidden="true" tabindex="-1"></a>bakerloo_stops <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bakerloo_stops, rods)</span></code></pre></div>
<p>Now we can calculate the rate by dividing the number of crimes (<code>num_crimes</code>) by the total number of daily passengers (<code>total_pax</code>), and let’s times by 10,000 to get crimes per 10,000 passengers for each station.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="chapter-8-crime-along-spatial-networks.html#cb399-1" aria-hidden="true" tabindex="-1"></a>bakerloo_stops<span class="sc">$</span>violent_crime_rate <span class="ot">&lt;-</span> bakerloo_stops<span class="sc">$</span>num_violent_crimes<span class="sc">/</span></span>
<span id="cb399-2"><a href="chapter-8-crime-along-spatial-networks.html#cb399-2" aria-hidden="true" tabindex="-1"></a>  bakerloo_stops<span class="sc">$</span>total_pax <span class="sc">*</span> <span class="dv">10000</span></span></code></pre></div>
<p>Great now we have a rate. Our top station for violent and sexual offences is Edgware Road, which has 34.4 such crimes per 10,000 passengers, while our lowest are the stations which recorded 2 crimes per 10,000 passengers (Warwick Avenue). Great, now let’s actually visualise crime along the stations of the Bakerloo Line using Street Profile Analysis!</p>
</div>
<div id="visualising-with-street-profile-analysis" class="section level3" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> Visualising with Street Profile Analysis</h3>
<p>Now we have (almost) everything we need to visualise crime along the Bakerloo line using Street Profile Analysis. What we want to do, is imagine the Bakerloo line is the x axis, and then use the y axis to show the crime rate. Of course for this, we want to know the order in which the stations follow each other. Annoyingly, at the time of writing, the TfL API doesn’t actually have any sort of sequence information with the stops so we have to make our own lookup table:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="chapter-8-crime-along-spatial-networks.html#cb400-1" aria-hidden="true" tabindex="-1"></a>bakerloo_order <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">stop_num =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>),</span>
<span id="cb400-2"><a href="chapter-8-crime-along-spatial-networks.html#cb400-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stn_name =</span> <span class="fu">c</span>(<span class="st">&quot;Harrow &amp; Wealdstone&quot;</span>,</span>
<span id="cb400-3"><a href="chapter-8-crime-along-spatial-networks.html#cb400-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Kenton&#39;</span>,</span>
<span id="cb400-4"><a href="chapter-8-crime-along-spatial-networks.html#cb400-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;South Kenton&#39;</span>,</span>
<span id="cb400-5"><a href="chapter-8-crime-along-spatial-networks.html#cb400-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;North Wembley&#39;</span>,</span>
<span id="cb400-6"><a href="chapter-8-crime-along-spatial-networks.html#cb400-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Wembley Central&#39;</span>,</span>
<span id="cb400-7"><a href="chapter-8-crime-along-spatial-networks.html#cb400-7" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Stonebridge Park&#39;</span>,</span>
<span id="cb400-8"><a href="chapter-8-crime-along-spatial-networks.html#cb400-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Harlesden&#39;</span>,</span>
<span id="cb400-9"><a href="chapter-8-crime-along-spatial-networks.html#cb400-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Willesden Junction&#39;</span>,</span>
<span id="cb400-10"><a href="chapter-8-crime-along-spatial-networks.html#cb400-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Kensal Green&#39;</span>,</span>
<span id="cb400-11"><a href="chapter-8-crime-along-spatial-networks.html#cb400-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;Queen&#39;s Park&quot;</span>,</span>
<span id="cb400-12"><a href="chapter-8-crime-along-spatial-networks.html#cb400-12" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Kilburn Park&#39;</span>,</span>
<span id="cb400-13"><a href="chapter-8-crime-along-spatial-networks.html#cb400-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Maida Vale&#39;</span>,</span>
<span id="cb400-14"><a href="chapter-8-crime-along-spatial-networks.html#cb400-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Warwick Avenue&#39;</span>,</span>
<span id="cb400-15"><a href="chapter-8-crime-along-spatial-networks.html#cb400-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Paddington&#39;</span>,</span>
<span id="cb400-16"><a href="chapter-8-crime-along-spatial-networks.html#cb400-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Edgware Road&#39;</span>,</span>
<span id="cb400-17"><a href="chapter-8-crime-along-spatial-networks.html#cb400-17" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Marylebone&#39;</span>,</span>
<span id="cb400-18"><a href="chapter-8-crime-along-spatial-networks.html#cb400-18" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Baker Street&#39;</span>,</span>
<span id="cb400-19"><a href="chapter-8-crime-along-spatial-networks.html#cb400-19" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;Regent&#39;s Park&quot;</span>,</span>
<span id="cb400-20"><a href="chapter-8-crime-along-spatial-networks.html#cb400-20" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Oxford Circus&#39;</span>,</span>
<span id="cb400-21"><a href="chapter-8-crime-along-spatial-networks.html#cb400-21" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Piccadilly Circus&#39;</span>,</span>
<span id="cb400-22"><a href="chapter-8-crime-along-spatial-networks.html#cb400-22" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Charing Cross&#39;</span>,</span>
<span id="cb400-23"><a href="chapter-8-crime-along-spatial-networks.html#cb400-23" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Embankment&#39;</span>,</span>
<span id="cb400-24"><a href="chapter-8-crime-along-spatial-networks.html#cb400-24" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Waterloo&#39;</span>,</span>
<span id="cb400-25"><a href="chapter-8-crime-along-spatial-networks.html#cb400-25" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Lambeth North&#39;</span>,</span>
<span id="cb400-26"><a href="chapter-8-crime-along-spatial-networks.html#cb400-26" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&#39;Elephant &amp; Castle&#39;</span>)</span>
<span id="cb400-27"><a href="chapter-8-crime-along-spatial-networks.html#cb400-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In other cases you might have some sort of sequence information, or you might need to make a different sequence. For example, if you are plotting your Street Profile Analysis of a major roadway, like <span class="citation"><a href="#ref-Spicer_2016" role="doc-biblioref">Spicer et al.</a> (<a href="#ref-Spicer_2016" role="doc-biblioref">2016</a>)</span>, you might want to list the streets which intersect it, in order from one end to the other. Once the ordered list exists, we can join this to the original dataframe to have a sequence to order our stops by:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="chapter-8-crime-along-spatial-networks.html#cb401-1" aria-hidden="true" tabindex="-1"></a>bakerloo_stops <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bakerloo_stops, bakerloo_order)</span></code></pre></div>
<p>And then we can use this to order our stop names, and finally present the Street (or rather Route) Profile for the Bakerloo line considering violent and sexual offences:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="chapter-8-crime-along-spatial-networks.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bakerloo_stops, </span>
<span id="cb402-2"><a href="chapter-8-crime-along-spatial-networks.html#cb402-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(stn_name, stop_num), </span>
<span id="cb402-3"><a href="chapter-8-crime-along-spatial-networks.html#cb402-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> violent_crime_rate, </span>
<span id="cb402-4"><a href="chapter-8-crime-along-spatial-networks.html#cb402-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> line)) <span class="sc">+</span> </span>
<span id="cb402-5"><a href="chapter-8-crime-along-spatial-networks.html#cb402-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb402-6"><a href="chapter-8-crime-along-spatial-networks.html#cb402-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb402-7"><a href="chapter-8-crime-along-spatial-networks.html#cb402-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bakerloo Line&quot;</span>) <span class="sc">+</span> </span>
<span id="cb402-8"><a href="chapter-8-crime-along-spatial-networks.html#cb402-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Crime Rate per 10,000 passengers&quot;</span>) <span class="sc">+</span> </span>
<span id="cb402-9"><a href="chapter-8-crime-along-spatial-networks.html#cb402-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb402-10"><a href="chapter-8-crime-along-spatial-networks.html#cb402-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-239"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-239-1.png" alt="Route profile for Bakerloo line" width="672" />
<p class="caption">
FIGURE 9.9: Route profile for Bakerloo line
</p>
</div>
<p>This is a non-geographical way to visualise crime rates along micro places, while still taking into account some spatial information, namely the sequence of these nodes along our line segment. Surely we could prettify the plot with additional code, but with this cruder version you can see what the street profile gives you.</p>
<p>What is really a strength of Street Profile Analysis is that you can compare different things along the same route, which may be difficult to compare on a two-dimensional map. For example, we could compare how crime changes along the network between different months of the year here. For this, we can create a dataframe of crimes per month for each station. For each crime find the nearest station (<code>st_nearest_feature()</code>) and assign the station id to a new column, then group by month and nearest station.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="chapter-8-crime-along-spatial-networks.html#cb403-1" aria-hidden="true" tabindex="-1"></a>monthy_crimes <span class="ot">&lt;-</span> bakerloo_crimes <span class="sc">%&gt;%</span> </span>
<span id="cb403-2"><a href="chapter-8-crime-along-spatial-networks.html#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nearest_stn_id =</span> <span class="fu">st_nearest_feature</span>(bakerloo_crimes, bakerloo_stops)) <span class="sc">%&gt;%</span> </span>
<span id="cb403-3"><a href="chapter-8-crime-along-spatial-networks.html#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb403-4"><a href="chapter-8-crime-along-spatial-networks.html#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nearest_stn_id, month) <span class="sc">%&gt;%</span> </span>
<span id="cb403-5"><a href="chapter-8-crime-along-spatial-networks.html#cb403-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb403-6"><a href="chapter-8-crime-along-spatial-networks.html#cb403-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> month, <span class="at">values_from =</span> n)  <span class="sc">%&gt;%</span> </span>
<span id="cb403-7"><a href="chapter-8-crime-along-spatial-networks.html#cb403-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bakerloo_stops, ., <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;stop_num&quot;</span> <span class="ot">=</span> <span class="st">&quot;nearest_stn_id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb403-8"><a href="chapter-8-crime-along-spatial-networks.html#cb403-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span></code></pre></div>
<p>And now we can compare between different months by adding each month on as a ggplot layer. For example, if we wanted to see January, February, and March:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="chapter-8-crime-along-spatial-networks.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthy_crimes, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(stn_name, stop_num), <span class="at">group =</span> line)) <span class="sc">+</span> </span>
<span id="cb404-2"><a href="chapter-8-crime-along-spatial-networks.html#cb404-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2019-01</span><span class="st">`</span>, <span class="at">col =</span> <span class="st">&quot;Jan&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb404-3"><a href="chapter-8-crime-along-spatial-networks.html#cb404-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2019-01</span><span class="st">`</span>, <span class="at">col =</span> <span class="st">&quot;Jan&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb404-4"><a href="chapter-8-crime-along-spatial-networks.html#cb404-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2019-02</span><span class="st">`</span>, <span class="at">col =</span> <span class="st">&quot;Feb&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb404-5"><a href="chapter-8-crime-along-spatial-networks.html#cb404-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2019-02</span><span class="st">`</span>, <span class="at">col =</span> <span class="st">&quot;Feb&quot;</span>)) <span class="sc">+</span></span>
<span id="cb404-6"><a href="chapter-8-crime-along-spatial-networks.html#cb404-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2019-03</span><span class="st">`</span>, <span class="at">col =</span> <span class="st">&quot;Mar&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb404-7"><a href="chapter-8-crime-along-spatial-networks.html#cb404-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2019-03</span><span class="st">`</span>, <span class="at">col =</span> <span class="st">&quot;Mar&quot;</span>)) <span class="sc">+</span></span>
<span id="cb404-8"><a href="chapter-8-crime-along-spatial-networks.html#cb404-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Bakerloo Line&quot;</span>) <span class="sc">+</span> </span>
<span id="cb404-9"><a href="chapter-8-crime-along-spatial-networks.html#cb404-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Crime Rate per 10,000 passengers&quot;</span>) <span class="sc">+</span> </span>
<span id="cb404-10"><a href="chapter-8-crime-along-spatial-networks.html#cb404-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb404-11"><a href="chapter-8-crime-along-spatial-networks.html#cb404-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb404-12"><a href="chapter-8-crime-along-spatial-networks.html#cb404-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#8da0cb&quot;</span>, <span class="st">&quot;#fc8d62&quot;</span>), </span>
<span id="cb404-13"><a href="chapter-8-crime-along-spatial-networks.html#cb404-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>), </span>
<span id="cb404-14"><a href="chapter-8-crime-along-spatial-networks.html#cb404-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide=</span><span class="st">&quot;legend&quot;</span>, <span class="at">name=</span><span class="st">&quot;Month&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-241"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-241-1.png" alt="Route profile of Bakerloo line comparing different months" width="672" />
<p class="caption">
FIGURE 9.10: Route profile of Bakerloo line comparing different months
</p>
</div>
<p>We could also visualise different crime types, or different sources of data, the possibilities are many, and this is where the strength of this method is evident, over a map, where only one variable at one time can be displayed.</p>
</div>
</div>
<div id="density-estimation-along-networks" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Density estimation along networks</h2>
<p>Earlier we showed how you can produce the hot route maps, which conceptually are similar to the thematic maps we used in previous chapters. Another way of estimating the intensity of crime along spatial networks is to use kernel density estimation methods. You could, as we did in Chapter 7, use standard kernel density estimation methods, but this ignores the underlying structure in the data. As Jeremy Gelb indicates in the vignette for <code>spNetwork</code>, there are a number of problems with this cruder approach:</p>
<blockquote>
<p>“Calculating density values for locations outside the network is meaningless and the Euclidean distance underestimates the real distance between two objects on the network. Moreover, networks are not isotropic spaces. In other words, it is not possible to move in every direction, but only along the edges of the network” <span class="citation">(<a href="#ref-Gelb_2021" role="doc-biblioref">Gelb 2021</a>)</span>.</p>
</blockquote>
<p>Smoothing through kernel density estimation in linear networks is an area of active development and a number of approaches have been proposed over recent years, some of which provide a pragmatic (heuristic) solution, but “their properties are not well understood, statistical insight is lacking,” and “computational cost is high” <span class="citation">(<a href="#ref-McSwiggan_2016" role="doc-biblioref">McSwiggan, Baddeley, and Nair 2016</a>: 325)</span>. The existing software implementation of the “traditional” algorithms that have been developed can deal with small datasets, but may become prohibitive when dealing with larger datasets. More recent algorithms aim to provide faster solutions for larger datasets without seriously compromising performance (see <span class="citation"><a href="#ref-Rakshit_2019" role="doc-biblioref">Rakshit et al.</a> (<a href="#ref-Rakshit_2019" role="doc-biblioref">2019</a>)</span>). You can currently do this in R with at least two separate packages <code>spatstat</code> and the newer <code>spNetwork</code>. For reasons of space, given that it provides a more general framework for point pattern analysis and a wider selection of (more principled) approaches, we will only cover <code>spatstat</code> here.</p>
<p>In <code>spatstat</code> a point pattern on a linear network is represented by an object of class <code>lpp</code> (stands for point pattern in a linear network). The functions <code>lpp()</code> and <code>as.lpp()</code> convert raw data into an object of class <code>lpp</code>. The two needed arguments are a matrix or data frame with the coordinates of the points (or alternatively a <code>ppp</code> object that we discussed in chapter 7) and a liner network of class <code>linnet</code>).</p>
<p>The <code>linnet</code> object will represent the network of a set of line segments, containing information about each of these segments (edges) and its vertices (nodes). You can generate a <code>linnet</code> object from a <code>SpatialLines</code> (<code>sp</code>) object using functions from <code>maptool</code>, specifically <code>as.linnet.SpatialLines()</code>. If you need to process this network before is ready you can do so with some functions from <code>spatstat</code> or <code>SpnetPrep</code> as preferable (and only then create your <code>linnet</code> object).</p>
<p>We will show here how to transform a <code>SpatialLines</code> object into <code>linnet</code> and how, then, we generate a <code>lpp</code> object. First, we will get the road network for a few census tracts in Englewood, one of the community areas in Chicago with a high crime rate (see <span class="citation"><a href="#ref-BrizRedon_2019a" role="doc-biblioref">Briz-Redón, Martı́nez-Ruiz, and Montes</a> (<a href="#ref-BrizRedon_2019a" role="doc-biblioref">2019a</a>)</span> for a similar example that inspired ours). To do this we will use the <code>tigris</code> package, that provides both the road network data and the census geographies as shown in the code below. We then use the <code>intersect()</code> function from the <code>raster</code> package to only get the fractions of the roads covered by the census tracts we have selected. Then we need to get this into a projected coordinate system so that we can use <code>spatstat</code>. The final step is to turn this <code>sp</code> object into a <code>linnet</code> object using <code>as.linnet.SpatialLines()</code> from the <code>maptools</code> package.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="chapter-8-crime-along-spatial-networks.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the road network and census tracts for Cook county in Illinois</span></span>
<span id="cb405-2"><a href="chapter-8-crime-along-spatial-networks.html#cb405-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the tracts we get as sf for easier filter and then turn into sp</span></span>
<span id="cb405-3"><a href="chapter-8-crime-along-spatial-networks.html#cb405-3" aria-hidden="true" tabindex="-1"></a>cook_roads <span class="ot">&lt;-</span> <span class="fu">roads</span>(<span class="at">state =</span> <span class="st">&quot;Illinois&quot;</span>, <span class="at">county =</span> <span class="st">&quot;031&quot;</span>, <span class="at">class=</span><span class="st">&quot;sp&quot;</span>)</span>
<span id="cb405-4"><a href="chapter-8-crime-along-spatial-networks.html#cb405-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-5"><a href="chapter-8-crime-along-spatial-networks.html#cb405-5" aria-hidden="true" tabindex="-1"></a><span class="co"># select census tracts based on their id code</span></span>
<span id="cb405-6"><a href="chapter-8-crime-along-spatial-networks.html#cb405-6" aria-hidden="true" tabindex="-1"></a>cook_tract <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="at">state =</span> <span class="st">&quot;Illinois&quot;</span>, <span class="at">county =</span> <span class="st">&quot;031&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb405-7"><a href="chapter-8-crime-along-spatial-networks.html#cb405-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TRACTCE <span class="sc">==</span> <span class="st">&quot;681100&quot;</span> <span class="sc">|</span> TRACTCE <span class="sc">==</span> <span class="st">&quot;681400&quot;</span> <span class="sc">|</span> </span>
<span id="cb405-8"><a href="chapter-8-crime-along-spatial-networks.html#cb405-8" aria-hidden="true" tabindex="-1"></a>           TRACTCE <span class="sc">==</span> <span class="st">&quot;681200&quot;</span> <span class="sc">|</span> TRACTCE <span class="sc">==</span> <span class="st">&quot;681300&quot;</span> )</span>
<span id="cb405-9"><a href="chapter-8-crime-along-spatial-networks.html#cb405-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-10"><a href="chapter-8-crime-along-spatial-networks.html#cb405-10" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to sp object</span></span>
<span id="cb405-11"><a href="chapter-8-crime-along-spatial-networks.html#cb405-11" aria-hidden="true" tabindex="-1"></a>cook_tract <span class="ot">&lt;-</span> <span class="fu">as</span>(cook_tract, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb405-12"><a href="chapter-8-crime-along-spatial-networks.html#cb405-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-13"><a href="chapter-8-crime-along-spatial-networks.html#cb405-13" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the roads to only the census tract coverage</span></span>
<span id="cb405-14"><a href="chapter-8-crime-along-spatial-networks.html#cb405-14" aria-hidden="true" tabindex="-1"></a>tract_roads <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">intersect</span>(cook_roads, cook_tract)</span>
<span id="cb405-15"><a href="chapter-8-crime-along-spatial-networks.html#cb405-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-16"><a href="chapter-8-crime-along-spatial-networks.html#cb405-16" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject the sp object</span></span>
<span id="cb405-17"><a href="chapter-8-crime-along-spatial-networks.html#cb405-17" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="at">SRS_string=</span><span class="st">&#39;EPSG:6454&#39;</span>)</span>
<span id="cb405-18"><a href="chapter-8-crime-along-spatial-networks.html#cb405-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-19"><a href="chapter-8-crime-along-spatial-networks.html#cb405-19" aria-hidden="true" tabindex="-1"></a>tract_roads <span class="ot">&lt;-</span> <span class="fu">spTransform</span>(tract_roads, x)</span>
<span id="cb405-20"><a href="chapter-8-crime-along-spatial-networks.html#cb405-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-21"><a href="chapter-8-crime-along-spatial-networks.html#cb405-21" aria-hidden="true" tabindex="-1"></a>s_englewood_linnet <span class="ot">&lt;-</span> <span class="fu">as.linnet.SpatialLines</span>(tract_roads)</span>
<span id="cb405-22"><a href="chapter-8-crime-along-spatial-networks.html#cb405-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-23"><a href="chapter-8-crime-along-spatial-networks.html#cb405-23" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up no longer needed objects and plot</span></span>
<span id="cb405-24"><a href="chapter-8-crime-along-spatial-networks.html#cb405-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">&quot;cook_roads&quot;</span>, <span class="st">&quot;cook_tract&quot;</span>, <span class="st">&quot;tract_roads&quot;</span>,<span class="st">&quot;x&quot;</span> ))</span></code></pre></div>
<p>Now we have our <code>linnet</code> object called <code>s_englewood_linnet</code> which contains a street network for the South Englewood area. We can plot this to have a visual inspection.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="chapter-8-crime-along-spatial-networks.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_englewood_linnet, <span class="at">style =</span> <span class="st">&quot;none&quot;</span>, <span class="at">main =</span> <span class="st">&quot;South Englewood&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-242"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-242-1.png" alt="Street network of South Englewood as linnet object" width="672" />
<p class="caption">
FIGURE 9.11: Street network of South Englewood as linnet object
</p>
</div>
<p>Now we need to put some crime data in this street network. For that we will rely on the <code>crimedata</code> package we introduced in the previous chapter. We will take this data and first will create a <code>ppp</code> object using as a window the bounding box of the ´linnet` object we just created and that you can see by printing it:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="chapter-8-crime-along-spatial-networks.html#cb407-1" aria-hidden="true" tabindex="-1"></a>s_englewood_linnet</span></code></pre></div>
<pre><code>## Linear network with 1149 vertices and 1351 lines
## Enclosing window: rectangle = [356456, 358379] x 
## [565240, 567094] units</code></pre>
<p>The code for getting the data has been covered before so we don´t annotate it nor provide a detailed explanation here. We are extracting the assaults for the summer of 2019 and the Englewood community area. Just to note we are using <code>as.ppp()</code> since the standard <code>ppp</code> function retains in the created object the points outside the bounding box (even if this only affects the plotting, which will plot all).</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="chapter-8-crime-along-spatial-networks.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get chicago crime data</span></span>
<span id="cb409-2"><a href="chapter-8-crime-along-spatial-networks.html#cb409-2" aria-hidden="true" tabindex="-1"></a>chicago_viol <span class="ot">&lt;-</span> <span class="fu">get_crime_data</span>(<span class="at">cities =</span> <span class="st">&quot;Chicago&quot;</span>, <span class="at">years =</span> <span class="dv">2019</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb409-3"><a href="chapter-8-crime-along-spatial-networks.html#cb409-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">type =</span> <span class="st">&quot;extended&quot;</span>, <span class="at">output =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb409-4"><a href="chapter-8-crime-along-spatial-networks.html#cb409-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only assaults</span></span>
<span id="cb409-5"><a href="chapter-8-crime-along-spatial-networks.html#cb409-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((offense_type <span class="sc">==</span> <span class="st">&quot;aggravated assault&quot;</span> <span class="sc">|</span>  offense_type <span class="sc">==</span> <span class="st">&quot;simple assault&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb409-6"><a href="chapter-8-crime-along-spatial-networks.html#cb409-6" aria-hidden="true" tabindex="-1"></a>           <span class="co"># select only area of interest</span></span>
<span id="cb409-7"><a href="chapter-8-crime-along-spatial-networks.html#cb409-7" aria-hidden="true" tabindex="-1"></a>           chi_community_area <span class="sc">==</span> <span class="st">&quot;68&quot;</span>)</span>
<span id="cb409-8"><a href="chapter-8-crime-along-spatial-networks.html#cb409-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-9"><a href="chapter-8-crime-along-spatial-networks.html#cb409-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-10"><a href="chapter-8-crime-along-spatial-networks.html#cb409-10" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to projected CRS</span></span>
<span id="cb409-11"><a href="chapter-8-crime-along-spatial-networks.html#cb409-11" aria-hidden="true" tabindex="-1"></a>chicago_viol <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(chicago_viol, <span class="dv">6454</span>)</span>
<span id="cb409-12"><a href="chapter-8-crime-along-spatial-networks.html#cb409-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-13"><a href="chapter-8-crime-along-spatial-networks.html#cb409-13" aria-hidden="true" tabindex="-1"></a><span class="co"># create a variable for month and keep only June to August</span></span>
<span id="cb409-14"><a href="chapter-8-crime-along-spatial-networks.html#cb409-14" aria-hidden="true" tabindex="-1"></a>chicago_viol <span class="ot">&lt;-</span> chicago_viol <span class="sc">%&gt;%</span> </span>
<span id="cb409-15"><a href="chapter-8-crime-along-spatial-networks.html#cb409-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date_single)) <span class="sc">%&gt;%</span> </span>
<span id="cb409-16"><a href="chapter-8-crime-along-spatial-networks.html#cb409-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(month <span class="sc">%in%</span> (<span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>))</span>
<span id="cb409-17"><a href="chapter-8-crime-along-spatial-networks.html#cb409-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-18"><a href="chapter-8-crime-along-spatial-networks.html#cb409-18" aria-hidden="true" tabindex="-1"></a><span class="co"># create matrix of coordinates for our violent crimes</span></span>
<span id="cb409-19"><a href="chapter-8-crime-along-spatial-networks.html#cb409-19" aria-hidden="true" tabindex="-1"></a>chi_viol_coord <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(chicago_viol<span class="sc">$</span>geometry), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T)</span>
<span id="cb409-20"><a href="chapter-8-crime-along-spatial-networks.html#cb409-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-21"><a href="chapter-8-crime-along-spatial-networks.html#cb409-21" aria-hidden="true" tabindex="-1"></a><span class="co"># create window</span></span>
<span id="cb409-22"><a href="chapter-8-crime-along-spatial-networks.html#cb409-22" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">c</span>(<span class="fl">356456.4</span>, <span class="fl">358379.1</span>,<span class="fl">565240.1</span>, <span class="fl">567094.3</span>))</span>
<span id="cb409-23"><a href="chapter-8-crime-along-spatial-networks.html#cb409-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-24"><a href="chapter-8-crime-along-spatial-networks.html#cb409-24" aria-hidden="true" tabindex="-1"></a><span class="co"># create ppp object</span></span>
<span id="cb409-25"><a href="chapter-8-crime-along-spatial-networks.html#cb409-25" aria-hidden="true" tabindex="-1"></a>chi_viol_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> chi_viol_coord[,<span class="dv">1</span>], <span class="at">y =</span> chi_viol_coord[,<span class="dv">2</span>], </span>
<span id="cb409-26"><a href="chapter-8-crime-along-spatial-networks.html#cb409-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">window =</span> w, <span class="at">check =</span> T)</span>
<span id="cb409-27"><a href="chapter-8-crime-along-spatial-networks.html#cb409-27" aria-hidden="true" tabindex="-1"></a>chi_viol_ppp <span class="ot">&lt;-</span> <span class="fu">as.ppp</span>(chi_viol_ppp)</span>
<span id="cb409-28"><a href="chapter-8-crime-along-spatial-networks.html#cb409-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-29"><a href="chapter-8-crime-along-spatial-networks.html#cb409-29" aria-hidden="true" tabindex="-1"></a><span class="co">#we know there is multiplicity so we will add this as a mark</span></span>
<span id="cb409-30"><a href="chapter-8-crime-along-spatial-networks.html#cb409-30" aria-hidden="true" tabindex="-1"></a><span class="fu">marks</span>(chi_viol_ppp) <span class="ot">&lt;-</span> <span class="fu">multiplicity</span>(chi_viol_ppp)</span></code></pre></div>
<p>Now that we have the <code>ppp</code> object we can use it to create our <code>lpp</code> object (notice that, as noted above, there are other ways to input your points when creating a <code>lpp</code> object) and then plot it. There are a 264 locations, some of which represent up to 6 incidents. Remember that this is likely the result of geomasking due to privacy concerns.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="chapter-8-crime-along-spatial-networks.html#cb410-1" aria-hidden="true" tabindex="-1"></a>chi_viol_lpp <span class="ot">&lt;-</span> <span class="fu">lpp</span>(chi_viol_ppp, s_englewood_linnet)</span></code></pre></div>
<p>Now we can plot our two layers, the crimes in our <code>chi_viol_lpp</code> object, and the network in the <code>s_englewood_linnet</code> object.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="chapter-8-crime-along-spatial-networks.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chi_viol_lpp, <span class="at">meansize =</span> <span class="dv">50</span>, <span class="at">main =</span> <span class="st">&quot;Assaults in South Englewood (2019)&quot;</span>)</span>
<span id="cb411-2"><a href="chapter-8-crime-along-spatial-networks.html#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_englewood_linnet, <span class="at">style =</span> <span class="st">&quot;none&quot;</span>, <span class="at">add=</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-245"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-245-1.png" alt="Assaults as lpp object over network as linnet object" width="672" />
<p class="caption">
FIGURE 9.12: Assaults as lpp object over network as linnet object
</p>
</div>
<p>A <code>lpp</code> object contains the linear network information, the spatial coordinates of the data points, and any number of columns of <em>marks</em> (in this case the mark is telling us the type of crime we are dealing with). It also contains the local coordinates <code>seg</code> and <code>tp</code> for the data points. The local coordinate <code>seg</code> is an integer identifying the particular street segment the data point is located in. A segment is each of the sections of a street between two vertices (marking the intersection with another segment). The local coordinate <code>tp</code> is a real number between 0 and 1 indicating the position of the point within the segment: <code>tp=0</code> corresponds to the first endpoint and <code>tp=1</code> correspond to the second endpoint.</p>
<p>The visual inspection of the map suggest that the intensity of crime along the network is not spatially uniform. Like we did before, we can estimate the density of data points along the networks using Kernel estimation with <code>density.lpp()</code>. This is an area of <code>spatstat</code> that has seen significant development in the latest release. Depending on the arguments passed to the function a different algorithm will be employed to estimate the density. Alternatively one could use the new specific functions for each of these different algorithms: <code>densityQuick()</code> (see <span class="citation"><a href="#ref-Rakshit_2019" role="doc-biblioref">Rakshit et al.</a> (<a href="#ref-Rakshit_2019" role="doc-biblioref">2019</a>)</span>), <code>densityEqualSplit()</code> (see <span class="citation"><a href="#ref-Okabe_2012" role="doc-biblioref">Okabe and Sugihara</a> (<a href="#ref-Okabe_2012" role="doc-biblioref">2012</a>)</span>), or <code>densityHeat()</code> (see <span class="citation"><a href="#ref-McSwiggan_2016" role="doc-biblioref">McSwiggan, Baddeley, and Nair</a> (<a href="#ref-McSwiggan_2016" role="doc-biblioref">2016</a>)</span>).</p>
<p>The Okabe-Suhigara method was the first to be developed for this kind of applications and can be invoked with <code>densityEqualSplit()</code>. We can specify the kernel (the default is <code>epanechnikov</code>) and the smoothing bandwidth, sigma (the standard deviation of the kernel). Here, we are going for 60 meters for illustration, but see <em>Chapter 7: Spatial point patterns of crime events</em> in this book for details on these parameters). There are two versions of this algorithm, the continuous that is excruciatingly slow (particularly for larger datasets) and the discontinuous that is a bit quicker but has less desirable statistical properties. We are using the number of events per point as the weight for computation, and wrapping everything on <code>system.time()</code> to provide a notion of computation time. We will only show the discontinuous version.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="chapter-8-crime-along-spatial-networks.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d_okabe <span class="ot">&lt;-</span> <span class="fu">densityEqualSplit</span>(chi_viol_lpp, </span>
<span id="cb412-2"><a href="chapter-8-crime-along-spatial-networks.html#cb412-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">weights =</span> <span class="fu">marks</span>(chi_viol_lpp), </span>
<span id="cb412-3"><a href="chapter-8-crime-along-spatial-networks.html#cb412-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sigma =</span> <span class="dv">60</span>,</span>
<span id="cb412-4"><a href="chapter-8-crime-along-spatial-networks.html#cb412-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">continuous =</span> <span class="cn">FALSE</span>,</span>
<span id="cb412-5"><a href="chapter-8-crime-along-spatial-networks.html#cb412-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">verbose=</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   7.570   0.122   7.712</code></pre>
<p>And to visualise:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="chapter-8-crime-along-spatial-networks.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_okabe, <span class="at">main=</span><span class="st">&quot;Okabe-Suhigara (disc.)&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-247"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-247-1.png" alt="Network density map (Okabe-Suhigara (disc.) method)" width="672" />
<p class="caption">
FIGURE 9.13: Network density map (Okabe-Suhigara (disc.) method)
</p>
</div>
<p><span class="citation"><a href="#ref-McSwiggan_2016" role="doc-biblioref">McSwiggan, Baddeley, and Nair</a> (<a href="#ref-McSwiggan_2016" role="doc-biblioref">2016</a>)</span> subsequently developed an algorithm that is equivalent to the Okabe-Suhigara method using the continuous rule applied to the Gaussian kernel, and therefore has more desirable properties than the equal split discontinuous, but that runs faster (than the Okabe-Suhigara equal split continuous version).</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="chapter-8-crime-along-spatial-networks.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d_mcswiggan <span class="ot">&lt;-</span> <span class="fu">densityHeat.lpp</span>(chi_viol_lpp, </span>
<span id="cb415-2"><a href="chapter-8-crime-along-spatial-networks.html#cb415-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">weights =</span> <span class="fu">marks</span>(chi_viol_lpp), </span>
<span id="cb415-3"><a href="chapter-8-crime-along-spatial-networks.html#cb415-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sigma =</span> <span class="dv">60</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##  304.24   58.14  363.38</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="chapter-8-crime-along-spatial-networks.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_mcswiggan, <span class="at">main=</span><span class="st">&quot;McSwiggan&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-249"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-249-1.png" alt="Network density map (McSwiggan Gaussian method)" width="672" />
<p class="caption">
FIGURE 9.14: Network density map (McSwiggan Gaussian method)
</p>
</div>
<p>Finally, as noted above, <span class="citation"><a href="#ref-Rakshit_2019" role="doc-biblioref">Rakshit et al.</a> (<a href="#ref-Rakshit_2019" role="doc-biblioref">2019</a>)</span> developed a fast algorithm, using a convolution method, that is particularly helpful with large datasets. The analysis of the authors suggest this estimator “is consistent, and its statistical efficiency is only slightly suboptimal” <span class="citation">(<a href="#ref-Rakshit_2019" role="doc-biblioref">Rakshit et al. 2019</a>)</span>.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="chapter-8-crime-along-spatial-networks.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(d_rakshit <span class="ot">&lt;-</span> <span class="fu">densityQuick.lpp</span>(chi_viol_lpp, </span>
<span id="cb418-2"><a href="chapter-8-crime-along-spatial-networks.html#cb418-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">weights =</span> <span class="fu">marks</span>(chi_viol_lpp), </span>
<span id="cb418-3"><a href="chapter-8-crime-along-spatial-networks.html#cb418-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sigma =</span> <span class="dv">60</span>,</span>
<span id="cb418-4"><a href="chapter-8-crime-along-spatial-networks.html#cb418-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">edge2D =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.116   0.011   0.128</code></pre>
<p>We can now plot the data and compare the results:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="chapter-8-crime-along-spatial-networks.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d_rakshit, <span class="at">main=</span><span class="st">&quot;Rakshit&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-251"></span>
<img src="crime_mapping_files/figure-html/unnamed-chunk-251-1.png" alt="Network density map (Rakshit method)" width="672" />
<p class="caption">
FIGURE 9.15: Network density map (Rakshit method)
</p>
</div>
<p>So these are some ways in which we can create a density map of crime along networks. You can compare the three maps to see how choice of method affects conclusions. This is something we must always reflect on, when applying these techniques.</p>
</div>
<div id="summary-and-further-reading-7" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Summary and further reading</h2>
<p>The focus in this chapter has been to introduce the issue of crime events along a network. There has been increasing recognition in recent years that the spatial existence of many phenomena is constrained by networks. We have discussed some of the issues associated with the storage, handling, and visualisation of this kind of data. Chapter 1 of <span class="citation"><a href="#ref-Okabe_2012" role="doc-biblioref">Okabe and Sugihara</a> (<a href="#ref-Okabe_2012" role="doc-biblioref">2012</a>)</span> provides a fairly accessible introduction to the relevance of point pattern data along a network, whereas Chapter 3 offers a slightly more technical discussion of the computational issues associated with the statistical analysis of points along a network. The first few sections of Chapter 17 of <span class="citation"><a href="#ref-Baddeley_2016" role="doc-biblioref">Baddeley, Rubak, and Turner</a> (<a href="#ref-Baddeley_2016" role="doc-biblioref">2015</a>)</span> provides background and very useful detail on the way that <code>spatstat</code> handles and stores point pattern data in a network. <span class="citation"><a href="#ref-Baddeley_2021" role="doc-biblioref">Baddeley et al.</a> (<a href="#ref-Baddeley_2021" role="doc-biblioref">2021</a>)</span> offers an excellent overview of the challenges of analysing this kind of data and the available methods we have. This overview can also offers an excellent framework to understand the issues of clustering and detection of local clusters along networks to which we will return in the next two chapters.</p>
<p>But spatial networks analysis is a more general area, with various other applications that we could not explore in detail here. <span class="citation"><a href="#ref-OSullivan_2014" role="doc-biblioref">O´Sullivan</a> (<a href="#ref-OSullivan_2014" role="doc-biblioref">2014</a>)</span> provides an introduction to spatial network analysis, basically a translation of social network metrics and concepts applied to spatial networks. This kind of perspective is particularly helpful within transport, routing, and similar applications. See, for example, the kind of functionality and applications provided by <code>stplanr</code>. We are also witnessing cross fertilisation between social network analysis and spatial analysis. In epidemiology, for example, we see how this is done for studying the transmission of disease through personal networks and geographic (see, for example, <span class="citation"><a href="#ref-Emch_2010" role="doc-biblioref">Emch et al.</a> (<a href="#ref-Emch_2010" role="doc-biblioref">2010</a>)</span>). Whereas <span class="citation"><a href="#ref-Radil_2010" role="doc-biblioref">Radil, Flint, and Tita</a> (<a href="#ref-Radil_2010" role="doc-biblioref">2010</a>)</span> and <span class="citation"><a href="#ref-Tita_2011" role="doc-biblioref">Tita and Radil</a> (<a href="#ref-Tita_2011" role="doc-biblioref">2011</a>)</span> offer some criminological examples (focused on the study of gangs) linking social network analysis and spatial analysis. Along these lines, the package <code>spnet</code> facilitates the rendering of social network data into a geographical space. Some of these applications can be relevant for investigative crime analysis and other criminological uses. Finally, another way in which social networks are being used within the context of environmental criminology is in contributing to the alternative specifications of neighbourhoods that aim to move beyond the traditional use of census geographies (see <span class="citation"><a href="#ref-Hipp_2012" role="doc-biblioref">Hipp, Faris, and Boessen</a> (<a href="#ref-Hipp_2012" role="doc-biblioref">2012</a>)</span> and <span class="citation"><a href="#ref-Hipp_2013" role="doc-biblioref">Hipp and Boessen</a> (<a href="#ref-Hipp_2013" role="doc-biblioref">2013</a>)</span>). Finally, it is also worth exploring the literature on <strong>space syntax</strong> and crime, and the various analysis that are looking at the structural characteristics of the street network (such as betweenness) and how it influences crime <span class="citation">(<a href="#ref-Davies_2018" role="doc-biblioref">Toby Davies and Bowers 2018</a>; <a href="#ref-Kim_2019" role="doc-biblioref">Kim, John, and Hipp 2019</a>)</span>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Abad_2019" class="csl-entry">
Abad, Lorena, Robin Lovelace, and Lucas van der Meer. 2019. <span>“Spatial Networks in r with Sf and Tidygraph.”</span> <a href="https://r-spatial.org/r/2019/09/26/spatial-networks.html">https://r-spatial.org/r/2019/09/26/spatial-networks.html</a>.
</div>
<div id="ref-Baddeley_2021" class="csl-entry">
Baddeley, Adrian, Gopalan Nair, Suman Rakshit, Greg McSwiggan, and Tilman Davies. 2021. <span>“Analysing Point Patterns on Networks — a Review.”</span> <em>Spatial Statistics</em> 42: doi.org/10.1016/j.spasta.2020.100435.
</div>
<div id="ref-Baddeley_2016" class="csl-entry">
Baddeley, Adrian, Ege Rubak, and Rolf Turner. 2015. <em>Spatial Point Patterns: Methodology and Applications with r</em>. Boca Ratón: CRC Press.
</div>
<div id="ref-BrizRedon_2019a" class="csl-entry">
Briz-Redón, Álvaro, Francisco Martı́nez-Ruiz, and Francisco Montes. 2019a. <span>“DRHotNet: An r Package for Detecting Differential Risk Hotspots on a Linear Network.”</span> <a href="http://arxiv.org/abs/1911.07827">http://arxiv.org/abs/1911.07827</a>.
</div>
<div id="ref-BrizRedon_2019b" class="csl-entry">
———. 2019b. <span>“Identification of Differential Risk Hotspots for Collision and Vehicle Type in a Directed Linear Network.”</span> <em>Accident Analysis and Prevention</em>, doi.org/10.1016/j.aap.2019.105278.
</div>
<div id="ref-Ceccato_2013" class="csl-entry">
Ceccato, Vania. 2013. <em>Moving Safely: Crime and Perceived Safety in Stockholm’s Subway Stations</em>. Lanham: Lexington Books.
</div>
<div id="ref-Davies_2018" class="csl-entry">
Davies, Toby, and Kate Bowers. 2018. <span>“Street Networks and Crime.”</span> In <em>The Oxford Handbook of Environmental Criminology</em>, edited by Gerben Bruinsma and Shane Johnson, 545–78. New York: Oxford University Press.
</div>
<div id="ref-Emch_2010" class="csl-entry">
Emch, Michael, Elisabeth Root, Sophia Giebultowicz, Mohammad Ali, Carolina Perez-Heydrich, and Mohammad Yunus. 2010. <span>“Integration of Spatial and Social Network Analysis in Disease Transmission Studies.”</span> <em>CAnnals of the Association of American Geographers</em> 102 (5): 1004–15.
</div>
<div id="ref-gastwirth1972estimation" class="csl-entry">
Gastwirth, Joseph L. 1972. <span>“The Estimation of the Lorenz Curve and Gini Index.”</span> <em>The Review of Economics and Statistics</em>, 306–16.
</div>
<div id="ref-Gelb_2021" class="csl-entry">
Gelb, Jeremy. 2021. <em>spNetwork: Spatial Analysis on Network</em>. <a href="https://CRAN.R-project.org/package=spNetwork">https://CRAN.R-project.org/package=spNetwork</a>.
</div>
<div id="ref-Hipp_2013" class="csl-entry">
Hipp, John, and Adam Boessen. 2013. <span>“Egohoods as Waves Washing Across the City: A New Measure of "Neighborhoods".”</span> <em>Criminology</em> 51 (2): 287–327.
</div>
<div id="ref-Hipp_2012" class="csl-entry">
Hipp, John, Robert Faris, and Adam Boessen. 2012. <span>“Measuring <span>‘Neighborhood’</span>: Constructing Network Neighborhoods.”</span> <em>Social Networks</em> 34 (1): 128–40.
</div>
<div id="ref-Kim_2019" class="csl-entry">
Kim, Young‑A, John, and Hipp. 2019. <span>“Pathways: Examining Street Network Configurations, Structural Characteristics and Spatial Crime Patterns in Street Segments.”</span> <em>Journal of Quantitative Criminology</em> 36: 725–52.
</div>
<div id="ref-McSwiggan_2016" class="csl-entry">
McSwiggan, Greg, Adrian Baddeley, and Gopalan Nair. 2016. <span>“Kernel Density Estimation on a Linear Network.”</span> <em>Scandinavian Journal of Statistics</em> 44 (2): 324–45.
</div>
<div id="ref-Newton_2008" class="csl-entry">
Newton, Andrew David. 2008. <span>“A Study of Bus Route Crime Risk in Urban Areas: The Changing Environs of a Bus Journey.”</span> <em>Built Environment</em> 34 (1): 88–103.
</div>
<div id="ref-OSullivan_2014" class="csl-entry">
O´Sullivan, David. 2014. <span>“Spatial Network Analysis.”</span> In <em>Handbook of Regional Science</em>, edited by Manfred Fische and Peter Nijkamp, 1253–73. Heidelberg: Springer.
</div>
<div id="ref-Okabe_2012" class="csl-entry">
Okabe, Atsuyuki, and Kokichi Sugihara. 2012. <em>Spatial Analysis Along Networks</em>. Chichester: John Wiley; Sons.
</div>
<div id="ref-Radil_2010" class="csl-entry">
Radil, Steven, Colin Flint, and George Tita. 2010. <span>“Spatializing Social Networks: Using Social Network Analysis to Investigate Geographies of Gang Rivalry, Territoriality, and Violence in Los Angeles.”</span> <em>Annals of the Association of American Geographers</em> 100 (2): 307–26.
</div>
<div id="ref-Rakshit_2019" class="csl-entry">
Rakshit, Suman, Tilman Davies, M Mehdi-Moradi, Greg McSwiggan, Gopalan Nair, Jorge Mateu, and Adrian Baddeley. 2019. <span>“Fast Kernel Smoothing of Point Patterns on a Large Network Using Two-Dimensional Convolution.”</span> <em>International Statistical Review</em> 87 (3): 531–56.
</div>
<div id="ref-Rosser_2017" class="csl-entry">
Roser, Gabriel, Toby Davies, Kate Bowers, Shane Johnson, and Tao Cheng. 2017. <span>“Predictive Crime Mapping: Arbitrary Grids or Street Networks?”</span> <em>Journal of Quantitative Criminology</em> 33: 569–94.
</div>
<div id="ref-Singleton_2014" class="csl-entry">
Singleton, Alex, and Chris Brunsdon. 2014. <span>“Escaping the Pushpin Paradigm in Geographic Information Science: (Re)presenting National Crime Data.”</span> <em>Area</em> 46 (3): 294–304.
</div>
<div id="ref-Solymosi_2017" class="csl-entry">
Solymosi, Reka, Matthew Ashby, Tom Cohen, and Aiden Sidebottom. 2017. <span>“Alternative Denominators in Transport Crime Rates.”</span>
</div>
<div id="ref-Spicer_2016" class="csl-entry">
Spicer, Valerie, Justin Song, Patricia L Brantingham, Andrew Park, and Martin A Andresen. 2016. <span>“Street Profile Analysis: A New Method for Mapping Crime on Major Roadways.”</span> <em>Applied Geography</em> 69: 65–74.
</div>
<div id="ref-Tita_2011" class="csl-entry">
———. 2011. <span>“Spatializing the Social Networks of Gangs to Explore Patterns of Violence.”</span> <em>Journal of Quantitative Criminology</em> 27: 521–45.
</div>
<div id="ref-Tompson_2009" class="csl-entry">
Tompson, Lisa, Henry Partridge, and Naomi Shepherd. 2009. <span>“Hot Routes: Developing a New Technique for the Spatial Analysis of Crime.”</span> <em>Crime Mapping: A Journal of Research and Practice</em> 1 (1): 77–96.
</div>
<div id="ref-Vandemeer_2021" class="csl-entry">
van der Meer, Lucas, Lorena Abad, Andrea Gilardi, and Robin Lovelace. 2021. <em>Sfnetworks: Tidy Geospatial Networks</em>. <a href="https://CRAN.R-project.org/package=sfnetworks">https://CRAN.R-project.org/package=sfnetworks</a>.
</div>
<div id="ref-Weisburd_2015" class="csl-entry">
Weisburd, David. 2015. <span>“The Law of Crime Concentration and the Criminology of Place.”</span> <em>Criminology</em> 53 (2): 133–57.
</div>
<div id="ref-zeileis2012package" class="csl-entry">
Zeileis, Achim, Christian Kleiber, and Maintainer Achim Zeileis. 2012. <span>“Package <span>‘Ineq’</span>.”</span> <em>Vienna: Comprehensive R Archive Network</em>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-7-spatial-point-patterns-of-crime-events.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-9-spatial-dependence-and-autocorrelation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/08-spatial_networks.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["crime_mapping.pdf", "crime_mapping.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
